<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>Control</title>
<meta http-equiv="Content-Type" Content="text/html; charset=utf-8">
<link rel="stylesheet" type="text/css" href="../../styles/styles.css">
<script language="javascript" src='../links.js' type="text/javascript"></script>
</head>

<body>

<h1>Control</h1>
<div class=navbar>
<a href="../index.html">главная</a> |
<a href="index.html">сервисные функции</a><br>
</div>

<div class=shortdescr>
Функция <dfn>Control</dfn> позволяет запрашивать различную информацию
и выполнять управляющие действия над панелями и командной строкой.
</div>

<pre class=syntax>
int WINAPI Control(
  HANDLE hPlugin,
  int Command,
  void *Param
);
</pre>

<h3>Параметры</h3>
<div class=descr>
  <div class=dfn>hPlugin</div>
  <div class=dfndescr>Текущий описатель плагина.
    При запросе информации относительно активной панели установите
    этот параметр равным <code>INVALID_HANDLE_VALUE</code>. Это позволяет
    использовать эту функцию в командах плагина без создания новой
    панели. Так же <code>INVALID_HANDLE_VALUE</code> можно использовать
    для неплагиновой панели.</div>

  <div class=dfn>Command</div>
  <div class=dfndescr>Тип команды. Может быть следующим <a name="FILE_CONTROL_COMMANDS">FILE_CONTROL_COMMANDS</a>):

<table class="cont">
<tr class="cont"><th class="cont" width="40%">Команда</th><th class="cont" width="60%">Описание</th></tr>
      <!-- панельные -->
<tr class="cont"><th class="cont" width="100%" colspan="2"><b>Панель</b></th></tr>
      <tr class="cont"><td class="cont" width="40%"><a name="FCTL_CHECKPANELSEXIST">FCTL_CHECKPANELSEXIST</a></td>
      <td class="cont" width="60%">Проверить доступность панелей.<br>
        <var>Param</var> = 0 (не используется).<br>
        Функция возвращает <code>FALSE</code>, если FAR запущен с ключами /e или /v (в
        качестве внешнего редактора или программы просмотра). В этом режиме панели
        не создаются.
          <p class=note><img src="../../images/note.gif" alt="Замечание для FCTL_CHECKPANELSEXIST" width="10" height="10"> Внимание!</p>
          <UL class=note><LI>
          В режиме, когда FAR запущен с ключами /e или /v, функция обрабатывает
          только одну эту команду - <dfn>FCTL_CHECKPANELSEXIST</dfn>.
          </LI></UL>

      </td></tr>

      <tr class="cont"><td class="cont" width="40%"><a name="FCTL_CLOSEPLUGIN">FCTL_CLOSEPLUGIN</a></td>
      <td class="cont" width="60%">Закрыть текущий плагин.<br><var>Param</var> указывает на имя
        каталога, который будет показан в панели после закрытия.<br>
        <!-- Если <var>Param</var> указывает на пустую строку или равен NULL,
        то панель после закрытия плагина не обновится.<br>
        Если <var>hPlugin</var> равен <code>INVALID_HANDLE_VALUE</code> -->
        </td></tr>

      <tr class="cont"><td class="cont" width="40%"><a name="FCTL_GETPANELINFO">FCTL_GETPANELINFO</a><br>
      <a name="FCTL_GETANOTHERPANELINFO">FCTL_GETANOTHERPANELINFO</a></td>
      <td class="cont" width="60%">Получить информацию о активной/пассивной панели плагина.<br>
      <var>Param</var>
        указывает на структуру <a href="../structures/panelinfo.html">PanelInfo</a>,
        которая получит информацию о панели.<br>
        PanelInfo.SelectedItemsNumber равно 1, если не выделено никаких
        элементов. В этом случае PanelInfo.SelectedItems содержит данные для
        элемента под курсором. Если вы хотите узнать, действительно ли выделен этот
        файл, то проверьте у него состояние флага <a href="../structures/pluginpanelitem.html#PPIF_SELECTED">PPIF_SELECTED</a>.
        <p>В процессе исполнения запроса
<pre class=code>Info.Control(INVALID_HANDLE_VALUE,
             FCTL_GETPANELINFO,
             &amp;PInfo);</pre>
        FAR вызывает экспортируемую функцию <a href="../exported_functions/getopenplugininfo.html">GetOpenPluginInfo</a>
        того плагина, которому принадлежит панель. FAR содержит защиту от
        бесконечной рекурсии: в случае, когда плагин из обработчика
        <code>GetOpenPluginInfo()</code> тоже вызывает
        <code>Info.Control(...,FCTL_GETPANELINFO)</code>, повторного
        вложенного вызова <code>GetOpenPluginInfo()</code> не произойдёт.
        <p>В некоторых случаях (пример: поиск в архивах по <kbd>Alt-F7</kbd>)
        физически панель плагина не создается, поэтому необходимо
        обязательно проверять код возврата у <dfn>Control</dfn>, чтобы не упасть в
        самый не подходящий момент, выполнив работу для панели, которой нет.

          <p class=note><img src="../../images/note.gif" alt="Замечание для FCTL_GET[ANOTHER]PANELINFO" width="10" height="10"> Внимание!</p>
          <UL class=note><LI>
          Поля PanelItems и SelectedItems структуры <a href="../structures/panelinfo.html">PanelInfo</a> после
          каждого вызова <dfn>FCTL_GETPANELINFO</dfn> или <dfn>FCTL_GETANOTHERPANELINFO</dfn> будут иметь
          разные адреса.
          </LI></UL>

        </td></tr>

      <tr class="cont"><td class="cont" width="40%"><a name="FCTL_GETPANELSHORTINFO">FCTL_GETPANELSHORTINFO</a><br>
      <a name="FCTL_GETANOTHERPANELSHORTINFO">FCTL_GETANOTHERPANELSHORTINFO</a></td>
      <td class="cont" width="60%">Аналогична FCTL_GETPANELINFO/FCTL_GETANOTHERPANELINFO, но поля PanelItems и
       SelectedItems структуры <a href="../structures/panelinfo.html">PanelInfo</a>
       не заполнены и равны <code>NULL</code>. Эта команда предназначена для получения общей
       информации о активной/пассивной панели без конкретных сведений об элементах панели.<br>
       </td></tr>


      <tr class="cont"><td class="cont" width="40%"><a name="FCTL_REDRAWPANEL">FCTL_REDRAWPANEL</a><br>
      <a name="FCTL_REDRAWANOTHERPANEL">FCTL_REDRAWANOTHERPANEL</a></td>
      <td class="cont" width="60%">Перерисовать активную/пассивную панель плагина.<br>
      <var>Param</var> - указатель
        на структуру <a href="../structures/panelredrawinfo.html">PanelRedrawInfo</a>, которой можно задать
        новые позиции курсора и верхнего элемента панели. Если <var>Param</var> равен NULL, то позиции курсора
        и верхнего элемента панели при прорисовке не изменяются.<br>
        Если <var>hPlugin</var> равен INVALID_HANDLE_VALUE, то перерисуется активная панель независимо от того, какую
        команду использовал плагин.<br>
        Панель прорисуется только в случае, если в данный момент панелей видны.
      </td></tr>

      <tr class="cont"><td class="cont" width="40%"><a name="FCTL_SETNUMERICSORT">FCTL_SETNUMERICSORT</a><br>
      <a name="FCTL_SETANOTHERNUMERICSORT">FCTL_SETANOTHERNUMERICSORT</a></td>
      <td class="cont" width="60%">Задает <a href="../dict.html#numericsort">числовой порядок</a> сортировки для активной/пассивной панели.<br>
      <var>Param</var> - указатель на целое число, задающий числовую сортировку:
      0 (отключить числовую сортировку) или 1 (включить числовую сортировку).<br>
      Значение <var>Param</var> равное NULL эквивалентно отключению числовой сортировки.
      </td></tr>

      <tr class="cont"><td class="cont" width="40%"><a name="FCTL_SETPANELDIR">FCTL_SETPANELDIR</a><br>
      <a name="FCTL_SETANOTHERPANELDIR">FCTL_SETANOTHERPANELDIR</a></td>
      <td class="cont" width="60%">Установить текущий каталог в активной/пассивной панели плагина.<br>
       <var>Param</var>
        указывает на имя каталога. Если плагин поддерживает
        свою собственную панель, он будет закрыт после
        выполнения этой команды.
        <p>После выполнения этой функции пропадет выделение с элементов каталога
        и его будет невозможно восстановить (комбинация <kbd>Ctrl-M</kbd>) по желанию
        пользователя, даже если новый каталог равен старому.
        </td></tr>

      <tr class="cont"><td class="cont" width="40%"><a name="FCTL_SETSELECTION">FCTL_SETSELECTION</a><br>
      <a name="FCTL_SETANOTHERSELECTION">FCTL_SETANOTHERSELECTION</a></td>
      <td class="cont" width="60%">Установить выделение в активной/пассивной панели.<br><var>Param</var> указывает
        на структуру <a href="../structures/panelinfo.html">PanelInfo</a>,
        заполненную предыдущими вызовами FCTL_GETPANELINFO или
        FCTL_GETANOTHERPANELINFO . Нельзя использовать другие
        функции <dfn>Control</dfn> между FCTL_GETPANELINFO и FCTL_SETSELECTION.
        <p>Для изменения выделения установите или
        очистите флаг PPIF_SELECTED у элементов массива,
        указатель на которое содержится в поле <dfn>PanelItems</dfn> структуры
        <a href="../structures/panelinfo.html">PanelInfo</a>.
        Обратите внимание, что FCTL_GETPANELINFO и FCTL_GETANOTHERPANELINFO
        устанавливают значение PPIF_SELECTED для элементов массива,
        соответствующее состоянию панели.
        <p>Нужно вызвать FCTL_REDRAWPANEL для показа изменений.
      </td></tr>

      <tr class="cont"><td class="cont" width="40%"><a name="FCTL_SETSORTMODE">FCTL_SETSORTMODE</a><br>
      <a name="FCTL_SETANOTHERSORTMODE">FCTL_SETANOTHERSORTMODE</a></td>
      <td class="cont" width="60%">Установить режим сортировки для активной/пассивной панели.
      <var>Param</var> - указатель на целое число, содержащее режим сортировки
      (см. "<a href="../defs/sortmetods.html">Режимы сортировки</a>").
      </td></tr>

      <tr class="cont"><td class="cont" width="40%"><a name="FCTL_SETSORTORDER">FCTL_SETSORTORDER</a><br>
      <a name="FCTL_SETANOTHERSORTORDER">FCTL_SETANOTHERSORTORDER</a></td>
      <td class="cont" width="60%">Задает порядок сортировки для активной/пассивной панели.<br>
      <var>Param</var> - указатель на целое число, содержащее порядок сортировки:
      0 или 1 (обратная сортировка).<br>
      Значение <var>Param</var> равное NULL эквивалентно установки прямого порядка сортировки (0).
      </td></tr>

      <tr class="cont"><td class="cont" width="40%"><a name="FCTL_SETVIEWMODE">FCTL_SETVIEWMODE</a><br>
      <a name="FCTL_SETANOTHERVIEWMODE">FCTL_SETANOTHERVIEWMODE</a></td>
      <td class="cont" width="60%">Установить режим просмотра активной/пассивной панели.<br><var>Param</var>
        указывает на целое значение, которое содержит номер нового режима, от 0 до 9.<br>
        Значение <var>Param</var> равное NULL эквивалентно установки режима 0.</td></tr>

      <tr class="cont"><td class="cont" width="40%"><a name="FCTL_UPDATEPANEL">FCTL_UPDATEPANEL</a><br>
      <a name="FCTL_UPDATEANOTHERPANEL">FCTL_UPDATEANOTHERPANEL</a></td>
      <td class="cont" width="60%">Обновить содержимое активной/пассивной панели плагина.<br>
        Если <var>Param</var> равен <code>NULL</code>, текущее выделение файлов
        будет снято, иначе выделение не изменится.</td></tr>

      <!-- ком.строка -->
<tr class="cont"><th class="cont" width="100%" colspan="2"><b>Командная строка</b></th></tr>
      <tr class="cont"><td class="cont" width="40%"><a name="FCTL_GETCMDLINE">FCTL_GETCMDLINE</a></td>
      <td class="cont" width="60%">Получить содержимое командной строки.<br><var>Param</var>
        указывает на буфер, который получит данные
        (должен быть не меньше 1 Kb).</td></tr>

      <tr class="cont"><td class="cont" width="40%"><a name="FCTL_GETCMDLINEPOS">FCTL_GETCMDLINEPOS</a></td>
      <td class="cont" width="60%">Получить позицию курсора в командной строке.<br>
      <var>Param</var> содержит указатель на переменную типа int, в которую будет помещена позиция курсора.
      </td></tr>

      <tr class="cont"><td class="cont" width="40%"><a name="FCTL_GETCMDLINESELECTEDTEXT">FCTL_GETCMDLINESELECTEDTEXT</a></td>
      <td class="cont" width="60%">Получить выделенный текст из командной строки.<br>
      <var>Param</var> указывает на буфер, который получит данные (должен быть не меньше 1 Kb).</td></tr>

      <tr class="cont"><td class="cont" width="40%"><a name="FCTL_GETCMDLINESELECTION">FCTL_GETCMDLINESELECTION</a></td>
      <td class="cont" width="60%">Получить параметры выделенного текста командной строки.<br>
      <var>Param</var> указывает на структуру <a href="../structures/cmdlineselect.html">CmdLineSelect</a>.</td></tr>


      <tr class="cont"><td class="cont" width="40%"><a name="FCTL_INSERTCMDLINE">FCTL_INSERTCMDLINE</a></td>
      <td class="cont" width="60%">Вставить текст в командную строку, начиная с текущей позиции курсора.<br>
       <var>Param</var> указывает на строку, оканчивающуюся нулем, которая будет вставлена в командную строку.</td></tr>

      <tr class="cont"><td class="cont" width="40%"><a name="FCTL_SETCMDLINE">FCTL_SETCMDLINE</a></td>
      <td class="cont" width="60%">Установить содержимое командной строки.<br><var>Param</var>
        указывает на строку, оканчивающуюся нулем, которая будет помещена в командную строку.</td></tr>

      <tr class="cont"><td class="cont" width="40%"><a name="FCTL_SETCMDLINEPOS">FCTL_SETCMDLINEPOS</a></td>
      <td class="cont" width="60%">Установить позицию курсора в командной строке.<br>
      <var>Param</var> содержит указатель на переменную типа int - позиция курсора.
      </td></tr>

      <tr class="cont"><td class="cont" width="40%"><a name="FCTL_SETCMDLINESELECTION">FCTL_SETCMDLINESELECTION</a></td>
      <td class="cont" width="60%">Выделить текст командной строки.<br>
      <var>Param</var> указывает на структуру <a href="../structures/cmdlineselect.html">CmdLineSelect</a>.</td></tr>


      <!-- прочие -->
<tr class="cont"><th class="cont" width="100%" colspan="2"><b>Прочие</b></th></tr>
      <tr class="cont"><td class="cont" width="40%"><a name="FCTL_SETUSERSCREEN">FCTL_SETUSERSCREEN</a></td>
      <td class="cont" width="60%">Копиpует текущее содеpжимое экpана в буфеp
        пользовательского экрана FAR (он показывается, когда панели убpаны).<br>
        <var>Param</var> должен быть <code>NULL</code>.
      </td></tr>

      <tr class="cont"><td class="cont" width="40%"><a name="FCTL_GETUSERSCREEN">FCTL_GETUSERSCREEN</a></td>
      <td class="cont" width="60%">Выводит буфеp пользовательского экрана FAR (он показывается, когда панели убpаны)
        на экpан.<br>
        <var>Param</var> должен быть <code>NULL</code>.
      </td></tr>
</table>
  </div>
  <div class=dfn>Param</div>
  <div class=dfndescr>Указывает на параметры команды. Смотрите
    описание <dfn>Command</dfn>
  </div>

</div>

<h3>Возвращаемое значение</h3>
<div class=descr>
  В случае успеха возвращается TRUE, иначе FALSE.
</div>

<h3>Замечания</h3>
<div class=descr>
  Обычно вы не должны обновлять или перерисовывать панель и директивно
  закрывать плагин. FAR делает это сам, при выполнении стандартных операций.
  Эти функции могут быть необходимыми для реализации некоторых нестандартных
  функциональных возможностей.
</div>

<div class=see>Смотрите также:</div><div class=seecont>
<a href="advcontrol.html">AdvControl</a>,
<a href="editorcontrol.html">EditorControl</a>
</div>

</body>
</html>