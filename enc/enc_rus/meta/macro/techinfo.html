<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>

<head>
<title>Технические подробности - Макросы</title>
<meta http-equiv="Content-Type" Content="text/html; charset=utf-8">
<link rel="stylesheet" type="text/css" href="../../styles/styles.css">
</head>

<body>

<h1>Технические подробности</h1>
<div class="navbar">
<a href="../index.html">главная</a> |
<a href="index.html">Макросы</a>
</div>

<a name="register"></a>
<h3>Хранение макросов</h3>
<p>Все макрокоманды хранятся в ветке реестра <code>[HKEY_CURRENT_USER\Software\Far\[Users\USERNAME\]KeyMacros]</code>
в текстовом виде.
<p>Макрокоманды делятся на 16 областей действий (см. <a href="about/macroarea.html">Области действия</a>) и 2 области для хранения глобальных переменных и констант.
Имя области соответствует ветке реестра:
<table class="cont">
  <tr class="cont">
    <th class="cont" width="40%">Область</th>
    <th class="cont" width="60%">Назначение</th>
  </tr>
  <tr class="cont">
    <td class="cont" width="40%">&quot;Shell&quot;</td>
    <td class="cont" width="60%">Файловые панели</td>
  </tr>
  <tr class="cont">
    <td class="cont" width="40%">&quot;Viewer&quot;</td>
    <td class="cont" width="60%">Внутренняя программа просмотра</td>
  </tr>
  <tr class="cont">
    <td class="cont" width="40%">&quot;Editor&quot;</td>
    <td class="cont" width="60%">Редактор</td>
  </tr>
  <tr class="cont">
    <td class="cont" width="40%">&quot;Dialog&quot;</td>
    <td class="cont" width="60%">Диалоги</td>
  </tr>
  <tr class="cont">
    <td class="cont" width="40%">&quot;Search&quot;</td>
    <td class="cont" width="60%">Быстрый поиск в панелях</td>
  </tr>
  <tr class="cont">
    <td class="cont" width="40%">&quot;Disks&quot;</td>
    <td class="cont" width="60%">Меню выбора дисков</td>
  </tr>
  <tr class="cont">
    <td class="cont" width="40%">&quot;MainMenu&quot;</td>
    <td class="cont" width="60%">Основное меню</td>
  </tr>
  <tr class="cont">
    <td class="cont" width="40%">&quot;Menu&quot;</td>
    <td class="cont" width="60%">Прочие меню</td>
  </tr>
  <tr class="cont">
    <td class="cont" width="40%">&quot;Help&quot;</td>
    <td class="cont" width="60%">Система помощи</td>
  </tr>
  <tr class="cont">
    <td class="cont" width="40%">&quot;Info&quot;</td>
    <td class="cont" width="60%">Информационная панель</td>
  </tr>
  <tr class="cont">
    <td class="cont" width="40%">&quot;QView&quot;</td>
    <td class="cont" width="60%">Панель быстрого просмотра</td>
  </tr>
  <tr class="cont">
    <td class="cont" width="40%">&quot;Tree&quot;</td>
    <td class="cont" width="60%">Панель дерева папок</td>
  </tr>
  <tr class="cont">
    <td class="cont" width="40%">&quot;FindFolder&quot;</td>
    <td class="cont" width="60%">Панель поиска папок</td>
  </tr>
  <tr class="cont">
    <td class="cont" width="40%">&quot;UserMenu&quot;</td>
    <td class="cont" width="60%">Пользовательское меню</td>
  </tr>
  <tr class="cont">
    <td class="cont" width="40%">&quot;Other&quot;</td>
    <td class="cont" width="60%">Режим копирования текста с экрана</td>
  </tr>
  <tr class="cont">
    <td class="cont" width="40%">&quot;Common&quot;</td>
    <td class="cont" width="60%">Макросы из этой области работают везде. FAR просматривает эту область последней.</td>
  </tr>
  <tr class="cont">
    <td class="cont" width="40%">&quot;Vars&quot;</td>
    <td class="cont" width="60%">Область для глобальных переменных, которые FAR считывает при старте.
    Переменные могут быть двух типов - строковые (типа REG_SZ) и числовые (типа REG_QWORD). В эту область можно писать
    с помощью функции <a href="macrocmd/functions.html#msave">msave()</a></td>
  </tr>
  <tr class="cont">
    <td class="cont" width="40%">&quot;Consts&quot;</td>
    <td class="cont" width="60%">Область для глобальных констант, которые FAR считывает при старте.
    Константы могут быть двух типов - строковые (типа REG_SZ) и числовые (типа REG_QWORD). </td>
  </tr>
</table>

<p>В областях на каждую макрокоманду в реестре заводится
отдельная ветвь с именем назначенной клавиши. Макрокоманда
описывается определенным набором значений:
<table class="cont">
  <tr class="cont">
    <th class="cont" width="25%">Имя</th>
    <th class="cont" width="10%">Тип</th>
    <th class="cont" width="10%">Default</th>
    <th class="cont" width="55%">Описание</th>
  </tr>
  <tr class="cont">
    <td class="cont" width="25%">Sequence</td>
    <td class="cont" width="10%">REG_SZ<br>REG_MULTI_SZ</td>
    <td class="cont" width="10%">&nbsp;</td>
    <td class="cont" width="55%">Последовательность клавиш.</td>
  </tr>
  <tr class="cont">
    <td class="cont" width="25%">DisableOutput</td>
    <td class="cont" width="10%">REG_DWORD</td>
    <td class="cont" width="10%">0</td>
    <td class="cont" width="55%">Запретить на время выполнения вывод на экран. При записи нового
      макроса значение этого параметра выставляется в 1 (запретить вывод на экран). Если
      параметр отсутствует, то вывод на экран во время исполнения макроса разрешен.</td>
  </tr>
  <tr class="cont">
    <td class="cont" width="25%">RunAfterFARStart</td>
    <td class="cont" width="10%">REG_DWORD</td>
    <td class="cont" width="10%">0</td>
    <td class="cont" width="55%">Выполнять после запуска FAR. Флаг актуален только для макросов, стартующих в области <dfn>Shell</dfn>.</td>
  </tr>
  <tr class="cont">
    <td class="cont" width="25%">EmptyCommandLine</td>
    <td class="cont" width="10%">REG_DWORD</td>
    <td class="cont" width="10%">0</td>
    <td class="cont" width="55%">Выполнять, только если командная строка пуста</td>
  </tr>
  <tr class="cont">
    <td class="cont" width="25%">NotEmptyCommandLine</td>
    <td class="cont" width="10%">REG_DWORD</td>
    <td class="cont" width="10%">0</td>
    <td class="cont" width="55%">Выполнять, только если командная строка не
      пуста</td>
  </tr>
  <tr class="cont">
    <td class="cont" width="25%">NoFilePanels</td>
    <td class="cont" width="10%">REG_DWORD</td>
    <td class="cont" width="10%">0</td>
    <td class="cont" width="55%">Не выполнять для файловой панели</td>
  </tr>
  <tr class="cont">
    <td class="cont" width="25%">NoFilePPanels</td>
    <td class="cont" width="10%">REG_DWORD</td>
    <td class="cont" width="10%">0</td>
    <td class="cont" width="55%">Не выполнять если пассивная панель - файловая</td>
  </tr>
  <tr class="cont">
    <td class="cont" width="25%">NoPluginPanels</td>
    <td class="cont" width="10%">REG_DWORD</td>
    <td class="cont" width="10%">0</td>
    <td class="cont" width="55%">Не выполнять для плагиновой панели</td>
  </tr>
  <tr class="cont">
    <td class="cont" width="25%">NoPluginPPanels</td>
    <td class="cont" width="10%">REG_DWORD</td>
    <td class="cont" width="10%">0</td>
    <td class="cont" width="55%">Не выполнять если пассивная панель - плагиновая</td>
  </tr>
  <tr class="cont">
    <td class="cont" width="25%">NoFolders</td>
    <td class="cont" width="10%">REG_DWORD</td>
    <td class="cont" width="10%">0</td>
    <td class="cont" width="55%">Не выполнять если текущий элемент - папка</td>
  </tr>
  <tr class="cont">
    <td class="cont" width="25%">NoPFolders</td>
    <td class="cont" width="10%">REG_DWORD</td>
    <td class="cont" width="10%">0</td>
    <td class="cont" width="55%">Не выполнять если текущий элемент - папка (пассивная
      панель)</td>
  </tr>
  <tr class="cont">
    <td class="cont" width="25%">NoFiles</td>
    <td class="cont" width="10%">REG_DWORD</td>
    <td class="cont" width="10%">0</td>
    <td class="cont" width="55%">Не выполнять если текущий элемент - файл</td>
  </tr>
  <tr class="cont">
    <td class="cont" width="25%">NoPFiles</td>
    <td class="cont" width="10%">REG_DWORD</td>
    <td class="cont" width="10%">0</td>
    <td class="cont" width="55%">Не выполнять если текущий элемент - файл (пассивная
      панель)</td>
  </tr>
  <tr class="cont">
    <td class="cont" width="25%">Selection</td>
    <td class="cont" width="10%">REG_DWORD</td>
    <td class="cont" width="10%">0</td>
    <td class="cont" width="55%">Выполнять, только если на панели есть
      отмеченные файлы/папки</td>
  </tr>
  <tr class="cont">
    <td class="cont" width="25%">PSelection</td>
    <td class="cont" width="10%">REG_DWORD</td>
    <td class="cont" width="10%">0</td>
    <td class="cont" width="55%">Выполнять, только если на панели есть
      отмеченные файлы/папки (пассивная панель)</td>
  </tr>
  <tr class="cont">
    <td class="cont" width="25%">NoSelection</td>
    <td class="cont" width="10%">REG_DWORD</td>
    <td class="cont" width="10%">0</td>
    <td class="cont" width="55%">Выполнять, если нет отмеченных файлов/папок (пассивная
      панель)</td>
  </tr>
  <tr class="cont">
    <td class="cont" width="25%">NoPSelection</td>
    <td class="cont" width="10%">REG_DWORD</td>
    <td class="cont" width="10%">0</td>
    <td class="cont" width="55%">Выполнять, если нет отмеченных файлов/папок (пассивная
      панель)</td>
  </tr>
  <tr class="cont">
    <td class="cont" width="25%">EVSelection</td>
    <td class="cont" width="10%">REG_DWORD</td>
    <td class="cont" width="10%">0</td>
    <td class="cont" width="55%">Выполнять, если отмечен блок в редакторе,
      программе просмотра, в строках ввода в диалогах.</td>
  </tr>
  <tr class="cont">
    <td class="cont" width="25%">NoEVSelection</td>
    <td class="cont" width="10%">REG_DWORD</td>
    <td class="cont" width="10%">0</td>
    <td class="cont" width="55%">Выполнять, если не отмечен блок в редакторе,
      программе просмотра, в строках ввода в диалогах.</td>
  </tr>
  <tr class="cont">
    <td class="cont" width="25%">NoSendKeysToPlugins</td>
    <td class="cont" width="10%">REG_DWORD</td>
    <td class="cont" width="10%">0</td>
    <td class="cont" width="55%">Специальный режим: нажимаемые клавиши при
      записи и воспроизведении не будут передаваться плагинам.</td>
  </tr>
  <tr class="cont">
    <td class="cont" width="25%">Description</td>
    <td class="cont" width="10%">REG_SZ</td>
    <td class="cont" width="10%">&nbsp;</td>
    <td class="cont" width="55%">Комментарий (не используется)</td>
  </tr>
</table>
<p>Обязательным является параметр &quot;Sequence&quot;, остальные могут
отсутствовать и принимать значение по умолчанию.
<p>Последовательность &quot;Sequence&quot; содержит строковое
представление макрокоманды. Каждая клавиша имеет свой строковый
эквивалент, разделителем клавиш является пробел или табуляция.
<p>При старте FAR компилирует последовательность &quot;Sequence&quot; во
внутренний байткод. Если в процессе компиляции обнаружена ошибка,
то макрос &quot;отбрасывается&quot; <a name="startmacro"></a>
<h3>Условия запуска макроса</h3>
<p>Перед исполнением макроса FAR проверяет условия запуска в
следующей последовательности:
<ol>
  <li>NoSendKeysToPlugins
  <li>EmptyCommandLine + NotEmptyCommandLine
  <li>NoFilePanels + NoPluginPanels
  <li>NoFilePPanels + NoPluginPPanels
  <li>NoFolders + NoFiles
  <li>NoPFolders + NoPFiles
  <li>Selection + NoSelection (если не в Viewer, Editor и Dialog)
  <li>PSelection + NoPSelection (если не в Viewer, Editor и Dialog)
  <li>EVSelection + NoEVSelection (если в Viewer, Editor и Dialog)
</ol>

<div class=see>Смотрите также:</div><div class=seecont>
<a href="about/index.html">Общие сведения</a>,
<a href="macrokey/index.html">Работа с макросами</a>,
<a href="macrocmd/index.html">Макроязык</a>,
<a href="examples.html">Примеры</a>
</div>

</body>

</html>
