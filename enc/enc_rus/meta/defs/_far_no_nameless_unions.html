<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>_FAR_NO_NAMELESS_UNIONS</title>
<meta http-equiv="Content-Type" Content="text/html; charset=utf-8">
<link rel="stylesheet" type="text/css" href="../../styles/styles.css">
<script language="javascript" src='../links.js' type="text/javascript"></script>
</head>

<body>
<h1>_FAR_NO_NAMELESS_UNIONS</h1>
<div class=navbar>
<a href="../index.html">главная</a> |
<a href="index.html">типы и определения</a>
</div>


<div class=shortdescr>
Mакроопределение _FAR_NO_NAMELESS_UNIONS определяет, будут ли в структуре
<a href="../dialogapi/structures/fardialogitem.html">FarDialogItem</a>
использоваться неименованные объединения (union). Такие конструкции
допустимы стандартом C++, но не в ANSI C.

<p>
Если <b>не определено</b> макроопределение <dfn>_FAR_NO_NAMELESS_UNIONS</dfn>, структура
<code>FarDialogItem</code> имеет вид, совместимый с FAR 1.65 и FAR 1.70
beta 3 и более ранними. При этом структура
<a href="../dialogapi/structures/fardialogitem.html">FarDialogItem</a>
будет иметь следующий вид:

<pre class="code">
struct FarDialogItem
{
  ...
  union {
    int Selected;
    char *History;
    char *Mask;
    struct FarList *ListItems;
    CHAR_INFO *VBuf;
  <span class="alert3">};</span>
  ...
  union {
    char Data[512];

    struct {
      DWORD PtrFlags;
      int   PtrLength;
      char *PtrData;
      char  PtrTail[1];
    } Ptr;
  <span class="alert3">};</span>
};
</pre>

Таким образом, для обращения, например, к полю <code>Data</code>
структуры <a href="../dialogapi/structures/fardialogitem.html">FarDialogItem</a>
достаточно будет писать <code>Data</code>, а к полю <code>Selected</code>
- <code>Selected</code>.

<p>Если <b>определено</b> макроопределение <dfn>_FAR_NO_NAMELESS_UNIONS</dfn>,
в структуре будут использоваться именованные объединения. При этом структура
будет совместима с компиляторами ANSI C, но не будет совместима на уровне
исходных текстов с плагинами, написанными для FAR 1.65. Структура будет иметь
следующий вид:

<pre class="code">
struct FarDialogItem
{
  ...
  union {
    int Selected;
    char *History;
    char *Mask;
    struct FarList *ListItems;
    CHAR_INFO *VBuf;
  <span class="alert3">} Param;</span>
  ...
  union {
    char Data[512];

    struct {
      DWORD PtrFlags;
      int   PtrLength;
      char *PtrData;
      char  PtrTail[1];
    } Ptr;
  <span class="alert3">} Data;</span>
};
</pre>

<p>В этом случае для обращения, например, к полю <code>Data</code> структуры
необходимо будет писать <code>Data.Data</code>, а к полю <code>Selected</code>
- <code>Param.Selected</code>.

<p>То или иное макроопределение должна быть объявлено перед
директивой <code>#include "plugin.hpp"</code>:
<pre class="code">
<b>#define _FAR_NO_NAMELESS_UNIONS</b>
#include "plugin.hpp"
</pre>

<p class=note><img src="../../images/warning.gif" alt="Внимание!" width="10" height="10"> Внимание!</p>
<UL class=note><LI>В FAR 1.70 beta 4 умолчанием является вариант,
совместимый со старыми плагинами, то есть, <dfn>_FAR_NO_NAMELESS_UNIONS</dfn> не определено.
Однако в FAR 1.70 release умолчанием станет новый вариант структуры -
<dfn>_FAR_NO_NAMELESS_UNIONS</dfn>. Поэтому если вы хотите, чтобы ваши
плагины были совместимы с версией 1.70 release, вы можете уже сейчас добавить
константу <dfn>_FAR_NO_NAMELESS_UNIONS</dfn> и внести соответствующие
модификации в исходный код ваших плагинов.
</LI></UL>

<div class=see>Смотрите также:</div><div class=seecont>
<a href="../exported_functions/getminfarversion.html">GetMinFarVersion</a>
</div>

</body>
</html>
