svs 10.04.2007 19:58:36 +0300 - build 

Без билда. Добавлен файл "TODO"

t-rex 10.04.2007 17:41:18 +0200 - build 2222

1. В 2220 погорячился немного, вернул и переделал проверку для не добавления "..".


svs 09.04.2007 20:31:34 +0300 - build 2221

1. Bug: В обработчике MCODE_OP_SAVE сначала нужно вытащить из стека значение,
        а потом остальным заниматься.

2. Добавлены макросы логирования:
   SYSLOG_KEYMACRO_PARSE/_KEYMACRO_PARSE()  - для парсера макросов
   SYSLOG_YJH/_YJH()                        - для Харона :-)

3. Остальное по мелочам - антураж при логировании макросов, etc.


t-rex 08.04.2007 17:29:06 +0200 - build 2220

1. Mantis#263 - ".." не всегда красились (а точнее когда мы их добавляли в ручную).
   В дополнении к этому убрал одну лишнюю по моему мнению проверку для
   НЕ добавления ".." даже если FindFile его нашел - раз нашел значит надо, я так думаю.


svs 07.04.2007 14:39:06 +0300 - build 2119

0. В проект добавлены файлы TVMStack.cpp и TVMStack.hpp 
   (реализация стека).

1. Нормальная реализация стека в макросах - был полный бардак, 
   как работало раньше - ХЗ. Например, $Text брал текст из вершины
   стека, но не удалял из стека это значение...
   Это позволило решить проблему с кодом возврата PlayMacro и,
   на будущее, исключить некоторые новые баги.

2. Если при исполнении $Text в стеке ничего нет (например, макрос
  "$Text _"), то ничего и не исполняется.

3. В ряд классов добавлены функции XXX::VMProcess()

4. В клавиши добавлен блок KEY_OP_BASE.
   В него входят аналоги некоторых макроопераций, которые невозможно
   исполнять в VMProcess (например, придется дублировать код из 
   ProcessKey).
   Имя таких аналогов начинается с KEY_OP_???
   Макродвижок сам подменяет макрокод на код нужной клавиши.

   Эта добавка (как и предыдущие и последующие) - небольшие 
   продвижения к...
   ...конечная цель: макрокоды должны иметь свои коды, отличные 
   от кодов клавишь.
   В будущем все обычные клавиши в байткоде будут ограничены кодами
   MCODE_OP_KEYS и MCODE_OP_ENDKEYS.

5. В редакторе добавлена обработка концов строк "\r\r\n"
   Увидеть такое чудо можно вот так: 
     ping localhost > file.txt
   Сохранение (SaveAs) с таким окончанием строк не предусмотрен.


svs 04.04.2007 14:28:14 +0300 - build 2218

1. Бага - постоянно собрасывается на английский
   Как повторить:
   - Выбираем русский язык интерфейса и справки; 
   - Язык нормально меняется; 
   - Выходим из FAR (установлен крыжик "Автосохранение настроек"); 
   - Загружаем FAR - язык русский; 
   - Выходим из FAR; 
   - Загружаем FAR снова и видим, что язык сбросился в английскй. Язык справки при этом не сбрасывается.

svs 03.04.2007 20:30:55 +0300 - build 2217

1. Фигня была с языками. 
   Например, убили FarEng.lng, в реестре при этом стоит Language/Main="English"
   Грузимся. Видим русский интерфейс.
   set FARLANG
   видим "English".

2. Mantis#0000092: Переопределение лейбов функциональных клавиш
   Ну, это фича, давно востребованная... В общем работает. :-)
   [HKCU\Software\Far\KeyLabels\ЯЗЫК\ОБЛАСТЬ]
   "ИМЯКЛАВИШИ"="Значение"

   Здесь
     ЯЗЫК       - так, как написано в LNG-файле, например,
                  English или Russian, т.е. тот, который в параметре
                  ".Language" идет первым после "=" и до ","
     ОБЛАСТЬ    - область действия в терминологии macro.
                  Понимаем области: Shell, Help, Edit, View, QView, Tree, Info
     ИМЯКЛАВИШИ - так, как они описываются в макросах.
                  Понимаются только функциональные "*F?" (что естественно :-))

3. Mantis#0000270: В показе установки атрибутов в пути до файла присутсвует SFN имена папок
   Хмм... что сказать, облажались. :-(
   Влиял параметр "System/FolderDeepScan", введенный в билде 2046, но не описанный.

   1.2.26.(TechInfo #76)
   ~~~~~~~~~~~~~~~~~~~~~
   [HKEY_CURRENT_USER\Software\Far\System]
   "FolderDeepScan":DWORD
   Параметр "System/FolderDeepScan" с типом DWORD позволяет обходить
   ограничения при работе с каталогами, в именах которых содержатся
   символы, некорректно преобразованные из ANSI в OEM.
   Если параметр включен (=1), то при обработке подобных каталогов будет
   произведена попытка получить информацию по короткому имени.
   Эта опция не влияет на работу механизма копирования.
   Может быть одним из следующих значений:
      0 - опция отключена;
      1 - так же использовать короткие имена;
   По умолчанию значение = 0 (работать только с длинными именами каталогов)


svs 02.04.2007 11:35:58 +0300 - build 2216

1. Функции GetFileDateAndTime, StrToDateTime и ReadFileTime 
   вынесены в отдельный модуль timefunc.cpp
   А то расплодилось...

2. Про FarSprintf и еже с ним. Вернем. Для старого борманда (на остальные 
   компилеры не влияет)

3. Macro: Легализация "$SelWord". Предполагалось несколько для других целей...

4. Macro: Локальная таблица переменных (типа TVarTable) теперь имеет отношение 
   только к текущей области исполнения.

5. Macro: в panelitem добавлено 3 индекса - 15-17, соответствующие 3-5, но имеющие
   тип FILETIME (для макросов это __int64)


yjh 01.04.2007 13:41:11 +0300 - 2215

1. Добавлена уточнённая (более корректная) диагностика при слишком длинном 
   (>MAX_PATH) полном имени файла, например, при попытке входа в каталог

2. Убраны последние предупреждения при компиляции vc8

yjh 31.03.2007 21:51:15 +0300 - 2214

1. Обойдён удар по памяти при подсчёте файлов в каталоге со слишком длинным 
   полным именем (полученном через subst) [mantis:0000271]

yjh 31.03.2007 04:41:45 +0300 - 2213

1. Убрана ошибка перераспределения памяти в обработке макросов (проявлялось в
   x64 и - теоретически - в висте)

yjh 31.03.2007 03:17:21 +0300 - 2212

1. Убрана ошибка на закрытии при отсуствующих панелях (gpf) - возникало,
   например, при запуске с /r

t-rex 30.03.2007 05:59:00 +0200

1. Мелкие обновления в мэйке. Включил ворнинги о x64 совместимости для всех видов сборок.


t-rex 30.03.2007 01:38:50 +0200 - 2211

1. PluginNumber в plugin.hpp теперь INT_PTR - нужно это сугубо на будущее
   для работы 1.7x x64 плагинов под будущим врапером в 1.80.
   Внутри фара всё осталось как и было, изменение чисто наружное.
   x64 плагины требуется пересобрать.

2. Убил последний ворнинг.


yjh 26.03.2007 06:48:19 +0300

1. Уточнение отмены "Перекрытых" ключей ulink в Far.mak

yjh 24.03.2007 02:28:48 +0300

1. Забыл убрать вывод замангленной мяпы ulink'ом


yjh 24.03.2007 02:25:19 +0300

1. Все компиляции с /W3 и убрано сохранение релокаций ulink'ом в w64


t-rex 23.03.2007 16:47:42 +0200

1. Несколько новых ключиков для улучшения размера exe.


t-rex 23.03.2007 01:57:32 +0200 - 2210

1. Напутал скобки в одном месте в прошлом билде.


t-rex 22.03.2007 19:53:58 +0200 - 2209

1. Пару мелких фиксов в системе сборки. В custom.*.bat больше не надо выставлять FARTRY.

2. Убрал ворнинги для VC32, VC64, GCC.

3. Из за 2 пофиксился ещё одни баг в x64 сборке - DialogParam внутри фара был long а не LONG_PTR.


yjh 21.03.2007 03:17:21 +0300 

1. Косметические правки в manager.cpp (64бит, исключительно для читабельности :)
   и в этом файле - в заголовке не было номера билда

yjh 21.03.2007 00:17:21 +0300 - build 2208

1. Доделана сборка отладочных билдов vc8 (32/64), а так жк "по заявкам 
   телезрителей" :) добавлена парочка ключей которая (потенциально)
   может дать выигрыш по размеру

2. Косметически правки в mkfar.mak (borland)

3. Сделана "нормальная" (без ассемблера кроме ud2 :) генерация исключений
   для ALPHA_VERSION

5. Добавлена "расшифровка" при exception по недопустимой/привелигированной
   инструкции

6. Для "нерасшифрованных" исключений выводится их код

7. Доделана нормальная отработка (показ) исключения по переполнению стека
   (и 32 и 64 бит версии)



yjh 18.03.2007 13:57:13 +0300

1. Доделки в сборке VC8 :) - убраны диагностики компилятора/линкера о 
   устаревших ключах.

2. Добавлен возможность компоновать ulink'ом - см. readme

3. Добавлена возможность передавать опции nmake - см. readme 



t-rex 15.03.2007 03:44:07 +0200 - build 2207

1. Собираемся под VC8 (проверял с WindowsSDK).

2. Из за 1 и вообще убрал
   int WINAPIV FarSprintf(char *buffer,const char *format,...);
   int WINAPIV FarSnprintf(char *buffer,size_t sizebuf,const char *format,...);
   int WINAPIV FarSscanf(const char *buffer, const char *format,...);
   так как не нужны, в FSF вставляются напрямую сами: sprintf, _snprintf, sscanf.


svs 14.03.2007 19:03:16 +0300 - build 2206

1. Mantis#268: ECTL_GETINFO может вернуть BlockStartLine = -1 
     Вызываю EditorControl c ECTL_SELECT и устанавливаю EditorSelect.BlockStartLine = -1 
     (подразумевается текущая строка, как это часто принято). Конкретно для этой операции
     в энциклопедии не указано, что -1 можно употребить. Но это работает (внешне). 
     Но это, похоже, приводит к тому, что следующий вызов EditorControl с ECTL_GETINFO 
     дает BlockStartLine = -1, и вот это уже неожиданно для остального кода, который 
     к этому не готов.
     Даже если EditorSelect.BlockStartLine = -1 недопустимо, ECTL_GETINFO не должен 
     возвращать некорретное значение BlockStartLine. 

2. В mix.cpp::GetDiskSize не "__int64", но "unsigned __int64"

svs 13.03.2007 20:10:37 +0300 - build 2205

1. GetDiskSize (mix.cpp) чудил на терабайтных томах. Там вообще какой-то странный алгоритм
   был...

2. Macro: +"N=playmacro(S)" - "проиграть" строку в макросе
          +"S=waitkey(N)"   - ждать клавишу (вернет строковое представление клавиши, 
                              или пусто по таймауту)

3. В связи с п.2 у функции GetInputRecord появился второй параметр (чтобы не вызывать повторно 
   макросы из макросов, т.к. нам нужна всего лишь реальная клавиша)
   + у WaitKey() тоже есть параметр - таймаут в ms

4. Небольшие заделы для SERVICEREGION (Editor)


t-rex 12.03.2007 19:56:02 +0200 - build 2204

1. Изменилась логика наследования в раскраске, теперь от того кто следующий
   наследуется всё кроме прозрачных элементов. А также добавил кнопочку "Make transparent".

2. В фильрах "панели" если выбраны несколько фильтров то делается AND.

3. Добавил текст в заголовке меню фильтров для описания D?,D-,D+.


warp 03.03.2007 00:54:00 +0300 - build 2203

1. Элементы диалога типа DI_LISTBOX не ловили клик мышью в DN_MOUSECLICK 
   отличный от FROM_LEFT_1ST_BUTTON_PRESSED.


svs 26.02.2007 10:38:45 +0300 - build 2202

1. Символ '^' после буквы режима сортировки показывает включенный режим 
   "Show selected first"

2. Bug: Если одновременно указать несколько /v и /e, но из ФАРа не выйдем.
   На будущее - имеет смысл проработать вариант для стандалоне редактора/вьювера, 
   но с неколькими открытыми файлами.

3. В FileEditor немного подсократил количество параметров.

4. Shift-F4 Ctrl-Y Enter на панели плагина матерится будет.
   (пока затычка...)

5. Был такой вот флаг FFILEEDIT_ISNEWFILE - нафига? - не помню.
   Убрал. Если "всплывет" - полечим.

6. Добавил EF_SERVICEREGION. Пка зарезервировано.

7. DIF_NOTCVTUSERCONTROL доступен всем.


t-rex 25.02.2007 06:45:48 +0200 - build 2201

1. Добавил фильтры в пометку файлов.


warp 25.02.2007 02:38:00 +0300 - build 2200

1. Поправил еще глюков с отрисовкой елки. Заодно сделал показ частичной елки
   в панели.


warp 12.02.2007 12:35:00 +0300 - build 2199

1. Вторая попытка исправить ситуацию с неправильно выставленной папкой в
   в ситуации, когда IsModulePlugin вернул FALSE. Предыдущая была какая-то
   идиотская. Будем надеяться, что работает, я так ситуацию до конца и не 
   повторил.


t-rex 12.02.2007 04:44:25 +0200 - 2198

1. Сделал везде где должно быть virtual функции.

2. Удалил ещё нескольно ненужных файлов.

3. Исправил баг с падением при вводе таба в режиме EXPAND_NEWTABS.


svs 07.02.2007 18:29:07 +0300 - build 2197

1. Макро: 
    APanel.ColumnCount - активная панель:  количество колонок
    PPanel.ColumnCount - пассивная панель: количество колонок

2. Правило "Panel\ShellRightLeftArrowsRule":REG_DWORD
    <ER>
    Нынешнее FAR'овское поведение ближе к NC/VC, чем предлагаемое. 
    Единственная разница - в NC при пустой командной строке в режиме 
    панели в одну колонку Left/Right просто игнорируются. Я же решил 
    применить их к панели, чтобы не пропадали зря. При непустой 
    командной строке FAR работает аналогично NC и VC. Как мне кажется, 
    менять это поведение значит идти в разрез с многолетними привычками 
    пользователей. Да и пользы от Left/Right в одноколоночной панели 
    немного. Почти те же PgUp/PgDn.
    </ER>


   "ShellRightLeftArrowsRule":REG_DWORD
    Параметр "ShellRightLeftArrowsRule" с типом DWORD позволяет управлять 
    поведением стрелок влево/вправо (как на основной, так и на дополнительной 
    клавиатуре).
    Значения:
      0 - поведение как у 1.70: если командная строка непуста, то клавиши 
          Left/Right и Num4/Num6 действуют по-разному в зависимости от 
          режима панели: если имена файлов отображаются в несколько колонок 
          (по умолчанию режимы 2 и 3), то команды вправо/влево применяются 
          к панели (как и при пустой командной строке); а если имена файлов 
          отображаются в одну колонку (по умолчанию все остальные режимы), 
          то команды вправо/влево применяются к командной строке.
      1 - клавиши Left/Right и Num4/Num6 при включённой панели всегда 
          применяются только к ней, независимо от содержимого командной 
          строки и режима панели. 
          Примечание: в командной строке есть CtrlD/CtrlS. 
    По умолчанию значение = 0. 


t-rex 07.02.2007 01:06:56 +0200 - 2196

1. Разные мелочи по теме фильтров.


t-rex 05.02.2007 17:01:41 +0200 - 2195

1. Алгоритмическое завершение фильтров панели - будем показывать тока те
   выбранные авто фильтры (для которых нету файлов на панели) которые
   выбраны в области текущего меню.

2. Партия хэлпа от Самлюкова. Плюс анг перевод и исправления от меня.


warp 05.02.2007 16:27:00 +0300 - 2194

1. Тот самый веселый баг с неудалением FolderTree с экрана. Как оно работало 
   раньше - неизвестно, видимо по причине другого бага.
   
2. Сделал кое-где в классах правильное виртуальное наследование методов. 


t-rex 04.02.2007 23:42:28 +0200 - 2193

1. Если диалог был во весь экран то фар мог падать при рисовании тени.

2. Раскраска и группы сортировки имеют один пункт в меню F9.

3. Немного обновил хэлп.


t-rex 04.02.2007 19:14:21 +0200 - 2192

1. Если плагин бы вызван по префиксу то до и после его вызова ком-строка обнулялась.
   Убрал обнуление после запуска так как плагин мог установить ком строку во время работы.
   При запуске из usermenu ком-строка как и раньше восстанавливается и так вроде должно быть.


t-rex 04.02.2007 16:21:16 +0200 - 2191

1. Компактизация диалога фильтров.

2. Раскраска символа пометки.

3. [ ] Continue processing для настроек раскраски.
   Если есть прозрачные цвета и [x] то ищем дальше.

4. Объединение групп сортировки с раскраской и вообще новый дизайн меню раскраски.
   В реестре всё хранится так чтоб была совместимость со старыми фарами.
   Файлы grpsort.cpp и grpsort.hpp удалены.

5. Дизайн меню раскраски как меню фильтров панели.

6. В меню фильтров панели функционал Ctrl-F изменен так что теперь Ctrl-F работает
   как тригер для текущего меню на разрешение или запрет фильтровать папки.
   Статус тригера виден в заголовке меню - D+ - папки не фильтруются, D? - папки фильтруются.
   По дефолту D+ - т.е. как и в старых фарах.

7. В меню фильтров панели теперь всегда есть пустая строка после юзер-фильтров.

8. Shift-<Grey -> в меню фильтров панели также сбрасывает статус тригера фильтрации папок в D+.
   Shift-BS как и было сбрасывает только пометки.


t-rex 02.02.2007 19:09:42 +0200 - 2190

1. Для DI_TEXT если заданы по человечески X1 и X2 то не будем выводить больше текста чем заданно.

2. Диалог настройки цвета в режиме с настройкой прозрачности теперь выглядит красивей.

3. Сделал хоткеи в диалоге фильтра.


t-rex 01.02.2007 03:05:40 +0200 - 2189

1. Оптимизация проверки непопадания под фильтр (FileFilterParams::FileInFilter)
   для фильтров не только по маске. Теперь в тысячи процентов быстрее.

svs 31.01.2007 19:14:14 +0300 - build 2188

1. После 2174 всплыла бага, судя по всему старая.
   Пропадал курсор после Shift-F7
   http://forum.farmanager.com/viewtopic.php?t=2399
   подробности в REMINDER

t-rex 30.01.2007 21:47:23 +0200 - 2187

1. В диалоге настроек фильтра для настройки цвета передавал фигню вместо самого цвета.


t-rex 30.01.2007 20:34:37 +0200 - 2186

1. Фиксы в диалоге фильтров.

2. Меню настройки цветов перерисовывает панели чтоб отражались прозрачные цвета.

3. Продолжаю продвигать код с в сторону настройки цветов для символа пометки.

4. FCTL_GETUSERSCREEN - сбрасывает UserBuffer на экран.
   Теперь плагины могу эмулировать запуск программ в фаре используя
   FCTL_GETUSERSCREEN и FCTL_SETUSERSCREEN.
   Заодно исправлен баг в FCTL_SETUSERSCREEN который съедал последнюю строчку
   при выводе в Ctrl-O.
   Ну и для правильной работы FCTL_GETUSERSCREEN при первом запуске фара, добавил
   выставления курсора перед сохранением первичного UserBuffer в ControlObject::Init().


warp 30.01.2007 20:19:00 +0300 - 2185

1. Привет из 1.8 - удалил все это бессмысленное виртуальное наследование классов. 
   Унаследовал классы как положено, уменьшил размер .exe файла на 9кб.


t-rex 29.01.2007 02:53:12 +0200 - 2184

1. Довёл прозрачность в раскраске до логического финала - если в конце всё ещё есть
   прозрачные цвета то берутся дефолтные цвета фара. А также пофиксил глюк когда для
   прозрачного цвета брался чёрный цвет вместо дефолтного когда оригинальный цвет был
   black on black.

2. Переделал немного структуру хранящую раскраску для удобной работы с ней а также сделал
   заготовку для раскраски символа пометки.

3. Новый экспериментальный вид меню фильтров панели.
   По идеи хочу сделать все меню похожим образом и централизовано.

4. Вернул Ctrl-R в меню раскраски и оптимизировал его.

5. Вернул обработку %PATHEXT% фильтрам.


t-rex 28.01.2007 05:59:14 +0200 - 2183

1. Доделал сохранение в реестр для раскраски - осталось только CtrlR доделать.
   И вообще вроде как зафиналил работу с реестром во всех местах где используются
   фильтры и сделал так чтоб обновления фара прошло прозрачно для тех кто использует
   старые версии. Только в панельных фильтрах нету полной прозрачности но пользовательские
   фильтры загрузятся без проблем.

2. Группы сортировок это теперь тоже фильтры - полная реализация.
   А также теперь группы сортировок могу работать на папки - сделано так что папки
   все ровно всегда сверху но сортируются по группам между собой.

3. По мотивам fargroupwiki добавил опциональную прозрачность цветам и символу пометки в раскраске
   файлов. Реализация по моему очень удачная так как код ну супер простой и нет конфликтов со
   старыми настройками.
   Прозрачными могут быть цвета текста, фона и символ пометки. 
   Прозрачность она дополнительна к существующим настройками а не вместо них.

   Алгоритм прозрачности вот такой:
   0. выставляем дефолтные цвета (чёрный на чёрном) + прозрачность 
   1. ищем подходящий фильтр 
   2. если нашли, считываем настройки раскраски, если нет то 5 
   3. применяем настройки только к прозрачным элементам 
   4. если всё ещё есть прозрачные элементы то назад в 1 
   5. сбрасываем прозрачность если такая ещё есть - тут выходит
      что прозрачные элементы будут иметь такие настройки как
      последний подошедший фильтр (даже если там тоже была прозрачность).

   пример чтоб было более понятно: 
   скажем есть такие пункты раскраски 
   1. *.exe - у которого выставлены все цвета и стоит пустой прозрачный символ пометки 
   2. * - атрибут RO - символ ! 
   3. * - атрибут H - символ . 

   значит что выйдет - RO exe файл будет цвета exe файлов и будет иметь символ '!',
   H exe файл будет цвета exe файлов и будет иметь символ '.',
   все другие exe файлы будут цвета exe файлов и без символа. 
   А также любые RO файлы будут иметь символ '!' а любые H файлы символ '.'.
   Надеюсь так более понятно.

4. В файл REMINDER записал первичный набросок API фильтров.
   Но с этим спешить не стоит, надо сначала устаканить код фильтров.


t-rex 27.01.2007 05:52:31 +0200 - 2182

1. Теперь раскраска файлов это тоже фильтры :)
   Ещё не доделано до конца (нет сохранения в реестр) но решил закомитить
   пока не поломал всё окончательно.

2. Добавил пару хотекеев в меню фильтров:
   CtrlF - для пометки фильтра папок
   BackSpace - снимает пометку
   ShiftBackSpace - как и ShiftGrey- снимает пометку у всех фильтров

   А также чекбокс "Match file mask(s)" теперь по дефолту включен в диалоге фильтра.

3. Класс FileFilterParams который и является самим фильтром вынесен в отдельные файлы
   filefilterparams.?pp так как он теперь будет использоваться в нескольких местах.
   Этот класс теперь также хранит настройки раскраски (во всяком случае пока я
   не разберусь как красиво сделать это через наследование).
   Диалог фильтров и раскраски это теперь один диалог который подстраивает себя соответственно.

4. В array.hpp добавлен новый шаблонный класс TPointerArray для базовой работы
   с массивом объектов. Он же используется теперь во всех местах где нужны фильтры.

5. Исправил мэйк для GCC.

6. Уря! Убил последние коменты. И удалил dummy.cpp.


svs 26.01.2007 16:35:13 +0300 - build 2181

1. Добавлен флаг DIF_SEPARATORUSER. Пока "внутри", т.к. в процессе...
   (подробнее в REMINDER)

2. Проблема с сепараторами, когда указаны ВСЕ координаты (из форума)
   пересчитаем правильные размеры.

3. В SysLog вместо пвсевдографики (вертикальная черта) ставим обычный '|'

4. Очередная порция убиения комментов.


t-rex 26.01.2007 01:24:46 +0200 - 2180

1. Ещё пару фиксов для фильтра.


svs 25.01.2007 13:16:27 +0300 - build 2179

1. В обработчике DefDlgProc для события DN_BTNCLICK не учитывался флаг DIF_BTNNOCLOSE

2. Траблы с надписями в кейбаре (редактор, вьювер).
   Теперь между MXXXXF1 и MXXXXF12 не должно быть добавочных... типа MXXXXF1DOS
   Такова специфика кода.

3. Для элемента DI_VTEXT добавлена обработка флагов:
    DIF_CENTERGROUP - (не уверен, надо проверить), 
    DIF_SEPARATOR
    DIF_SEPARATOR2
    DIF_SHOWAMPERSAND

4. В обработчике флага DIF_CENTERTEXT трабла. Если был указан сепаратор, этот флаг 
   и координата X (отличная от -1, т.е. полные координаты), то... сепаратор 
   затирался...
   В общем DIF_CENTERTEXT в сочетании с DIF_SEPARATOR сам центрует строку.


t-rex 25.01.2007 07:14:19 +0200 - 2178

1. Снова фильтр - авто фильтры они только для файлов, папки не должны к ним подходить.


t-rex 25.01.2007 00:55:06 +0200 - 2177

1. Исправил пару багов с фильтром и доработал правильное сохранение в реестр.


t-rex 24.01.2007 23:18:17 +0200 - 2176

1. Соединил все виды фильтров (панели, копир и поиск) в одну сущность
   имеющую функционал всех прошлых фильтров вместе.

   Удобность работы с фильтром ещё не доработана до конца.
   На сей момент настройки меню фильтров независимы для каждого места
   откуда это меню может вызываться (панели, копир, поиск).

   Убрал файлы filter.* - теперь всё в filefilter.*.

2. Заодно исправлен баг из за которого в меню фильтров не сохранялись
   настройки для авто-фильтров но есть небольшой прикол - теперь маски
   авто-фильтра которые помечены в одной из областей работы фильтра
   показываются в меню фильтров во всех областях.
   Думаю может давать им другое имя если такой маски нет в панели.

3. Также исправлен Mantis#202 как побочный эффект.

4. На панелях можно фильтровать папки. Надо бы разобраться с копиром ещё.

5. Изменил в батниках имя файла куда сохраняется вывод компайлера чтоб у него
   не было окончания и все такие файлы шли на панели вместе.


svs 24.01.2007 18:57:20 +0300 - build 2175

1. Уточнение DlgEdit. Все же будем наследовать от ScreenObject

2. dlgedit?.pp - в досовой кодировке были

3. ScreenObject::GetPosition стала виртуальной. 
   Возможно еще нужны уточнения по виртуальности функций...


svs 24.01.2007 16:32:45 +0300 - build 2174

1. убил немного комментов

2. везде, где встречается DialogData, прописаны Y2.
   Просьба - если делаете диалог, то Y2 обязательно заполняйте!

3. Переделка класса DlgEdit. Теперь он ни от кого не наследуется, но держт на борту
   2 ссылки - на Edit и Editor.
   Плюс - необходимый набор функций.
   В диалоге это один объект, по сути - два (но этот объект для диалога, так что...)

4. небольшая заготовка в usermenu под DI_MEMOEDIT (в обычной жизни не используется)
   макрос PROJECT_DI_MEMOEDIT пока не юзабелен.


svs 18.01.2007 22:11:48 +0300 - build 2173

1. Ля... ну никак нельзя заниматься работй и ФАРом (явно "работа" лишняя :-)
   Мать мать мать...  Снова кейбар.
   Ну естественно нужно не на "" заменять, а просто, согласно писанию, тупо
   пропускать установку лейба....
   в 1.8x это исправлено.

2. когда в Message не используется диалог, но применяется MSG_WARNING,
   ...цвета кривые :-(
   (по наводке warp&t-rex)
   в 1.8x это исправлено.

3. убил немного комментов


svs 18.01.2007 20:53:52 +0300 - build 2172

1. Упс... пропустил гол в предыдущем матче ;-(
   (нет проверки на NULL)

2. Бага. Вылечил. Визуальная бага. Старая бага.
   стоим в каталоге, где есть диз-файл
   Ctrl-L Tab  - перешли на инфо-панель
   Alt-F? (для противоположной панели) и дальше на тот диск, 
          в каталоге которого нету diz`а
   Видим, что кейбар не обновился (Tab Tab - обновление прошло)

svs 18.01.2007 17:54:23 +0300 - build 2171

0. Пересмотр кода кейбаров... выкинул кучу кода.

1. Закончим с кейбаром в FolderTree (он у нас от Frame, так пусть по 
   человече себя ведет, хотя бы как хелп)

2. Так же попробуем избавится от SaveScreen в FolderTree

3. в конструкторе TreeList проинициируем  SaveListData, иначе несколько
   раз Alt-F10 Esc и мы упали при освобождении памяти.

4. удалим немного комметов

5. Сейчас MKBFolderTreeXXX - всего несколько, имеет лис смысл разворачивать
   по всем клавишам (пусть даже они будут пустыми...) или как?
   Т.е. - делать как у всех объктов, юзающих кейбар или оставить так?


warp 16.01.2007 10:15:00 +0300 - build 2170

1. Не глядя поправил ситуацию с неправильно выставленной папкой в
   в ситуации, когда IsModulePlugin вернул FALSE.


t-rex 12.01.2007 21:52:01 +0200 - build 2169

1. Не посылался EE_CLOSE для ?New file?.
   Теперь EE_CLOSE посылается всегда если послался EE_READ чтоб
   небыло утечек памяти в плагинах.


t-rex 12.01.2007 16:38:51 +0200 - build 2168

1. !$! не работал по назначению.


t-rex 10.01.2007 15:11:17 +0200 - build 2167

1. Ещё немного x64.


svs 10.01.2007 14:43:36 +0300 - build 

1. Без билда. Касаемо логирования. 
   Добавлена _MCODE_ToName

warp 08.01.2007 21:45:00 +0300 - build 2166

1. Ужесточена проверка на наличие hotplug устройства. Проверяем, не 
   ждет устройство извлечения. 

svs 08.01.2007 11:46:54 +0300 - build 2165

1. Ctrl-A в архиве на каталоге - все опции атрибутов помчеены.


svs 08.01.2007 00:01:11 +0300 - build 

1. Без билда. Восстановление возможности дебажной компиляции под VC 6
   Для компиляции понадобятся файлы cfg.h и cfgmgr32.h (из DDK)
   
   На сейчас следующее состояние 
   ("+" - компилится, "-" - нет, "*" - не пробовал, "?" - нафиг ненать)

               BCC/5.02  BCC/5.5  VC/6  VC/2003  VC/2005  GCC
   Release        *?       +?      *?     +        *       *
   Release/64     *?       *?      *?     +        *       *
   Debug          +        +?      +      -        *       *
   Debug/64       *?       *?      -?     -        *       *

   (это я пробовал в своем окружении - усли у кого есть что добавить...)

2. Изменен scripts/mkdep.awk - не учитывался objlog для дебажной версии.


svs 07.01.2007 12:40:55 +0300 - build 2164

1. Изменен формат функции ScreeObject::VMProcess - новые параметры
   Возможно потом нужно будет еще несколько уточнений вводить, но на
   сейчас (для Help.XXXX) вполне достаточно.


t-rex 05.01.2007 17:57:39 +0200 - build 2163

1. Вернул назад прошлые изменения. Валя, ещё раз такое сделаешь, убью.
   Или ты делаешь этот хренов класс или удаляешь нафиг эту фичу вообще.


svs 05.01.2007 16:41:08 +0300 - build 2162

1. Про "поймаю Валю" :-)
   Пока сделаем так. По хорошему нужна отдельные методы у класса Help для 
   получения необходимых данных...

t-rex 04.01.2007 11:19:01 +0200 - build 2161

1. Убрал всевозможные ворнинги связанные с x64 и заодно подправил пару мест
   (или я раньше пропустил или кто то уже успел нагадить).
   Включил показ x64 ворнингов для x64 билда - люди, перед тем как вы комитите свои
   изменения, соберите x64 версию и посмотрите на ворнинги - если есть и вы не знаете
   как правильно их решить то стучите ко мне (главное не уберите ворнинг оставив баг).

   Остались несколько ворнингов которые показывают на баг внесенный новыми макросами для
   хэлпа - буду решать когда поймаю Валю.

2. Удалил ClevMutex.hpp из за ненадобности и из за x64 несовместимости.


svs 27.12.2006 18:34:59 +0300 - build 2160

1. Macro: + новых слова:
    Help.FileName - имя просматриваемого файла помощи
    Help.Topic    - просматриваемый топик
    Help.SelTopic - топик, который сейчас выделен

2. Попутно бадья нашлась при формировании топика:
   Shift-F2, а дальше путешествуем по топикам.
   в итоге получаем кучу слешей в конце StackDate.HelpPath
   Решение - удалим все конечные слеши и добавляем единственный.

3. У DeleteEndSlash новый параметр - удалить ли _ВСЕ_ концевые слеши.
   по умолчание "неа, тока один от конца строки".

4. В WindowInfo для Help`а теперь заполням Name - полный путь к файлу.
     

svs 20.12.2006 17:12:10 +0300 - build 2159

1. Полумера, решения проблемы с выходом по ".." из юниководового каталога.
   а) позиционирование на каталого не происходит
   б) "cd .." матерится, но выходит.

svs 20.12.2006 15:26:33 +0300 - build 2158

1. Откат Mantis#198. Здесь все веселее и веселее...
   Проблема в том, что пока ФАР не получит управление...

svs 15.12.2006 16:48:23 +0300 - build 2157

1. Mantis#255 - При вставке пути к файлу/папке по Ctrl+Alt+F последний слеш 
                получается  не в ту сторону 
   Пусть AddEndSlash сама определяет чьих слешей больше :-)
   (второй параметр не "\", а 0x00).

2. Mantis#254 - Падение при копировании файла с длинным путём из связи с 
                коротким путём
   (выправляем RawConvertShortNameToLongName)

3. Пусть "mkdep.list.txt" будет именоваться как "mkdep.list" 
   (он, гад такой все время попадает... под txt)

4. Mantis#198. Уточнение. В обчем тут такое дело...
   Есть у меня макрос "F11 ? 1 !".
   Здесь 
   '?' - хоткей для "cdHelps"
   '1' - Context-dependent help
   '!' - Previous query
   Если раньше в консоли ничего не появлялось, а просто тупо появлялся гуевый 
   хелп. То сейчас мелькает меню - открывается и закрывается.
   Посему пока просто учтем Mode==MACRO_DIALOG.
   Хмм пока это писал, увидел артефакты и в редакторе...
   Однозначно только MACRO_DIALOG учитываем (а там посмотрим - в смысле
   вернуть все взад...)

svs 15.12.2006 12:17:28 +0300 - build 2156

1. Mantis#198: проблема с прорисовкой сообщения при работе с макросом
   Изменил немного механих окончания работы макропоследовательности

2. Жука надыбал. В панеле дерева "Shift-F6 End 1" ФАР с грохоттом
   завалился.
   Некорректно была сработана функция TreeList::GetCurDir()

svs 14.12.2006 12:04:08 +0300 - build 2155

1. Mantis#218: Проблема с копированием файла в самого себя
   (это когда копируем файл "c:\a.txt" в "c:")
   [-] При копировании уничтожалось содержимое файла в корне диска, если в 
       качестве приемника указывался этот самый диск (файл "C:\a.txt" копируем в "C:")

2. Поддержка колеса мыши в объекте выбора папок (копир)


svs 13.12.2006 12:31:57 +0300 - build 2154

1. Mantis#235: Не распознаётся zip-архив
   Хотел сначала подателя жалобы послать на... TechInfo#63 :-)
   Но, расположение требуемой сигнатуры этого архива (в сааамом конце файла) 
   не укладывается в указанный диапазон - "Диапазон от 0x1000 до 0x80000".
   Здесь как раз бы 4метра указать, но...
   В общем снял органичение на верхний предел.
   Доку поправлю.


svs 12.12.2006 15:17:13 +0300 - build 2153

1. В FolderTree не отрабатывали мышиные правила для диалога (вне диалога).
   
2. Mantis#253 - Пропадание содержимого дерева папок
   [-] Пропадало содержимое дерева папок, если процесс перечитывания 
       каталогов прерывался.
   Добавил TreeList::SaveState() и TreeList::RestoreState(). чтобы сохранить
   текущие значения кеша и списка каталогов дерева.

3. DMOUSEBUTTON_* перенесены из dialog.hpp в farconst.hpp

svs 07.12.2006 15:25:47 +0300 - build 2152

1. Вводим VSMFL_REDRAW для ViewerSetMode.Flags, ибо так правильнее будет.
   т.е. либо VCTL_SETMODE + VCTL_REDRAW, либо VCTL_SETMODE(VSMFL_REDRAW).

svs 06.12.2006 19:30:17 +0300 - build 2151

1. Класс FolderTree наследуется от Frame, что позволило вылечить древний баг с 
   прорисовкой (F5 F10 F1 F5 F5 Esc - видим "грязь" на экране).
   Так же это изменение позволило добавить фичи:
   а) Alt-F9 (само получилось, т.к. Manager сам умеет перерисовывать все, что 
      наследуется от Frame)
   б) F5 - распахнуть/вернуть окно поиска каталога (по аналогии с хелпом)

   Так же, конструктор претерпел некоторые изменения в параметрах.

   В хелпах в раздел "@FindFolder" добавлена инфа про F5 и Ctrl[-Shift]-Enter.
   В FarEng.hlf.m4 нужен перевод.

2. Небольшие правки plugins.cpp. Просьба не употреблять __try/__except. Для
   этого есть макросы TRY/EXCEPT, соответственно.

3. Добавлен файл README. Перечислены некоторые правила. Если кто-то вспомнит
   еще правила - писать в этот файл.


warp & t-rex 05.12.2006 03:09:38 +0300 - build 2150

1. Поправлена логика предыдущего изменения. Кэшированные плагины не проверяются
   на принадлежность плагинам, это лишнее.

2. Функция проверки на принадлежность плагинам приведена в соответствие с x64.

warp 05.12.2006 01:39:38 +0300 - build 2149

1. Изменена логика загрузки плагинов. Введена проверка на принадлежность
   плагинам до загрузки модуля. Теперь Far будет ругаться на невозможность
   загрузить плагин, только если он был признан таковым до загрузки и при 
   этом LoadLibraryEx вернул _любую_ ошибку.

   [*] Изменена логика загрузки плагинов. Модуль проверяется на принадлежность
   плагинам до загрузки. 

2. Исправлен .pas файл на предмет VSMT_XXXX

svs 01.12.2006 19:47:38 +0300 - build 2148

1. Замена в составе: ViewerMode.TypeWrap -> ViewerMode.WordWrap

2. Добавка в ViewerAPI - VCTL_SETMODE, enum VIEWER_SETMODE_TYPES, struct ViewerSetMode

3. В XXXControl добавлена проверка на вшивость с юзанием IsBadReadPtr()


svs 30.11.2006 09:21:52 +0300 - build 2147

1. При выключенных настройках [ ] Save file position [ ] Save bookmarks 
   после открытия файла на редактирование курсор по умолчанию становится 
   в конец первой строки.

svs 28.11.2006 12:37:14 +0300 - build 2146

1. Mantis#248: Открытие по ShiftF4 предыдущего редактируемого файла.


t-rex 25.11.2006 10:53:30 +0200 - build 2145

1. Дополнение к x64. В PluginStartupInfo и FarStandardFunctions
   Reserved заменены с DWORD на DWORD_PTR чтоб не терять свой смысл.
   Соответственно это изменение требует пересборки x64 плагинов!

2. Немного GCC. Почему вы упорно не используете _i64(NUMBER) вместо NUMBERi64?
   И _ui64(NUMBER) вместо NUMBERui64.


svs 23.11.2006 19:51:42 +0300 - build 2144

1. Macro: $AKey - клавиша, который вызвали данный макрос
   (небольшой задел на будущее)

2. Возможность компиляции 1.7x под BCC


t-rex 23.11.2006 08:24:11 +0200 - build 2143

1. При удалении пустой строки или соединении двух строк при помощи DEL или BS выставлялись
   неправильные символы конца строки для "новой" строки.


t-rex 21.11.2006 18:13:55 +0200 - build 2142

1. Входим в эру 64-бит (ждём юникод :)

   Главные изменения: (надо будет обновить Енц.)
     DlgProc: long Param2 -> LONG_PTR Param2 и возвращает LONG_PTR вместо long
     SendDlgMessage: long Param2 -> LONG_PTR Param2 и возвращает LONG_PTR вместо long
     DefDlgProc: long Param2 -> LONG_PTR Param2 и возвращает LONG_PTR вместо long
     DialogEx: long Param -> LONG_PTR Param
     FarMenuItemEx: DWORD UserData -> DWORD_PTR UserData
     PluginPanelItem: DWORD UserData -> DWORD_PTR UserData
     AdvControl: возвращает INT_PTR вместо int
     OpenPlugin: int Item -> INT_PTR Item
   А также в execute.cpp добавлено определение 64-bit GUI прог.

   После некоторых экспериментов было выведено что выравнивание должно быть 8 для 64-bit версии.
   Обновил Far.mak и добавил vc.build.debug.64.bat и vc.build.release.64.bat которые используют
   custom.vc.debug.64.bat и custom.vc.release.64.bat соответственно.
   Мой custom.vc.release.64.bat содержит следующее:
   call "I:\Program Files\Microsoft Platform SDK for Windows Server 2003 R2\SetEnv.Cmd" /X64

   Единственное что ещё не доделано до конца это SEH - кто у нас в этом шарит?


svs 20.11.2006 16:37:26 +0300 - build 2141

1. Editor - copy/paste, блин.


t-rex 18.11.2006 23:23:58 +0200

1. без билда, обновил инклюды и скрипт генерации оных чтоб в них выводилась версия фара.


svs 17.11.2006 23:09:05 +0300 - build 2140

1. Бага предыдущего патча. В конце файла появлялся 0x00 
   при повторном открытии редактора.

2. Mantis#139 - Нарушения с концами строк при Отмене

3. + Edit::GetEOL()

4. У Editor::AddUndoData новый параметр - пусть Undo помнит EOL!

5. Небольшие правки в mkfar.mak


svs 16.11.2006 23:03:47 +0300 - build 2139

1. EditList удален. Next/Prev теперь принадлежать классу Edit

2. Однообразные куски кода по добавлению строки в редакторе 
   преобразованы в функции AddString и CreateString.

svs 13.11.2006 20:08:25 +0300 - build 2138

1. Добавлена функция FAR_GetFileSize (по аналогии с 1.80)

2. Wipe теперь "умеет" файлы > 2Gb

3. Заголовочные комменты в сорцах выносим в отдельный каталог.


svs 07.11.2006 21:33:42 +0300 -

1. без билда добавлен tee.exe с коррекцией vc.build.debug.bat и 
   vc.build.release.bat

warp 01.11.2006 02:56:09 +0300 - build 2137

1. Несколько ахтунговый фикс. До конца не проверил еще. 
   [-] Cтрока префиксов плагина больше не ограничена 512 символами. 

svs 10.10.2006 11:10:09 +0300 - build 2136

1. Macro: Area-коды разнесены. Теперь Condition имеет свои OpCode, а
   области - свои. Иначе в дампе макроса при логировании хрень.
   Для ньюсов ничего пистать ненадо.

svs 09.10.2006 12:08:32 +0300 - build 2135

1. Упоминание про Ctrl-Shift-Enter при быстром поиске (нужен перевод!)
   Mantis 244

2. FindFile: Зацикливается поиск при поиске подстроки на файле больше 2Gb
   Mantis 243

3. уточнение mkfar.mak - компиляция под BCC.


warp 05.10.2006 06:18:34 +0300 - build 2134

1. Вроде поправил ширину DIF_SEPARATOR для диалогов без рамки. 

t-rex 27.09.2006 04:05:23 +0300 - build 2133

1. Ещё одно дополнение к фиксу "Падение при старте ФАРа, когда каталог недоступен".
   На пассивной панели открывался каталог без ".." вверху.

t-rex 27.09.2006 03:07:27 +0300

Косметика без билда.

1. Прошлый патч был совсем не в тему. Вернул как было и чтоб больше не было
   вопросов сделал два батника и изменил Far.mak:

   Эти батники на прямую не редактировать!!!!!!!!!
   Только для постоянных изменений для всех участников проекта.
   Читайте объяснение - всё продумано.

   --------------------
   vc.build.release.bat
   --------------------
   Этот батник собирает release версию фара с помощью VC и Far.mak.
   Батник заодно обновляет far.release.dep и языковые файлы.
   С запуском этого батника никогда не будут никаких проблем при сборке фара
   (кроме ошибок в самом коде :).
   Чтобы батник был универсальным и работал у всех без изменений он
   вызывает другой батник - custom.vc.release.bat - если такой есть.
   Этот (custom.vc.release.bat) батник вам надо создать самим так как он ваш
   личный и на SVN комитится не будет. В нём вы можете определять переменные
   среды компайлера и переопределять переменные среды которые используются
   для сборки фара в главном батнике.
   Например у меня он содержит:
   ---->8----
   @echo off
   call F:\lng\VC.Toolkit.2003\vcvars32.bat
   ----8<----
 
   ------------------
   vc.build.debug.bat
   ------------------
   Тоже что и vc.build.release.bat только собирает debug версию, обновляет
   far.debug.dep и вызывает custom.vc.debug.bat если такой есть.
   Пример custom.vc.debug.bat:
   ---->8----
   @echo off
   call F:\lng\VS98\Bin\VCVARS32.BAT
   set FAR_MSVCRT=/D FAR_MSVCRT
   set FARSYSLOG=-DSYSLOG_TREX %FARSYSLOG%
   ----8<----


svs 26.09.2006 10:52:00 +0300 -

Косметика без билда.

1. В mkdep.list.txt добавлены copyright.inc и farversion.inc, т.к. если сделать
   первый раз экспорт, а потом запустить компиляцию, то будет ошибка компиляции
   global.cpp, т.к.  ни copyright.inc ни farversion.inc еще нету.
   
   Так же исправлен scripts\mkdep.awk - учитывает расширение INC, т.е. как раз 
   те самые файлы copyright.inc и farversion.inc, которые генерятся из *.m4.


t-rex 24.09.2006 17:21:44 +0300 - build 2132

1. Не влезали русские слова в диалог фильтра.

t-rex 23.09.2006 04:19:12 +0300 - build 2131

1. Дополнил Валин фикс на тему "Падение при старте ФАРа, когда каталог недоступен"
   а то выходила фигня если недоступный путь был например C:\a - фар открывал C: и
   делал это очень криво.

t-rex 23.09.2006 02:54:44 +0300 - build 2130

1. Починил вставку мусора в редакторе в висте при нажатие на Enter.
   В висте realloc на уменьшение не всегда (а может и никогда) ни возвращает тот же адрес.

2. Починил сборку GCC.

t-rex 23.09.2006 01:12:39 +0300 - build 2129

1. Новая система сборки как и в 1.80 для работы с SVN.

2. Начинаем писать changelog, я сделал себе макрос
   "t - r e x Space $Date \"%d.%m0.%Y %H:%M:%S %Z\" Enter"
   чтоб выводить заголовок changelog-а.
   Последующие логи надо писать сверху - т.е. файл будет идти хронологически снизу вверх.
   В changelog прошу писать в Win кодировке.
