drkns 11.05.2008 20:03:36 +0200 - без билда

1. Прекомпилированные заголовочные файлы для VC.

drkns 03.05.2008 15:35:46 +0200 - build 480

1. Mantis#0000524: При использовании !?<title>?<init>! в диалог запроса параметров попадает мусор.

2. При обработке farmenu.ini byte order mark воспринимался как хоткей 1-го пункта меню.

3. Лишний realloc для DialogItemEx при формировании диалога для !?<title>?<init>!. Падало.

drkns 23.04.2008 19:25:04 +0200 - build 479

1. Древний баг: если при перемещении диалога мышью резко увести её к краю экрана, то диалог до этого края не доедет.

t-rex 19.04.2008 21:05:28 +0200 - build 478

1. Текст из клипборда, содержащий юниксовые окончания строк, пастился в редакторе как одна строка.

drkns 15.04.2008 07:23:53 +0200 - build 477

1. Продолжение эпопеи о дополнительной клавиатуре и включенном по умолчанию TechInfo#48,
   теперь на тему AltShiftIns/AltShiftNum0 в панелях.

drkns 14.04.2008 20:26:46 +0200 - build 476

1. При удалении общего макроса неправильно формировалось имя ключа в реестре,
   вследствие чего удаление макроса работало только в пределах текущей сессии.

2. При назначении макроса на клавишу, которой уже был сопоставлен общий макрос,
   запрашивалось подтверждение удаления общего макроса.

3. Продолжение 441: еще немного соответствия основных и дополнительных курсорных
   клавиш в диалоге результатов поиска, на этот раз home/end/pgup/pgdn.

4. Меню плагинов (F11) уничтожалось позже, чем нужно, вследствие чего оно могло
   отрисовываться и после вызова плагина.

5. Убрано шаманство с DN_EDITCHANGE во враппере - после 464 уже не актуально.

drkns 08.04.2008 23:37:32 +0200 - build 475

1. "Юникодизация" strftime.

2. Mantis#0000506: Когда в данном режиме перемещаешься во второй понели по каталогам - Far часто перерисовывает панели

3. С форума: "Переход к найденному по Alt+F7 файлу не меняет заголовок"

4. Mantis#0000280: Move/Rename папки с заблокированным файлом.
   Самое смешное - в 1.70 beta 4 это так и работало.

5. Не работала макрофункция N=Menu.Select(S[,N]).

t-rex 05.04.2008 23:00:28 +0200 - build 474

1. Ещё раз Mantis#395: Crash in UnicodeString::Format().

svs 03.04.2008 01:30:26 +0300 - build 473

1. Macro: добавлены функции работы с закладками
     N=BM.Del([Idx]) 
       удаляет закладку с указанным индексом (1...), 
       Idx=0 или параметр Idx не указан - удаляет текущую закладку
     N=BM.Get(Idx,M)
       возвращает параметры закладки с индексом (Idx=1...), Idx=0 - текущая закладка
       M=0 - координаты строки (начиная с 1)
       M=1 - координаты колонки (начиная с 1)
       M=2 - позиция, соответствующая первому видимому символу текста на экране слева
       M=3 - номер строки, соответствующей первой видимой строке текста на экране
     N=BM.Stat([M]) 
       возвращает информацию о закладках
       M=0 - текущее количество закладок
       На сейчас параметр роли не играет, можно указывать любое число или не указывать
       параметр совсем. Функция не обозвана как BM.Count так, как предполагается,
       что, если стековые букмарки распространить на вьювер или панели или... то может
       понадобится еще какая нибудь информация.

2. Кое-где, в классах верхнего уровня не передавались параметры vParam и iParam 
   в функции VMProcess низлежащих классов.


ts 01.04.2008 23:31:05 +0200 - build 472

1. Проверка на запись в ECTL_GETSTACKBOOKMARKS

2. Подготовка функций для макросов

svs 01.04.2008 16:23:57 +0300 - build 471

1. Mantis#0000518: Search does not honor Hex mode

svs 31.03.2008 12:31:56 +0300 - build 470

1. Mantis#0000517: перестал работать 'panel.SetPos'
   (from Denis Kosy)

ts 30.03.2008 18:27:35 +0200 - build 469

1. Изменена навигация в начальной и конечной позициях.

2. Исправлен алгоритм добавления позиции навигации.

ts 30.03.2008 14:20:08 +0200 - build 468

1. Теперь нельзя добавить две и более позиций навигации подряд на ту же позицию.

2. ECTL_STATSTACKBOOKMARK переименовано в ECTL_GETSTACKBOOKMARKS.

3. Закончено апи редактора управления позициями навигации: доработаны  комманды
   ECTL_DELETESTACKBOOKMARK (при Param равном -1 удаляет текущую позицию
   навигации, при 0 и более - позицию с указанным индексом) и
   ECTL_GETSTACKBOOKMARKS (Param указывает на заполняемую структуру
   EditorBookMarks или равен NULL, возвращает общее количество позиций).
   Описание всех комманд в Энц.

zeroes 29.03.2008 18:33:17 +0200 - build 467

1. Не срабатывали некоторые макросы (например повешенный на CtrlLeft)
проблема была из-за того что использовался KEY_MASKF вместо KEY_FKEY_BEGIN

ts 29.03.2008 17:21:57 +0200 - build 466

1. Добавлена коррекция позиций в стековых закладках при удалении и вставке строк.
   При удалении строки в позиции закладки происходит удаление этой закладки.

2. В апи редактора добавлены новые команды управления позициями навигации:
   ECTL_DELETESTACKBOOKMARK, ECTL_STATSTACKBOOKMARK для удаления указанной
   (пока что только текущей) закладки и получения информации о закладках
   (пока что заглушка).

t-rex 29.03.2008 09:26:14 +0200 - build 465

1. Panel API: Флаги PFLAGS_PANELLEFT и PFLAGS_PANELRIGHT.

t-rex 28.03.2008 13:10:48 +0200 - build 464

1. При GETDLGITEM возвращалась начальная а не текущая строка для эдитов.

2. От Alexey Samlyukov: В настройках неправильно читалось время для screen saver.

svs 27.03.2008 18:03:22 +0300 - build 463

1. Macro: добавлена макрообласть "Consts" для хранения именованных констант.
   Константы располагать в ветке реестра "KeyMacros\Consts". Синтаксис аналогичен "Vars", т.е.
   Код:
   KeyMacros\Consts
     "StringName":REG_SZ
     "IntName":REG_DWORD
   Имена констант произвольные, начинающиеся с буквы...
   Константы аля "ShiftIns" не имеют право на жизнь (хотя "ShiftIns1" допустим для имени)

   Вот вполне работоспособный макрос с использование константы FIB_PASSWORD.

   [HKEY_CURRENT_USER\Software\Far\KeyMacros\Consts]
   "FIB_PASSWORD"=dword:00000002
   [HKEY_CURRENT_USER\Software\Far\KeyMacros\Editor\CtrlP]
   "Sequence"="%s=prompt(\"Password\",\"Input password:\",FIB_PASSWORD); $Text %s"
   "DisableOutput"=dword:00000001

   Константы ФАР считывает из реестра при старте и хранит в таблице glbConstTable
   Т.к. это константа, то ее наличие можно только проверить функцией checkMacroConst()

2. Переделаем функцию varLook. Было так, что она всегда добавляла переменную, даже если
   параметр ins = 0. В ней тек же удален параметр error. Вместо этого функция возвращает
   ссылку или NULL. В связи с этим переделки в макроисполняторе.


drkns 26.03.2008 10:19:23 +0200 - build 462

1. Mantis#0000510: Тип FarDialogEvent.Result должен быть PLONG_PTR, а не LONG_PTR
   Result оставлен LONG_PTR, но теперь содержит само значение, а не указатель на него.
   Вроде бы ещё никто не успел использовать это в плагинах :)

t-rex 25.03.2008 23:41:53 +0200 - build 461

1. Оптимизация Editor::GoToLine ибо уж полный ужас был.

t-rex 25.03.2008 21:25:42 +0200 - build 460

1. Mantis#499: Invalid file handle used in ShellCopy::ShellCopyFile().

2. Mantis#395: Crash in UnicodeString::Format().

3. Мешанина пробелов и табов в panel.cpp.

4. От Denis Kosy Mantis#505: Необрезание строк в некоторых VMenu.

5. syntax.cpp: не собирался (как минимум) в VC8.

svs 25.03.2008 21:51:35 +0300 - build 459

1. Macro: добавлен Editor.RealPos - текущая поз. в редакторе без привязки к размеру табуляции

2. Macro: функция S=prompt("Title"[,"Prompt"[,flags[, "Src"[, "History"]]]])
   Mantis#0000512: N = prompt(Title, Text, Flags)
   Описание в Энц.

svs 25.03.2008 18:34:01 +0300 - build 458

1. Уточнения в panel.SetPath и опциональных параметров

svs 25.03.2008 16:54:07 +0300 - build 457

1. XXX::SetCurDir - функция возвращает BOOL - удачно или неудачно сделан переход

2. Macro: Добавилась функция -  N=panel.SetPath(panelType,pathName[,fileName])
   установить на панели каталог pathName, опционально можно указать имя файлового объекта (для курсора, как в panel.SetPos)

3. Макродвижок приведен к функционалу 1.7x:
   a) добавлены недостающие функции и операторы
       N=Menu.Select(S[,N])
       N=mod(a,b) == a %  b
       S=replace(sS,sF,sR[,Count])

   б) выставлена приоритизация операций:

       Унарные (R->L):          !  ~  -
       Бинарные арифметические: * /
       Бинарные арифметические: + -
       Сдвиг:                   << >>
       Сравнение:               < <= > >=
       Сравнение:               == !=
       Битовая:                 &
       Битовая:                 ^
       Битовая:                 |
       Логическая:              &&
       Логическая:              ||


4. Некоторые макро-функции могут иметь опциональные параметры
     S=itoa(N[,radix]) - здесь, если radix не указан, подразумевается 10
     N=Menu.Select(S[,N]) - здесь N подразумевается = 0
     N=panel.SetPath(panelType,pathName[,fileName]) - здесб пустая строка
     S=replace(Str,Find,Replace[,Cnt]) - Cnt=0 => до бесконечности
     S=substr(S,N1[,N2]) - до конца строки
     + msgbox - последний параметр (флаги) могут быть опущены, подразумевается 0

   Для этого в структуре __TMacroFunction добавлен параметр oParam.
   В интерфейсе параметры можно опускать, в коде они добиваются PushInt(0)


drkns 25.03.2008 07:15:18 +0200 - build 456

1. Mantis#0000004: DI_EDIT в Message для полей с именами файлов.
   Message теперь "умный": если строка длиннее, чем влезает - она кладётся в DI_EDIT, иначе - как раньше.
   Соотвественно, при вызовах Message убраны TruncPathStr.

2. Mantis#0000080: Перемещение символической связи на другой диск.

zg 25.03.2008 02:15:01 +0200 - build 455

1. при TabSize=1 ShiftTab вначале строки приводил к отрицательной текущей колонке.

t-rex 22.03.2008 21:33:34 +0200 - build 454

1. DM_LISTINSERT возвращал не то что в енц. описано.

2. Ещё заметил один глюк и потенциальный глюк рядом.

svs 20.03.2008 18:22:21 +0300 - build 453

1. Добавлен Disable цвет для пред. билда и изменены наименования пунктов меню в настройке цвета
   Итого размер палитры ФАРа = 0x7F байт

2. В History/Combobox стрелки отображались цветом меню - жлбавим флаг VMENU_COMBOBOX


svs 17.03.2008 20:23:22 +0300 - build 452

1. Mantis#0000498 - Screen scrolling arrows colors for Menu/Listbox/Combobox
   Добавлены цвета, связанные со стрелками:
     COL_DIALOGLISTARROWS,
     COL_DIALOGLISTARROWSSELECTED,
     COL_DIALOGCOMBOARROWS,
     COL_DIALOGCOMBOARROWSSELECTED,
     COL_WARNDIALOGLISTARROWS,
     COL_WARNDIALOGLISTARROWSSELECTED,
     COL_WARNDIALOGCOMBOARROWS,
     COL_WARNDIALOGCOMBOARROWSSELECTED,
     COL_MENUARROWS,
     COL_MENUARROWSSELECTED,

2. Добьем '>' - выкинут лишний кусок по расчету новой длины строки, немного оптимизации.

3. Макросы зависили от раскладки клавиатуры

drkns 17.03.2008 07:36:28 +0200 - build 451

1. Уточнение в отрисовке '>' при прокрутке строк VMenu.

t-rex 16.03.2008 23:39:26 +0200 - build 450

От Denis Kosy:

1. Mantis#497: Строки с масками файлов обрезаются на 60/78 символах.
   Поскольку теперь постоянно включен режим прокрутки (ex-CtrlN), строку уже можно не резать.

t-rex 15.03.2008 19:49:48 +0200 - build 449

От Alexey Samlyukov:

1. Ошибка в математике при отрисовке '>' (для длинных пунктов) в меню.

t-rex 15.03.2008 17:47:09 +0200 - build 448

1. Mantis#87: Копирование и жёсткие связи.

svs 15.03.2008 17:48:39 +0300 - build  447

1. Ctrl-N в списках убираем (http://forum.farmanager.com/viewtopic.php?f=3&t=3130)

drkns 15.03.2008 15:53:04 +0200 - build 446

1. Mantis#0000222: Не вполне корректная работа (или не работа) с потоками, привязанным к директориям.
   Тут потоки в общем не при чём, дело в обработке путей "\\?\c:\" и "\\?\Volume{GUID}\".
   Заодно поправил еще пару мест c этими путями.

t-rex 15.03.2008 13:41:32 +0200 - build 445

1. Mantis#467: Не пускает на плагинную панель; неправильные элемены панели.
   Исправил, но нифига не понимаю :)

t-rex 14.03.2008 19:16:30 +0200 - build 666-666/3

1. Mantis#458: Из истории папок запускается плагин с 1-буквенным префиксом.

t-rex 14.03.2008 17:23:28 +0200 - build 443

1. Mantis#463: Текущая папка процесса не меняется из юзер меню и отличается от активной панели.
   Во первых юзер меню сам переходил по папкам хотя это там нафиг не надо было,
   а во вторых был совершенно не нужный AI с восстановлением пути.
   Просто всё удалил (и ещё мусор который под руку попался).

2. От Denis Kosy: Mantis#493: Execute поломалась.

3. От Alexey Samlyukov: "" -> L"" в hilight.cpp.

svs 14.03.2008 00:18:12 +0300 - build 442

1. Bug в UserMenu.
   а) UserMenu пустое.
      - F2
      - AltF4
      - в редакторе вставляем из клипборда/набираем пункты руками.
      - F2
      - Esc
      Меню по прежнему пустое
   б) В UserMenu есть пункты.
      - F2
      - AltF4
      - в редакторе видим аля "неправильный юникод"
   Решение.
   При открытии UserMenu во встроенном редакторе в качестве кодовой страницы
   выставляем принудительно Unicode и никакого автоопределения.

2. При выставленном TTF-шрифте для консоли симолы указывающие на подменю в UserMenu
   представлены квадратами.
   usermenu.cpp::SubMenuSymbol[1] ==> Unicode символ 0x25BA.

drkns 13.03.2008 19:18:08 +0200 - build 441

1. Mantis#0000462: !=\ изменила поведение

2. Mantis#0000469: Ошибочное сообщение "Длина имени файла превышает системные ограничения"

3. Переполнение буфера в ConvertNameToReal()

4. Macro: в [panel.]fattr|fexist не работала подстановка * и ?.

5. В UserMenu, MainMenu и окне поиска по-разному вели себя курсорные клавиши на основной и доп. клавиатуре.

t-rex 13.03.2008 15:00:43 +0200 - build 440

От Denis Kosy:

1. Mantis#492: FindFile results window теряет информацию.

svs 13.03.2008 14:20:19 +0300 - build 439

1. От Denis Kosy: Mantis#0000491: макро panel.fexist не работает.

t-rex 12.03.2008 23:55:03 +0200 - build 438

1. От Alexey Samlyukov: wrapper: FarInputBoxA в отличии от 1.7х выставлял DestText даже если отменили диалог.

2. Не работало копирование (и т.п. операции) в плагины c выставленным OPIF_REALNAMES (TmpPanel например).

t-rex 12.03.2008 15:24:39 +0200 - build 437

От Andrey Kuznetsov:

1. Mantis#459: Невозможно войти в каталог, если имя состоит из одной буквы.
   Специфичный баг Win2K SP4.

svs 12.03.2008 14:24:00 +0300 - build 436

1. В диалоге фильтров нажать Reset - в комбобоксах размера и даты видим символ '&'
   Введем Edit::SetHiString(), аналог HiText2Str.

t-rex 12.03.2008 11:28:17 +0200 - build 435

1. Mantis#489: Crash in ConvertPanelItemA()
   pItemsNumber посланый плагину в GetFindData не обнулялся а некоторые
   плагины (network) возвращают TRUE ничего не выставив (типа пустая папка).

svs 12.03.2008 11:42:45 +0300 - build 434

1. После 431 "сломалась" навигация по раскраске в диалоге FileFilterConfig

2. Если в при вызове диалога фильтра/раскраски/сортировки второй параметр ColorConfig равен true
   то меняем заголовок диалога и подставляем нужный топик хелпа, относящийся не к фильтрам, а к раскраске.

t-rex 12.03.2008 00:36:38 +0200 - build 433

1. Расширяем UnicodeString:
   bool Pos(size_t &nPos, wchar_t Ch, size_t nStartPos=0)
   bool Pos(size_t &nPos, const wchar_t *lpwszFind, size_t nStartPos=0)
   bool RPos(size_t &nPos, wchar_t Ch, size_t nStartPos=0)
   bool Contains(wchar_t Ch, size_t nStartPos=0)
   bool Contains(const wchar_t *lpwszFind, size_t nStartPos=0)

2. Выставил const для ещё пару методов в UnicodeString.

3. Заюзал новый Pos в одном месте и ещё пару мелочей.

t-rex 11.03.2008 22:51:56 +0200 - build 432

1. Небольшая оптимизация HiText2Str().

svs 11.03.2008 21:01:02 +0300 - build 431

1. Macro: клавиша вызова наследуется из основного макроса при вызове eval()
   для этого у функции KeyMacro::PostNewMacro() добавлен новый параметр - клавиша вызова.
   например ('y' - клавиша назначения),
     y=eval("< $AKey >")
   теперь печатает "<y>" (было '<>')

2. Macro: V=akey(N) - функция возвращает имя или код клавиши, инициировавшей макрос.

3. Macro: Bug: если в макропоследовательности есть только 1 "клавиша", отличная от набираемых на клавиатуре
   (например, $AKey), то такой макрос ничего не делает (точнее может делать все, что угодно).
   Это остатки (недопеределки) предыдущих изысканий из области сокращения объемов памяти
   (было - если клавиша одна, то память не выделяется, а Buffer считается не как указатель на массив DWORD`ов,
   а как значение DWORD).

4. Dialog: bug: когда в комбобоксах применяются хоткеи, в строку редактирования символ '&' тоже попадает.

5. Фильтры: в конце filefilterparams.cpp::MenuString() сделаем обрезание концевых пробелов.

6. API: добавлены флаги: FMENU_TRUNCPATH, FMENU_TRUNCSTR, FMENU_TRUNCSTREND.
   Показывают как нужно обрезать выводимый на экран пункт меню. Оригинальный текст пункта не изменяется.

7. В любом объекте, основанном на VMenu действуют клавиши
     Ctr-N - включить/выключить режим обрезания выводимых итемов списка
     Alt-Home/Alt-End - прокрутка всех элементов списка по горизонтали в начало/конец
     Alt-Left/Alt-Right - прокрутка всех элементов списка по горизонтали влево/вправо на 1 символ
     Alt-Shift-Left/Alt-Shift-Right - прокрутка текущего элемента списка по горизонтали влево/вправо на 1 символ

    TODO: ОТКРЫТЫЙ ВОПРОС ПРО Ctrl-N !!!

8. Mantis#0000264: Недочёты диалога редактирования группы раскраски
    1. изменен tab-ордер задаваемых цветов
    2. добавлены горячие клавиши в комбобоксах Size и Data/Time.

9. Добавлены функции
     wchar_t* WINAPI TruncStrFromEnd(wchar_t *Str,int MaxLength)
      (по аналогии с TruncStr и TruncPathStr)
   и
     string& HiText2Str(string& strDest, const wchar_t *Str)
      (аналог HiText(), но вывод в строку)

10. Возможно с LIF_USETEXTPTR перебор вышел...
    возможно этот флаг ненужно было тянуть из 1.7x


t-rex 11.03.2008 11:17:36 +0200 - build 430

1. Mantis#488: Crash in GetRegKey()
   в общем просто неправельный вызов из PrepareTable().

2. Mantis#468: Закрытие быстрого просмотра папок вызывает VE_CLOSE (без VE_READ)
   Тут типа 2 бага:
   1. То что qview вообще создаёт объект въювера при просмотре папки.
   2. То что в деструкторе посылается VE_CLOSE хотя никакого файла открыто небыло.

t-rex 10.03.2008 22:39:06 +0200 - build 429

1. Mantis#487: Memory under FAR_FIND_DATA is removed twice
   Тока там всё хуже было, фар нагло освобождал плагиновую память и свою подсовывал.

t-rex 10.03.2008 21:47:59 +0200 - build 428

1. От Alexey Samlyukov: Mantis#486: Баг в Dialog::ProcessLastHistory - не подставлялось значение из истории.

2. В связи с 1 нашелся ещё баг в UnicodeString, если в кратце то возможное чтение из недоступной памяти при
   str = (const wchar_t *)str;
   str += str;

3. Заодно ещё немного форматирования табами.

4. Обновил немного "readme".

t-rex 09.03.2008 23:11:42 +0200 - build 427

from Alexander Mitin

1. Mantis#484: Memory corruption in GetPathRootOne().

t-rex 09.03.2008 14:35:11 +0200 - build 426

1. Грузились все плагины подряд даже когда не надо.
   К примеру колорер загружался при открытии въювера, диалогов и архивов :)

2. Кэш всех плагинов читался тока из первой записи кэша из за чего плагины
   могли тупо не грузится пока их не вызвать из меню плагинов, а в некоторых
   случаях не грузится вообще (особенно с фиксом 1 :).

drkns 09.03.2008 12:28:26 +0200 - build 425

1. Обнаружены чудеса: wcsncat(dst,src,sizeof(dst)-1)
   На всякий случай: 3-й параметр в wcsncat - это "сколько дописываем", а не "сколько влезает".
   Во всех подобных местах wcsncat заменена на xwcsncat, где 3-й параметр уже таки размер приёмника-1.

2. Комбобокс, открытый по Alt-Hotkey, при закрытии получал DN_EDITCHANGE
   с параметрами предыдущего фокусного элемента.

3. В открытый комбобокс не приходили события от мыши.

4. Мелкий баг в диалоге задания макрокоманды.

t-rex 09.03.2008 12:23:43 +0200

1. Конфликты хоткеев в диалоге фильтров (анг).

t-rex 09.03.2008 11:38:53 +0200 - build 424

От Dmitry Ovdienko:

1. Mantis#483: Undefined behavior in Search window.

t-rex 08.03.2008 19:21:05 +0200 - build 423

От Alexey Samlyukov:

1. Mantis#439: Cancel after Ctrl+G should not update the panels.

t-rex 08.03.2008 15:51:50 +0200 - build 422

От George Yohng:
1. Mantis#475: Отображение заголовка панели ЗАГЛАВНЫМИ буквами даже когда директорий не заглавный.

warp 02.03.2008 17:50:00 +0300 - build 421

1. Так, постебаться. Исправил недопоказ плагинов в меню дисков.

t-rex 25.02.2008 01:28:29 +0200 - build 420

От Stanislav Vinokurov:

1. Mantis#436: PrepareExecuteModule() bug(s)

zg 20.02.2008 19:27:59 +0200 - build 419

1. hotplug devices list. при удалении подряд нескольких устройств - визуальные глюки.

drkns 12.02.2008 22:41:34 +0200 - build 418

1. Mantis#0000464: В панелях F10 F1... появляется "Requested help topic not found:"

2. Для плагинов не вызывался ExitFAR при выходе.

3. Уточение в отрисовке открытого комбобокса.

4. Мелкие правки во враппере.

svs 30.01.2008 01:38:39 +0300 - build 417

1. В headers.hpp закомменчен "#include <crtdbg.h>" - кому надо - ставьте "#if"
   в зависимости от компилятора. MSVC (по крайней мере у меня) и без этого
   компилит.

2. Mantis#0000460: Add support of FILE_ATTRIBUTE_VIRTUAL
   "временно" патч принимается.
   "временно" - потому, что диалог фильтра не вмещается в 25 строк.
   нужен редизайн диалога фильтра - это отдельная песня.

3. Букмарки в редакторе... перенесены в макросы:
     N=BM.Add()
     N=BM.Clear()
     N=BM.Next()
     N=BM.Prev()
     N=BM.Stat()
   Причем...
   а) нужно доработать математику "BM.Stat()" (что-то типа StatStackBookmark())
   б) "BM.XXX" в принципе может быть не только "редактор" :-)
   d) Хмм... индикацию, опять же... стекового букмарка...

4. Хмм... трабла? откуда?
   В панелях F10 F1... появляется "Requested help topic not found:"
   Таки Хто?

Zuz 25.01.2008 23:11:21 +0500 - build 416

1. Mantis#000337, Mantis#0000176 refix
2. Двойное обновление панели после CTRL-Z.

ts 23.01.2008 15:32:27 +0200 - build 415

1. Добавлена поддержка навигации а-ля браузер в редакторе: Ctrl-<Gray Enter> сохраняет
   позицию навигации, Ctrl-<Gray -> и Ctrl-<Gray +> переход на следующую и предыдущую
   позиции навигации.
2. В апи редактора добавлены команды управления позициями навигации: ECTL_ADDSTACKBOOKMARK,
   ECTL_PREVSTACKBOOKMARK, ECTL_NEXTSTACKBOOKMARK, ECTL_CLEARSTACKBOOKMARKS для добавления
   позиции навигации, переход к предыдущей, следующей позициям навигации и очистка списка
   навигаций.

drkns 18.01.2008 23:48:39 +0200 - build 414

1. Враппер:
   - Изменена логика хранения массивов структур FarDialogItem и oldfar::FarDialogItem,
     а также конветрирования одного в другой. Теперь (по идее) корректно и без утечек
     обрабатываются DM_GETDLGITEM и прочие сообщения, передающие плагину FarDialogItem.

   - в макросы EXECUTE_FUNCTION/EXECUTE_FUNCTION_EX (pluginA.cpp) добавлена SetFileApisToOEM();

   - добавлен "режим совместимости" - возможность задать версию FAR, возвращаемую в
     ACTL_GETFARVERSION - как оказалось, не все плагины понимают, что 1.80 > 1.70 :-)
     Берётся из \software\far18\wrapper\version, REG_DWORD, формат - как в MAKEFARVERSION.
     Скручивать можно только в меньшую сторону, от текущей версии до 1.70.1.

2. Язык интерфейса периодически сбрасывался на английский.

3. Уточнение в plugin.hpp.

drkns 15.01.2008 19:50:26 +0200 - build 413

1. Враппер:
   - уточнения в DM_LISTGETCURPOS и DM_GETSELECTION;
   - MB_USEGLYPHCHARS был нужен не везде;
   - прочие мелкие правки.

2. В DialogItemEx инициализировались не все поля (в 1.7x это делал memset),
   что при определенных обстоятельствах было чревато падениями.

3. Лишний инкремент количества строк в редакторе при вставке новой строки.

4. gcc warnings.

svs 15.01.2008 14:44:11 +0300 - build 412

1. Mantis#0000425: Add support of FILE_ATTRIBUTE_OFFLINE attribute

2. Добавлен FILE_ATTRIBUTE_VIRTUAL
   Пока что для отображения. Если "нада" - делать изменения по аналогии c FILE_ATTRIBUTE_OFFLINE...
   ..типа ID_FF_VIRTUAL и еже с ним...
   ...если кто объяснит как ЭТО УВИДЕТЬ!

3. Немного добавок в syslog.cpp
   + IO_REPARSE_TAG_* в headers.hpp

4. Не работают хоткеи при русской раскладке (с альтом работают).
   See Dialog::IsKeyHighlighted()

drkns 14.01.2008 19:43:11 +0200 - build 411

1. Враппер:
   - от Tim Sobolev: правильная обработка DI_USERCONTROL;
   - более корректная обработка нескольких одновременно открытых диалогов;
   - не работал DM_LISTDELETE;
   - при преобразовании OEM->Unicode используется флаг MB_USEGLYPHCHARS.
   - прочие мелкие правки.

Zuz 12.01.2008 01:52:26 +0500 - build 410
1. Ещё немного снижены требования к правам (Mantis#0000453).

2. В FindFiles::LookForString замена libc API для файловых операций на WIN32 API.


drkns 11.01.2008 11:12:03 +0200 - build 409

1. Враппер:
   - добавлена ConvertNameToRealA.
   - уточнения в ConvertKeyBarTitlesA, FarMenuFnA и FCTL_GET[ANOTHER]PANEL[SHORT]INFO.
   - DN_* -> oldfar:DN_.
2. Не работал QuickView на плагиновой панели.

svs 11.01.2008 11:48:41 +0300 - build 408

1. Mantis#0000456: Функция ConvertNameToReal не работает для симлинков
   уточнение

svs 09.01.2008 20:53:11 +0300 - build 407

1. Mantis#0000447: Buffer overrun in Edit:ProcessKey()
   "патч на патч"

svs 09.01.2008 19:54:42 +0300 - build 406

1. Mantis#0000456: Функция ConvertNameToReal не работает для симлинков
     Функция ConvertNameToReal не работает для симлинков, т.е. вместо полного пути с
     развёрнутыми симлинками (в случае их наличия) возвращает мусор.

     Что сделано:
     1. В функции ConvertNameToReal исправлена работа с симлинками (ошибки портирования);
     2. Функция ConvertNameToReal не учитывала возможность существования вложенных симлинков,
        т.е. она завершала свою работу после нахождения первого с конца пути симлинка
        (насколько я понимаю, ошибка перетянута из линейки 1.7x, так что неплохо было бы
        фикс портировать и туда).

   От себя добавил приведение к int (у GetBuffer параметр = int)

2. Mantis#0000455: Fix in GetWindowText

ts 07.01.2008 12:25:13 +0200 - build 405

1. В OpenPluginInfo теперь передается полная информация из старых плагинов, во
   враппер добавлены сопутсвующие функции.
2. Во враппер добавлена функция ArrayAnsiToUnicode для преобразования в юникод
   массива строк, конец массива помечается элементом-маркером, при удалении созданного
   массива с помощью FreeArrayUnicode не нужно указывать его размер.
   Рекомендуется использовать эту функцию во всех встречающихся местах.
3. Поправлено отладочный билд, сломанный в 402

ts 07.01.2008 21:02:07 +0200 - build 404

1. Во wrap.cpp добавлены функции OldKeyToKey и KeyToOldKey для перевода внутренних
   кодов клавиш FAR со старого формата в новый и обратно.
2. В KeyNameToKeyA и FarKeyToNameA добавлено коррекцию кода клавиши.
3. Доработаны (возможно) ECTL_PROCESSINPUT, ECTL_PROCESSKEY, ECTL_READINPUT.
4. Добавлена заглушка FarCharTableA.

t-rex 07.01.2008 08:31:08 +0200

1. Правки индентации во врапере, без билда.

ts 07.01.2008 06:45:38 +0200 - build 403

1. Поправлена передача флагов во враппере для FarStandardFunctions:
   a. FarRecursiveSearchA
   b. ProcessNameA
2. Во враппер добавлена функция AnsiToUnicodeBin для преобразования в юникод
   символов из буфера заданной длины (см. UnicodeToAnsiBin).
3. В функции UnicodeToAnsiBin увеличено размер выделяемой под результирующую
   строку памяти на байт для нормальной работы старых плагинов, считающих что
   строка всегда завершается нулем (например в EditorGetString.StringText).
4. Изменена логика обработки команд доступа к АПИ редактора во враппере
   (функция FarEditorControlA), заменена обработка команд:
   a. ECTL_SAVEFILE, ECTL_SETKEYBAR, ECTL_SETTITLE - полностью.
   b. ECTL_PROCESSINPUT, ECTL_PROCESSKEY, ECTL_READINPUT - временно, в работе.
   d. ECTL_SETPARAM - полностью, кроме заглушки на команду ESPT_CHARTABLE в
                      силу отсутствия обработки в самом фаре.
                      А для команды ESPT_GETWORDDIV в самом фаре пора бы
                      использовать Reserved2 для передачи длины принимающего
                      буфера.
   e. ECTL_SETSTRING - непонятно что подразумевалось под "Помещаемая строка
                       должна быть в кодировке редактора", считаем что строка
                       была в ОЕМ (как результат ECTL_GETSTRING).

   Теперь работают все АПИ вызовы редактора кроме ECTL_EDITORTOOEM и ECTL_OEMTOEDITOR

   Не забываем во враппере правильно передавать флаги, в юникодовой ветке у них часто
   другие значения!

drkns 06.01.2008 14:57:04 +0200 - build 402

1. Новые псевдоклавиши MsWheelLeft и MsWheelRight - горизонтальная прокрутка колеса мыши (для Vista и выше).
   В TI#33 добавлены параметры MsHWheelDelta*.

svs 05.01.2008 19:19:19 +0300 - build 401

1. По аналогии с Mantis#0000414 "починем" хэндлы файлов в поисковике и вьювере

2. Mantis#0000453: При поиске файлов с учетом содержимого файлы открываются с запросом прав на изменение
   (тянет еще аж с 1.65...)

3. Небольшое уточнение в registry.cpp::MkKeyName - RegMon`у не нравится... например, такое: "HKCU\\Console"


ts 05.01.2008 11:39:30 +0200 - build 400

1. Changes in wrapper messages handling for listbox and combobox.

t-rex 04.01.2008 18:07:50 +0200 - build 399

1. From Hannes Eder (and some changes from me): remove redundant definition of GetFileDateAndTime from setattr.cpp.

2. Mantis#445: Makefiles have no -mno-cygwin switch.

drkns 31.12.2007 20:03:57 +0200 - build 398

1. Некорректная работа GetPathRoot() для относительного пути внутри симлинка.

2. При вызове меню плагинов из диалогов не выставлялась соответствующая макрообласть.

3. В диалог подтверждения перезаписи файла добавлена кнопка "Append all".

4. Mantis#0000023: ConsoleAlias. Работает в комстроке и меню пользователя.
   Поддерживается стандартный спецсимвол $*. Управлять этим делом можно с помощью doskey.

5. Из 1.7 перетащено наследование от региональных настоек системы разделителей
   групп разрядов и целой/дробной части чисел.

6. TechInfo #78:
   [HKEY_CURRENT_USER\Software\Far\Interface]
   "FormatNumberSeparators":REG_DWORD
   Параметр  "Interface/FormatNumberSeparators"  с  типом  DWORD  позволяет
   определять символы,  используемые в качестве разделителей групп разрядов
   и целой/дробной части чисел.
   Старшее слово - код символа для разделителя групп разрядов.
   Младшее слово - код символа для разделителя целой и дробной части.
   По умолчанию значение - 0 (использовать региональные настройки ОС).

7. Добавлена команда ACTL_REDRAWALL - перерисовка всех фреймов фара.

svs 28.12.2007 13:39:19 +0300 - build 397

1. Mantis#0000452: Bug, doubling code and improvements in hotplug.cpp

svs 23.12.2007 16:14:14 +0300 - build 396

from Alexey Samlyukov:

1. memcpy()/wmemcpy() + прочая уникодная мелочь + убраны анахронизмы (#if defined(FAR_ANSI)), может и зря..

svs 23.12.2007 15:54:37 +0300 - build 395

1. Mantis#0000447: Buffer overrun in Edit:ProcessKey()

2. Mantis#0000446: Wrong function to free memory in TreeList::SaveState()

3. Mantis#0000449: Handle leak in History::ReadHistory()

4. Mantis#0000444: Bugs and memory leaks in class History

5. Mantis#0000441: Cannot delete file "Descript.ion"
   Здесь в panel.hpp было неправильное определение виртуальной функции GetDizName().
   Поэтому в ShellDelete() конструкция SrcPanel->GetDizName(strDizName); возвращала...
   да ничего она не возвращала!

yjh 15.12.2007 00:54:56 +0300 - build 394

1. Доделка фильтров "исключения" при поиске (Alt-F7) в отношении каталогов.
   Теперь поведение фильтров такое же как в копировании, т.е. если включена
   фильтрации и в списке есть "запрещающий" (-) фильтр, то когда под его
   действие попадает каталог пропускается не только сам каталог, но и всё
   что находится в нём (и его подкаталогах). Разумеется, это верно только при
   выключенном D+ :)


svs 15.12.2007 00:35:38 +0300 - build 393

1. Неправильно сохранялись макросы, содержащие буквы, оличные от латиницы.
   По этому поводу:
   а) уточнение в KeyNameToKey и KeyToText;
   б) в KeyMacro::ReadMacros юзалась не та функция GetRegKey().

drkns 14.12.2007 21:59:01 +0200 - build 392

1. Меню плагинов можно вызывать по F11 из диалогов.
   Чтобы попасть в это меню, плагин должен установить флаг PF_DIALOG в PluginInfo.Flags.
   Вызванный плагин получает следующие параметры в OpenPlugin():
   - OpenFrom: OPEN_DIALOG
   - Item: указатель на структуру OpenDlgPluginData:
     struct OpenDlgPluginData
     {
      int ItemNumber; //номер выбранного пункта в меню из зарегистрированных плагином пунктов
      HANDLE hDlg;    //хэндл диалога, из которого вызван плагин
     };

2. Плагин может экспортировать ProcessDialogEvent для обработки поступающих в диалог событий:
   int ProcessDialogEvent(int Event, void* Param)
   Event:
    DE_DLGPROCINIT - событие поступает в обработчик
    DE_DEFDLGPROCINIT - событие поступает в стандартный обработчик
    DE_DLGPROCEND - событие уже обработано

   Param - указатель на структуру FarDialogEvent:
   struct FarDialogEvent
   {
    HANDLE hDlg;
    int Msg;
    int Param1;
    LONG_PTR Param2;
    LONG_PTR Result;
   };

   return:
   - TRUE - событие обработали сами, не продолжать обработку.
     FarDialogEvent.Result - указатель на переменную, используемую обработчиком
     в качестве возвращаемого значения.
   - FALSE - продолжить обработку события.

svs 14.12.2007 13:45:16 +0300 - build 391

from Alexander Mitin

1. Mantis#0000432: Assertion while creating a submenu in User Menu

2. Mantis#0000431: Crash when deleting the File Highlighting entry

3. Mantis#0000430: Crash in "Системные параметры"


svs 13.12.2007 20:31:34 +0300 - build 390

1. Mantis#0000433: Updated operator new in new.cpp

2. Mantis#408: Memory leak in struct MacroState.
    тыкс... перебор вышел с Work.locVarTable :-(
    Сам "Work.locVarTable" нужно удалять только в деструкторе.
    В остальных случаях - только содержимое таблицы.

3. API: Команда MCMD_GETSTATE для ACTL_KEYMACRO,
    возвращает одно из значений (перечисление FARMACROSTATE):
      enum FARMACROSTATE {
        MACROSTATE_NOMACRO          =0,  // не в режиме макро
        MACROSTATE_EXECUTING        =1,  // исполнение: без передачи плагину пимп
        MACROSTATE_EXECUTING_COMMON =2,  // исполнение: с передачей плагину пимп
        MACROSTATE_RECORDING        =3,  // запись: без передачи плагину пимп
        MACROSTATE_RECORDING_COMMON =4,  // запись: с передачей плагину пимп
      };

4. Попытка исправить
   Mantis#0000432: Assertion while creating a submenu in User Menu
   Mantis#0000430: Crash in "Системные параметры"

svs 10.12.2007 21:22:18 +0300 - build 389

1. Mantis#0000428: Вновь DI_COMBOBOX
   Отсутствовала проверка на тип элемента.

2. Mantis#0000429: Не очищается и не сохраняется кеш директорий

3. Macro: BOF, EOF, EMPTY и SELECTED не обрабатывались в ком.строке

4. Mantis#0000415: произошли какие-то непонятные изменения в DI_COMBOBOX
   (сломалось в 306)

5. API: пусть OPEN_FILEPANEL будет официальным, а не спрятанным.

t-rex 08.12.2007 23:40:46 +0200 - build 388

От Stanislav Vinokurov:

1. Mantis#411: Batch files are executed in the external window.

t-rex 08.12.2007 17:55:02 +0200 - build 387

1. Mantis#416: Crash while deleting folders
   Это в общем более глубокая проблема была, глюк был в UnicodeString,
   размер буффера рос при операциях для которых его рост был не нужен и при многих
   операциях над одной и той же строкой буффер вырастал до нереальных значений.

2. Mantis#408: Memory leak in struct MacroState.

3. Коррупция хипа при удаление несуществующих макросов.

4. Некорректное сохранение REG_MULTI_SZ макросов.

5. From Hannes Eder: StrLength in clipboard.cpp.

6. Потенциальные коррупции хипа и за неправильного не/использование sizeof(wchar_t) в паре мест.

7. От Alexey Samlyukov: wmem* вместо mem* в strmix.cpp.

t-rex 07.12.2007 16:36:54 +0200 - build 386

1. Mantis#421: Memory leak caused by using memset() to initialize values of structures.

svs 06.12.2007 18:45:06 +0300 - build 385

1. 2 новых эвента для панельного плагина: FE_GOTFOCUS и FE_KILLFOCUS
   Параметр Param для ProcessEvent равен NULL.
   В соответствии с этим переделан механизм (очередность) посыла событий - сначала Gotfocus, а потом остальное.
   Для этого в SetPluginMode() добавлен параметр SendOnFocus

2. В диалогах, сразу после DN_INITDIALOG приходит DN_GOTFOCUS для того элемента, который Focus=1

3. 2 новых эвента для редакторного плагина: EE_GOTFOCUS и EE_KILLFOCUS
   Параметр Param для ProcessEditorEvent равен EditorID.
   Для этого в класс FileEditor добавлена virtual функция OnChangeFocus.


svs 06.12.2007 13:31:33 +0300 - build 384

1. Mantis#0000417: Memory leak in Viewer::ProcessKey()

2. Mantis#0000418: Wrong memory copy function used in TArray<Object>::Pack()

3. Mantis#0000419: Wrong memory copy function used in ScreenBuf::Scroll(int Num)

4. Mantis#0000420: INVALID_HANDLE_VALUE used in FindClose() in ScanTree::GetNextName()


svs 05.12.2007 17:29:24 +0300 - build 383

1. Mantis#0000414: Handle leak in FileEditor::LoadFile()

2. Mantis#0000412: Wrong delete type in Language::Init()

3. Mantis#0000413: Wrong delete type in FileEditor::SaveFile()


t-rex 04.12.2007 23:41:54 +0200 - build 382

1. Различные глюки - по большому кривое использование sizeof в связи с wchar_t.

drkns 04.12.2007 19:55:33 +0200 - build 381

1. Мелкий глюк в 379.

svs 04.12.2007 20:25:07 +0300 - build 380

1. Mantis#0000410: Memory leak in class History

drkns 04.12.2007 18:51:36 +0200 - build 379

1. Mantis#0000409: User Menu (F2) doesn't handle process INS key when Opt.UseNumPad == 1
   Также поправлено в истории строк ввода, ссылках на папки, фильтрах и ассоциациях.

svs 04.12.2007 09:26:51 +0300 - build 378

1. Mantis#0000354: Goto dialog in editor
   Здесь сделано не так, как хотелка звучит.
   Добавлен флаг DIF_NOAUTOCOMPLETE, но т.к. код в dialog.cpp закомменчен, то
   просто обозначено место в коде...

2. Mantis#0000331: ...
   про комбобокс; уточнение:
   - корректировка Top`а
   - динамическое изменение открытого выпадающего списка (Hide+Show)


t-rex 04.12.2007 08:18:31 +0200 - build 377

1. Mantis#406: Memory corruption and crash in Editor::AddUndoData().

2. Mantis#407: Memory leak in CommandLine class.

t-rex 03.12.2007 23:19:20 +0200 - build 376

1. Mantis#367: Не загружаются плагины, когда FAR запущен из папки которая сама или одина из её папок более высокого уровня являются связью.

2. Mantis#401: Handle leak in ProcessGlobalFileTypes().

3. Mantis#402: Handle leak in History::SaveHistory().

4. Mantis#403: Not initialized variable used in MessageRemoveConnection().

5. Mantis#404: Handle leak in CopyKeyTree().

6. Mantis#400: Function xf_wcsdup() should replace wcsdup().

drkns 03.12.2007 20:20:28 +0200 - build 375

1. Mantis#0000364: Maximize button doesn't work as expected
   Попробуем с другой стороны :-)
   Теперь работает "as expected" (кнопка, даблклик по заголовку, Maximize/Restore в системном меню и т. п.)
   Также учитывается состояние окна консоли при старте (start /max, настройка в lnk и т. п.)

drkns 03.12.2007 07:54:40 +0200 - build 374

1. Mantis#0000399: Memory leak in add_sid_cache()

2. Не работал DM_SETDLGITEM

t-rex 03.12.2007 00:01:04 +0200 - build 373

1. По наводке от Sten, Mantis#398: Patches to fix crashes after adding file to archive by pressing Shift+F1/Enter.

2. One of the memory leaks fixed in 372 was not a memory leak at all :), it was a perfectly correct code.

t-rex 02.12.2007 23:06:15 +0200 - build 372

1. From Hannes Eder: removed unused variables and corrected a condition in macro processing.

2. Fixed two memory leaks found along the way.

t-rex 02.12.2007 20:05:17 +0200 - build 371

1. От Stanislav Vinokurov: Mantis#397: Неправильная обработка oldfar::DM_GETTEXTPTR в FarSendDlgMessageA()

2. Тоже самое для oldfar::DM_GETTEXT.

t-rex 02.12.2007 13:59:53 +0200 - build 370

1. Из Mantis#396, неверная проверка при реалоке в TreeList::ReadTreeFile.

t-rex 02.12.2007 00:15:59 +0200 - build 369

1. Mantis#394: В OpenFilePlugin() должен передаваться в Name полный путь, а не имя файла.

t-rex 01.12.2007 19:47:22 +0200 - build 368

1. Memory leak в DeletePluginItemList.

2. Mantis#314: поле Description в PluginPanelItem находится мусор при вызове GetFilesW.
   И дупликат, Mantis#393.

3. Mantis#380: Memory leak in ConvertWildcards().

t-rex 01.12.2007 15:54:34 +0200 - build 367

от Stanislav Vinokurov (Sten):

1. Mantis#391: Wrapper: Реализация FarRecursiveSearchA.

2. Mantis#392: Wrapper: Некорректная обработка DI_EDIT и DI_FIXEDIT в AnsiDialogItemToUnicode().

t-rex 30.11.2007 16:28:14 +0200 - build 366

от Alexey Samlyukov:

1. Mantis#388: фиксы инициализации диалогов File/Folder descriptions.

t-rex 30.11.2007 16:12:41 +0200 - build 365

от Alexandr Zamaraev:

1. Mantis#387: copy.cpp, цикл подсчёта количества вместо вызова функции.

t-rex 30.11.2007 16:02:33 +0200 - build 364

от Alexey Samlyukov:

1. Mantis#389: удалим ConvertOldSettings().

t-rex 30.11.2007 15:30:14 +0200 - build 363

1. UnicodeString: Удалил RShift, глюкодром полный и оно не нужно.

2. UnicodeString: Исправил LShift, не выставлялась длина строки после изменения.

3. По наводке от Sten, неправильно работал цикл в PluginManager::OpenFilePlugin.

drkns 27.11.2007 21:20:14 +0200 - build 362

1. Обновление DialogAPI: FarListItem.Text теперь const wchar_t*.
   Плагины c DI_LISTBOX/DI_COMBOBOX надо править.

2. Криво работал DM_LISTGETITEM.

svs 27.11.2007 09:46:25 +0300 - build 361

1. TechInfo#48 по умолчанию делаем 1, а для Numpad5 TechInfo#48 игнорируем.

2. Mantis#0000360: Неверное отображение назначаемой клавиши
   Здесь есть вопросы...
   а) Не отработан код (в InitKeysArray), когда TechInfo#21 == 0
   б) проверял под двумя локалями - 409 и 419: проверить бы на остальных.
   с) замечено (кстати, в 1.7x тоже самое) в русской раскладке 2 правых
      нижних клавиши '.' и '/' выдают один и тот же код ==> '.', т.к.
      нажали <.> ==> LocalKeyToKey(0x44E) ==> 0x2E
      нажали </> ==> LocalKeyToKey(0x02E) ==> 0x2E
      В принципе, на работоспособность это не влияет, но визуально...

3. Уточнения в SysLogDump()

svs 26.11.2007 12:49:47 +0300 - build 360

From Alexander Mitin (alexmitin):
1. Mantis#0000379: Memory corruption in QuickView::DisplayObject()

В остальном - в keyboard.cpp local.cpp macro.cpp отмечены спорные моменты для Mantis#360

t-rex 25.11.2007 21:15:46 +0200

Без билда.

1. Не нужный "wchar_t *m_lpwszBuffer" в UnicodeString.hpp.

2. Обновления в HACKING-*.

t-rex 25.11.2007 20:39:14 +0200 - build 359

от Alexey Samlyukov:

1. Mantis#376: Фикс диалога Viewer settings.

drkns 24.11.2007 18:24:58 +0200 - build 358

1. Не обрабатывались макросы, содержащие макрокоманды $If, $Else и т. п.

2. Не работала макрофункция Date().


t-rex 24.11.2007 18:03:42 +0200 - build 357

1. Mantis#375: Не вызывался Network плагин при ChangeUp из сетевого ресурса. По наводке Redart.

t-rex 24.11.2007 17:30:03 +0200 - build 356

1. Вернул поиск в редакторе.

2. При поиске в редакторе мог пропадать курсор.

drkns 22.11.2007 19:33:01 +0200 - build 355

1. Mantis#0000365: Падение при вводе любого символа в поле "Опциональный символ пометки" в диалоге фильтра раскраски файлов

2. Mantis#0000366: В диалоге раскраски файлов и групп сортировки не всегда корректно показываются опциональные символы пометки


svs 19.11.2007 11:57:58 +0300 - build 354

1. Mantis#0000358: Для элемента "точки" PluginPanelItem.UserData всегда 0

t-rex 18.11.2007 23:23:43 +0200 - build 353

1. Доделал DN_EDITCHANGE и DN_DRAWDLGITEM на предмет передачи FarDialogItem.

2. Юзаем правильные xf_(free|malloc|realloc) во всём коде.

drkns 18.11.2007 12:11:21 +0200 - build 352

1. для меню пользователя выставлялась макрообласть Menu, a не UserMenu.


t-rex 18.11.2007 02:19:42 +0200 - build 351

1. Mantis#357 По наводке от Oleg Bekhter: Удар по памяти при удаление блока в редакторе.

t-rex 18.11.2007 01:33:22 +0200 - build 350

1. Мешанина new и malloc при работе с Clipboard.
   Заодно убраны пару мем ликов и около того.

2. Юзаем правильные xf_(free|malloc|realloc) во врапере.

t-rex 16.11.2007 22:52:36 +0200 - build 349

1. Снова обновление DialogAPI, теперь вроде бы с ним удобно работать
   (нету больше аллокатора и выходных данных).
   Плагины которые используют DialogAPI надо переделывать!
-----------------------------------------
   Описание нового API:
   Теперь есть 3 функции: (Dialog и DialogEx больше нету)
   а. HANDLE DialogInit(те же параметры что и были у DialogEx), возвращает
      описатель диалога или INVALID_HANDLE_VALUE в случае ошибки.
   б. int DialogRun(HANDLE hDlg), запускает диалог, возвращает то что раньше
      возвращал DialogEx.
   с. void DialogFree(HANDLE hDlg), освобождает всю память связанную с диалогом.

   FarDialogItem уже не имеет DataIn и DataOut а только const wchar_t *PtrData.
   Этот PtrData является начальным текстом для элемента.

   Главное отличие от старого DialogAPI это то что массив структур FarDialogItem
   является только входным, в него не пишутся ни какие изменения при закрытии
   диалога.

   Система работы с новым API такова:
   DialogInit()
   DialogRun()
   *** различные вызовы SendDlgMessage()                ***
   *** для получения нужных выходных данных из диалога. ***
   DialogFree()

   Также появились дополнительные DM_* и изменён один старый:
   а. DM_GETDLGITEM - изменён, Param2 должен быть 0, а поинтер на нужный
                      элемент возвращается самой функцией (NULL если ошибка).
                      Фар сам аллоцирует память под элемент, его нельзя
                      изменять и в конце использования его надо освободить с
                      помощью DM_FREEDLGITEM.
   б. DM_FREEDLGITEM - освобождает элемент полученый с помощью DM_GETDLGITEM.
                       Param1=0, Param2 = поинтер полученый от DM_GETDLGITEM.
   с. DM_GETCONSTTEXTPTR - возвращает (const wchar_t *) поинтер на внутренний
                           буффер фара связаный со строкой элемента. Не в коем
                           случае нельзя изменять, а также нельзя сохранять сам
                           поинтер так как он меняется при изменениях в строке
                           элемента. Добавлен для удобства работы после
                           закрытия диалога (DialogRun) и до DialogFree, но
                           можно конечно использовать и в обработчике, только
                           аккуратно :). Param1 = ID элемента, Param2 = 0.
-----------------------------------------

yjh 16.11.2007 07:20:48 +0300 - build 348

1. В операции Move при включенной фильтрации не удалялся полностью
   скопированный каталог

2. В операции Move при включенной фильтрации пустые каталоги не копировались
   даже если они соотвествуют фильту


yjh 16.11.2007 00:17:38 +0300 - build 347

1. В правке фильтров исключений не учитывался запрет на фильтрацию каталогов



drkns 15.11.2007 20:04:49 +0200 - build 346

1. Ещё одна небольшая правка с овнерами.


yjh 15.11.2007 04:10:08 +0300 - build 345

1. Доделка фильтров "исключения" при копировании в отношении каталогов.
   Если при копировании включена фильтраци, то в отношении "разрещающих"
   фильтров всё работает как раньше. В отношении же "запрещающих" (-) фильтров,
   если встречается каталог подпадающий под действие фильтра, то пропускается
   и он и всё его содержимое

2. Убрана пара BUGBUG в копировании при включенных фильтрах. Теперь работает :)


drkns 14.11.2007 22:22:05 +0200 - build 344

1. Мелкий глюк в 343.

drkns 14.11.2007 21:22:05 +0200 - build 343

1. Не обрабатывалась маска %pathext% в раскраске файлов.

2. В режиме отображения овнеров не работало кеширование и не освобождалась память.

3. К типу колонки "владелец файла" можно добавлять флаг 'L' - отображать домен.

4. Можно вводить юникодные символы по Alt-NumX :)


yjh 14.11.2007 22:04:42 +0300 - build 342

1. В FarMkTempEx игнорировлася параметр WithPath, что далеко не всегда допустимо

2. В FarMkTempEx убран потенциальный infinite loop. При ошибке возвращается
   "пустая" строка (при референсах по другому не получится)

3. В WipeDirectory переименование сделано именно переименованием (inplace)
   вместо "перемещения". Это дешевле, исчезает ошибка "восстановления" (при
   невозможности удаления и ответе Skip оставались частично переименованные
   каталоги, да ещё и не всегда на своём месте :), меньше вероятность нарваться
   на "забитость" каталога (при генерации имени временного файла).
   Кроме того. в старой логие оно вооще не могло работать, когда  Opt.TempPath
   на другом диске - MoveFile не позволяет перемещать каталоги между дисками



drkns 13.11.2007 22:45:17 +0200 - build 341

1. Падение в режиме панели "File owners".

2. В панелях не работал быстрый поиск по неанглийским символам.

3. Правки на предмет юникода в меню выбора принтера.


yjh 13.11.2007 09:44:34 +0300

1. Возможность компилировать хук vc7 (для извращенцев :). Очень рекомендую
   в этом случае омпилировать определив -DLINK_WITH_ULINK и компоновать
   ulink'ом. В противном случае, работать-то будет, но меньше степень
   защиты :). О чём будет сообщение при компиляции :)


yjh 13.11.2007 07:06:56 +0300 - build 340

1. FarNameToKey для плугинов


yjh 13.11.2007 03:04:15 +0300 - build 339

1. Hook позволяющий 32хбитовому Far'у корректно работать с FS в Win64
   (отключение WOW64-fs redirection). По умолчанию оно отключено и
   включается только на моменты загрузки DLL/запуска задач (для "штатной"
   работы 32хбитовых процессов).
   При желании собрать Far без этого кода следует определить (для make)
   DISABLE_WOW64_HOOK.
   Корректно это будет компоноваться (и, как следствие, работать) либо
   ms-link не ниже чем от vc8, либо ulink версии >= 1.05 build 3.9 (лучше
   использовать build >= 3.11 - иначе будет ненужное информационное сообщение).


t-rex 12.11.2007 22:58:42 +0200 - build 338

1. Пару глюков в открытие хэлпа в фаре и в АПЙ.

drkns 12.11.2007 21:59:08 +0200 - build 337

1. Мелкие правки во враппере

2. При записи макроса руками по Ctrl. запоминалась только последняя нажатая клавиша.

3. Цикличный перевод фокуса с первого элемента диалога на последний приводил к зависанию.

4. В меню дисков нельзя было одновременно включить показ метки и файловой системы.

svs 12.11.2007 19:09:32 +0300 - build 336

1. Mantis#0000352: Undo, вызываемое CTRL+Z не работает если открыть существующий файл на редактирование
   Продолжаем...
   ...слишком мало данных сохранялось :-(

svs 12.11.2007 14:51:46 +0300 - build 335

1. Падает FAR в следующих ситуациях:

   a) Запущен FAR без макросов в реестре
   b) Запущен FAR с макросами в реестре но запущен как Far.exe /m
   c) Запущен FAR с макросами но их удалили во время сеанса FAR и вызвали плагин UpdateMacros.dll

   когда падает:

   Ctrl. Ctrl. Любая_допустимая_клавиша Enter
   FAR упал

2. Пусть у нас есть 2 макроса:
   [HKEY_CURRENT_USER\Software\Far\KeyMacros\Shell\F10]
   "Sequence"="F5"
   [HKEY_CURRENT_USER\Software\Far\KeyMacros\Common\F10]
   "Sequence"="F4"

   запускаем FAR
   находясь на панели жмем Ctrl. Ctrl. F10
   выбираем "ДА"

   ещё раз делаем Ctrl. Ctrl. F10
   выбираем "ДА"

   жмем F10 и видим макрос не снялся если ещё раз сделать Ctrl. Ctrl. F10
   нам опять предлагает удалить...

   те макрос (общий) в такой ситуации не снимается



yjh 11.11.2007 22:33:53 +0300 - build 334

1. plugin.hpp скорректирован для работы с .c (не .cpp) файлами


t-rex 10.11.2007 23:26:42 +0200 - build 333

1. Правки во врапере по теме нового DialogAPI и около.

2. ViewerInfoW -> ViewerInfo.

yjh 10.11.2007 20:39:24 +0300 - build 332

1. Убран memory leak в GETDLGITEM

2. Добавлен DM_GETREALLOC (для враппера и DialogManager)

3. ВНИМАНИЕ: при получении Item с динамическим буфером
             (IsEdit(Type) && MaxLen==0)
             выделенный буфер (DataOut) должен особождаться плагином


t-rex 10.11.2007 19:11:17 +0200 - build 331

1. Напутал с CutToSlash в 326.

yjh 10.11.2007 18:41:37 +0300 - build 330

1. Изменения в DialogAPI (для нормальной работы с памятью редактируемых
   строк).
   !!!ВНИМАНИЕ!!! почти все (уже "готовые" плугины надо править)
***
   Краткое описание нового API:
    В FarDialogItem есть 3 поля
      const wchar_t* DataIn;
      wchar_t* DataOut;
      size_t MaxLen;
    DataIn - задаёт все ВХОДНЫЕ строковые данные (было в DataPtr)
    DataOut - для полей с редактируемоей строкой (см. IsEdit() в pluging.hpp)
              здесь находится указатель на возвращаемые данные.
              для всех остальных типов полей всегда возвращается NULL (см. ниже)
    MaxLen имеет двойное назначение:
       if(MaxLen != 0), то это максимальный размер (включая закрывающий 0)
       ЗАРАНЕЕ выделенного (плугином) буфера указатель на который должен
       передаваться через DataOut.
       Кроме того, это ограничитель размера для строки ввода (currently not implemented)

       Если же MaxLen==0, то подразумевается, что работа(редактирование) идёт
       со строками с НЕ лимитированным размером. В этом случае в DataOut
       попадает указатель на динамически выделяемую память (см. ниже) которую
       плугин должен особождать сам.

    В ф-циях FSF.Dialog и FSF.DialogEx добавил ещё один параметр - указатель
    на ф-цию ReAlloc. которая используется Far'ом для аллокации "неограниченных"
    возвращаемых "неограниченных" строк (и освобождения памяти - см. ниже).
    В случае отсуствия в диалоге IsEdit полей, можно передавать NULL.

    При обработке Dialog/DialoEx осуществляется дополнительная проверка
    параметра DataOut - если MaxLen!=0, то
       IsBadWritePtr(DataOut,MaxLen*sizeof(wchar_t))
    если же MaxLen==0, то ReAlloc не может быть NULL.
        IsBadReadDataIn должен быть valid read ptr, а DataOut (если Ь

    Если параметр (одного из Item) невалиден, до возвращается -1 БЕЗ исполнения
    диалога.

    Если после "отработки" диалога, при возвращении строк ReAlloc вернёт NULL,
    то будет освобождена вся ранее захваченная им память (через ReAlloc(ptr, 0);)
    и так же возвращена -1.

    При нормальном же завершении Dialog/DialogEx плугин должен сам освободить
    память (все OutPtr) если, конечно, выделял её динамически :)

***

2. Выкинута ф-ция FSF.FreeDialogAnsStr - она теперь не нужна

3. Некоторое (попавшееся по пути :) убирание знаковых целых там где им
   сoвсем не место. По хорошему, надо бы тормознуть все правки и сначала
   навести порядок с этим...

4. Пара ошибок предыдущих патчей обнаруженная в посиках отавшейся ошибки
   в использовании CutToSlash :)


t-rex 09.11.2007 21:34:19 +0200 - build 329

1. Исправил ещё одни недочёт в АПЙ для x64 версии. Надеюсь что это последний.

t-rex 09.11.2007 18:12:56 +0200 - build 328

1. В UnicodeString::GetBuffer nLength переименован в nSize.

от Alex Alabuzhev:

2. API 1.7:
   a) Control: всё, кроме:
      - в FCTL_GET[ANOTHER]PANELINFO не заполняются поля PanelItems и SelectedItems;
      - не реализован FCTL_SET[ANOTHER]SELECTION, т. к. зависит от предыдущего.
   b) MkLink
   c) GetNumberOfLinks
   d) правильно работает DM_KEY
   e) пропущен break после VCTL_GETINFO в ViewerControl

svs 09.11.2007 15:54:24 +0300 - build 327

1. Mantis#0000352: Undo, вызываемое CTRL+Z не работает если открыть существующий файл на редактирование
   Проблема в том, что в 1.7x Editor::FreeAllocatedData вызывалась только из деструктора класса Editor.
   В 1.8x эта же функция так же вызывается из FileEditor::LoadFile, при этом массив UndoData удаляется.
   В общем, сделал очередную затычку - новый параметр у Editor::FreeAllocatedData - удалять или очищать
   массив UndoData.
   Для номальной работы (в т.ч. и для реализации Redo) необходимо отказаться от массива в пользу
   двусвязанного списка (или еще чего...)

t-rex 09.11.2007 13:18:53 +0200 - build 326

1. Различные фиксы и улучшения связанные с string.GetBuffer().

2. Немного правок на предмет табы-пробелы в коде.

svs 09.11.2007 11:57:41 +0300 - build 325

1. TVar вынесен в отдельный модуль tvar.?pp + компилятор из macro.cpp в syntax.cpp

2. KeyNameToKey теперь для макроязыка возвращает -1.

3. GetMacroParseError - теперь функция класса Macro.

4. После 2280 пункт 6 отвалился $MMode.
   Теперь $MMode будет компилится по правилам...
   т.е. если раньше было для "$MMode 1":
     0: MCODE_OP_MACROMODE
     1: '1'
   то теперь все встало на свои места:
     0: MCODE_OP_PUSHINT
     1: HIDWORD(1)
     2: LODWORD(1)
     3: MCODE_OP_MACROMODE

5. Mantis#0000351: ACTL_POSTKEYSEQUENCE: пауза при выполнении и лишняя перерисовка


t-rex 07.11.2007 17:47:14 +0200 - build 324

1. Пару мелких BUGBUG и немного правок на предмет табы-пробелы в коде.

zg 05.11.2007 12:04:08 +0200 - build 323

1. Траблы с...
     > есть 2 макроса
     > а) в области shell Ctrl-CapsLock=CtrlShiftTab flock(1,2)
     > б) в области редактора Ctrl-CapsLock=CtrlShiftTab flock(1,2)
     >
     > 0. в shell открыли файл в редаторе, переключились снова в shell
     > 1. нажали Ctrl-CapsLock, у нас таки есть макрос, макрос запускается
     > 2. макрос отработал, в конце саданул в очередь Up-Down для VK_CAPITAL (тот самый flock(1,2))
     > 3. макрос закончился, но:
     > 3.1 состояние Ctrl - в "нажато"
     > 3.2 на подходе Up-Down для капслоск
     > 4. ФАР видит в очереди CtrlCapsLock, проверяет, что мы в редакторе, а там такой же макрос тоже есть - начинает работать макрос
     > 5. goto п.2
     >
     > Помогает только кнопка на морде системного блока

   исправлено зависание. но так как во время физического нажатия *Lock программно изменить состояние этого самого *Lock нельзя, то макросы надо чуть доработать:
   CtrlCapsLock="CtrlShiftTab %a=flock(1,-1)&1; $while((flock(1,-1)&1)==%a) sleep(50) flock(1,2) $end"

yjh 05.11.2007 05:01:40 +0300 - build 322

1. Для возможности обхода недоделок в API добавлена FSF.FreeDialogAnsStr
   (освобождение памяти аллоцированной ядром для ответа в DI_EDIT).
   Пример использования можно посмотреть в MacroView


t-rex 04.11.2007 22:41:29 +0200 - build 321

1. Исправил пару мелких BUGBUG, в ком строке и запускаторе.

yjh 04.11.2007 22:21:28 +0300 - build 320

1. В FarKeyToName параметр Size и возвращаемое значение в символах, а не
   байтах.

yjh 04.11.2007 21:33:24 +0300 - build 319

1. Добавлена нормальная имплементация FarKeyToName. Изменения в API:
   typedef size_t  (WINAPI *FARSTDKEYTOKEYNAME)(int Key,wchar_t *KeyText,size_t Size);
   Возвращает общий размер (с финальным нулём) скопированный в KeyText.
   Если Size == 0, то возвращает необходимый размер

t-rex 01.11.2007 23:37:35 +0200 - build 318

от chupakabra:

1. При отрисовке рамки вывода информации о панели плагина (Ctrl+L) не используется BoxSymbols[].

t-rex 01.11.2007 22:42:35 +0200 - build 317

от Alex Alabuzhev:

1. API 1.7:
   - ViewerControl
   - еще несколько сообщений Dialog API
   - Text: рекурсия при Str = NULL

svs 01.11.2007 16:57:56 +0300 - build 316

1. Mantis#0000344: Ключи для отключения при запуске макросов / автостартующих макросов
   [+] Добавлены параметры командной строки:
       /m - при старте FAR не будет загружать макросы из реестра
       /ma - при старте ФАР не будет исполнять автостартующие макросы.

2. Падение, если в поисковике файлов в качестве маски указать "*.*, ,*.*"

3. В Хелпе FarEng.hlf.m4 есть русские буковки!
   В очередном патче кто-нить исправьте сей недостаток :-)


t-rex 30.10.2007 20:55:12 +0200 - build 315

от Alex Alabuzhev (с долей исправлений от меня :):
Вообще всё это надо очень хорошо потом протестировать.

1. API 1.7:
   - более-менее рабочий DialogEx.
   - AdvControl.
   - в FARKEYSEQUENCEFLAGS пропущен флаг KSFLAGS_REG_MULTI_SZ

svs 29.10.2007 09:52:31 +0300 - build 314

от _anton_ (?)

1. в plugin.hpp второй параметр у функции MakeDirectoryW char* вместо
   wchar_t*.

t-rex 28.10.2007 21:10:05 +0200

1. Мелкое исправление в EXCEPTION лицензии, неправельный набор слов
   приводил к тому что плагины должны были использовать один или все хидеры
   плагинов а не любой чтоб не попадать под лицензию фара.
   Но полюбому в самих хедерах и так написано что их можно юзать, в LICENSE это
   написано для суммирования.

t-rex 28.10.2007 20:04:06 +0200 - build 313

от Alexandr Zamaraev:

1. Улучшение GCC сборки.

t-rex 28.10.2007 17:59:38 +0200 - build 312

1. По наводке Yurij, в истории редактора\въювера теперь нет ограничения на размер строки,
   ну и за одно падать перестало :).

t-rex 28.10.2007 17:31:13 +0200 - build 311

от Alexandr Zamaraev (Tonal):

1. Сборка под GCC 4.2.1

t-rex 28.10.2007 16:37:51 +0200 - build 310

от Alex Alabuzhev:

1. API 1.7:
   a) Dialog (вроде всё), DialogEx (пока без обработчика) (wrap.cpp)
   b) Menu: пользовательская метка выбора (FarMenuItem.Checked>1) во враппере не перекодировалась
      в юникод (wrap.cpp), глубже тоже были грабли - приводилось к char (vmenu.cpp)

svs 28.10.2007 17:00:58 +0300 - build

1. Добавлен файл SYSLOG-RU, описывающий элементы логирования в FAR`е

svs 28.10.2007 01:54:39 +0300 - build 309

1. Macro: Падение при записи последовательности с клавиатуры.

2. Вернем обратно KEY_MACRO_BASE в разряд "клавиш".
   Есть проблемы.


svs 28.10.2007 01:15:53 +0300 - build 308

from DrKnS (Alex Alabuzhev):

1. при выводе плагинового диалога в заголовке консоли был мусор

2. при закрытии некоторых диалогов фар падал из-за неинициализированных переменных.

3. поправлена рамка внизу панели (flshow.cpp).

4. Editor: падала дебажная версия на выходе из редактора после сохранения

5. Editor: неправильно отрезался путь сохр. файла

6. Editor: если новый файл и вышли без сохр - UpdateFileList() не вызываем


t-rex 27.10.2007 22:08:48 +0200 - build 307

1. После 301 всплыл глюк с не вытеранием FEDITLINE_CLEARFLAG у Edit контролев.

t-rex 27.10.2007 20:05:33 +0200 - build 306

1. Оптимизация вывода строк редактора на экран, очень ощутимо на очень длинных строках.

2. Убрал SHITHAPPENS за ненадобностью.

t-rex 27.10.2007 17:05:41 +0200 - build 305

от chupakabra:

1. Вход в бесконечный цикл в FarMkTempEx().

2. DeleteFileWithFolder() удаляет только файл и оставляет каталог.

svs 27.10.2007 15:37:28 +0300 - build 304

1. Добавлен MCODE_OP_NOP

2. Уточнения кода по поводу падения во время удаления макроса
   и/или воспроизведенния...


t-rex 27.10.2007 14:18:57 +0200 - build 303

1. Исправил Debug и GCC сборку, и ещё пару варнингов.

svs 27.10.2007 13:15:23 +0300 - build 302

1. Уточнение в KeyMacro::MkTextSequence.

svs 26.10.2007 19:09:24 +0300 - build 301

Поехали....

1. MCODE_OP_EXPR и MCODE_OP_DOIT удалены как класс.

2. KEY_MACRO_BASE ... KEY_MACRO_ENDBASE ужО не "клавиши"!
   Остались только KEY_OP_*, кторые являются "клавишами"

3. В логирование добавлен _MOUSE_EVENT_RECORD_Dump()

4. Изменена SetFLockState
   GetKeyboardState отстой, работает только в дебажной версии (вот ить!)
   вместо нее юзаем нашу GetKeyState()

5. Хмм... а, ну да, оп-коды макросов теперь навинаются с 0
   (небольшое приближение к...)

6. В парсере макросов.
   между MCODE_OP_KEYS и MCODE_OP_ENDKEYS находятся настоящие клавиши!
   сейчас можем наблюдать фигню типа когда parseMacroString() каждую
   "настояшую клавишу" обрамляет этими кода (избыток!), но
   это промежуточный этап....
   В конце будет отдельный DLL, который ФАРу будет отдавать только байткод.

7. В PostNewMacro() добавлен новый параметр...
   предполагается (сейчас!), что плагины "пидалят" макросы с чистыми
   кодами клавиш!
   Но т.к. эта функция испльзуется не только для плагинов, то...
   ...нужно отличать "где мы".

9. Траблы с...
     есть 2 макроса
     а) в области shell Ctrl-CapsLock=CtrlShiftTab flock(1,2)
     б) в области редактора Ctrl-CapsLock=CtrlShiftTab flock(1,2)

     0. в shell открыли файл в редаторе, переключились снова в shell
     1. нажали Ctrl-CapsLock, у нас таки есть макрос, макрос запускается
     2. макрос отработал, в конце саданул в очередь Up-Down для VK_CAPITAL (тот самый flock(1,2))
     3. макрос закончился, но:
     3.1 состояние Ctrl - в "нажато"
     3.2 на подходе Up-Down для капслоск
     4. ФАР видит в очереди CtrlCapsLock, проверяет, что мы в редакторе, а там такой же макрос тоже есть - начинает работать макрос
     5. goto п.2

     Помогает только кнопка на морде системного блока


t-rex 26.10.2007 14:34:01 +0200 build 300

1. Все готовы? Are you ready? :)

--------------------------------------------------------------------------------

t-rex 26.10.2007 14:27:32 +0200 - build 300

1. Изменил билд, с этого билда Open Source. Да и вообще красивый номер билда :)

t-rex 25.10.2007 23:59:44 +0200

1. Файл CONTRIBUTORS.

2. Обновил доки.

svs 25.10.2007 19:02:31 +0300 - build 299

1. Удалил мусорные комменты.
   Билд изменил для того, чтобы в репозитарии ЭТО было отдельным пунктом.

   Вроде ни где не промахнулся :-)

Zuz 22.10.2007 12:09:48 +0500 - build 298

1. Mantis#000337: сразу не обновлялась панель с открытой на ней шарой при удалении одного файла
даже когда её просили по UIC_UPDATE_FORCE

svs 18.10.2007 22:07:16 +0300 - build 297

1. Editor: Падает, гад.
   Имеем файл (символ '*' - обозначим концы строк)
     +----------------------+
     |1 2 3*                |
     |3 4 5 6*              |
     |*                     |
     +----------------------+

   настройки редактора:
    [x] Persistent blocks     
    [ ] Del removes blocks
    [x] Cursor beyond end of line

   Последовательность действий:
     Выделяем символ '6' 
     End
     Del
     Up
     Del
     упали.

   В Editor::DeleteString() после "BlockStart=BlockStart->m_next;" не
   проверялся  BlockStart на NULL, но был вызов "BlockStart->IsSelection()".

2. Добавлена обработка клавиш NumLock, CapsLock, ScrollLock с модификаторами.


3. Macro: добавлена функция FLock()
    N=FLock(Nkey,NState)
       Nkey:
          0 - NumLock
          1 - CapsLock
          2 - ScrollLock

       State:
         -1 get state
          0 off
          1 on
          2 flip

     Windows NT/2000/XP: The keybd_event function can toggle the NUM LOCK, CAPS LOCK, and SCROLL LOCK keys.
     Windows 95/98/Me:   The keybd_event function can toggle only the CAPS LOCK and SCROLL LOCK keys. It cannot toggle the NUM LOCK key.


4. Небольшая перетасовко-перегруппировка кода в macro.cpp


svs 15.10.2007 18:51:33 +0300 - build 296

1. Ctrl-: и Ctrl-Alt-: - приводим к соответствию, к Ctrl-; и Ctrl-Alt-;

2. Bug: Во вьювере при отключенном постоянном выделении после внесения 
        воздействия выделение не снимается. 

3. Mantis#0000303: Названия кнопкосочетаний с модификаторами
   Обнаружилась ещё одна нерегулярность в том же духе: ` vs ~



svs 15.10.2007 11:27:58 +0300 - build 295

1. Снова 2269 :). Правда уже во вьювере.
   ViewY1 теперь ненужна (была нужна только на тот случай, когда Viewer учитывал статусную строку)
    "...если вьювер окрывается сразу в hex,... первая строка за статусной скрыта... не достанешь"


t-rex 13.10.2007 23:08:51 +0200

1. Добавил файл MAINTAINERS. Посмотрите там что всё как надо.

t-rex 13.10.2007 20:32:18 +0200 - build 294

289 всё ещё даёт о себе знать:

1. Oчень заметно на примере плагина Visualizer (CtrlEnd или Down на нижней строке).

1. После CtrlY на предпоследней строке в файле (если файл
   занимает больше чем один экран) неправильно выставлялся TopScreenLine.

2. Прошелся по всем местам где есть Y2-Y1, нашел ещё одно место где теоретически могло глючить.
   Бум надеяться что больше 289 о себе не даст знать.

svs 12.10.2007 14:37:59 +0300 - build 293

1. Mantis#0000206: Некорректная работа переноса по словам в "Программе просмотра"
   как я и подозревал - кривая инициализация строки.

2. Mantis#0000335: Нельзя набрать символ ']' 
   Опираясь на фразу из хелпа 
   "Кроме обычных символов в имени файла также можно использовать символы '*' и '?'" 
   сделаю грязный хак :-)
   1. В XXX::FindPartName() добавляем параметр ExcludeSets, который говорит о том,
      чтобы не учитыват наборы (в квадратных скобках)
   2. Т.к. юзается CmpName(), то пере ее вызовом изменим маску поиска, заменив
      '[' на '[[]' и ']' на '[]]':

       ReplaceStrings(Mask,"[","<[%>",-1,1);
       ReplaceStrings(Mask,"]","[]]",-1,1);
       ReplaceStrings(Mask,"<[%>","[[]",-1,1);

      '<[%>' - это типа "уникальная последовательность", наличие которой в оригинальной 
               маске как бы не должно быть.
               без нее получим кривизну, если заюзаем

                 ReplaceStrings(Mask,"[","[[]",-1,1);
                 ReplaceStrings(Mask,"]","[]]",-1,1);

               второй реплейс криво отработает.

3. Избавился в FileList::FindPartName() от malloc. Применяем "string".
   усекаю строку strMask на 1 символ:
     
     strMask.SetLength(strMask.GetLength ()-1);

   Если не так, исправьте, что в курсе ;-)

4. Уточнение в хотплюгах по поводу хилайта


svs 12.10.2007 10:55:15 +0300 - build 292

1. В 289 забыл про АПИ (это про "Editor должен работать в пределах X1,Y1,X2,Y2...")

2. Mantis#0000303: Названия кнопкосочетаний с модификаторами
   Ctrl-" и Ctrl-: забыл...

3. Mantis#0000326: QView, Info: ItemCount, CurPos, Selected, Bof, Eof всегда 0; Empty всегда 1
   Теперь: Bof/Eof/Empty/Selected - если в панелях, но в QView/Info/Tree, то возвращается
   значение для этих типов панелей, иначе - для ком.строки.

4. API: ListBox не реагировал на выбор мышкой, если был выставлен режим LMRT_NEVER.

5. Macro: Добавлен MacroArea - возвращает имя текущей макрообласти.

6. Alt-Shift-F9 - не сохранялось значение опции "Lock editing of read-only files"

svs 11.10.2007 11:44:09 +0300 - build 291

1. Mantis#0000106: Экран уезжает вправо после PgDn 

   Проблема в следующем. Сначала код.

   Editor::ShowEditor
     if (!EdOpt.CursorBeyondEOL)
     {
       CurLine->SetLeftPos(0);
       Здесь LeftPos =  0
   (а)>>  CurLine->FastShow();
       Здесь LeftPos != 0
     }

   Edit::FastShow()
   (б)>>  EditLength=ObjWidth;

    if (!Flags.Check(FEDITLINE_DROPDOWNBOX))
    {
      if (TabCurPos-LeftPos>EditLength-1)
        LeftPos=TabCurPos-EditLength+1;
      if (TabCurPos<LeftPos)
        LeftPos=TabCurPos;
    }

   Теперь описание :-)
   1. Начинаем открывать файл в редакторе.
   2. Читаем построчно, создавая при этом связанный список строк 
      (используется Editor::CreateString)
   3. Т.к. класс Edit основан на ScreenObject, то ObjWidth=0
   4. в (б) EditLength=0
   5. ...
   Когда по строкам "пробежались", то... ObjWidth нормализуется
   и в последующем для этого открытого файла баг пропадает.

   Делаем следующее. В Editor::CreateString задаем изначальное значение
   X1 и X2 (Y1 и Y2 нам здесь на этом этапе ненужен)

2. Воркэраундд для strmix.cpp::IsWordDiv()
   Вместо возврата FALSE проигнорируем параметр TableSet и просто
   тупо поищим Chr в массиве WordDiv.
   Потом это надо уточнить. Уточнялка занесена в REMINDER.


svs 09.10.2007 20:31:33 +0300 - build 290

1. Mantis#0000333: Не работает Lock editing Read-only files 
   напутал с логикой.


svs 09.10.2007 19:41:37 +0300 - build 289

1. Editor должен работать в пределах X1,Y1,X2,Y2. В коде замечем-то есть коррекция
   на статусную строку, за которую должен отвечать FileEditor.
   Как побочный эффект:
   [+] Комбинация Ctrl-Shift-B в редакторе и программе просмотра показывает или
   скрывает статусную строку.


svs 13.09.2007 20:08:20 +0300 - build 288

1. Mantis#0000327: [X] Save bookmarks не работает без [X] Save file position
   Сделаем автоблокировку второго пункта (Save bookmarks), т.к.
   он сейчас зависим от первого.

2. В диалоге настройки вьювера небольшие изменения:
   - постоянное выделение уехало вверх (чтобы быть похожим на конфигурирование редактора)
   - по аналогии с настройками редактора "Save bookmarks" уехал вверх-вправо
   - та же сама автоблокировка пункта "Save bookmarks"

3. API: добавлены DM_SETCOMBOBOXEVENT и DM_GETCOMBOBOXEVENT.
   позволяют управлять (FARCOMBOBOXEVENTTYPE) посылкой событий клавиатуры и мыши 
   в диалоговую процедуру для открытого комбобокса. 

4. API: Для элемента DI_COMBOBOX теперь в ответ на сообщения DM_LIST???? строка
   редактирования не изменяется при навигации по элементу.


svs 07.09.2007 20:27:01 +0300 - build 287

1. Mantis#0000293: Дополнение DI_COMBOBOX 
   [+] API: Добавлены события DN_KEY или DN_MOUSEEVENT, которые посылаются 
       в процедуру обработки диалога при навигации по DI_COMBOBOX


svs 07.09.2007 09:36:31 +0300 - build 286

1. Mantis#0000303: Названия кнопкосочетаний с модификаторами
   [*] Macro: Изменены названия сочетаний клавиш с модификаторами: 
       вместо `:` теперь `;`, а вместо `"` теперь `'`. Это относится 
       ко всем комбинациям модификаторов, кроме одиночного Shift. 


svs 06.09.2007 15:54:45 +0300 - build 285

1. "Не удалось открыть файл" -> "Ошибка открытия файла"
   уже не помню какой-там мантис...

2. Другой вариант переключения раскладки в XLat и $KbdSwitch
   (взято с форума)

Zuz 05.09.2007 00:52:11 +0500 - build 284

1. For elimination of effects of Vista virtualization technology the manifest file has been added

t-rex 01.09.2007 23:04:03 +0200 - build 283

1. Bug in OEM to UNICODE conversion in UnicodeString.cpp.

2. Revert copyright.inc.m4.

zg 01.09.2007 22:55:45 +0200 - build 282

1. проблема с ".." в папках, в которых он отсутствует.
   например линкуем диск в папку.

t-rex 01.09.2007 21:41:06 +0200

1. Preparing for open source:
   - added BSD license to all source files
   - added an exception to the license for plugin api header files
   - added LICENSE file with the BSD license including the exception for plugins

2. Removed some unneeded files.

warp 01.09.2007 20:33:00 +0300 - build 281

1. В несколько раз уменьшил потребление памяти на панелях (это к вопросу "а вот Far жрет аж 191 мб").

2. Под это дело резко всплыла целая пачка глюков с падениями и прочими косяками, какие всплыли - починил, остальные 
   видимо всплывут еще.


t-rex 01.09.2007 15:59:22 +0200

1. Added a README-EN file for our new member and for the future open source community.


svs 30.08.2007 19:06:59 +0300 - build 280

1. 0000324: GetHotkey() возвращает "0" 
   [-] Macro: Если пункт меню не содержит горячую клавишу, то GetHotkey() возвращает "0" вместо ""

2. 0000325: $SelWord выделяет лишнее знакоместо в конце строки 
   [-] Macro: $SelWord выделяет лишнее знакоместо в конце строки

3. 0000326: QView, Info: ItemCount, CurPos, Selected, Bof, Eof всегда 0; Empty всегда 1
   [-] Macro: В панелях быстрого просмотра и информации не работали некоторые переменные:
       ItemCount, CurPos, Selected, Bof, Eof всегда 0; Empty всегда 1.

4. Код возврата функций VMProcess теперь будет __int64


yjh 28.08.2007 14:49:21 +0300 - build 279

1. Issue 313, У форточек сносит крышу при попытке сделать 
   GetFileAttributes("..") когда находишся в корне UNC-заданного диска.

svs 24.08.2007 20:05:59 +0300 - build 278

1. Mantis#0000318: Опция - Восстановить размеры панелей
   Добавлена комбинация для панелей Ctrl-Shift-Num5 - "по высоте"
   размеры панелей будут восстановлены до Командной строки 
   Работать будет пока только при TI#48 (UseNumPad=1)

svs 24.08.2007 15:02:24 +0300 - build 277

1. Mantis#0000316: Не работает копирование строки

2. Mantis#0000259: Выделить до первой/последней строки


svs 24.08.2007 14:07:42 +0300 - build 276

1. Баг в диалоге (http://forum.farmanager.com/viewtopic.php?p=26515#26515)
   юзер нажал F4 {
     диалоговый менеджер послал плагину DN_KEY, F4 {
       плагину послал DM_CLOSE {
          диалоговый менеджер погасил диалог и приготовил всё необходимое 
          для удаления внутренних элементов и т.п., т.с. Leave
       }
     }
     управление вернулось в менеджер и он продолжил анализ клавиши, 
     дошел до комбобокса и послал клавишу строке редактирования 
     (комбобокс состоит из 2-х обхектов!), та вязала и перерисовалась
   }


Zuz 24.08.2007 15:24:49 +0500 - build 275

1. Не работал KEY_DECIMAL при UseNumPad=0

2. Игнорировались клавиши в диалоге назначения клавиш для макросов интервале
INTERNAL_KEY_BASE > KEY < INTERNAL_KEY_BASE_2, что привело к тому, что Decimal, NumDel
и т.п. не могли быть корректно назначены и ряду других интересных эффектов.

3. В KeyText (keyboard.cpp) неправильно инициализировалась переменная, что приводило
к эффекту добавления мусора для клавиш модификаторов.

svs 22.08.2007 14:14:37 +0300 - build 274

1. Mantis#0000321: диалог ошибки открытия файла выдаётся не на панелях а в редакторе 
   Проблема в том, что Editor::SetCodePage вызывал Show()
   Нарисовал в FileEditor::Init() приватный класс SmartLock, который лочит
   ScreenObject от прорисовки.

2. Потенциальная утечка памяти в FileList::ProcessKey().
   В 1.70 похоже так же есть...
   если при вызове редактора была ошибка - то ShellEditor в список манагера не попадает
   (оно вызывается через new)
   Соответственно вызов "FrameManager->ExecuteModal();" ничего не меняет (манагер не 
   удалит объект!)
   Тупо проверить "ShellEditor->GetExitCode()" на "XC_OPEN_ERROR" - этого мало, 
   т.к. кодов возврата несколько...

svs 14.08.2007 14:30:43 +0300 - build 273

1. NumDecimal не отрабатывал в редакторе

2. Внутренние добавки для проекта "Флаги редактора"


Zuz 12.08.2007 22:19:19 +0500 - build 272

1. Опять Mantis#0000176 не доконца перенёс патч, вообще артефактов при обновлении 
панелей на медленных соединениях хватает, кто бы занялся ;-)

Zuz 11.08.2007 16:50:52 +0500 - build 271

1. Mantis#0000176: Двойное сканирование после cd path, логический фикс
2. В flupdate.cpp (FileList::ReadFileNames) рамка криво рисовалась для
сообщения MReadingFiles, пока сформировал её с помощью MakeSeparator

svs 07.08.2007 22:06:56 +0300 - build 270

1. Ctrl+/Ctrl- - траблы с пометкой в панелях.
   Переменную нужно инициализировать!

svs 07.08.2007 14:33:55 +0300 - build 269

1. Mantis#0000309: DM_LISTSETMOUSEREACTION с флагом LMRT_NEVER - не приходят клики мыши
   Двойной клик мыши просто не учитывался. добавил.

svs 07.08.2007 12:59:42 +0300 - build 268

1. Mantis#0000310: Сброс сохраненной позиции во View'ere 
   бага стара как мир... :-(

2. В setattr.cpp косметика - для удобоваримости и понятности имен переменных.

3. viewer.cpp - принудительная очистка массива BMSavePos.

4. Macro: макросы, назначенные на Модификаторы+Decimal записывались, но не 
   воспроизводились.

5. Mantis#0000158: _FAR_USE_FARFINDDATA и Релиз 1.70
   Здесь _FAR_USE_WIN32_FIND_DATA вообще не юзаем - вычеркиваем.


svs 24.07.2007 21:54:22 +0300 - build 267

1. Mantis#0000073: Не работает автоскролинг в QView

   WaitInMainLoop - "мы в основном цикле (в панелях)?". Если в панелях,
   то в GetInputRecord() не пашет механизм "холостого пробега" (if (WaitInMainLoop))
   Посему, для QView недостаточно проверки на панели - IsPanelsActive().
   Уточним сей факт.

2. Для раздела "@Viewer" в хелпах добавлена информация об автоматическом скроллинге.
   (В FarEng.hlf.m4 появились русские буковки!!!)


svs 23.07.2007 16:57:14 +0300 - build 266

1. Добавка к Dialog API. DM_[S|G]ETEDITPOSITION - управление позицией сктроки в строках 
   ввода в диалогах. Добавка к DM_[S|G]ETCURSORPOS.
   В качестве Param2 принята структура EditorSetPosition, чтобы в будущем команды так же
   работали и на MI_MEMO.


t-rex 21.07.2007 01:14:38 +0200 - build 265

1. В режиме колонки NR AltHome не прокручивал строки в начало.
   По идеи это был баг но например в режиме NR,Z этот "баг" давал возможность вернутся
   к оригинальному выравниванию после того как покрутили (чего теперь незя сделат)
   но вроде это все ровно баг.


svs 09.07.2007 15:04:41 +0300 - build 264

1. [-] Macro: не работали конструкции Eof/Bof/etc в программе просмотра.

yjh 08.07.2007 08:17:24 +0300 - build 263

1. Для поиска файлов признак использования фильтра запоминается в registry


t-rex 07.07.2007 22:42:39 +0200 - build 262

Несколько патчей от 1.71, надеюсь что ничего не потерял по дороге.
Патч про вистовые симлинки из 2226 пока что решил не делать так как
я там такие костыли наделал что сюда переносить их не хочется.
Надо подумать как это красиво сделать.

1. Mantis#263 - ".." не всегда красились (а точнее когда мы их добавляли в ручную).

2. Mantis#0000275: В диалогах при обработке DIF_CENTERGROUP выставлялся
   X1 но не X2 что приводило к проблемам как минимум с DI_TEXT так как
   недавно для него стал учитыватся также и X2.

3. Сохраняем фильтры только если AutoSaveSetup или юзер нажал Shift-F9.
   Это вписывается в общюю логику работы с реестром у фара.


t-rex 07.07.2007 15:51:04 +0200 - build 261

1. Исправил не сохранение MarkChar в диалоге раскраски. С диалогами надо что то решать.


warp 07.07.2007 15:04:00 +0300 - build 260

1. Это, типа, ребрендинг. Задолбали имена вида LocalXXXX и мешанина с __cdecl/__stdcall.
   Строковые функции теперь имеют вид StrLength/StrCmp/StrCmpI/StrCmpNI и т.п. и все они
   __cdecl. Для FAR API эти же функции обернуты в __stdcall заглушки (__cdecl варианты 
   удобно использовать в сортировке напрямую, да и разделения на внутренние/внешние функции 
   это правильнее). wcscmp/wcslen считаются врагами народа. Ожидаются осадки.

2. Часть функций FAR_XXX переименовалось в apiXXX.

2yjh: и нет, я пока не починил диалоги на предмет настройки фильтров, но пока помню. :-)


yjh 07.07.2007 06:57:11 +0300 - build 259

1. Убрана бага в TranslateKeyToVK в части обработки VK_Fn и прочих
   EXTENDED/INTERNAL кнопок.

2. Убран гнуснейший удар по памяти (стеку!) в Manager::CountFramesWithName.
   Это то из-зачего релиз гробился по выходе из вьювера вызванного из proclist
   Вот за такое кодирование точно надо запрещать автору пользоваться Cшными
   кастингами :(((

svs 06.07.2007 17:44:20 +0300 - build 258

1. Mantis#0000304: DM_LISTGETCURPOS для отмененного комбобокса.
   Блин, перебор в трех местах вышел...

t-rex 06.07.2007 01:31:09 +0200 - build 257

1. Ну так как все молчат - удалил нафиг регистрацию.


svs 05.07.2007 17:36:55 +0300 - build 256

1. Mantis#0000289: прорисовка сообщения обрезана при выволнении макро 

2. Mantis#0000304: DM_LISTGETCURPOS для отмененного комбобокса.


svs 05.07.2007 11:37:11 +0300 - build 255

1. Mantis#160 - Хочется F3 и F5 на дисках.
   В обчем репорт извернули в сторону Macro.gethotkey() :-)

   S=gethotkey(N)
   где N - нужная позиция в списке от 1 (0 - текущая)
       S - либо "", если хоткея нет или N > количества пунктов в меню или это не меню;
           иначе S = сам хоткей. 


Zuz 03.07.2007 14:10:47 +0500 - build 254

Mantis#223 - вернул возможность уставливать дату/время для каталогов на FAT/FAT32
локальных дисков под WinNT+ (нужно для тех же флешек, например), для сетевых дисков
ошибка теперь тихо игнорируется.

warp 28.06.2007 05:33:00 +0300 - build 253

1. Крайней экспериментальный фикс. Из Plugin::OpenPlugin убрано выставление
   текущей папки, не похоже, что оно реально требуется, но оно порождает ситуацию,
   когда текущей оказывается неверная папка (когда в плагине текущая папка 
   имеет такое же имя, как реально существующая).


yjh 28.06.2007 02:07:17 +0300 - build 252

1. Убрана ошибка "переполнения" в рассчётах времени/скорости при копировании
   и изменена (упрощена) логика учёта времени ожидания ответов пользователя
   в ситуации ошибок при копировании.
   Сейчас общее время операции учитывает время ожидания, а оставшееся время
   и средняя скорость - нет.

svs 26.06.2007 20:15:33 +0300 - build 251

1. Mantis#286 - Порча бинарных файлов при сохранении встроенным редактором.
   Mantis#295 - Пропуск символов при смешанных переводах строк

   пробуем...


svs 26.06.2007 19:37:17 +0300 - build 250

1. Mantis#287 - Не воспринимаются переменные начинающиеся с цифр

svs 31.05.2007 20:18:55 +0300 - build 249

1. Macro: добавлена функция Panel.SetPosIdx - позиционирование
   на файловой панели по индексу.

2. В WaitKey добавлена задержка на 50ms - иначе при CAS наблюдается
   повышенная "возбужденность" FAR`а в таскманагере.


svs 15.05.2007 10:29:18 +0300 - build 248

1. Для "System/UseNumPad=1" НЕ понадобятся макросы, т.к.
   все продублировано.

2. Macro: имена переменных, начинающихся с числа не воспринимаются.
   Например, %3Proc.

svs 11.05.2007 15:39:28 +0300 - build 247

1. Mantis#0000232: Различать Del и NumDel, Enter и NumEnter 
   Для "System/UseNumPad=1" понадобятся макросы:

   REGEDIT4

   [HKEY_CURRENT_USER\Software\Far\KeyMacros\Common\NumEnter]
   "Sequence"="Enter"
   "DisableOutput"=dword:00000001

   [HKEY_CURRENT_USER\Software\Far\KeyMacros\Common\CtrlNumEnter]
   "Sequence"="CtrlEnter"
   "DisableOutput"=dword:00000001
   
   [HKEY_CURRENT_USER\Software\Far\KeyMacros\Common\ShiftNumEnter]
   "Sequence"="ShiftEnter"
   "DisableOutput"=dword:00000001 

   Появились новые клавиши: NumEnter, Decimal/NumDel (в зависимости от состояния
   NumLock)

2. macro:post eval("AltF1") не работал; конструкция превращалась в Alt00000


svs 10.05.2007 14:38:34 +0300 - build 246

1. Macro: добавлены функции asc и chr.


svs 08.05.2007 15:47:40 +0300 - build 245

1. Забыл в прошлый раз про Automation в диалоге SystemSettings

2. "TreeFileAttr" можно задавать. По умолчанию FA_HIDDEN.

3. В farconst.hpp до бавлены закомменченные определения DRIVE_*

4. Macro: PlayMacro переименован в Eval и в нем же обнаружена бага - 
   нужно снимать флаг MFLAGS_REG_MULTI_SZ перед парсением...



svs 24.04.2007 20:55:54 +0300 - build 244

1. Mantis#279 - Редактор не позиционируется на новый файл после сохранения 
      macro:post ShiftF4 1 Enter F2 CtrlF10 Esc
      не позиционирует на созданный файл 

   В обчем вроде как... но при большом объеме каталога будут тормоза.
   Здесь проблема в том, что поиск файла ведет на VFS (на панели), а т.к.
   панель еще не апдейтилась, то, соответственно про этот новый файл
   ни кто ничего не знает.

2. Bug с удалением в корзину с последующей очисткой.
   Напихали в каталог симлинков. Грохнули каталог в корзину.
   Теперь, если корзину очистить, то киляется все, что было в этих
   симлинках.
   Здесь тупо вводим опцию "Delete symbolic links". Если она включена,
   то перед килянием каталога в корзину сканим подпапки на предмет симлинков
   и эти самые симлинки удаляем.
   Говорят Виста в этом плане умнее будет - ХЗ, поверим на слово, но мезханизм
   сканирования все же оставим :-)

   Здесь затронуты хелпы - нужен перевод!


svs 23.04.2007 16:25:20 +0300 - build 243

1. MFLAGS_LABELPRESENT - в морг. вместо него будет MFLAGS_REG_MULTI_SZ

2. +API::FARKEYSEQUENCEFLAGS::KSFLAGS_REG_MULTI_SZ

3. Как следствие - Sequence может иметь тип REG_MULTI_SZ.

4. Небольшая добавка в виде операторов ">>" (shr) и "<<" (shl)
   У них приоритет такой же как и у "+" и "-".

5. Отучение от внутреннего цикла для MCODE_OP_EXPR.
   Теперь MCODE_OP_EXPR и MCODE_OP_DOIT пережитки прошлого.

6. В KeyMacro::FARPseudoVariable в паре мест были пропущены "break;"

7. В KeyMacro::GetKey - вместо MCODE_OP_LT (и подобных) нужно было 
   MCODE_OP_JLT


warp 17.04.2007 03:20:36 +0300 - build 242

1. Падение хелпа при нажатии Shift-F2. Это жесть.

2. Зависания хелпа при попытке открыть пункт в том самом Shift-F2. 
   А реально - баг в DeleteEndSlash, мог всплывать и еще где-то.


t-rex 15.04.2007 20:25:36 +0200 - build 241

1. Wrapper: Начальная реализация панельного АПЙ. Иногда даже работает :)


t-rex 15.04.2007 03:23:58 +0200 - build 240

1. Не грузились плагины из кэша.


warp 10.04.2007 13:30:00 +0300 - build 239

1. Вернул на скорую руку хранение ANSI вариантов строк для .lng файлов. 
   Colorer x1.7 теперь даже показывает в меню строки. 


svs 09.04.2007 20:58:47 +0300 - build 238

1. Bug: В обработчике MCODE_OP_SAVE сначала нужно вытащить из стека значение,
        а потом остальным заниматься.

2. Добавлены макросы логирования:
   SYSLOG_KEYMACRO_PARSE/_KEYMACRO_PARSE()  - для парсера макросов
   SYSLOG_YJH/_YJH()                        - для Харона :-)

3. Остальное по мелочам - антураж при логировании макросов, etc.


svs 08.04.2007 20:55:06 +0300 - build 237

0. В проект добавлены файлы TVMStack.cpp и TVMStack.hpp 
   (реализация стека).

1. Нормальная реализация стека в макросах - был полный бардак, 
   как работало раньше - ХЗ. Например, $Text брал текст из вершины
   стека, но не удалял из стека это значение...
   Это позволило решить проблему с кодом возврата PlayMacro и,
   на будущее, исключить некоторые новые баги.

2. Если при исполнении $Text в стеке ничего нет (например, макрос
  "$Text _"), то ничего и не исполняется.

3. В ряд классов добавлены функции XXX::VMProcess()

4. В клавиши добавлен блок KEY_OP_BASE.
   В него входят аналоги некоторых макроопераций, которые невозможно
   исполнять в VMProcess (например, придется дублировать код из 
   ProcessKey).
   Имя таких аналогов начинается с KEY_OP_???
   Макродвижок сам подменяет макрокод на код нужной клавиши.

   Эта добавка (как и предыдущие и последующие) - небольшие 
   продвижения к...
   ...конечная цель: макрокоды должны иметь свои коды, отличные 
   от кодов клавишь.
   В будущем все обычные клавиши в байткоде будут ограничены кодами
   MCODE_OP_KEYS и MCODE_OP_ENDKEYS.

5. В редакторе добавлена обработка концов строк "\r\r\n"
   Увидеть такое чудо можно вот так: 
     ping localhost > file.txt
   Сохранение (SaveAs) с таким окончанием строк не предусмотрен.

6. Локальная таблица переменных в макросах... по аналогии с 1.7x

7. Вроде как макросы заработали :-)
   За исключением $SelWord - здесь нужно привести к юникоду
   функцию strmix.cpp::CalcWordFromString()


svs 04.04.2007 14:32:04 +0300 - build 236

1. Бага - постоянно собрасывается на английский
   Как повторить:
   - Выбираем русский язык интерфейса и справки; 
   - Язык нормально меняется; 
   - Выходим из FAR (установлен крыжик "Автосохранение настроек"); 
   - Загружаем FAR - язык русский; 
   - Выходим из FAR; 
   - Загружаем FAR снова и видим, что язык сбросился в английскй. Язык справки при этом не сбрасывается.


svs 04.04.2007 13:12:18 +0300 - build 235

1. Бага в EnumRegValueEx.
   Первый вызов RegEnumValueW выставлял ValSize в правильное значение, но
   для второго вызова этого размера было маловато и в итоге получали
   ERROR_MORE_DATA.

2. С макросами пока засада... думаю.


svs 03.04.2007 21:27:41 +0300 - build 234

1. Фигня была с языками. 
   Например, убили FarEng.lng, в реестре при этом стоит Language/Main="English"
   Грузимся. Видим русский интерфейс.
   set FARLANG
   видим "English".

2. Mantis#0000092: Переопределение лейбов функциональных клавиш
   Ну, это фича, давно востребованная... В общем работает. :-)
   [HKCU\Software\Far\KeyLabels\ЯЗЫК\ОБЛАСТЬ]
   "ИМЯКЛАВИШИ"="Значение"

   Здесь
     ЯЗЫК       - так, как написано в LNG-файле, например,
                  English или Russian, т.е. тот, который в параметре
                  ".Language" идет первым после "=" и до ","
     ОБЛАСТЬ    - область действия в терминологии macro.
                  Понимаем области: Shell, Help, Edit, View, QView, Tree, Info
     ИМЯКЛАВИШИ - так, как они описываются в макросах.
                  Понимаются только функциональные "*F?" (что естественно :-))

2Warp: Бадья с EnumRegValueEx и EnumRegValue.
       второй RegEnumValueW возвращает
       #define ERROR_MORE_DATA                  234L    // dderror

       И в config.cpp вот это глянь
      {1, REG_SZ,     NKeyLanguageW,L"Main",&Opt.strLanguage, 0, InitedLanguage}, 

      в общем... все, что связано с InitedLanguage :-)



t-rex 02.04.2007 08:07:13 +0200 - 233

1. Wrapper: Теперь работает Menu.


t-rex 02.04.2007 05:23:47 +0200 - 232

1. Wrapper: Частичная реализация EditorControl. Теперь обычный колорер пашет в 1.80.
   Обработка ECTL_GETSTRING сделана через жопу но вроде как работает (пока).


t-rex 02.04.2007 03:46:11 +0200 - 231

1. Wrapper: Ещё несколько функций в FSF, пару в PSI и несколько заглушек в PSI.


t-rex 02.04.2007 01:36:33 +0200 - 230

1. Сделал почти весь FSF и немного PSI для OEM плагинов.
   Пока что все враперы лежат в wrap.cpp который тупо инклудится в PluginA.cpp.


t-rex 01.04.2007 23:11:36 +0200 - 229

1. Начальная имплементация враппера для OEM (старых) плагинов.
   Даже работает :) Структуры PSI и FSF пустые, но можно уже написать плагин который будет
   открыватся по OpenPlugin и не юзать FarAPI. Есть обработка PluginInfo, и wchar_t -> char
   в некоторых функциях. Остальные функции не работают.
   В PluginA.cpp - класс для работы со старыми плагинами.
   В PluginW.cpp - класс для работы с юникодными плагинами.
   В Plclass.hpp - абстрактный класс Plugin который наследуют PluginA и PluginW и с ним работает PluginManager.
   В pluginold.hpp - это plugin.hpp от 1.71, немного подредактированый и закрытый в namespace oldfar.

2. Убраны ворнинги.


yjh 31.03.2007 04:47:13 +0300 - 228

1. Убрана ошибка перераспределения памяти в обработке макросов (проявлялось в
   x64 и - теоретически - в висте)

yjh 31.03.2007 03:17:21 +0300 - 227

1. Убрана ошибка на закрытии при отсуствующих панелях (gpf) - возникало,
   например, при запуске с /r

t-rex 30.03.2007 05:55:19 +0200

1. Мелкие обновления в мэйке. Включил ворнинги о x64 совместимости для всех видов сборок.


t-rex 30.03.2007 05:46:02 +0200

1. Мелкое переименование переменных без билда.


t-rex 30.03.2007 04:54:38 +0200 - build 226

1. Массовое уничтожение "W" продолжается.

2. Решил стать оригинальным и добавил паре функций "A" в имя.
   Чтоб их потом было легче найти и убить.


t-rex 30.03.2007 02:04:50 +0200 - build 225

1. Вот теперь можно реально бояться :) Убрал у всех APIшых структур и функций "W" в имени.
   А вот ко всем экспортам наоборот добавил "W" ввиду подготовительного процесса для написания
   врапера для 1.7x плагинов.

2. Где попало на глаза исправил мешанину пробелов и табов (на табы соответственно).
   Если кто не в курсе то мой плагин BlockIndent делает такие вещи очень классно :)

3. Убил последний ворнинг.


warp 30.03.2007 03:52:00 +0300 - build 224

1. Продолжаем массово убивать "W" в именах функций. Всем бояться.


warp 27.03.2007 16:04:00 +0300 - build 223

1. Функции с "W" на конце просочились со стороны _DEBUG. Восстание подавлено.


warp 27.03.2007 15:04:00 +0300 - build 222

1. Массовое истребление "W" в именах функций. Может что отвалилось.

2. Поправлено имя параметра в plugin.hpp::OpenFilePlugin. Не OpenFrom, а OpMode.

3. При исключительной ситуации не всегда правильно передавался идентификатор функции,
   вызвавшей исключение, кроме того неправильно вызывалась функция UnloadPlugin.


warp 26.03.2007 15:50:00 +0300 - build 221

1. Починил меню дисков на предмет новой системы плагинов. Однако там еще остались
   веселые места, связанные с работой TArray/MenuItemEx. 

2. Добавил к функции OpenFilePlugin еще один параметр - OpMode. Во время поиска в архивах
   принимает значение OPM_FIND. Если какие плагины эту функцию уже используют - надо их пересобрать.

3. Убрал W из имен некоторых функций, на большее терпения не хватает. Так что процесс будет продолжен. 8-)


yjh 26.03.2007 06:49:23 +0300

1. Уточнение ключей ulink в Far.mak

t-rex 24.03.2007 04:07:51 +0200

1. То баг а не нормальный каст, пусть про него кричит.


yjh 24.03.2007 02:44:49 +0300

1. Все компиляции с /W3 и убрано последнее предупреждение в 64bit build


t-rex 23.03.2007 17:09:43 +0200 - build 220

1. Пару мелких фиксов в системе сборки. В custom.*.bat больше не надо выставлять FARTRY.

2. Убрал ворнинги для VC32, VC64, GCC.

3. Из за 2 пофиксился ещё одни баг в x64 сборке - DialogParam внутри фара был long а не LONG_PTR
   и у VMenu был не правильный прототип у обработчика сообщений.

4. Несколько новых ключиков для улучшения размера exe.

5. В UnicodeString появился SetLength() чтобы выставить новый конец строки (тока на уменьшение само собой).
   Там где в коде заметил, то переделал чтоб юзать это вместо танцов с GetBuffer() и ReleaseBuffer().

6. Переделал на ходу где заметил memcpy/memmove на wmemcpy/wmemmove где это нужно.


yjh 21.03.2007 00:17:21 +0300 - build 219

1. Доделана сборка отладочных билдов vc8 (32/64), и добавлена парочка ключей 
   которая (потенциально) может дать выигрыш по размеру

2. Сделана "нормальная" (без ассемблера кроме ud2 :) генерация исключений
   для ALPHA_VERSION

3. Добавлена "расшифровка" при exception по недопустимой/привелигированной
   инструкции

4. Для "нерасшифрованных" исключений выводится их код

5. Доделана нормальная отработка (показ) исключения по переполнению стека
   (и 32 и 64 бит версии)

6. Добавлен возможность компоновать ulink'ом - см. readme

7. Добавлена возможность передавать опции nmake - см. readme 


t-rex 19.03.2007 19:30:09 +0200 - build 218

Несколько патчей от 1.71, надеюсь что ничего не потерял по дороге.

1. Сделал везде где должно быть virtual функции.

2. Удалил ещё нескольно ненужных файлов.

3. Исправил баг с падением при вводе таба в режиме EXPAND_NEWTABS.

4. Добавил фильтры в пометку файлов.

5. Изменилась логика наследования в раскраске, теперь от того кто следующий
   наследуется всё кроме прозрачных элементов. А также добавил кнопочку "Make transparent".

6. В фильрах "панели" если выбраны несколько фильтров то делается AND.

7. Добавил текст в заголовке меню фильтров для описания D?,D-,D+.


warp 19.03.2007 01:01:00 +0300 - build 217

1. Юрий поймал очень забавный глюк с макросами, связанный с изменениями в 
   работе LocalUpperW/LocalLowerW. Поймал и поправил, собственно.

2. Некоторые изменения в apiExpandEnvironmentStrings для большего соответствия
   результата тому, что возвращает оригинальный ExpandEnvironmentStrings.


warp 18.03.2007 23:19:00 +0300 - build 216

1. Если плагин прописывал в кэш пустую строку для пункта меню, то он больше никогда
   в этом меню не показывался. Видимо, тоже самое имеется и в 1.7.

2. Неправильно работала функция копирования частей реестра.

3. Неправильно была задана строка для проверки, какую часть дерева не надо копировать
   при создании нового пользователя.


t-rex 16.03.2007 11:04:46 +0200 - build 215

1. Не правильно обнулялся CopyDlgParam в копире что приводило к падениям.

2. Диалог настроек "Dialog settings" был не того размера.

3. Исправления для x64 билда. Осталась одна бага в panel.cpp

      PanelMenuItem *item = (PanelMenuItem*)UserData; <--- DWORD

    	MessageBox (0, "this is BUGBUG, do not touch!", "Error!", MB_OK);

3. Сборка под VC8.


warp 15.03.2007 23:37:00 +0300 - build 214

1. Падало меню плагинов/меню конфигурации при наличии более чем одного плагина
   (привет сортировке).

2. Вроде все правки от yjh в plugin.hpp учел и применил. 


warp 15.03.2007 21:37:00 +0300 - build 213

1. Не во все места еще проник свет нового типа Plugin. Поправил Help::MkTopic.


svs 14.03.2007 19:08:36 +0300 - build 212

1. Mantis#268: ECTL_GETINFO может вернуть BlockStartLine = -1 
     Вызываю EditorControl c ECTL_SELECT и устанавливаю EditorSelect.BlockStartLine = -1 
     (подразумевается текущая строка, как это часто принято). Конкретно для этой операции
     в энциклопедии не указано, что -1 можно употребить. Но это работает (внешне). 
     Но это, похоже, приводит к тому, что следующий вызов EditorControl с ECTL_GETINFO 
     дает BlockStartLine = -1, и вот это уже неожиданно для остального кода, который 
     к этому не готов.
     Даже если EditorSelect.BlockStartLine = -1 недопустимо, ECTL_GETINFO не должен 
     возвращать некорретное значение BlockStartLine. 

2. В mix.cpp::GetDiskSize не "__int64", но "unsigned __int64"


svs 13.03.2007 20:33:15 +0300 - build 211

1. GetDiskSize (mix.cpp) чудил на терабайтных томах. Там вообще какой-то странный алгоритм
   был...

2. Macro: +"N=playmacro(S)" - "проиграть" строку в макросе
          +"S=waitkey(N)"   - ждать клавишу (вернет строковое представление клавиши, 
                              или пусто по таймауту)

3. В связи с п.2 у функции GetInputRecord появился второй параметр (чтобы не вызывать повторно 
   макросы из макросов, т.к. нам нужна всего лишь реальная клавиша)
   + у WaitKey() тоже есть параметр - таймаут в ms

4. Небольшие заделы для SERVICEREGION (Editor)


warp 05.03.2007 01:53:00 +0300 - build 210

1. Редактор падал при открытии пустого файла.

2. Дерево падало при попытке прервать операцию сканирования.

3. Частичное чтение дерева взято из 1.7.

4. Виртуальное наследование просочилось таки.


warp 03.03.2007 00:54:00 +0300 - build 209

1. Элементы диалога типа DI_LISTBOX не ловили клик мышью в DN_MOUSECLICK 
   отличный от FROM_LEFT_1ST_BUTTON_PRESSED.


svs 26.02.2007 10:44:24 +0300 - build 208

1. В main.cpp неправильно вызывался FileEditor - забыли про параметр codepage

2. Bug: Если одновременно указать несколько /v и /e, но из ФАРа не выйдем.
   На будущее - имеет смысл проработать вариант для стандалоне редактора/вьювера, 
   но с неколькими открытыми файлами.

3. В FileEditor немного подсократил количество параметров.

4. Shift-F4 Ctrl-Y Enter на панели плагина матерится будет.
   (пока затычка...)

5. Был такой вот флаг FFILEEDIT_ISNEWFILE - нафига? - не помню.
   Убрал. Если "всплывет" - полечим.

6. Добавил EF_SERVICEREGION. Пока зарезервировано.

7. DIF_NOTCVTUSERCONTROL доступен всем.


warp 25.02.2007 04:09:00 +0300 - build 207

1. Так, для разминки, убил Ansi вариант SendDlgMessage (он давно не используется)
   и исправил рекурсию при вызове плагинов. 


svs 07.02.2007 18:51:09 +0300 - build 206

1. Макро: 
    APanel.ColumnCount - активная панель:  количество колонок
    PPanel.ColumnCount - пассивная панель: количество колонок

2. Правило "Panel\ShellRightLeftArrowsRule":REG_DWORD
    <ER>
    Нынешнее FAR'овское поведение ближе к NC/VC, чем предлагаемое. 
    Единственная разница - в NC при пустой командной строке в режиме 
    панели в одну колонку Left/Right просто игнорируются. Я же решил 
    применить их к панели, чтобы не пропадали зря. При непустой 
    командной строке FAR работает аналогично NC и VC. Как мне кажется, 
    менять это поведение значит идти в разрез с многолетними привычками 
    пользователей. Да и пользы от Left/Right в одноколоночной панели 
    немного. Почти те же PgUp/PgDn.
    </ER>


   "ShellRightLeftArrowsRule":REG_DWORD
    Параметр "ShellRightLeftArrowsRule" с типом DWORD позволяет управлять 
    поведением стрелок влево/вправо (как на основной, так и на дополнительной 
    клавиатуре).
    Значения:
      0 - поведение как у 1.70: если командная строка непуста, то клавиши 
          Left/Right и Num4/Num6 действуют по-разному в зависимости от 
          режима панели: если имена файлов отображаются в несколько колонок 
          (по умолчанию режимы 2 и 3), то команды вправо/влево применяются 
          к панели (как и при пустой командной строке); а если имена файлов 
          отображаются в одну колонку (по умолчанию все остальные режимы), 
          то команды вправо/влево применяются к командной строке.
      1 - клавиши Left/Right и Num4/Num6 при включённой панели всегда 
          применяются только к ней, независимо от содержимого командной 
          строки и режима панели. 
          Примечание: в командной строке есть CtrlD/CtrlS. 
    По умолчанию значение = 0. 


t-rex 06.02.2007 23:52:24 +0200 - 205

Очень много патчей от 1.71, надеюсь что ничего не потерял по дороге.

1. Соединил все виды фильтров (панели, копир и поиск) в одну сущность
   имеющую функционал всех прошлых фильтров вместе.

1.1. Заодно исправлен баг из за которого в меню фильтров не сохранялись
     настройки для авто-фильтров.

1.2. Также исправлен Mantis#202 как побочный эффект.

1.3. На панелях можно фильтровать папки. Надо бы разобраться с копиром ещё.

1.4. В array.hpp добавлен новый шаблонный класс TPointerArray для базовой работы
     с массивом объектов. Он же используется теперь во всех местах где нужны фильтры.

2. Раскраска файлов и группы сортировки теперь фильтры и соединены в одну сущность.

2.1. Группы сортировок влияют также на папки но папки все ровно всегда сверху,
     просто сортируются между собой.

2.2. Добавил прозрачность в раскраску и возможность раскраски файлов с помощью нескольких
     пунктов раскраски ([ ] Continur processing).

2.3. Меню настройки цветов перерисовывает панели чтоб отражались прозрачные цвета.

3. Для DI_TEXT если заданы по человечески X1 и X2 то не будем выводить больше текста чем заданно.

4. FCTL_GETUSERSCREEN - сбрасывает UserBuffer на экран.
   Теперь плагины могу эмулировать запуск программ в фаре используя
   FCTL_GETUSERSCREEN и FCTL_SETUSERSCREEN.
   Заодно исправлен баг в FCTL_SETUSERSCREEN который съедал последнюю строчку
   при выводе в Ctrl-O.
   Ну и для правильной работы FCTL_GETUSERSCREEN при первом запуске фара, добавил
   выставления курсора перед сохранением первичного UserBuffer в ControlObject::Init().

5. Если плагин был вызван по префиксу то до и после его вызова ком-строка обнулялась.
   Убрал обнуление после запуска так как плагин мог установить ком строку во время работы.
   При запуске из usermenu ком-строка как и раньше восстанавливается и так вроде должно быть.

6. Если диалог был во весь экран то фар мог падать при рисовании тени.

7. Не посылался EE_CLOSE для ?New file?.
   Теперь EE_CLOSE посылается всегда если послался EE_READ чтоб
   небыло утечек памяти в плагинах.

8. Изменил в батниках имя файла куда сохраняется вывод компайлера чтоб у него
   не было окончания и все такие файлы шли на панели вместе.

9. Исправил мэйк для GCC.


svs 26.01.2007 16:51:12 +0300 - build 204

1. Добавлен флаг DIF_SEPARATORUSER. Пока "внутри", т.к. в процессе...
   (подробнее в REMINDER)

2. Проблема с сепараторами, когда указаны ВСЕ координаты (из форума)
   пересчитаем правильные размеры.


svs 25.01.2007 14:25:20 +0300 - build 203

1. В обработчике DefDlgProc для события DN_BTNCLICK не учитывался флаг DIF_BTNNOCLOSE

2. Траблы с надписями в кейбаре (редактор, вьювер).
   Теперь между MXXXXF1 и MXXXXF12 не должно быть добавочных... типа MXXXXF1DOS
   Такова специфика кода.

3. Для элемента DI_VTEXT добавлена обработка флагов:
    DIF_CENTERGROUP - (не уверен, надо проверить), 
    DIF_SEPARATOR
    DIF_SEPARATOR2
    DIF_SHOWAMPERSAND

4. В обработчике флага DIF_CENTERTEXT трабла. Если был указан сепаратор, этот флаг 
   и координата X (отличная от -1, т.е. полные координаты), то... сепаратор 
   затирался...
   В общем DIF_CENTERTEXT в сочетании с DIF_SEPARATOR сам центрует строку.


svs 24.01.2007 19:01:33 +0300 - build 202

1. Уточнение DlgEdit. Все же будем наследовать от ScreenObject

2. ScreenObject::GetPosition стала виртуальной. 
   Возможно еще нужны уточнения по виртуальности функций...


svs 24.01.2007 18:06:17 +0300 - build 201

1. везде, где встречается DialogData, прописаны Y2.
   Просьба - если делаете диалог, то Y2 обязательно заполняйте!

2. Переделка класса DlgEdit. Теперь он ни от кого не наследуется, но держт на борту
   2 ссылки - на Edit и Editor.
   Плюс - необходимый набор функций.
   В диалоге это один объект, по сути - два (но этот объект для диалога, так что...)

4. небольшая заготовка в usermenu под DI_MEMOEDIT (в обычной жизни не используется)
   макрос PROJECT_DI_MEMOEDIT пока не юзабелен.


svs 18.01.2007 21:07:44 +0300 - build 200

1. Упс... пропустил гол в предыдущем матче ;-(
   (нет проверки на NULL)

2. Бага. Вылечил. Визуальная бага. Старая бага.
   стоим в каталоге, где есть диз-файл
   Ctrl-L Tab  - перешли на инфо-панель
   Alt-F? (для противоположной панели) и дальше на тот диск, 
          в каталоге которого нету diz`а
   Видим, что кейбар не обновился (Tab Tab - обновление прошло)


svs 18.01.2007 19:49:44 +0300 - build 199

0. Пересмотр кода кейбаров... выкинул кучу кода.

1. Закончим с кейбаром в FolderTree (он у нас от Frame, так пусть по 
   человече себя ведет, хотя бы как хелп)

2. Так же попробуем избавится от SaveScreen в FolderTree

3. в конструкторе TreeList проинициируем  SaveListData, иначе несколько
   раз Alt-F10 Esc и мы упали при освобождении памяти.

4. удалим немного комметов

5. Сейчас MKBFolderTreeXXX - всего несколько, имеет лис смысл разворачивать
   по всем клавишам (пусть даже они будут пустыми...) или как?
   Т.е. - делать как у всех объктов, юзающих кейбар или оставить так?

warp 18.01.2007 19:31:00 +0300 - build 198

1. Исправления в новой системе загрузки плагинов.

1.1. Не работал вызов конфигурации у кэшированных плагинов из-за изменения системы кэширования. 
   
1.2. Вызовы меню плагинов могли падать из-за неверного формирования строки-маски для хоткея. Странно, 
     что сразу не проявилось, баг где-то при портировании в юникод появился.

1.3. Функция сохранения кэша теперь принадлежит самому классу Plugin.

2. Файл plugin.Plugin.cpp переименован в plclass.cpp (.hpp соответственно). NMAKE
   отказался работать с файлом у которого "." в имени, ну и так имя файла ближе к
   стандарту. plclass.cpp(.hpp) добавлен в зависимости и far.mak и теперь самостоятельный
   файл (а не include).


warp 17.01.2007 18:42:00 +0300 - build 197

1. Почти полностью переделал всю систему загрузки плагинов. Теперь надо
   ее на чем-то хорошенько проверять. В теории возможна загрузка/выгрузка
   плагинов на ходу и прочие подобные штучки. 

2. Макрос UMSG теперь тоже возвращает const wchar_t *, передал в соответствующих
   местах инициализцию кейбара и пр.


t-rex 12.01.2007 16:51:21 +0200 - build 196

1. !$! не работал по назначению.


zg 11.01.2007 13:26:53 +0200

1. без билда, снова собирается gcc.

2. прототипы GetOpenPluginInfo и GetPluginInfo.


t-rex 10.01.2007 18:10:22 +0200 - build 195

1. Ещё немного x64.

2. Исправил фильтр (CtrlI).


svs 10.01.2007 14:28:59 +0300 - build 194

1. Добавлен файл REMINDER - своеобразная напоминалка о тех или иных действиях
   которые необходимо выполнить в будущем. Не TODO!
   Иначе потом не найдем что и как...

2. Из реминдера в принципе понятно почему "заработал" диалог назначения
   макросов...
   Вразумительного ответа пока не дождался почему в dialog.cpp было так сделано
   и будет ли переделано... посему - затычка.

3. Немного логирования + функция __MCODE_ToName() - логирование MCODE_


t-rex 10.01.2007 07:54:00 +0200 - build 193

1. Прошелся вроде бы по всем структурам которые содержат string и сделал для
   них правильную инициализацию и аллокацию в коде где такое было нужно.

2. Несколько мелких юникод, x64 и других фиксов.


svs 10.01.2007 00:52:09 +0300 - build 192

1. Кривая инициализация... FAR_FIND_DATA_EX DestData={0};
   error C2552: 'DestData' : non-aggregates cannot be initialized with initializer list
   В FAR_FIND_DATA_EX среди членов ходит класс string!
   Убираем.
   2WARP: просмотри дифы для copy.cpp и global.cpp

2. Дебажная компиляция под MSVC.
   Добавлена _wcstoi64. Если у кого вылезут глюки, то в farrtl.cpp между
   <SVS> и </SVS> нужно добавить "&& defined(SYSLOG_SVS)" - и мне приятно 
   и вам спокойнее ;-)
   
   А. О! Если кто юзает vc.2003.rar, то нужно 
     copy mspdb71.dll mspdb70.dll 
   с перезаписью :-)

3. Ctrl-A в архиве на каталоге - все опции атрибутов помечены.

4. Про макросы немного уточнений, в т.ч. включение в работу MsgBox.

5. Очередное уточнение SysLog


t-rex 09.01.2007 04:04:42 +0200 - build 191

1. Немного юникодных мелочей там и сям - чтоб получить вкус.


t-rex 09.01.2007 01:42:48 +0200

1. Совершенно мелкая фигня без билда, заменил две *A функции на *W.


t-rex 09.01.2007 01:03:04 +0200 - build 190

1. Вернул нумерическую сортировку.

2. Убрал несколько Ansi функций.

3. Переделал Ansi функции сравнения строк (которые могут понадобится для врапера плагинов)
   чтоб юзали внутри себя юникод, чем отменил LCIDSort и т.п.


warp 08.01.2007 21:45:00 +0300 - build 189

1. Ужесточена проверка на наличие hotplug устройства. Проверяем, не 
   ждет устройство извлечения. 

svs 08.01.2007 00:07:47 +0300 - build 188

1. Вторая итерация SysLog. Путем "#define" сделаем явный вызов
   функции преобразования из "string" в "const wchar_t *", дабы
   не упасть...

2. Изменен scripts/mkdep.awk - не учитывался objlog для дебажной версии.

3. Именуем внутрение структуры в структуре FilterParams (матюки компилятора)


svs 07.01.2007 21:27:50 +0300 - build 187

1. Первая итерация восстановить работоспособность SysLog.


t-rex 07.01.2007 19:37:52 +0200 - build 186

1. Убрал несколько Ansi функций из фара и импортов.
   И заодно исправил мелкие юникод баги в eject функции для Win9x на случай что оно будет надо.


svs 07.01.2007 18:10:04 +0300 - build 185

1. Изменен формат функции ScreeObject::VMProcess - новые параметры
   Возможно потом нужно будет еще несколько уточнений вводить, но на
   сейчас (для Help.XXXX) вполне достаточно.

warp 07.01.2007 16:48:00 +0300 - build 184

1. Больше не существует GetMsg, MSG и т.п. Обработка .lng только в юникоде (т.е. файлы 
   читаются и в ANSI, но внутри Far'а только юникод).

2. Попутно в обработчике .lng исправлено несколько ошибок с удалением данных.

3. Выкинул USE_WFUNC, Opt.UseUnicodeConsole и неюникодные версии Text/VText/mprintf и т.п.
   Opt.UseUnicodeConsole, видимо, вернется. В виде Opt.UseAnsiConsole (привет телнету).

4. Выкинул еще пачку ANSI функций, которые реально уже не требовались, где еще требовались - исправил.

t-rex 05.01.2007 02:44:35 +0200

1. без билда, обновил инклюды и скрипт генерации оных чтоб в них выводилась версия фара.

2. Удалил файл dummy.cpp из-за ненадобности.

3. Синхронизайия хэлпа и *.pas с 1.7x


warp 05.01.2007 03:36:00 +300 - build 183

1. Выкинул глюкодром по имен RawConvertShortNameToLong, заменил его на
   ConvertNameToLongW. Если чего отвалится, буду крутить дальше, но глюкодром не верну.

2. GetMsg в API зачем-то возвращала char *, теперь, как положено, возвращает const wchar_t *.

t-rex 04.01.2007 13:16:24 +0200 - build 182

1. Убрал /* Revision: $ */ и лишние коменты отовсюду.

2. Входим в эру 64-бит

   Главные изменения:
     DlgProc: long Param2 -> LONG_PTR Param2 и возвращает LONG_PTR вместо long
     SendDlgMessage: long Param2 -> LONG_PTR Param2 и возвращает LONG_PTR вместо long
     DefDlgProc: long Param2 -> LONG_PTR Param2 и возвращает LONG_PTR вместо long
     DialogEx: long Param -> LONG_PTR Param
     FarMenuItemEx: DWORD UserData -> DWORD_PTR UserData
     PluginPanelItem: DWORD UserData -> DWORD_PTR UserData
     AdvControl: возвращает INT_PTR вместо int
     OpenPlugin: int Item -> INT_PTR Item
   А также в execute.cpp добавлено определение 64-bit GUI прог.

   После некоторых экспериментов было выведено что выравнивание должно быть 8 для 64-bit версии.
   Обновил Far.mak и добавил vc.build.debug.64.bat и vc.build.release.64.bat которые используют
   custom.vc.debug.64.bat и custom.vc.release.64.bat соответственно.
   Мой custom.vc.release.64.bat содержит следующее:
   call "I:\Program Files\Microsoft Platform SDK for Windows Server 2003 R2\SetEnv.Cmd" /X64

   Убрал всевозможные ворнинги связанные с x64.
   Включил показ x64 ворнингов для x64 билда - люди, перед тем как вы комитите свои
   изменения, соберите x64 версию и посмотрите на ворнинги - если есть и вы не знаете
   как правильно их решить то стучите ко мне (главное не уберите ворнинг оставив баг).

   Остались несколько ворнингов которые показывают на баг внесенный новыми макросами для
   хэлпа - буду решать когда поймаю Валю.

3. Удалил ClevMutex.hpp из за ненадобности и из за x64 несовместимости.


warp 31.12.2006 16:06:00 +300 - build 181

как это модно писать - regression fixes

1. делал сохранение - в самом конце поломал правильность
получения кодировки в диалоге сохранения.

2. когда менял PluginItem на Plugin откусил возможность грузить плагины.

warp 30.12.2006 06:20:00 +300 - build 180

1. Различные переделки в fileeditor.cpp. новый диалог открытия/создания файла.

2. PluginItem переименован в Plugin и это теперь класс. Попутно устранены несколько memset'ов, нельзя
так очищать классы и структуры, содержащие string.

3. Новый диалог сохранения файла в fileeditor.cpp. Практически реальное сохранение файлов. Зачатки 
механизма переоткрытия файла при смене c юникодной кодовой таблицы на неюникодную или наоборот. 

4. Очень много изменений в editor/fileedit. Все ужасно сыро.

5. lng.generator rc10, тот который с поддержкой UTF-8. 

2SVS: У меня тоже, там ??? не зря стоит. 

svs 27.12.2006 18:36:43 +0300 - build 179

1. Macro: + новых слова:
    Help.FileName - имя просматриваемого файла помощи
    Help.Topic    - просматриваемый топик
    Help.SelTopic - топик, который сейчас выделен

2. Попутно бадья нашлась при формировании топика:
   Shift-F2, а дальше путешествуем по топикам.
   в итоге получаем кучу слешей в конце StackDate.HelpPath
   Решение - удалим все конечные слеши и добавляем единственный.

3. У DeleteEndSlash новый параметр - удалить ли _ВСЕ_ концевые слеши.
   по умолчание "неа, тока один от конца строки".

4. В WindowInfo для Help`а теперь заполням Name - полный путь к файлу.

2WARP: вызывает сомнение вот фрагмент, подобный:

    case MCODE_V_HELPFILENAME: // Help.FileName
       return (int)(const wchar_t *)strFullHelpPathName;     // ???


svs 20.12.2006 15:29:10 +0300 - build 178

1. Откат Mantis#198. Здесь все веселее и веселее...
   Проблема в том, что пока ФАР не получит управление...


svs 15.12.2006 17:20:37 +0300 - build 177

1. Mantis#255 - При вставке пути к файлу/папке по Ctrl+Alt+F последний слеш 
                получается  не в ту сторону 
   Пусть AddEndSlash сама определяет чьих слешей больше :-)
   (второй параметр не "\", а 0x00).

3. Пусть "mkdep.list.txt" будет именоваться как "mkdep.list" 
   (он, гад такой все время попадает... под txt)

4. Mantis#198. Уточнение. В обчем тут такое дело...
   Есть у меня макрос "F11 ? 1 !".
   Здесь 
   '?' - хоткей для "cdHelps"
   '1' - Context-dependent help
   '!' - Previous query
   Если раньше в консоли ничего не появлялось, а просто тупо появлялся гуевый 
   хелп. То сейчас мелькает меню - открывается и закрывается.
   Посему пока просто учтем Mode==MACRO_DIALOG.
   Хмм пока это писал, увидел артефакты и в редакторе...
   Однозначно только MACRO_DIALOG учитываем (а там посмотрим - в смысле
   вернуть все взад...)

svs 15.12.2006 12:26:06 +0300 - build 176

1. Mantis#198: проблема с прорисовкой сообщения при работе с макросом
   Изменил немного механих окончания работы макропоследовательности

svs 14.12.2006 12:22:59 +0300 - build 175

1. Mantis#218: Проблема с копированием файла в самого себя
   (это когда копируем файл "c:\a.txt" в "c:")
   [-] При копировании уничтожалось содержимое файла в корне диска, если в 
       качестве приемника указывался этот самый диск (файл "C:\a.txt" копируем в "C:")

2. Поддержка колеса мыши в объекте выбора папок (копир)


svs 13.12.2006 13:13:20 +0300 - build 174

1. Mantis#235: Не распознаётся zip-архив
   Хотел сначала подателя жалобы послать на... TechInfo#63 :-)
   Но, расположение требуемой сигнатуры этого архива (в сааамом конце файла) 
   не укладывается в указанный диапазон - "Диапазон от 0x1000 до 0x80000".
   Здесь как раз бы 4метра указать, но...
   В общем снял органичение на верхний предел.
   Доку поправлю.


svs 12.12.2006 19:06:46 +0300 - build 173

1. В FolderTree не отрабатывали мышиные правила для диалога (вне диалога).
   
2. Mantis#253 - Пропадание содержимого дерева папок
   Добавил TreeList::SaveState() и TreeList::RestoreState(). чтобы сохранить
   текущие значения кеша и списка каталогов дерева.

3. DMOUSEBUTTON_* перенесены из dialog.hpp в farconst.hpp


svs 07.12.2006 15:31:40 +0300 - build 172

1. Вводим VSMFL_REDRAW для ViewerSetMode.Flags, ибо так правильнее будет.
   т.е. либо VCTL_SETMODE + VCTL_REDRAW, либо VCTL_SETMODE(VSMFL_REDRAW).

svs 06.12.2006 20:02:31 +0300 - build 171

1. Класс FolderTree наследуется от Frame, что позволило вылечить древний баг с 
   прорисовкой (F5 F10 F1 F5 F5 Esc - видим "грязь" на экране).
   Так же это изменение позволило добавить фичи:
   а) Alt-F9 (само получилось, т.к. Manager сам умеет перерисовывать все, что 
      наследуется от Frame)
   б) F5 - распахнуть/вернуть окно поиска каталога (по аналогии с хелпом)

   Так же, конструктор претерпел некоторые изменения в параметрах.

   В хелпах в раздел "@FindFolder" добавлена инфа про F5 и Ctrl[-Shift]-Enter.
   В FarEng.hlf.m4 нужен перевод.

2. Небольшие правки plugins.cpp. Просьба не употреблять __try/__except. Для
   этого есть макросы TRY/EXCEPT, соответственно.

3. Добавлен файл README. Перечислены некоторые правила. Если кто-то вспомнит
   еще правила - писать в этот файл.


warp & t-rex 05.12.2006 03:36:01 +0300 - build 170

1. Добавлена проверка плагина на "плагиновость" из 1.7

2. Устранены пара мелких багов.

svs 01.12.2006 20:19:01 +0300 - build 169

1. Замена в составе: ViewerMode.TypeWrap -> ViewerMode.WordWrap

2. Добавка в ViewerAPI - VCTL_SETMODE, enum VIEWER_SETMODE_TYPES, struct ViewerSetMode

3. В XXXControl добавлена проверка на вшивость с юзанием IsBadReadPtr()


svs 30.11.2006 09:27:43 +0300 - build 168

1. При выключенных настройках [ ] Save file position [ ] Save bookmarks 
   после открытия файла на редактирование курсор по умолчанию становится 
   в конец первой строки.

warp 25.11.2006 03:27:00 +0300 - build 167

1. Кое-какое сохранение в редакторе. Уже даже можно попробовать сохранить файл в UTF-8.
   Сыро до безобразие. Наблюдаются глюки.

2. Исправил кое-какие баги и неточности в обработке кодировок.

3. Еще всякая мелочь.

warp 25.11.2006 01:03:00 +0300 - build 166

1. Изменил в редакторе AddString на InsertString, теперь там указывается после
   какой строки добавить текущую. Пока не совсем точная реализация.

2. Исправил кое-какую мелочь.

warp 25.11.2006 00:17:00 +0300 - build 165

1. Убил FCTL_*ANOTHER* команды. Теперь эта/другая панель задается
   через первый параметр Info.Control как CURRENT_PANEL/ANOTHER_PANEL.
   Функционал еще не протестирован.

t-rex 24.11.2006 22:35:49 +0200 - build 164

1. Немного GCC. Почему вы упорно не используете _i64(NUMBER) вместо NUMBERi64?
   И _ui64(NUMBER) вместо NUMBERui64.

svs 23.11.2006 19:57:42 +0300 - build 163

1. Macro: $AKey - клавиша, который вызвали данный макрос
   (небольшой задел на будущее)


t-rex 23.11.2006 09:03:15 +0200 - build 162

1. При удалении пустой строки или соединении двух строк при помощи DEL или BS выставлялись
   неправильные символы конца строки для "новой" строки.


svs 21.11.2006 00:00:11 +0300 - build 161

1. Copy/Paste: "CurLine->GetEOLW" VS "CurPtr->GetEOLW"

svs 18.11.2006 00:16:11 +0300 - build 160

1. Mantis#139 - Нарушения с концами строк при Отмене

2. + Edit::GetEOLW()

3. У Editor::AddUndoData новый параметр - пусть Undo помнит EOL!

2warp: Эта... есть бага одна (не моя :-). Если открыть редактор, то
       в начале файла есть пустая строка. Судя по всему это результат
       выноса ReadFile из Editor в FileEditor (не уверен).
       Мой патч это не исправляет! (пока не знаю где копать)


warp 16.11.2006 21:27:00 +0300 - build 159

1. Намутил что-то страшное с кодировками. Реализация несколько неправильная
   идеологически (нужен объект для перекодировки, а не какой-то m_codepage), но
   теперь можно даже открыть файл на редактирование в какой-нибудь кодировке
   вроде KOI-8 (кто сказал "а сохранить?").

svs 07.11.2006 21:33:42 +0300 -

1. без билда добавлен tee.exe с коррекцией vc.build.debug.bat и 
   vc.build.release.bat

warp 06.11.2006 02:42:00 +0300 - build 158

1. Убил. Я его убил. Да! Метод ReadFile теперь принадлежит FileEditor, кэш
   тоже теперь принадлежит ему. Editor теперь представляет собой только memo,
   как и положено. На данный момент в кэш может сохраняться туфта, кодировки
   не работают (хм, ну это... не совсем, конечно...), проверка на минимальный 
   размер не работает, сообщение о загрузке файла не работает... Убил, что говорить.

warp 02.11.2006 02:42:00 +0300 - build 157

1. Добавил функцию apiGetFileSize, работающую сразу с unsigned __int64.
   Под это дело сделал в wipe поддержку файлов размером больше 4Гб и заменил
   GetFileSize в соотв. местах.

warp 02.11.2006 01:40:00 +0300 - build 156

1. Выкинул из редактора примерно 3.5 кб кода, путем убиения структуры
   EditList. Теперь поля Next/Prev принадлежат непосредственно Edit'у. 

warp 01.11.2006 02:34:00 +0300 - build 155

1. Попортил редактор немного на предмет унификации функций по 
   добавлению/созданию строк. Готовлю себя к переносу чтения файла
   в FileEditor (где ей и место).

svs 10.10.2006 11:36:00 +0300 - build 154

1. Macro: Area-коды разнесены. Теперь Condition имеет свои OpCode, а
   области - свои. Иначе в дампе макроса при логировании хрень.
   Для ньюсов ничего пистать ненадо.


svs 09.10.2006 12:15:50 +0300 - build  153

1. Упоминание про Ctrl-Shift-Enter при быстром поиске (нужен перевод!)
   Mantis 244

2. FindFile: Зацикливается поиск при поиске подстроки на файле больше 2Gb
   Mantis 243


warp 06.10.2006 17:10:00 +0300 - build 152

1. Вроде поправил ширину DIF_SEPARATOR для диалогов без рамки. 

t-rex 27.09.2006 04:12:34 +0300 - build 151

1. Ещё одно дополнение к фиксу "Падение при старте ФАРа, когда каталог недоступен".
   На пассивной панели открывался каталог без ".." вверху.

t-rex 27.09.2006 03:07:27 +0300

Косметика без билда.

1. Прошлый патч был совсем не в тему. Вернул как было и чтоб больше не было
   вопросов сделал два батника и изменил Far.mak:

   Эти батники на прямую не редактировать!!!!!!!!!
   Только для постоянных изменений для всех участников проекта.
   Читайте объяснение - всё продумано.

   --------------------
   vc.build.release.bat
   --------------------
   Этот батник собирает release версию фара с помощью VC и Far.mak.
   Батник заодно обновляет far.release.dep и языковые файлы.
   С запуском этого батника никогда не будут никаких проблем при сборке фара
   (кроме ошибок в самом коде :).
   Чтобы батник был универсальным и работал у всех без изменений он
   вызывает другой батник - custom.vc.release.bat - если такой есть.
   Этот (custom.vc.release.bat) батник вам надо создать самим так как он ваш
   личный и на SVN комитится не будет. В нём вы можете определять переменные
   среды компайлера и переопределять переменные среды которые используются
   для сборки фара в главном батнике.
   Например у меня он содержит:
   ---->8----
   @echo off
   call F:\lng\VC.Toolkit.2003\vcvars32.bat
   ----8<----
 
   ------------------
   vc.build.debug.bat
   ------------------
   Тоже что и vc.build.release.bat только собирает debug версию, обновляет
   far.debug.dep и вызывает custom.vc.debug.bat если такой есть.
   Пример custom.vc.debug.bat:
   ---->8----
   @echo off
   call F:\lng\VS98\Bin\VCVARS32.BAT
   set FAR_MSVCRT=/D FAR_MSVCRT
   set FARSYSLOG=-DSYSLOG_TREX %FARSYSLOG%
   ----8<----


svs 26.09.2006 10:52:00 +0300 -

Косметика без билда.

1. В mkdep.list.txt добавлены copyright.inc и farversion.inc, т.к. если сделать
   первый раз экспорт, а потом запустить компиляцию, то будет ошибка компиляции
   global.cpp, т.к.  ни copyright.inc ни farversion.inc еще нету.
   
   Так же исправлен scripts\mkdep.awk - учитывает расширение INC, т.е. как раз 
   те самые файлы copyright.inc и farversion.inc, которые генерятся из *.m4.

t-rex 25.09.2006 04:36:38 +0300 - build 150

1. Не влезали русские слова в диалог фильтра.

2. Совершенно не работала функция смены языка Фара.

3. UserData для VMenu при Size==0 ожидается и обрабатывается как wchar_t * а не как char *.

t-rex 23.09.2006 05:07:44 +0300 - build 149

1. Дополнил Валин фикс на тему "Падение при старте ФАРа, когда каталог недоступен"
   а то выходила фигня если недоступный путь был например C:\a - фар открывал C: и
   делал это очень криво.

   ВАЖНО!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   Ну нельзя делать кастинг от string в wchar_t * и потом менять последний,
   если надо ручками изменить string то делать это нужно _обязательно_ используя
   string::GetBuffer() и string::ReleaseBuffer()!

t-rex 23.09.2006 02:51:38 +0300 - build 148

1. В фиксе для висты сделал случайно memcpy вместо wmemcpy.

svs 20.09.2006 16:05:00 +0300 - build 147

1. Macro: первые приближения "Height" и "Width" (и "[A|P]Panel.Height")

2. Macro: fexist fattr и еже с ними возвращаали фингню, если файла нет.
          (преобразования, млин)

3. Добавлена функция Manager::SwapTwoFrame() для макро-нужд.
   ...либо не для макронужд, если умный Ctrl-Tab будет делаться средствами
   FAR.


svs 20.09.2006 15:34:00 +0300 - build 146

1. Падение при старте ФАРа, когда каталог недоступен (например, на
   FS была примонтирована флешка, которой при тсрате на месте не оказалось).

2. Уточнение KeyNameToKey() - для переменной ала "%CtrlAltF1" отрабатывал...
   в общем кривизна была :-)


t-rex 15.09.2006 04:43:53 +0300 - build 145

1. Починил вставку мусора в редакторе в висте при нажатие на Enter.
   В висте realloc на уменьшение не всегда (а может и никогда) ни возвращает тот же адрес.

2. Починил сборку GCC.

3. Мелкие изменения в мэйках.   

4. Начинаем писать changelog, я сделал себе макрос
   "t - r e x Space $Date \"%d.%m0.%Y %H:%M:%S %Z\" Enter"
   чтоб выводить заголовок changelog-а.
   Последующие логи надо писать сверху - т.е. файл будет идти хронологически снизу вверх.
   В changelog прошу писать в Win кодировке.

5. Добавил батник и m4 скрипт для авто пометки нового билда в репоситории.
   Батник выведет вот такое сообщение чтоб вы случайно не сделали ошибки.
   --------------------------------------------------------------------
   Continue only if you are sure that you have set the correct
   build and commited the changes.
   This command will tag the trunk under tags/VERSION_bBUILD, if such
   tag already exists this command might cause problems.
   --------------------------------------------------------------------
   If you're not sure press СtrlC.
   --------------------------------------------------------------------
   --------------------------------------------------------------------
   Продолжайте тольке если вы уверены что вы выставили правельный
   номер билда и закомитили изменения.
   Эта команда пометит текущий trunk в tags/VERSION_bBUILD, если такая
   пометка уже существует то это может привести к проблемам.
   --------------------------------------------------------------------
   Если вы не уверены то нажмите CtrlC
   --------------------------------------------------------------------
