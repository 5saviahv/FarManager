warp 17.01.2007 18:42:00 +0300 - build 197

1. Почти полностью переделал всю систему загрузки плагинов. Теперь надо
   ее на чем-то хорошенько проверять. В теории возможна загрузка/выгрузка
   плагинов на ходу и прочие подобные штучки. 

2. Макрос UMSG теперь тоже возвращает const wchar_t *, передал в соответствующих
   местах инициализцию кейбара и пр.


t-rex 12.01.2007 16:51:21 +0200 - build 196

1. !$! не работал по назначению.


zg 11.01.2007 13:26:53 +0200

1. без билда, снова собирается gcc.

2. прототипы GetOpenPluginInfo и GetPluginInfo.


t-rex 10.01.2007 18:10:22 +0200 - build 195

1. Ещё немного x64.

2. Исправил фильтр (CtrlI).


svs 10.01.2007 14:28:59 +0300 - build 194

1. Добавлен файл REMINDER - своеобразная напоминалка о тех или иных действиях
   которые необходимо выполнить в будущем. Не TODO!
   Иначе потом не найдем что и как...

2. Из реминдера в принципе понятно почему "заработал" диалог назначения
   макросов...
   Вразумительного ответа пока не дождался почему в dialog.cpp было так сделано
   и будет ли переделано... посему - затычка.

3. Немного логирования + функция __MCODE_ToName() - логирование MCODE_


t-rex 10.01.2007 07:54:00 +0200 - build 193

1. Прошелся вроде бы по всем структурам которые содержат string и сделал для
   них правильную инициализацию и аллокацию в коде где такое было нужно.

2. Несколько мелких юникод, x64 и других фиксов.


svs 10.01.2007 00:52:09 +0300 - build 192

1. Кривая инициализация... FAR_FIND_DATA_EX DestData={0};
   error C2552: 'DestData' : non-aggregates cannot be initialized with initializer list
   В FAR_FIND_DATA_EX среди членов ходит класс string!
   Убираем.
   2WARP: просмотри дифы для copy.cpp и global.cpp

2. Дебажная компиляция под MSVC.
   Добавлена _wcstoi64. Если у кого вылезут глюки, то в farrtl.cpp между
   <SVS> и </SVS> нужно добавить "&& defined(SYSLOG_SVS)" - и мне приятно 
   и вам спокойнее ;-)
   
   А. О! Если кто юзает vc.2003.rar, то нужно 
     copy mspdb71.dll mspdb70.dll 
   с перезаписью :-)

3. Ctrl-A в архиве на каталоге - все опции атрибутов помечены.

4. Про макросы немного уточнений, в т.ч. включение в работу MsgBox.

5. Очередное уточнение SysLog


t-rex 09.01.2007 04:04:42 +0200 - build 191

1. Немного юникодных мелочей там и сям - чтоб получить вкус.


t-rex 09.01.2007 01:42:48 +0200

1. Совершенно мелкая фигня без билда, заменил две *A функции на *W.


t-rex 09.01.2007 01:03:04 +0200 - build 190

1. Вернул нумерическую сортировку.

2. Убрал несколько Ansi функций.

3. Переделал Ansi функции сравнения строк (которые могут понадобится для врапера плагинов)
   чтоб юзали внутри себя юникод, чем отменил LCIDSort и т.п.


warp 08.01.2007 21:45:00 +0300 - build 189

1. Ужесточена проверка на наличие hotplug устройства. Проверяем, не 
   ждет устройство извлечения. 

svs 08.01.2007 00:07:47 +0300 - build 188

1. Вторая итерация SysLog. Путем "#define" сделаем явный вызов
   функции преобразования из "string" в "const wchar_t *", дабы
   не упасть...

2. Изменен scripts/mkdep.awk - не учитывался objlog для дебажной версии.

3. Именуем внутрение структуры в структуре FilterParams (матюки компилятора)


svs 07.01.2007 21:27:50 +0300 - build 187

1. Первая итерация восстановить работоспособность SysLog.


t-rex 07.01.2007 19:37:52 +0200 - build 186

1. Убрал несколько Ansi функций из фара и импортов.
   И заодно исправил мелкие юникод баги в eject функции для Win9x на случай что оно будет надо.


svs 07.01.2007 18:10:04 +0300 - build 185

1. Изменен формат функции ScreeObject::VMProcess - новые параметры
   Возможно потом нужно будет еще несколько уточнений вводить, но на
   сейчас (для Help.XXXX) вполне достаточно.

warp 07.01.2007 16:48:00 +0300 - build 184

1. Больше не существует GetMsg, MSG и т.п. Обработка .lng только в юникоде (т.е. файлы 
   читаются и в ANSI, но внутри Far'а только юникод).

2. Попутно в обработчике .lng исправлено несколько ошибок с удалением данных.

3. Выкинул USE_WFUNC, Opt.UseUnicodeConsole и неюникодные версии Text/VText/mprintf и т.п.
   Opt.UseUnicodeConsole, видимо, вернется. В виде Opt.UseAnsiConsole (привет телнету).

4. Выкинул еще пачку ANSI функций, которые реально уже не требовались, где еще требовались - исправил.

t-rex 05.01.2007 02:44:35 +0200

1. без билда, обновил инклюды и скрипт генерации оных чтоб в них выводилась версия фара.

2. Удалил файл dummy.cpp из-за ненадобности.

3. Синхронизайия хэлпа и *.pas с 1.7x


warp 05.01.2007 03:36:00 +300 - build 183

1. Выкинул глюкодром по имен RawConvertShortNameToLong, заменил его на
   ConvertNameToLongW. Если чего отвалится, буду крутить дальше, но глюкодром не верну.

2. GetMsg в API зачем-то возвращала char *, теперь, как положено, возвращает const wchar_t *.

t-rex 04.01.2007 13:16:24 +0200 - build 182

1. Убрал /* Revision: $ */ и лишние коменты отовсюду.

2. Входим в эру 64-бит

   Главные изменения:
     DlgProc: long Param2 -> LONG_PTR Param2 и возвращает LONG_PTR вместо long
     SendDlgMessage: long Param2 -> LONG_PTR Param2 и возвращает LONG_PTR вместо long
     DefDlgProc: long Param2 -> LONG_PTR Param2 и возвращает LONG_PTR вместо long
     DialogEx: long Param -> LONG_PTR Param
     FarMenuItemEx: DWORD UserData -> DWORD_PTR UserData
     PluginPanelItem: DWORD UserData -> DWORD_PTR UserData
     AdvControl: возвращает INT_PTR вместо int
     OpenPlugin: int Item -> INT_PTR Item
   А также в execute.cpp добавлено определение 64-bit GUI прог.

   После некоторых экспериментов было выведено что выравнивание должно быть 8 для 64-bit версии.
   Обновил Far.mak и добавил vc.build.debug.64.bat и vc.build.release.64.bat которые используют
   custom.vc.debug.64.bat и custom.vc.release.64.bat соответственно.
   Мой custom.vc.release.64.bat содержит следующее:
   call "I:\Program Files\Microsoft Platform SDK for Windows Server 2003 R2\SetEnv.Cmd" /X64

   Убрал всевозможные ворнинги связанные с x64.
   Включил показ x64 ворнингов для x64 билда - люди, перед тем как вы комитите свои
   изменения, соберите x64 версию и посмотрите на ворнинги - если есть и вы не знаете
   как правильно их решить то стучите ко мне (главное не уберите ворнинг оставив баг).

   Остались несколько ворнингов которые показывают на баг внесенный новыми макросами для
   хэлпа - буду решать когда поймаю Валю.

3. Удалил ClevMutex.hpp из за ненадобности и из за x64 несовместимости.


warp 31.12.2006 16:06:00 +300 - build 181

как это модно писать - regression fixes

1. делал сохранение - в самом конце поломал правильность
получения кодировки в диалоге сохранения.

2. когда менял PluginItem на Plugin откусил возможность грузить плагины.

warp 30.12.2006 06:20:00 +300 - build 180

1. Различные переделки в fileeditor.cpp. новый диалог открытия/создания файла.

2. PluginItem переименован в Plugin и это теперь класс. Попутно устранены несколько memset'ов, нельзя
так очищать классы и структуры, содержащие string.

3. Новый диалог сохранения файла в fileeditor.cpp. Практически реальное сохранение файлов. Зачатки 
механизма переоткрытия файла при смене c юникодной кодовой таблицы на неюникодную или наоборот. 

4. Очень много изменений в editor/fileedit. Все ужасно сыро.

5. lng.generator rc10, тот который с поддержкой UTF-8. 

2SVS: У меня тоже, там ??? не зря стоит. 

svs 27.12.2006 18:36:43 +0300 - build 179

1. Macro: + новых слова:
    Help.FileName - имя просматриваемого файла помощи
    Help.Topic    - просматриваемый топик
    Help.SelTopic - топик, который сейчас выделен

2. Попутно бадья нашлась при формировании топика:
   Shift-F2, а дальше путешествуем по топикам.
   в итоге получаем кучу слешей в конце StackDate.HelpPath
   Решение - удалим все конечные слеши и добавляем единственный.

3. У DeleteEndSlash новый параметр - удалить ли _ВСЕ_ концевые слеши.
   по умолчание "неа, тока один от конца строки".

4. В WindowInfo для Help`а теперь заполням Name - полный путь к файлу.

2WARP: вызывает сомнение вот фрагмент, подобный:

    case MCODE_V_HELPFILENAME: // Help.FileName
       return (int)(const wchar_t *)strFullHelpPathName;     // ???


svs 20.12.2006 15:29:10 +0300 - build 178

1. Откат Mantis#198. Здесь все веселее и веселее...
   Проблема в том, что пока ФАР не получит управление...


svs 15.12.2006 17:20:37 +0300 - build 177

1. Mantis#255 - При вставке пути к файлу/папке по Ctrl+Alt+F последний слеш 
                получается  не в ту сторону 
   Пусть AddEndSlash сама определяет чьих слешей больше :-)
   (второй параметр не "\", а 0x00).

3. Пусть "mkdep.list.txt" будет именоваться как "mkdep.list" 
   (он, гад такой все время попадает... под txt)

4. Mantis#198. Уточнение. В обчем тут такое дело...
   Есть у меня макрос "F11 ? 1 !".
   Здесь 
   '?' - хоткей для "cdHelps"
   '1' - Context-dependent help
   '!' - Previous query
   Если раньше в консоли ничего не появлялось, а просто тупо появлялся гуевый 
   хелп. То сейчас мелькает меню - открывается и закрывается.
   Посему пока просто учтем Mode==MACRO_DIALOG.
   Хмм пока это писал, увидел артефакты и в редакторе...
   Однозначно только MACRO_DIALOG учитываем (а там посмотрим - в смысле
   вернуть все взад...)

svs 15.12.2006 12:26:06 +0300 - build 176

1. Mantis#198: проблема с прорисовкой сообщения при работе с макросом
   Изменил немного механих окончания работы макропоследовательности

svs 14.12.2006 12:22:59 +0300 - build 175

1. Mantis#218: Проблема с копированием файла в самого себя
   (это когда копируем файл "c:\a.txt" в "c:")
   [-] При копировании уничтожалось содержимое файла в корне диска, если в 
       качестве приемника указывался этот самый диск (файл "C:\a.txt" копируем в "C:")

2. Поддержка колеса мыши в объекте выбора папок (копир)


svs 13.12.2006 13:13:20 +0300 - build 174

1. Mantis#235: Не распознаётся zip-архив
   Хотел сначала подателя жалобы послать на... TechInfo#63 :-)
   Но, расположение требуемой сигнатуры этого архива (в сааамом конце файла) 
   не укладывается в указанный диапазон - "Диапазон от 0x1000 до 0x80000".
   Здесь как раз бы 4метра указать, но...
   В общем снял органичение на верхний предел.
   Доку поправлю.


svs 12.12.2006 19:06:46 +0300 - build 173

1. В FolderTree не отрабатывали мышиные правила для диалога (вне диалога).
   
2. Mantis#253 - Пропадание содержимого дерева папок
   Добавил TreeList::SaveState() и TreeList::RestoreState(). чтобы сохранить
   текущие значения кеша и списка каталогов дерева.

3. DMOUSEBUTTON_* перенесены из dialog.hpp в farconst.hpp


svs 07.12.2006 15:31:40 +0300 - build 172

1. Вводим VSMFL_REDRAW для ViewerSetMode.Flags, ибо так правильнее будет.
   т.е. либо VCTL_SETMODE + VCTL_REDRAW, либо VCTL_SETMODE(VSMFL_REDRAW).

svs 06.12.2006 20:02:31 +0300 - build 171

1. Класс FolderTree наследуется от Frame, что позволило вылечить древний баг с 
   прорисовкой (F5 F10 F1 F5 F5 Esc - видим "грязь" на экране).
   Так же это изменение позволило добавить фичи:
   а) Alt-F9 (само получилось, т.к. Manager сам умеет перерисовывать все, что 
      наследуется от Frame)
   б) F5 - распахнуть/вернуть окно поиска каталога (по аналогии с хелпом)

   Так же, конструктор претерпел некоторые изменения в параметрах.

   В хелпах в раздел "@FindFolder" добавлена инфа про F5 и Ctrl[-Shift]-Enter.
   В FarEng.hlf.m4 нужен перевод.

2. Небольшие правки plugins.cpp. Просьба не употреблять __try/__except. Для
   этого есть макросы TRY/EXCEPT, соответственно.

3. Добавлен файл README. Перечислены некоторые правила. Если кто-то вспомнит
   еще правила - писать в этот файл.


warp & t-rex 05.12.2006 03:36:01 +0300 - build 170

1. Добавлена проверка плагина на "плагиновость" из 1.7

2. Устранены пара мелких багов.

svs 01.12.2006 20:19:01 +0300 - build 169

1. Замена в составе: ViewerMode.TypeWrap -> ViewerMode.WordWrap

2. Добавка в ViewerAPI - VCTL_SETMODE, enum VIEWER_SETMODE_TYPES, struct ViewerSetMode

3. В XXXControl добавлена проверка на вшивость с юзанием IsBadReadPtr()


svs 30.11.2006 09:27:43 +0300 - build 168

1. При выключенных настройках [ ] Save file position [ ] Save bookmarks 
   после открытия файла на редактирование курсор по умолчанию становится 
   в конец первой строки.

warp 25.11.2006 03:27:00 +0300 - build 167

1. Кое-какое сохранение в редакторе. Уже даже можно попробовать сохранить файл в UTF-8.
   Сыро до безобразие. Наблюдаются глюки.

2. Исправил кое-какие баги и неточности в обработке кодировок.

3. Еще всякая мелочь.

warp 25.11.2006 01:03:00 +0300 - build 166

1. Изменил в редакторе AddString на InsertString, теперь там указывается после
   какой строки добавить текущую. Пока не совсем точная реализация.

2. Исправил кое-какую мелочь.

warp 25.11.2006 00:17:00 +0300 - build 165

1. Убил FCTL_*ANOTHER* команды. Теперь эта/другая панель задается
   через первый параметр Info.Control как CURRENT_PANEL/ANOTHER_PANEL.
   Функционал еще не протестирован.

t-rex 24.11.2006 22:35:49 +0200 - build 164

1. Немного GCC. Почему вы упорно не используете _i64(NUMBER) вместо NUMBERi64?
   И _ui64(NUMBER) вместо NUMBERui64.

svs 23.11.2006 19:57:42 +0300 - build 163

1. Macro: $AKey - клавиша, который вызвали данный макрос
   (небольшой задел на будущее)


t-rex 23.11.2006 09:03:15 +0200 - build 162

1. При удалении пустой строки или соединении двух строк при помощи DEL или BS выставлялись
   неправильные символы конца строки для "новой" строки.


svs 21.11.2006 00:00:11 +0300 - build 161

1. Copy/Paste: "CurLine->GetEOLW" VS "CurPtr->GetEOLW"

svs 18.11.2006 00:16:11 +0300 - build 160

1. Mantis#139 - Нарушения с концами строк при Отмене

2. + Edit::GetEOLW()

3. У Editor::AddUndoData новый параметр - пусть Undo помнит EOL!

2warp: Эта... есть бага одна (не моя :-). Если открыть редактор, то
       в начале файла есть пустая строка. Судя по всему это результат
       выноса ReadFile из Editor в FileEditor (не уверен).
       Мой патч это не исправляет! (пока не знаю где копать)


warp 16.11.2006 21:27:00 +0300 - build 159

1. Намутил что-то страшное с кодировками. Реализация несколько неправильная
   идеологически (нужен объект для перекодировки, а не какой-то m_codepage), но
   теперь можно даже открыть файл на редактирование в какой-нибудь кодировке
   вроде KOI-8 (кто сказал "а сохранить?").

svs 07.11.2006 21:33:42 +0300 -

1. без билда добавлен tee.exe с коррекцией vc.build.debug.bat и 
   vc.build.release.bat

warp 06.11.2006 02:42:00 +0300 - build 158

1. Убил. Я его убил. Да! Метод ReadFile теперь принадлежит FileEditor, кэш
   тоже теперь принадлежит ему. Editor теперь представляет собой только memo,
   как и положено. На данный момент в кэш может сохраняться туфта, кодировки
   не работают (хм, ну это... не совсем, конечно...), проверка на минимальный 
   размер не работает, сообщение о загрузке файла не работает... Убил, что говорить.

warp 02.11.2006 02:42:00 +0300 - build 157

1. Добавил функцию apiGetFileSize, работающую сразу с unsigned __int64.
   Под это дело сделал в wipe поддержку файлов размером больше 4Гб и заменил
   GetFileSize в соотв. местах.

warp 02.11.2006 01:40:00 +0300 - build 156

1. Выкинул из редактора примерно 3.5 кб кода, путем убиения структуры
   EditList. Теперь поля Next/Prev принадлежат непосредственно Edit'у. 

warp 01.11.2006 02:34:00 +0300 - build 155

1. Попортил редактор немного на предмет унификации функций по 
   добавлению/созданию строк. Готовлю себя к переносу чтения файла
   в FileEditor (где ей и место).

svs 10.10.2006 11:36:00 +0300 - build 154

1. Macro: Area-коды разнесены. Теперь Condition имеет свои OpCode, а
   области - свои. Иначе в дампе макроса при логировании хрень.
   Для ньюсов ничего пистать ненадо.


svs 09.10.2006 12:15:50 +0300 - build  153

1. Упоминание про Ctrl-Shift-Enter при быстром поиске (нужен перевод!)
   Mantis 244

2. FindFile: Зацикливается поиск при поиске подстроки на файле больше 2Gb
   Mantis 243


warp 06.10.2006 17:10:00 +0300 - build 152

1. Вроде поправил ширину DIF_SEPARATOR для диалогов без рамки. 

t-rex 27.09.2006 04:12:34 +0300 - build 151

1. Ещё одно дополнение к фиксу "Падение при старте ФАРа, когда каталог недоступен".
   На пассивной панели открывался каталог без ".." вверху.

t-rex 27.09.2006 03:07:27 +0300

Косметика без билда.

1. Прошлый патч был совсем не в тему. Вернул как было и чтоб больше не было
   вопросов сделал два батника и изменил Far.mak:

   Эти батники на прямую не редактировать!!!!!!!!!
   Только для постоянных изменений для всех участников проекта.
   Читайте объяснение - всё продумано.

   --------------------
   vc.build.release.bat
   --------------------
   Этот батник собирает release версию фара с помощью VC и Far.mak.
   Батник заодно обновляет far.release.dep и языковые файлы.
   С запуском этого батника никогда не будут никаких проблем при сборке фара
   (кроме ошибок в самом коде :).
   Чтобы батник был универсальным и работал у всех без изменений он
   вызывает другой батник - custom.vc.release.bat - если такой есть.
   Этот (custom.vc.release.bat) батник вам надо создать самим так как он ваш
   личный и на SVN комитится не будет. В нём вы можете определять переменные
   среды компайлера и переопределять переменные среды которые используются
   для сборки фара в главном батнике.
   Например у меня он содержит:
   ---->8----
   @echo off
   call F:\lng\VC.Toolkit.2003\vcvars32.bat
   ----8<----
 
   ------------------
   vc.build.debug.bat
   ------------------
   Тоже что и vc.build.release.bat только собирает debug версию, обновляет
   far.debug.dep и вызывает custom.vc.debug.bat если такой есть.
   Пример custom.vc.debug.bat:
   ---->8----
   @echo off
   call F:\lng\VS98\Bin\VCVARS32.BAT
   set FAR_MSVCRT=/D FAR_MSVCRT
   set FARSYSLOG=-DSYSLOG_TREX %FARSYSLOG%
   ----8<----


svs 26.09.2006 10:52:00 +0300 -

Косметика без билда.

1. В mkdep.list.txt добавлены copyright.inc и farversion.inc, т.к. если сделать
   первый раз экспорт, а потом запустить компиляцию, то будет ошибка компиляции
   global.cpp, т.к.  ни copyright.inc ни farversion.inc еще нету.
   
   Так же исправлен scripts\mkdep.awk - учитывает расширение INC, т.е. как раз 
   те самые файлы copyright.inc и farversion.inc, которые генерятся из *.m4.

t-rex 25.09.2006 04:36:38 +0300 - build 150

1. Не влезали русские слова в диалог фильтра.

2. Совершенно не работала функция смены языка Фара.

3. UserData для VMenu при Size==0 ожидается и обрабатывается как wchar_t * а не как char *.

t-rex 23.09.2006 05:07:44 +0300 - build 149

1. Дополнил Валин фикс на тему "Падение при старте ФАРа, когда каталог недоступен"
   а то выходила фигня если недоступный путь был например C:\a - фар открывал C: и
   делал это очень криво.

   ВАЖНО!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   Ну нельзя делать кастинг от string в wchar_t * и потом менять последний,
   если надо ручками изменить string то делать это нужно _обязательно_ используя
   string::GetBuffer() и string::ReleaseBuffer()!

t-rex 23.09.2006 02:51:38 +0300 - build 148

1. В фиксе для висты сделал случайно memcpy вместо wmemcpy.

svs 20.09.2006 16:05:00 +0300 - build 147

1. Macro: первые приближения "Height" и "Width" (и "[A|P]Panel.Height")

2. Macro: fexist fattr и еже с ними возвращаали фингню, если файла нет.
          (преобразования, млин)

3. Добавлена функция Manager::SwapTwoFrame() для макро-нужд.
   ...либо не для макронужд, если умный Ctrl-Tab будет делаться средствами
   FAR.


svs 20.09.2006 15:34:00 +0300 - build 146

1. Падение при старте ФАРа, когда каталог недоступен (например, на
   FS была примонтирована флешка, которой при тсрате на месте не оказалось).

2. Уточнение KeyNameToKey() - для переменной ала "%CtrlAltF1" отрабатывал...
   в общем кривизна была :-)


t-rex 15.09.2006 04:43:53 +0300 - build 145

1. Починил вставку мусора в редакторе в висте при нажатие на Enter.
   В висте realloc на уменьшение не всегда (а может и никогда) ни возвращает тот же адрес.

2. Починил сборку GCC.

3. Мелкие изменения в мэйках.   

4. Начинаем писать changelog, я сделал себе макрос
   "t - r e x Space $Date \"%d.%m0.%Y %H:%M:%S %Z\" Enter"
   чтоб выводить заголовок changelog-а.
   Последующие логи надо писать сверху - т.е. файл будет идти хронологически снизу вверх.
   В changelog прошу писать в Win кодировке.

5. Добавил батник и m4 скрипт для авто пометки нового билда в репоситории.
   Батник выведет вот такое сообщение чтоб вы случайно не сделали ошибки.
   --------------------------------------------------------------------
   Continue only if you are sure that you have set the correct
   build and commited the changes.
   This command will tag the trunk under tags/VERSION_bBUILD, if such
   tag already exists this command might cause problems.
   --------------------------------------------------------------------
   If you're not sure press СtrlC.
   --------------------------------------------------------------------
   --------------------------------------------------------------------
   Продолжайте тольке если вы уверены что вы выставили правельный
   номер билда и закомитили изменения.
   Эта команда пометит текущий trunk в tags/VERSION_bBUILD, если такая
   пометка уже существует то это может привести к проблемам.
   --------------------------------------------------------------------
   Если вы не уверены то нажмите CtrlC
   --------------------------------------------------------------------
