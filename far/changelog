svs 25.01.2007 13:16:27 +0300 - build 2179

1. В обработчике DefDlgProc для события DN_BTNCLICK не учитывался флаг DIF_BTNNOCLOSE

2. Траблы с надписями в кейбаре (редактор, вьювер).
   Теперь между MXXXXF1 и MXXXXF12 не должно быть добавочных... типа MXXXXF1DOS
   Такова специфика кода.

3. Для элемента DI_VTEXT добавлена обработка флагов:
    DIF_CENTERGROUP - (не уверен, надо проверить), 
    DIF_SEPARATOR
    DIF_SEPARATOR2
    DIF_SHOWAMPERSAND

4. В обработчике флага DIF_CENTERTEXT трабла. Если был указан сепаратор, этот флаг 
   и координата X (отличная от -1, т.е. полные координаты), то... сепаратор 
   затирался...
   В общем DIF_CENTERTEXT в сочетании с DIF_SEPARATOR сам центрует строку.


t-rex 25.01.2007 07:14:19 +0200 - 2178

1. Снова фильтр - авто фильтры они только для файлов, папки не должны к ним подходить.


t-rex 25.01.2007 00:55:06 +0200 - 2177

1. Исправил пару багов с фильтром и доработал правильное сохранение в реестр.


t-rex 24.01.2007 23:18:17 +0200 - 2176

1. Соединил все виды фильтров (панели, копир и поиск) в одну сущность
   имеющую функционал всех прошлых фильтров вместе.

   Удобность работы с фильтром ещё не доработана до конца.
   На сей момент настройки меню фильтров независимы для каждого места
   откуда это меню может вызываться (панели, копир, поиск).

   Убрал файлы filter.* - теперь всё в filefilter.*.

2. Заодно исправлен баг из за которого в меню фильтров не сохранялись
   настройки для авто-фильтров но есть небольшой прикол - теперь маски
   авто-фильтра которые помечены в одной из областей работы фильтра
   показываются в меню фильтров во всех областях.
   Думаю может давать им другое имя если такой маски нет в панели.

3. Также исправлен Mantis#202 как побочный эффект.

4. На панелях можно фильтровать папки. Надо бы разобраться с копиром ещё.

5. Изменил в батниках имя файла куда сохраняется вывод компайлера чтоб у него
   не было окончания и все такие файлы шли на панели вместе.


svs 24.01.2007 18:57:20 +0300 - build 2175

1. Уточнение DlgEdit. Все же будем наследовать от ScreenObject

2. dlgedit?.pp - в досовой кодировке были

3. ScreenObject::GetPosition стала виртуальной. 
   Возможно еще нужны уточнения по виртуальности функций...


svs 24.01.2007 16:32:45 +0300 - build 2174

1. убил немного комментов

2. везде, где встречается DialogData, прописаны Y2.
   Просьба - если делаете диалог, то Y2 обязательно заполняйте!

3. Переделка класса DlgEdit. Теперь он ни от кого не наследуется, но держт на борту
   2 ссылки - на Edit и Editor.
   Плюс - необходимый набор функций.
   В диалоге это один объект, по сути - два (но этот объект для диалога, так что...)

4. небольшая заготовка в usermenu под DI_MEMOEDIT (в обычной жизни не используется)
   макрос PROJECT_DI_MEMOEDIT пока не юзабелен.


svs 18.01.2007 22:11:48 +0300 - build 2173

1. Ля... ну никак нельзя заниматься работй и ФАРом (явно "работа" лишняя :-)
   Мать мать мать...  Снова кейбар.
   Ну естественно нужно не на "" заменять, а просто, согласно писанию, тупо
   пропускать установку лейба....
   в 1.8x это исправлено.

2. когда в Message не используется диалог, но применяется MSG_WARNING,
   ...цвета кривые :-(
   (по наводке warp&t-rex)
   в 1.8x это исправлено.

3. убил немного комментов


svs 18.01.2007 20:53:52 +0300 - build 2172

1. Упс... пропустил гол в предыдущем матче ;-(
   (нет проверки на NULL)

2. Бага. Вылечил. Визуальная бага. Старая бага.
   стоим в каталоге, где есть диз-файл
   Ctrl-L Tab  - перешли на инфо-панель
   Alt-F? (для противоположной панели) и дальше на тот диск, 
          в каталоге которого нету diz`а
   Видим, что кейбар не обновился (Tab Tab - обновление прошло)

svs 18.01.2007 17:54:23 +0300 - build 2171

0. Пересмотр кода кейбаров... выкинул кучу кода.

1. Закончим с кейбаром в FolderTree (он у нас от Frame, так пусть по 
   человече себя ведет, хотя бы как хелп)

2. Так же попробуем избавится от SaveScreen в FolderTree

3. в конструкторе TreeList проинициируем  SaveListData, иначе несколько
   раз Alt-F10 Esc и мы упали при освобождении памяти.

4. удалим немного комметов

5. Сейчас MKBFolderTreeXXX - всего несколько, имеет лис смысл разворачивать
   по всем клавишам (пусть даже они будут пустыми...) или как?
   Т.е. - делать как у всех объктов, юзающих кейбар или оставить так?


warp 16.01.2007 10:15:00 +0300 - build 2170

1. Не глядя поправил ситуацию с неправильно выставленной папкой в
   в ситуации, когда IsModulePlugin вернул FALSE.


t-rex 12.01.2007 21:52:01 +0200 - build 2169

1. Не посылался EE_CLOSE для ?New file?.
   Теперь EE_CLOSE посылается всегда если послался EE_READ чтоб
   небыло утечек памяти в плагинах.


t-rex 12.01.2007 16:38:51 +0200 - build 2168

1. !$! не работал по назначению.


t-rex 10.01.2007 15:11:17 +0200 - build 2167

1. Ещё немного x64.


svs 10.01.2007 14:43:36 +0300 - build 

1. Без билда. Касаемо логирования. 
   Добавлена _MCODE_ToName

warp 08.01.2007 21:45:00 +0300 - build 2166

1. Ужесточена проверка на наличие hotplug устройства. Проверяем, не 
   ждет устройство извлечения. 

svs 08.01.2007 11:46:54 +0300 - build 2165

1. Ctrl-A в архиве на каталоге - все опции атрибутов помчеены.


svs 08.01.2007 00:01:11 +0300 - build 

1. Без билда. Восстановление возможности дебажной компиляции под VC 6
   Для компиляции понадобятся файлы cfg.h и cfgmgr32.h (из DDK)
   
   На сейчас следующее состояние 
   ("+" - компилится, "-" - нет, "*" - не пробовал, "?" - нафиг ненать)

               BCC/5.02  BCC/5.5  VC/6  VC/2003  VC/2005  GCC
   Release        *?       +?      *?     +        *       *
   Release/64     *?       *?      *?     +        *       *
   Debug          +        +?      +      -        *       *
   Debug/64       *?       *?      -?     -        *       *

   (это я пробовал в своем окружении - усли у кого есть что добавить...)

2. Изменен scripts/mkdep.awk - не учитывался objlog для дебажной версии.


svs 07.01.2007 12:40:55 +0300 - build 2164

1. Изменен формат функции ScreeObject::VMProcess - новые параметры
   Возможно потом нужно будет еще несколько уточнений вводить, но на
   сейчас (для Help.XXXX) вполне достаточно.


t-rex 05.01.2007 17:57:39 +0200 - build 2163

1. Вернул назад прошлые изменения. Валя, ещё раз такое сделаешь, убью.
   Или ты делаешь этот хренов класс или удаляешь нафиг эту фичу вообще.


svs 05.01.2007 16:41:08 +0300 - build 2162

1. Про "поймаю Валю" :-)
   Пока сделаем так. По хорошему нужна отдельные методы у класса Help для 
   получения необходимых данных...

t-rex 04.01.2007 11:19:01 +0200 - build 2161

1. Убрал всевозможные ворнинги связанные с x64 и заодно подправил пару мест
   (или я раньше пропустил или кто то уже успел нагадить).
   Включил показ x64 ворнингов для x64 билда - люди, перед тем как вы комитите свои
   изменения, соберите x64 версию и посмотрите на ворнинги - если есть и вы не знаете
   как правильно их решить то стучите ко мне (главное не уберите ворнинг оставив баг).

   Остались несколько ворнингов которые показывают на баг внесенный новыми макросами для
   хэлпа - буду решать когда поймаю Валю.

2. Удалил ClevMutex.hpp из за ненадобности и из за x64 несовместимости.


svs 27.12.2006 18:34:59 +0300 - build 2160

1. Macro: + новых слова:
    Help.FileName - имя просматриваемого файла помощи
    Help.Topic    - просматриваемый топик
    Help.SelTopic - топик, который сейчас выделен

2. Попутно бадья нашлась при формировании топика:
   Shift-F2, а дальше путешествуем по топикам.
   в итоге получаем кучу слешей в конце StackDate.HelpPath
   Решение - удалим все конечные слеши и добавляем единственный.

3. У DeleteEndSlash новый параметр - удалить ли _ВСЕ_ концевые слеши.
   по умолчание "неа, тока один от конца строки".

4. В WindowInfo для Help`а теперь заполням Name - полный путь к файлу.
     

svs 20.12.2006 17:12:10 +0300 - build 2159

1. Полумера, решения проблемы с выходом по ".." из юниководового каталога.
   а) позиционирование на каталого не происходит
   б) "cd .." матерится, но выходит.

svs 20.12.2006 15:26:33 +0300 - build 2158

1. Откат Mantis#198. Здесь все веселее и веселее...
   Проблема в том, что пока ФАР не получит управление...

svs 15.12.2006 16:48:23 +0300 - build 2157

1. Mantis#255 - При вставке пути к файлу/папке по Ctrl+Alt+F последний слеш 
                получается  не в ту сторону 
   Пусть AddEndSlash сама определяет чьих слешей больше :-)
   (второй параметр не "\", а 0x00).

2. Mantis#254 - Падение при копировании файла с длинным путём из связи с 
                коротким путём
   (выправляем RawConvertShortNameToLongName)

3. Пусть "mkdep.list.txt" будет именоваться как "mkdep.list" 
   (он, гад такой все время попадает... под txt)

4. Mantis#198. Уточнение. В обчем тут такое дело...
   Есть у меня макрос "F11 ? 1 !".
   Здесь 
   '?' - хоткей для "cdHelps"
   '1' - Context-dependent help
   '!' - Previous query
   Если раньше в консоли ничего не появлялось, а просто тупо появлялся гуевый 
   хелп. То сейчас мелькает меню - открывается и закрывается.
   Посему пока просто учтем Mode==MACRO_DIALOG.
   Хмм пока это писал, увидел артефакты и в редакторе...
   Однозначно только MACRO_DIALOG учитываем (а там посмотрим - в смысле
   вернуть все взад...)

svs 15.12.2006 12:17:28 +0300 - build 2156

1. Mantis#198: проблема с прорисовкой сообщения при работе с макросом
   Изменил немного механих окончания работы макропоследовательности

2. Жука надыбал. В панеле дерева "Shift-F6 End 1" ФАР с грохоттом
   завалился.
   Некорректно была сработана функция TreeList::GetCurDir()

svs 14.12.2006 12:04:08 +0300 - build 2155

1. Mantis#218: Проблема с копированием файла в самого себя
   (это когда копируем файл "c:\a.txt" в "c:")
   [-] При копировании уничтожалось содержимое файла в корне диска, если в 
       качестве приемника указывался этот самый диск (файл "C:\a.txt" копируем в "C:")

2. Поддержка колеса мыши в объекте выбора папок (копир)


svs 13.12.2006 12:31:57 +0300 - build 2154

1. Mantis#235: Не распознаётся zip-архив
   Хотел сначала подателя жалобы послать на... TechInfo#63 :-)
   Но, расположение требуемой сигнатуры этого архива (в сааамом конце файла) 
   не укладывается в указанный диапазон - "Диапазон от 0x1000 до 0x80000".
   Здесь как раз бы 4метра указать, но...
   В общем снял органичение на верхний предел.
   Доку поправлю.


svs 12.12.2006 15:17:13 +0300 - build 2153

1. В FolderTree не отрабатывали мышиные правила для диалога (вне диалога).
   
2. Mantis#253 - Пропадание содержимого дерева папок
   [-] Пропадало содержимое дерева папок, если процесс перечитывания 
       каталогов прерывался.
   Добавил TreeList::SaveState() и TreeList::RestoreState(). чтобы сохранить
   текущие значения кеша и списка каталогов дерева.

3. DMOUSEBUTTON_* перенесены из dialog.hpp в farconst.hpp

svs 07.12.2006 15:25:47 +0300 - build 2152

1. Вводим VSMFL_REDRAW для ViewerSetMode.Flags, ибо так правильнее будет.
   т.е. либо VCTL_SETMODE + VCTL_REDRAW, либо VCTL_SETMODE(VSMFL_REDRAW).

svs 06.12.2006 19:30:17 +0300 - build 2151

1. Класс FolderTree наследуется от Frame, что позволило вылечить древний баг с 
   прорисовкой (F5 F10 F1 F5 F5 Esc - видим "грязь" на экране).
   Так же это изменение позволило добавить фичи:
   а) Alt-F9 (само получилось, т.к. Manager сам умеет перерисовывать все, что 
      наследуется от Frame)
   б) F5 - распахнуть/вернуть окно поиска каталога (по аналогии с хелпом)

   Так же, конструктор претерпел некоторые изменения в параметрах.

   В хелпах в раздел "@FindFolder" добавлена инфа про F5 и Ctrl[-Shift]-Enter.
   В FarEng.hlf.m4 нужен перевод.

2. Небольшие правки plugins.cpp. Просьба не употреблять __try/__except. Для
   этого есть макросы TRY/EXCEPT, соответственно.

3. Добавлен файл README. Перечислены некоторые правила. Если кто-то вспомнит
   еще правила - писать в этот файл.


warp & t-rex 05.12.2006 03:09:38 +0300 - build 2150

1. Поправлена логика предыдущего изменения. Кэшированные плагины не проверяются
   на принадлежность плагинам, это лишнее.

2. Функция проверки на принадлежность плагинам приведена в соответствие с x64.

warp 05.12.2006 01:39:38 +0300 - build 2149

1. Изменена логика загрузки плагинов. Введена проверка на принадлежность
   плагинам до загрузки модуля. Теперь Far будет ругаться на невозможность
   загрузить плагин, только если он был признан таковым до загрузки и при 
   этом LoadLibraryEx вернул _любую_ ошибку.

   [*] Изменена логика загрузки плагинов. Модуль проверяется на принадлежность
   плагинам до загрузки. 

2. Исправлен .pas файл на предмет VSMT_XXXX

svs 01.12.2006 19:47:38 +0300 - build 2148

1. Замена в составе: ViewerMode.TypeWrap -> ViewerMode.WordWrap

2. Добавка в ViewerAPI - VCTL_SETMODE, enum VIEWER_SETMODE_TYPES, struct ViewerSetMode

3. В XXXControl добавлена проверка на вшивость с юзанием IsBadReadPtr()


svs 30.11.2006 09:21:52 +0300 - build 2147

1. При выключенных настройках [ ] Save file position [ ] Save bookmarks 
   после открытия файла на редактирование курсор по умолчанию становится 
   в конец первой строки.

svs 28.11.2006 12:37:14 +0300 - build 2146

1. Mantis#248: Открытие по ShiftF4 предыдущего редактируемого файла.


t-rex 25.11.2006 10:53:30 +0200 - build 2145

1. Дополнение к x64. В PluginStartupInfo и FarStandardFunctions
   Reserved заменены с DWORD на DWORD_PTR чтоб не терять свой смысл.
   Соответственно это изменение требует пересборки x64 плагинов!

2. Немного GCC. Почему вы упорно не используете _i64(NUMBER) вместо NUMBERi64?
   И _ui64(NUMBER) вместо NUMBERui64.


svs 23.11.2006 19:51:42 +0300 - build 2144

1. Macro: $AKey - клавиша, который вызвали данный макрос
   (небольшой задел на будущее)

2. Возможность компиляции 1.7x под BCC


t-rex 23.11.2006 08:24:11 +0200 - build 2143

1. При удалении пустой строки или соединении двух строк при помощи DEL или BS выставлялись
   неправильные символы конца строки для "новой" строки.


t-rex 21.11.2006 18:13:55 +0200 - build 2142

1. Входим в эру 64-бит (ждём юникод :)

   Главные изменения: (надо будет обновить Енц.)
     DlgProc: long Param2 -> LONG_PTR Param2 и возвращает LONG_PTR вместо long
     SendDlgMessage: long Param2 -> LONG_PTR Param2 и возвращает LONG_PTR вместо long
     DefDlgProc: long Param2 -> LONG_PTR Param2 и возвращает LONG_PTR вместо long
     DialogEx: long Param -> LONG_PTR Param
     FarMenuItemEx: DWORD UserData -> DWORD_PTR UserData
     PluginPanelItem: DWORD UserData -> DWORD_PTR UserData
     AdvControl: возвращает INT_PTR вместо int
     OpenPlugin: int Item -> INT_PTR Item
   А также в execute.cpp добавлено определение 64-bit GUI прог.

   После некоторых экспериментов было выведено что выравнивание должно быть 8 для 64-bit версии.
   Обновил Far.mak и добавил vc.build.debug.64.bat и vc.build.release.64.bat которые используют
   custom.vc.debug.64.bat и custom.vc.release.64.bat соответственно.
   Мой custom.vc.release.64.bat содержит следующее:
   call "I:\Program Files\Microsoft Platform SDK for Windows Server 2003 R2\SetEnv.Cmd" /X64

   Единственное что ещё не доделано до конца это SEH - кто у нас в этом шарит?


svs 20.11.2006 16:37:26 +0300 - build 2141

1. Editor - copy/paste, блин.


t-rex 18.11.2006 23:23:58 +0200

1. без билда, обновил инклюды и скрипт генерации оных чтоб в них выводилась версия фара.


svs 17.11.2006 23:09:05 +0300 - build 2140

1. Бага предыдущего патча. В конце файла появлялся 0x00 
   при повторном открытии редактора.

2. Mantis#139 - Нарушения с концами строк при Отмене

3. + Edit::GetEOL()

4. У Editor::AddUndoData новый параметр - пусть Undo помнит EOL!

5. Небольшие правки в mkfar.mak


svs 16.11.2006 23:03:47 +0300 - build 2139

1. EditList удален. Next/Prev теперь принадлежать классу Edit

2. Однообразные куски кода по добавлению строки в редакторе 
   преобразованы в функции AddString и CreateString.

svs 13.11.2006 20:08:25 +0300 - build 2138

1. Добавлена функция FAR_GetFileSize (по аналогии с 1.80)

2. Wipe теперь "умеет" файлы > 2Gb

3. Заголовочные комменты в сорцах выносим в отдельный каталог.


svs 07.11.2006 21:33:42 +0300 -

1. без билда добавлен tee.exe с коррекцией vc.build.debug.bat и 
   vc.build.release.bat

warp 01.11.2006 02:56:09 +0300 - build 2137

1. Несколько ахтунговый фикс. До конца не проверил еще. 
   [-] Cтрока префиксов плагина больше не ограничена 512 символами. 

svs 10.10.2006 11:10:09 +0300 - build 2136

1. Macro: Area-коды разнесены. Теперь Condition имеет свои OpCode, а
   области - свои. Иначе в дампе макроса при логировании хрень.
   Для ньюсов ничего пистать ненадо.

svs 09.10.2006 12:08:32 +0300 - build 2135

1. Упоминание про Ctrl-Shift-Enter при быстром поиске (нужен перевод!)
   Mantis 244

2. FindFile: Зацикливается поиск при поиске подстроки на файле больше 2Gb
   Mantis 243

3. уточнение mkfar.mak - компиляция под BCC.


warp 05.10.2006 06:18:34 +0300 - build 2134

1. Вроде поправил ширину DIF_SEPARATOR для диалогов без рамки. 

t-rex 27.09.2006 04:05:23 +0300 - build 2133

1. Ещё одно дополнение к фиксу "Падение при старте ФАРа, когда каталог недоступен".
   На пассивной панели открывался каталог без ".." вверху.

t-rex 27.09.2006 03:07:27 +0300

Косметика без билда.

1. Прошлый патч был совсем не в тему. Вернул как было и чтоб больше не было
   вопросов сделал два батника и изменил Far.mak:

   Эти батники на прямую не редактировать!!!!!!!!!
   Только для постоянных изменений для всех участников проекта.
   Читайте объяснение - всё продумано.

   --------------------
   vc.build.release.bat
   --------------------
   Этот батник собирает release версию фара с помощью VC и Far.mak.
   Батник заодно обновляет far.release.dep и языковые файлы.
   С запуском этого батника никогда не будут никаких проблем при сборке фара
   (кроме ошибок в самом коде :).
   Чтобы батник был универсальным и работал у всех без изменений он
   вызывает другой батник - custom.vc.release.bat - если такой есть.
   Этот (custom.vc.release.bat) батник вам надо создать самим так как он ваш
   личный и на SVN комитится не будет. В нём вы можете определять переменные
   среды компайлера и переопределять переменные среды которые используются
   для сборки фара в главном батнике.
   Например у меня он содержит:
   ---->8----
   @echo off
   call F:\lng\VC.Toolkit.2003\vcvars32.bat
   ----8<----
 
   ------------------
   vc.build.debug.bat
   ------------------
   Тоже что и vc.build.release.bat только собирает debug версию, обновляет
   far.debug.dep и вызывает custom.vc.debug.bat если такой есть.
   Пример custom.vc.debug.bat:
   ---->8----
   @echo off
   call F:\lng\VS98\Bin\VCVARS32.BAT
   set FAR_MSVCRT=/D FAR_MSVCRT
   set FARSYSLOG=-DSYSLOG_TREX %FARSYSLOG%
   ----8<----


svs 26.09.2006 10:52:00 +0300 -

Косметика без билда.

1. В mkdep.list.txt добавлены copyright.inc и farversion.inc, т.к. если сделать
   первый раз экспорт, а потом запустить компиляцию, то будет ошибка компиляции
   global.cpp, т.к.  ни copyright.inc ни farversion.inc еще нету.
   
   Так же исправлен scripts\mkdep.awk - учитывает расширение INC, т.е. как раз 
   те самые файлы copyright.inc и farversion.inc, которые генерятся из *.m4.


t-rex 24.09.2006 17:21:44 +0300 - build 2132

1. Не влезали русские слова в диалог фильтра.

t-rex 23.09.2006 04:19:12 +0300 - build 2131

1. Дополнил Валин фикс на тему "Падение при старте ФАРа, когда каталог недоступен"
   а то выходила фигня если недоступный путь был например C:\a - фар открывал C: и
   делал это очень криво.

t-rex 23.09.2006 02:54:44 +0300 - build 2130

1. Починил вставку мусора в редакторе в висте при нажатие на Enter.
   В висте realloc на уменьшение не всегда (а может и никогда) ни возвращает тот же адрес.

2. Починил сборку GCC.

t-rex 23.09.2006 01:12:39 +0300 - build 2129

1. Новая система сборки как и в 1.80 для работы с SVN.

2. Начинаем писать changelog, я сделал себе макрос
   "t - r e x Space $Date \"%d.%m0.%Y %H:%M:%S %Z\" Enter"
   чтоб выводить заголовок changelog-а.
   Последующие логи надо писать сверху - т.е. файл будет идти хронологически снизу вверх.
   В changelog прошу писать в Win кодировке.
