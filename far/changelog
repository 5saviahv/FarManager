svs 07.09.2007 09:36:31 +0300 - build 286

1. Mantis#0000303: Названия кнопкосочетаний с модификаторами
   [*] Macro: Изменены названия сочетаний клавиш с модификаторами: 
       вместо `:` теперь `;`, а вместо `"` теперь `'`. Это относится 
       ко всем комбинациям модификаторов, кроме одиночного Shift. 


svs 06.09.2007 15:54:45 +0300 - build 285

1. "Не удалось открыть файл" -> "Ошибка открытия файла"
   уже не помню какой-там мантис...

2. Другой вариант переключения раскладки в XLat и $KbdSwitch
   (взято с форума)

Zuz 05.09.2007 00:52:11 +0500 - build 284

1. For elimination of effects of Vista virtualization technology the manifest file has been added

t-rex 01.09.2007 23:04:03 +0200 - build 283

1. Bug in OEM to UNICODE conversion in UnicodeString.cpp.

2. Revert copyright.inc.m4.

zg 01.09.2007 22:55:45 +0200 - build 282

1. проблема с ".." в папках, в которых он отсутствует.
   например линкуем диск в папку.

t-rex 01.09.2007 21:41:06 +0200

1. Preparing for open source:
   - added BSD license to all source files
   - added an exception to the license for plugin api header files
   - added LICENSE file with the BSD license including the exception for plugins

2. Removed some unneeded files.

warp 01.09.2007 20:33:00 +0300 - build 281

1. В несколько раз уменьшил потребление памяти на панелях (это к вопросу "а вот Far жрет аж 191 мб").

2. Под это дело резко всплыла целая пачка глюков с падениями и прочими косяками, какие всплыли - починил, остальные 
   видимо всплывут еще.


t-rex 01.09.2007 15:59:22 +0200

1. Added a README-EN file for our new member and for the future open source community.


svs 30.08.2007 19:06:59 +0300 - build 280

1. 0000324: GetHotkey() возвращает "0" 
   [-] Macro: Если пункт меню не содержит горячую клавишу, то GetHotkey() возвращает "0" вместо ""

2. 0000325: $SelWord выделяет лишнее знакоместо в конце строки 
   [-] Macro: $SelWord выделяет лишнее знакоместо в конце строки

3. 0000326: QView, Info: ItemCount, CurPos, Selected, Bof, Eof всегда 0; Empty всегда 1
   [-] Macro: В панелях быстрого просмотра и информации не работали некоторые переменные:
       ItemCount, CurPos, Selected, Bof, Eof всегда 0; Empty всегда 1.

4. Код возврата функций VMProcess теперь будет __int64


yjh 28.08.2007 14:49:21 +0300 - build 279

1. Issue 313, У форточек сносит крышу при попытке сделать 
   GetFileAttributes("..") когда находишся в корне UNC-заданного диска.

svs 24.08.2007 20:05:59 +0300 - build 278

1. Mantis#0000318: Опция - Восстановить размеры панелей
   Добавлена комбинация для панелей Ctrl-Shift-Num5 - "по высоте"
   размеры панелей будут восстановлены до Командной строки 
   Работать будет пока только при TI#48 (UseNumPad=1)

svs 24.08.2007 15:02:24 +0300 - build 277

1. Mantis#0000316: Не работает копирование строки

2. Mantis#0000259: Выделить до первой/последней строки


svs 24.08.2007 14:07:42 +0300 - build 276

1. Баг в диалоге (http://forum.farmanager.com/viewtopic.php?p=26515#26515)
   юзер нажал F4 {
     диалоговый менеджер послал плагину DN_KEY, F4 {
       плагину послал DM_CLOSE {
          диалоговый менеджер погасил диалог и приготовил всё необходимое 
          для удаления внутренних элементов и т.п., т.с. Leave
       }
     }
     управление вернулось в менеджер и он продолжил анализ клавиши, 
     дошел до комбобокса и послал клавишу строке редактирования 
     (комбобокс состоит из 2-х обхектов!), та вязала и перерисовалась
   }


Zuz 24.08.2007 15:24:49 +0500 - build 275

1. Не работал KEY_DECIMAL при UseNumPad=0

2. Игнорировались клавиши в диалоге назначения клавиш для макросов интервале
INTERNAL_KEY_BASE > KEY < INTERNAL_KEY_BASE_2, что привело к тому, что Decimal, NumDel
и т.п. не могли быть корректно назначены и ряду других интересных эффектов.

3. В KeyText (keyboard.cpp) неправильно инициализировалась переменная, что приводило
к эффекту добавления мусора для клавиш модификаторов.

svs 22.08.2007 14:14:37 +0300 - build 274

1. Mantis#0000321: диалог ошибки открытия файла выдаётся не на панелях а в редакторе 
   Проблема в том, что Editor::SetCodePage вызывал Show()
   Нарисовал в FileEditor::Init() приватный класс SmartLock, который лочит
   ScreenObject от прорисовки.

2. Потенциальная утечка памяти в FileList::ProcessKey().
   В 1.70 похоже так же есть...
   если при вызове редактора была ошибка - то ShellEditor в список манагера не попадает
   (оно вызывается через new)
   Соответственно вызов "FrameManager->ExecuteModal();" ничего не меняет (манагер не 
   удалит объект!)
   Тупо проверить "ShellEditor->GetExitCode()" на "XC_OPEN_ERROR" - этого мало, 
   т.к. кодов возврата несколько...

svs 14.08.2007 14:30:43 +0300 - build 273

1. NumDecimal не отрабатывал в редакторе

2. Внутренние добавки для проекта "Флаги редактора"


Zuz 12.08.2007 22:19:19 +0500 - build 272

1. Опять Mantis#0000176 не доконца перенёс патч, вообще артефактов при обновлении 
панелей на медленных соединениях хватает, кто бы занялся ;-)

Zuz 11.08.2007 16:50:52 +0500 - build 271

1. Mantis#0000176: Двойное сканирование после cd path, логический фикс
2. В flupdate.cpp (FileList::ReadFileNames) рамка криво рисовалась для
сообщения MReadingFiles, пока сформировал её с помощью MakeSeparator

svs 07.08.2007 22:06:56 +0300 - build 270

1. Ctrl+/Ctrl- - траблы с пометкой в панелях.
   Переменную нужно инициализировать!

svs 07.08.2007 14:33:55 +0300 - build 269

1. Mantis#0000309: DM_LISTSETMOUSEREACTION с флагом LMRT_NEVER - не приходят клики мыши
   Двойной клик мыши просто не учитывался. добавил.

svs 07.08.2007 12:59:42 +0300 - build 268

1. Mantis#0000310: Сброс сохраненной позиции во View'ere 
   бага стара как мир... :-(

2. В setattr.cpp косметика - для удобоваримости и понятности имен переменных.

3. viewer.cpp - принудительная очистка массива BMSavePos.

4. Macro: макросы, назначенные на Модификаторы+Decimal записывались, но не 
   воспроизводились.

5. Mantis#0000158: _FAR_USE_FARFINDDATA и Релиз 1.70
   Здесь _FAR_USE_WIN32_FIND_DATA вообще не юзаем - вычеркиваем.


svs 24.07.2007 21:54:22 +0300 - build 267

1. Mantis#0000073: Не работает автоскролинг в QView

   WaitInMainLoop - "мы в основном цикле (в панелях)?". Если в панелях,
   то в GetInputRecord() не пашет механизм "холостого пробега" (if (WaitInMainLoop))
   Посему, для QView недостаточно проверки на панели - IsPanelsActive().
   Уточним сей факт.

2. Для раздела "@Viewer" в хелпах добавлена информация об автоматическом скроллинге.
   (В FarEng.hlf.m4 появились русские буковки!!!)


svs 23.07.2007 16:57:14 +0300 - build 266

1. Добавка к Dialog API. DM_[S|G]ETEDITPOSITION - управление позицией сктроки в строках 
   ввода в диалогах. Добавка к DM_[S|G]ETCURSORPOS.
   В качестве Param2 принята структура EditorSetPosition, чтобы в будущем команды так же
   работали и на MI_MEMO.


t-rex 21.07.2007 01:14:38 +0200 - build 265

1. В режиме колонки NR AltHome не прокручивал строки в начало.
   По идеи это был баг но например в режиме NR,Z этот "баг" давал возможность вернутся
   к оригинальному выравниванию после того как покрутили (чего теперь незя сделат)
   но вроде это все ровно баг.


svs 09.07.2007 15:04:41 +0300 - build 264

1. [-] Macro: не работали конструкции Eof/Bof/etc в программе просмотра.

yjh 08.07.2007 08:17:24 +0300 - build 263

1. Для поиска файлов признак использования фильтра запоминается в registry


t-rex 07.07.2007 22:42:39 +0200 - build 262

Несколько патчей от 1.71, надеюсь что ничего не потерял по дороге.
Патч про вистовые симлинки из 2226 пока что решил не делать так как
я там такие костыли наделал что сюда переносить их не хочется.
Надо подумать как это красиво сделать.

1. Mantis#263 - ".." не всегда красились (а точнее когда мы их добавляли в ручную).

2. Mantis#0000275: В диалогах при обработке DIF_CENTERGROUP выставлялся
   X1 но не X2 что приводило к проблемам как минимум с DI_TEXT так как
   недавно для него стал учитыватся также и X2.

3. Сохраняем фильтры только если AutoSaveSetup или юзер нажал Shift-F9.
   Это вписывается в общюю логику работы с реестром у фара.


t-rex 07.07.2007 15:51:04 +0200 - build 261

1. Исправил не сохранение MarkChar в диалоге раскраски. С диалогами надо что то решать.


warp 07.07.2007 15:04:00 +0300 - build 260

1. Это, типа, ребрендинг. Задолбали имена вида LocalXXXX и мешанина с __cdecl/__stdcall.
   Строковые функции теперь имеют вид StrLength/StrCmp/StrCmpI/StrCmpNI и т.п. и все они
   __cdecl. Для FAR API эти же функции обернуты в __stdcall заглушки (__cdecl варианты 
   удобно использовать в сортировке напрямую, да и разделения на внутренние/внешние функции 
   это правильнее). wcscmp/wcslen считаются врагами народа. Ожидаются осадки.

2. Часть функций FAR_XXX переименовалось в apiXXX.

2yjh: и нет, я пока не починил диалоги на предмет настройки фильтров, но пока помню. :-)


yjh 07.07.2007 06:57:11 +0300 - build 259

1. Убрана бага в TranslateKeyToVK в части обработки VK_Fn и прочих
   EXTENDED/INTERNAL кнопок.

2. Убран гнуснейший удар по памяти (стеку!) в Manager::CountFramesWithName.
   Это то из-зачего релиз гробился по выходе из вьювера вызванного из proclist
   Вот за такое кодирование точно надо запрещать автору пользоваться Cшными
   кастингами :(((

svs 06.07.2007 17:44:20 +0300 - build 258

1. Mantis#0000304: DM_LISTGETCURPOS для отмененного комбобокса.
   Блин, перебор в трех местах вышел...

t-rex 06.07.2007 01:31:09 +0200 - build 257

1. Ну так как все молчат - удалил нафиг регистрацию.


svs 05.07.2007 17:36:55 +0300 - build 256

1. Mantis#0000289: прорисовка сообщения обрезана при выволнении макро 

2. Mantis#0000304: DM_LISTGETCURPOS для отмененного комбобокса.


svs 05.07.2007 11:37:11 +0300 - build 255

1. Mantis#160 - Хочется F3 и F5 на дисках.
   В обчем репорт извернули в сторону Macro.gethotkey() :-)

   S=gethotkey(N)
   где N - нужная позиция в списке от 1 (0 - текущая)
       S - либо "", если хоткея нет или N > количества пунктов в меню или это не меню;
           иначе S = сам хоткей. 


Zuz 03.07.2007 14:10:47 +0500 - build 254

Mantis#223 - вернул возможность уставливать дату/время для каталогов на FAT/FAT32
локальных дисков под WinNT+ (нужно для тех же флешек, например), для сетевых дисков
ошибка теперь тихо игнорируется.

warp 28.06.2007 05:33:00 +0300 - build 253

1. Крайней экспериментальный фикс. Из Plugin::OpenPlugin убрано выставление
   текущей папки, не похоже, что оно реально требуется, но оно порождает ситуацию,
   когда текущей оказывается неверная папка (когда в плагине текущая папка 
   имеет такое же имя, как реально существующая).


yjh 28.06.2007 02:07:17 +0300 - build 252

1. Убрана ошибка "переполнения" в рассчётах времени/скорости при копировании
   и изменена (упрощена) логика учёта времени ожидания ответов пользователя
   в ситуации ошибок при копировании.
   Сейчас общее время операции учитывает время ожидания, а оставшееся время
   и средняя скорость - нет.

svs 26.06.2007 20:15:33 +0300 - build 251

1. Mantis#286 - Порча бинарных файлов при сохранении встроенным редактором.
   Mantis#295 - Пропуск символов при смешанных переводах строк

   пробуем...


svs 26.06.2007 19:37:17 +0300 - build 250

1. Mantis#287 - Не воспринимаются переменные начинающиеся с цифр

svs 31.05.2007 20:18:55 +0300 - build 249

1. Macro: добавлена функция Panel.SetPosIdx - позиционирование
   на файловой панели по индексу.

2. В WaitKey добавлена задержка на 50ms - иначе при CAS наблюдается
   повышенная "возбужденность" FAR`а в таскманагере.


svs 15.05.2007 10:29:18 +0300 - build 248

1. Для "System/UseNumPad=1" НЕ понадобятся макросы, т.к.
   все продублировано.

2. Macro: имена переменных, начинающихся с числа не воспринимаются.
   Например, %3Proc.

svs 11.05.2007 15:39:28 +0300 - build 247

1. Mantis#0000232: Различать Del и NumDel, Enter и NumEnter 
   Для "System/UseNumPad=1" понадобятся макросы:

   REGEDIT4

   [HKEY_CURRENT_USER\Software\Far\KeyMacros\Common\NumEnter]
   "Sequence"="Enter"
   "DisableOutput"=dword:00000001

   [HKEY_CURRENT_USER\Software\Far\KeyMacros\Common\CtrlNumEnter]
   "Sequence"="CtrlEnter"
   "DisableOutput"=dword:00000001
   
   [HKEY_CURRENT_USER\Software\Far\KeyMacros\Common\ShiftNumEnter]
   "Sequence"="ShiftEnter"
   "DisableOutput"=dword:00000001 

   Появились новые клавиши: NumEnter, Decimal/NumDel (в зависимости от состояния
   NumLock)

2. macro:post eval("AltF1") не работал; конструкция превращалась в Alt00000


svs 10.05.2007 14:38:34 +0300 - build 246

1. Macro: добавлены функции asc и chr.


svs 08.05.2007 15:47:40 +0300 - build 245

1. Забыл в прошлый раз про Automation в диалоге SystemSettings

2. "TreeFileAttr" можно задавать. По умолчанию FA_HIDDEN.

3. В farconst.hpp до бавлены закомменченные определения DRIVE_*

4. Macro: PlayMacro переименован в Eval и в нем же обнаружена бага - 
   нужно снимать флаг MFLAGS_REG_MULTI_SZ перед парсением...



svs 24.04.2007 20:55:54 +0300 - build 244

1. Mantis#279 - Редактор не позиционируется на новый файл после сохранения 
      macro:post ShiftF4 1 Enter F2 CtrlF10 Esc
      не позиционирует на созданный файл 

   В обчем вроде как... но при большом объеме каталога будут тормоза.
   Здесь проблема в том, что поиск файла ведет на VFS (на панели), а т.к.
   панель еще не апдейтилась, то, соответственно про этот новый файл
   ни кто ничего не знает.

2. Bug с удалением в корзину с последующей очисткой.
   Напихали в каталог симлинков. Грохнули каталог в корзину.
   Теперь, если корзину очистить, то киляется все, что было в этих
   симлинках.
   Здесь тупо вводим опцию "Delete symbolic links". Если она включена,
   то перед килянием каталога в корзину сканим подпапки на предмет симлинков
   и эти самые симлинки удаляем.
   Говорят Виста в этом плане умнее будет - ХЗ, поверим на слово, но мезханизм
   сканирования все же оставим :-)

   Здесь затронуты хелпы - нужен перевод!


svs 23.04.2007 16:25:20 +0300 - build 243

1. MFLAGS_LABELPRESENT - в морг. вместо него будет MFLAGS_REG_MULTI_SZ

2. +API::FARKEYSEQUENCEFLAGS::KSFLAGS_REG_MULTI_SZ

3. Как следствие - Sequence может иметь тип REG_MULTI_SZ.

4. Небольшая добавка в виде операторов ">>" (shr) и "<<" (shl)
   У них приоритет такой же как и у "+" и "-".

5. Отучение от внутреннего цикла для MCODE_OP_EXPR.
   Теперь MCODE_OP_EXPR и MCODE_OP_DOIT пережитки прошлого.

6. В KeyMacro::FARPseudoVariable в паре мест были пропущены "break;"

7. В KeyMacro::GetKey - вместо MCODE_OP_LT (и подобных) нужно было 
   MCODE_OP_JLT


warp 17.04.2007 03:20:36 +0300 - build 242

1. Падение хелпа при нажатии Shift-F2. Это жесть.

2. Зависания хелпа при попытке открыть пункт в том самом Shift-F2. 
   А реально - баг в DeleteEndSlash, мог всплывать и еще где-то.


t-rex 15.04.2007 20:25:36 +0200 - build 241

1. Wrapper: Начальная реализация панельного АПЙ. Иногда даже работает :)


t-rex 15.04.2007 03:23:58 +0200 - build 240

1. Не грузились плагины из кэша.


warp 10.04.2007 13:30:00 +0300 - build 239

1. Вернул на скорую руку хранение ANSI вариантов строк для .lng файлов. 
   Colorer x1.7 теперь даже показывает в меню строки. 


svs 09.04.2007 20:58:47 +0300 - build 238

1. Bug: В обработчике MCODE_OP_SAVE сначала нужно вытащить из стека значение,
        а потом остальным заниматься.

2. Добавлены макросы логирования:
   SYSLOG_KEYMACRO_PARSE/_KEYMACRO_PARSE()  - для парсера макросов
   SYSLOG_YJH/_YJH()                        - для Харона :-)

3. Остальное по мелочам - антураж при логировании макросов, etc.


svs 08.04.2007 20:55:06 +0300 - build 237

0. В проект добавлены файлы TVMStack.cpp и TVMStack.hpp 
   (реализация стека).

1. Нормальная реализация стека в макросах - был полный бардак, 
   как работало раньше - ХЗ. Например, $Text брал текст из вершины
   стека, но не удалял из стека это значение...
   Это позволило решить проблему с кодом возврата PlayMacro и,
   на будущее, исключить некоторые новые баги.

2. Если при исполнении $Text в стеке ничего нет (например, макрос
  "$Text _"), то ничего и не исполняется.

3. В ряд классов добавлены функции XXX::VMProcess()

4. В клавиши добавлен блок KEY_OP_BASE.
   В него входят аналоги некоторых макроопераций, которые невозможно
   исполнять в VMProcess (например, придется дублировать код из 
   ProcessKey).
   Имя таких аналогов начинается с KEY_OP_???
   Макродвижок сам подменяет макрокод на код нужной клавиши.

   Эта добавка (как и предыдущие и последующие) - небольшие 
   продвижения к...
   ...конечная цель: макрокоды должны иметь свои коды, отличные 
   от кодов клавишь.
   В будущем все обычные клавиши в байткоде будут ограничены кодами
   MCODE_OP_KEYS и MCODE_OP_ENDKEYS.

5. В редакторе добавлена обработка концов строк "\r\r\n"
   Увидеть такое чудо можно вот так: 
     ping localhost > file.txt
   Сохранение (SaveAs) с таким окончанием строк не предусмотрен.

6. Локальная таблица переменных в макросах... по аналогии с 1.7x

7. Вроде как макросы заработали :-)
   За исключением $SelWord - здесь нужно привести к юникоду
   функцию strmix.cpp::CalcWordFromString()


svs 04.04.2007 14:32:04 +0300 - build 236

1. Бага - постоянно собрасывается на английский
   Как повторить:
   - Выбираем русский язык интерфейса и справки; 
   - Язык нормально меняется; 
   - Выходим из FAR (установлен крыжик "Автосохранение настроек"); 
   - Загружаем FAR - язык русский; 
   - Выходим из FAR; 
   - Загружаем FAR снова и видим, что язык сбросился в английскй. Язык справки при этом не сбрасывается.


svs 04.04.2007 13:12:18 +0300 - build 235

1. Бага в EnumRegValueEx.
   Первый вызов RegEnumValueW выставлял ValSize в правильное значение, но
   для второго вызова этого размера было маловато и в итоге получали
   ERROR_MORE_DATA.

2. С макросами пока засада... думаю.


svs 03.04.2007 21:27:41 +0300 - build 234

1. Фигня была с языками. 
   Например, убили FarEng.lng, в реестре при этом стоит Language/Main="English"
   Грузимся. Видим русский интерфейс.
   set FARLANG
   видим "English".

2. Mantis#0000092: Переопределение лейбов функциональных клавиш
   Ну, это фича, давно востребованная... В общем работает. :-)
   [HKCU\Software\Far\KeyLabels\ЯЗЫК\ОБЛАСТЬ]
   "ИМЯКЛАВИШИ"="Значение"

   Здесь
     ЯЗЫК       - так, как написано в LNG-файле, например,
                  English или Russian, т.е. тот, который в параметре
                  ".Language" идет первым после "=" и до ","
     ОБЛАСТЬ    - область действия в терминологии macro.
                  Понимаем области: Shell, Help, Edit, View, QView, Tree, Info
     ИМЯКЛАВИШИ - так, как они описываются в макросах.
                  Понимаются только функциональные "*F?" (что естественно :-))

2Warp: Бадья с EnumRegValueEx и EnumRegValue.
       второй RegEnumValueW возвращает
       #define ERROR_MORE_DATA                  234L    // dderror

       И в config.cpp вот это глянь
      {1, REG_SZ,     NKeyLanguageW,L"Main",&Opt.strLanguage, 0, InitedLanguage}, 

      в общем... все, что связано с InitedLanguage :-)



t-rex 02.04.2007 08:07:13 +0200 - 233

1. Wrapper: Теперь работает Menu.


t-rex 02.04.2007 05:23:47 +0200 - 232

1. Wrapper: Частичная реализация EditorControl. Теперь обычный колорер пашет в 1.80.
   Обработка ECTL_GETSTRING сделана через жопу но вроде как работает (пока).


t-rex 02.04.2007 03:46:11 +0200 - 231

1. Wrapper: Ещё несколько функций в FSF, пару в PSI и несколько заглушек в PSI.


t-rex 02.04.2007 01:36:33 +0200 - 230

1. Сделал почти весь FSF и немного PSI для OEM плагинов.
   Пока что все враперы лежат в wrap.cpp который тупо инклудится в PluginA.cpp.


t-rex 01.04.2007 23:11:36 +0200 - 229

1. Начальная имплементация враппера для OEM (старых) плагинов.
   Даже работает :) Структуры PSI и FSF пустые, но можно уже написать плагин который будет
   открыватся по OpenPlugin и не юзать FarAPI. Есть обработка PluginInfo, и wchar_t -> char
   в некоторых функциях. Остальные функции не работают.
   В PluginA.cpp - класс для работы со старыми плагинами.
   В PluginW.cpp - класс для работы с юникодными плагинами.
   В Plclass.hpp - абстрактный класс Plugin который наследуют PluginA и PluginW и с ним работает PluginManager.
   В pluginold.hpp - это plugin.hpp от 1.71, немного подредактированый и закрытый в namespace oldfar.

2. Убраны ворнинги.


yjh 31.03.2007 04:47:13 +0300 - 228

1. Убрана ошибка перераспределения памяти в обработке макросов (проявлялось в
   x64 и - теоретически - в висте)

yjh 31.03.2007 03:17:21 +0300 - 227

1. Убрана ошибка на закрытии при отсуствующих панелях (gpf) - возникало,
   например, при запуске с /r

t-rex 30.03.2007 05:55:19 +0200

1. Мелкие обновления в мэйке. Включил ворнинги о x64 совместимости для всех видов сборок.


t-rex 30.03.2007 05:46:02 +0200

1. Мелкое переименование переменных без билда.


t-rex 30.03.2007 04:54:38 +0200 - build 226

1. Массовое уничтожение "W" продолжается.

2. Решил стать оригинальным и добавил паре функций "A" в имя.
   Чтоб их потом было легче найти и убить.


t-rex 30.03.2007 02:04:50 +0200 - build 225

1. Вот теперь можно реально бояться :) Убрал у всех APIшых структур и функций "W" в имени.
   А вот ко всем экспортам наоборот добавил "W" ввиду подготовительного процесса для написания
   врапера для 1.7x плагинов.

2. Где попало на глаза исправил мешанину пробелов и табов (на табы соответственно).
   Если кто не в курсе то мой плагин BlockIndent делает такие вещи очень классно :)

3. Убил последний ворнинг.


warp 30.03.2007 03:52:00 +0300 - build 224

1. Продолжаем массово убивать "W" в именах функций. Всем бояться.


warp 27.03.2007 16:04:00 +0300 - build 223

1. Функции с "W" на конце просочились со стороны _DEBUG. Восстание подавлено.


warp 27.03.2007 15:04:00 +0300 - build 222

1. Массовое истребление "W" в именах функций. Может что отвалилось.

2. Поправлено имя параметра в plugin.hpp::OpenFilePlugin. Не OpenFrom, а OpMode.

3. При исключительной ситуации не всегда правильно передавался идентификатор функции,
   вызвавшей исключение, кроме того неправильно вызывалась функция UnloadPlugin.


warp 26.03.2007 15:50:00 +0300 - build 221

1. Починил меню дисков на предмет новой системы плагинов. Однако там еще остались
   веселые места, связанные с работой TArray/MenuItemEx. 

2. Добавил к функции OpenFilePlugin еще один параметр - OpMode. Во время поиска в архивах
   принимает значение OPM_FIND. Если какие плагины эту функцию уже используют - надо их пересобрать.

3. Убрал W из имен некоторых функций, на большее терпения не хватает. Так что процесс будет продолжен. 8-)


yjh 26.03.2007 06:49:23 +0300

1. Уточнение ключей ulink в Far.mak

t-rex 24.03.2007 04:07:51 +0200

1. То баг а не нормальный каст, пусть про него кричит.


yjh 24.03.2007 02:44:49 +0300

1. Все компиляции с /W3 и убрано последнее предупреждение в 64bit build


t-rex 23.03.2007 17:09:43 +0200 - build 220

1. Пару мелких фиксов в системе сборки. В custom.*.bat больше не надо выставлять FARTRY.

2. Убрал ворнинги для VC32, VC64, GCC.

3. Из за 2 пофиксился ещё одни баг в x64 сборке - DialogParam внутри фара был long а не LONG_PTR
   и у VMenu был не правильный прототип у обработчика сообщений.

4. Несколько новых ключиков для улучшения размера exe.

5. В UnicodeString появился SetLength() чтобы выставить новый конец строки (тока на уменьшение само собой).
   Там где в коде заметил, то переделал чтоб юзать это вместо танцов с GetBuffer() и ReleaseBuffer().

6. Переделал на ходу где заметил memcpy/memmove на wmemcpy/wmemmove где это нужно.


yjh 21.03.2007 00:17:21 +0300 - build 219

1. Доделана сборка отладочных билдов vc8 (32/64), и добавлена парочка ключей 
   которая (потенциально) может дать выигрыш по размеру

2. Сделана "нормальная" (без ассемблера кроме ud2 :) генерация исключений
   для ALPHA_VERSION

3. Добавлена "расшифровка" при exception по недопустимой/привелигированной
   инструкции

4. Для "нерасшифрованных" исключений выводится их код

5. Доделана нормальная отработка (показ) исключения по переполнению стека
   (и 32 и 64 бит версии)

6. Добавлен возможность компоновать ulink'ом - см. readme

7. Добавлена возможность передавать опции nmake - см. readme 


t-rex 19.03.2007 19:30:09 +0200 - build 218

Несколько патчей от 1.71, надеюсь что ничего не потерял по дороге.

1. Сделал везде где должно быть virtual функции.

2. Удалил ещё нескольно ненужных файлов.

3. Исправил баг с падением при вводе таба в режиме EXPAND_NEWTABS.

4. Добавил фильтры в пометку файлов.

5. Изменилась логика наследования в раскраске, теперь от того кто следующий
   наследуется всё кроме прозрачных элементов. А также добавил кнопочку "Make transparent".

6. В фильрах "панели" если выбраны несколько фильтров то делается AND.

7. Добавил текст в заголовке меню фильтров для описания D?,D-,D+.


warp 19.03.2007 01:01:00 +0300 - build 217

1. Юрий поймал очень забавный глюк с макросами, связанный с изменениями в 
   работе LocalUpperW/LocalLowerW. Поймал и поправил, собственно.

2. Некоторые изменения в apiExpandEnvironmentStrings для большего соответствия
   результата тому, что возвращает оригинальный ExpandEnvironmentStrings.


warp 18.03.2007 23:19:00 +0300 - build 216

1. Если плагин прописывал в кэш пустую строку для пункта меню, то он больше никогда
   в этом меню не показывался. Видимо, тоже самое имеется и в 1.7.

2. Неправильно работала функция копирования частей реестра.

3. Неправильно была задана строка для проверки, какую часть дерева не надо копировать
   при создании нового пользователя.


t-rex 16.03.2007 11:04:46 +0200 - build 215

1. Не правильно обнулялся CopyDlgParam в копире что приводило к падениям.

2. Диалог настроек "Dialog settings" был не того размера.

3. Исправления для x64 билда. Осталась одна бага в panel.cpp

      PanelMenuItem *item = (PanelMenuItem*)UserData; <--- DWORD

    	MessageBox (0, "this is BUGBUG, do not touch!", "Error!", MB_OK);

3. Сборка под VC8.


warp 15.03.2007 23:37:00 +0300 - build 214

1. Падало меню плагинов/меню конфигурации при наличии более чем одного плагина
   (привет сортировке).

2. Вроде все правки от yjh в plugin.hpp учел и применил. 


warp 15.03.2007 21:37:00 +0300 - build 213

1. Не во все места еще проник свет нового типа Plugin. Поправил Help::MkTopic.


svs 14.03.2007 19:08:36 +0300 - build 212

1. Mantis#268: ECTL_GETINFO может вернуть BlockStartLine = -1 
     Вызываю EditorControl c ECTL_SELECT и устанавливаю EditorSelect.BlockStartLine = -1 
     (подразумевается текущая строка, как это часто принято). Конкретно для этой операции
     в энциклопедии не указано, что -1 можно употребить. Но это работает (внешне). 
     Но это, похоже, приводит к тому, что следующий вызов EditorControl с ECTL_GETINFO 
     дает BlockStartLine = -1, и вот это уже неожиданно для остального кода, который 
     к этому не готов.
     Даже если EditorSelect.BlockStartLine = -1 недопустимо, ECTL_GETINFO не должен 
     возвращать некорретное значение BlockStartLine. 

2. В mix.cpp::GetDiskSize не "__int64", но "unsigned __int64"


svs 13.03.2007 20:33:15 +0300 - build 211

1. GetDiskSize (mix.cpp) чудил на терабайтных томах. Там вообще какой-то странный алгоритм
   был...

2. Macro: +"N=playmacro(S)" - "проиграть" строку в макросе
          +"S=waitkey(N)"   - ждать клавишу (вернет строковое представление клавиши, 
                              или пусто по таймауту)

3. В связи с п.2 у функции GetInputRecord появился второй параметр (чтобы не вызывать повторно 
   макросы из макросов, т.к. нам нужна всего лишь реальная клавиша)
   + у WaitKey() тоже есть параметр - таймаут в ms

4. Небольшие заделы для SERVICEREGION (Editor)


warp 05.03.2007 01:53:00 +0300 - build 210

1. Редактор падал при открытии пустого файла.

2. Дерево падало при попытке прервать операцию сканирования.

3. Частичное чтение дерева взято из 1.7.

4. Виртуальное наследование просочилось таки.


warp 03.03.2007 00:54:00 +0300 - build 209

1. Элементы диалога типа DI_LISTBOX не ловили клик мышью в DN_MOUSECLICK 
   отличный от FROM_LEFT_1ST_BUTTON_PRESSED.


svs 26.02.2007 10:44:24 +0300 - build 208

1. В main.cpp неправильно вызывался FileEditor - забыли про параметр codepage

2. Bug: Если одновременно указать несколько /v и /e, но из ФАРа не выйдем.
   На будущее - имеет смысл проработать вариант для стандалоне редактора/вьювера, 
   но с неколькими открытыми файлами.

3. В FileEditor немного подсократил количество параметров.

4. Shift-F4 Ctrl-Y Enter на панели плагина матерится будет.
   (пока затычка...)

5. Был такой вот флаг FFILEEDIT_ISNEWFILE - нафига? - не помню.
   Убрал. Если "всплывет" - полечим.

6. Добавил EF_SERVICEREGION. Пока зарезервировано.

7. DIF_NOTCVTUSERCONTROL доступен всем.


warp 25.02.2007 04:09:00 +0300 - build 207

1. Так, для разминки, убил Ansi вариант SendDlgMessage (он давно не используется)
   и исправил рекурсию при вызове плагинов. 


svs 07.02.2007 18:51:09 +0300 - build 206

1. Макро: 
    APanel.ColumnCount - активная панель:  количество колонок
    PPanel.ColumnCount - пассивная панель: количество колонок

2. Правило "Panel\ShellRightLeftArrowsRule":REG_DWORD
    <ER>
    Нынешнее FAR'овское поведение ближе к NC/VC, чем предлагаемое. 
    Единственная разница - в NC при пустой командной строке в режиме 
    панели в одну колонку Left/Right просто игнорируются. Я же решил 
    применить их к панели, чтобы не пропадали зря. При непустой 
    командной строке FAR работает аналогично NC и VC. Как мне кажется, 
    менять это поведение значит идти в разрез с многолетними привычками 
    пользователей. Да и пользы от Left/Right в одноколоночной панели 
    немного. Почти те же PgUp/PgDn.
    </ER>


   "ShellRightLeftArrowsRule":REG_DWORD
    Параметр "ShellRightLeftArrowsRule" с типом DWORD позволяет управлять 
    поведением стрелок влево/вправо (как на основной, так и на дополнительной 
    клавиатуре).
    Значения:
      0 - поведение как у 1.70: если командная строка непуста, то клавиши 
          Left/Right и Num4/Num6 действуют по-разному в зависимости от 
          режима панели: если имена файлов отображаются в несколько колонок 
          (по умолчанию режимы 2 и 3), то команды вправо/влево применяются 
          к панели (как и при пустой командной строке); а если имена файлов 
          отображаются в одну колонку (по умолчанию все остальные режимы), 
          то команды вправо/влево применяются к командной строке.
      1 - клавиши Left/Right и Num4/Num6 при включённой панели всегда 
          применяются только к ней, независимо от содержимого командной 
          строки и режима панели. 
          Примечание: в командной строке есть CtrlD/CtrlS. 
    По умолчанию значение = 0. 


t-rex 06.02.2007 23:52:24 +0200 - 205

Очень много патчей от 1.71, надеюсь что ничего не потерял по дороге.

1. Соединил все виды фильтров (панели, копир и поиск) в одну сущность
   имеющую функционал всех прошлых фильтров вместе.

1.1. Заодно исправлен баг из за которого в меню фильтров не сохранялись
     настройки для авто-фильтров.

1.2. Также исправлен Mantis#202 как побочный эффект.

1.3. На панелях можно фильтровать папки. Надо бы разобраться с копиром ещё.

1.4. В array.hpp добавлен новый шаблонный класс TPointerArray для базовой работы
     с массивом объектов. Он же используется теперь во всех местах где нужны фильтры.

2. Раскраска файлов и группы сортировки теперь фильтры и соединены в одну сущность.

2.1. Группы сортировок влияют также на папки но папки все ровно всегда сверху,
     просто сортируются между собой.

2.2. Добавил прозрачность в раскраску и возможность раскраски файлов с помощью нескольких
     пунктов раскраски ([ ] Continur processing).

2.3. Меню настройки цветов перерисовывает панели чтоб отражались прозрачные цвета.

3. Для DI_TEXT если заданы по человечески X1 и X2 то не будем выводить больше текста чем заданно.

4. FCTL_GETUSERSCREEN - сбрасывает UserBuffer на экран.
   Теперь плагины могу эмулировать запуск программ в фаре используя
   FCTL_GETUSERSCREEN и FCTL_SETUSERSCREEN.
   Заодно исправлен баг в FCTL_SETUSERSCREEN который съедал последнюю строчку
   при выводе в Ctrl-O.
   Ну и для правильной работы FCTL_GETUSERSCREEN при первом запуске фара, добавил
   выставления курсора перед сохранением первичного UserBuffer в ControlObject::Init().

5. Если плагин был вызван по префиксу то до и после его вызова ком-строка обнулялась.
   Убрал обнуление после запуска так как плагин мог установить ком строку во время работы.
   При запуске из usermenu ком-строка как и раньше восстанавливается и так вроде должно быть.

6. Если диалог был во весь экран то фар мог падать при рисовании тени.

7. Не посылался EE_CLOSE для ?New file?.
   Теперь EE_CLOSE посылается всегда если послался EE_READ чтоб
   небыло утечек памяти в плагинах.

8. Изменил в батниках имя файла куда сохраняется вывод компайлера чтоб у него
   не было окончания и все такие файлы шли на панели вместе.

9. Исправил мэйк для GCC.


svs 26.01.2007 16:51:12 +0300 - build 204

1. Добавлен флаг DIF_SEPARATORUSER. Пока "внутри", т.к. в процессе...
   (подробнее в REMINDER)

2. Проблема с сепараторами, когда указаны ВСЕ координаты (из форума)
   пересчитаем правильные размеры.


svs 25.01.2007 14:25:20 +0300 - build 203

1. В обработчике DefDlgProc для события DN_BTNCLICK не учитывался флаг DIF_BTNNOCLOSE

2. Траблы с надписями в кейбаре (редактор, вьювер).
   Теперь между MXXXXF1 и MXXXXF12 не должно быть добавочных... типа MXXXXF1DOS
   Такова специфика кода.

3. Для элемента DI_VTEXT добавлена обработка флагов:
    DIF_CENTERGROUP - (не уверен, надо проверить), 
    DIF_SEPARATOR
    DIF_SEPARATOR2
    DIF_SHOWAMPERSAND

4. В обработчике флага DIF_CENTERTEXT трабла. Если был указан сепаратор, этот флаг 
   и координата X (отличная от -1, т.е. полные координаты), то... сепаратор 
   затирался...
   В общем DIF_CENTERTEXT в сочетании с DIF_SEPARATOR сам центрует строку.


svs 24.01.2007 19:01:33 +0300 - build 202

1. Уточнение DlgEdit. Все же будем наследовать от ScreenObject

2. ScreenObject::GetPosition стала виртуальной. 
   Возможно еще нужны уточнения по виртуальности функций...


svs 24.01.2007 18:06:17 +0300 - build 201

1. везде, где встречается DialogData, прописаны Y2.
   Просьба - если делаете диалог, то Y2 обязательно заполняйте!

2. Переделка класса DlgEdit. Теперь он ни от кого не наследуется, но держт на борту
   2 ссылки - на Edit и Editor.
   Плюс - необходимый набор функций.
   В диалоге это один объект, по сути - два (но этот объект для диалога, так что...)

4. небольшая заготовка в usermenu под DI_MEMOEDIT (в обычной жизни не используется)
   макрос PROJECT_DI_MEMOEDIT пока не юзабелен.


svs 18.01.2007 21:07:44 +0300 - build 200

1. Упс... пропустил гол в предыдущем матче ;-(
   (нет проверки на NULL)

2. Бага. Вылечил. Визуальная бага. Старая бага.
   стоим в каталоге, где есть диз-файл
   Ctrl-L Tab  - перешли на инфо-панель
   Alt-F? (для противоположной панели) и дальше на тот диск, 
          в каталоге которого нету diz`а
   Видим, что кейбар не обновился (Tab Tab - обновление прошло)


svs 18.01.2007 19:49:44 +0300 - build 199

0. Пересмотр кода кейбаров... выкинул кучу кода.

1. Закончим с кейбаром в FolderTree (он у нас от Frame, так пусть по 
   человече себя ведет, хотя бы как хелп)

2. Так же попробуем избавится от SaveScreen в FolderTree

3. в конструкторе TreeList проинициируем  SaveListData, иначе несколько
   раз Alt-F10 Esc и мы упали при освобождении памяти.

4. удалим немного комметов

5. Сейчас MKBFolderTreeXXX - всего несколько, имеет лис смысл разворачивать
   по всем клавишам (пусть даже они будут пустыми...) или как?
   Т.е. - делать как у всех объктов, юзающих кейбар или оставить так?

warp 18.01.2007 19:31:00 +0300 - build 198

1. Исправления в новой системе загрузки плагинов.

1.1. Не работал вызов конфигурации у кэшированных плагинов из-за изменения системы кэширования. 
   
1.2. Вызовы меню плагинов могли падать из-за неверного формирования строки-маски для хоткея. Странно, 
     что сразу не проявилось, баг где-то при портировании в юникод появился.

1.3. Функция сохранения кэша теперь принадлежит самому классу Plugin.

2. Файл plugin.Plugin.cpp переименован в plclass.cpp (.hpp соответственно). NMAKE
   отказался работать с файлом у которого "." в имени, ну и так имя файла ближе к
   стандарту. plclass.cpp(.hpp) добавлен в зависимости и far.mak и теперь самостоятельный
   файл (а не include).


warp 17.01.2007 18:42:00 +0300 - build 197

1. Почти полностью переделал всю систему загрузки плагинов. Теперь надо
   ее на чем-то хорошенько проверять. В теории возможна загрузка/выгрузка
   плагинов на ходу и прочие подобные штучки. 

2. Макрос UMSG теперь тоже возвращает const wchar_t *, передал в соответствующих
   местах инициализцию кейбара и пр.


t-rex 12.01.2007 16:51:21 +0200 - build 196

1. !$! не работал по назначению.


zg 11.01.2007 13:26:53 +0200

1. без билда, снова собирается gcc.

2. прототипы GetOpenPluginInfo и GetPluginInfo.


t-rex 10.01.2007 18:10:22 +0200 - build 195

1. Ещё немного x64.

2. Исправил фильтр (CtrlI).


svs 10.01.2007 14:28:59 +0300 - build 194

1. Добавлен файл REMINDER - своеобразная напоминалка о тех или иных действиях
   которые необходимо выполнить в будущем. Не TODO!
   Иначе потом не найдем что и как...

2. Из реминдера в принципе понятно почему "заработал" диалог назначения
   макросов...
   Вразумительного ответа пока не дождался почему в dialog.cpp было так сделано
   и будет ли переделано... посему - затычка.

3. Немного логирования + функция __MCODE_ToName() - логирование MCODE_


t-rex 10.01.2007 07:54:00 +0200 - build 193

1. Прошелся вроде бы по всем структурам которые содержат string и сделал для
   них правильную инициализацию и аллокацию в коде где такое было нужно.

2. Несколько мелких юникод, x64 и других фиксов.


svs 10.01.2007 00:52:09 +0300 - build 192

1. Кривая инициализация... FAR_FIND_DATA_EX DestData={0};
   error C2552: 'DestData' : non-aggregates cannot be initialized with initializer list
   В FAR_FIND_DATA_EX среди членов ходит класс string!
   Убираем.
   2WARP: просмотри дифы для copy.cpp и global.cpp

2. Дебажная компиляция под MSVC.
   Добавлена _wcstoi64. Если у кого вылезут глюки, то в farrtl.cpp между
   <SVS> и </SVS> нужно добавить "&& defined(SYSLOG_SVS)" - и мне приятно 
   и вам спокойнее ;-)
   
   А. О! Если кто юзает vc.2003.rar, то нужно 
     copy mspdb71.dll mspdb70.dll 
   с перезаписью :-)

3. Ctrl-A в архиве на каталоге - все опции атрибутов помечены.

4. Про макросы немного уточнений, в т.ч. включение в работу MsgBox.

5. Очередное уточнение SysLog


t-rex 09.01.2007 04:04:42 +0200 - build 191

1. Немного юникодных мелочей там и сям - чтоб получить вкус.


t-rex 09.01.2007 01:42:48 +0200

1. Совершенно мелкая фигня без билда, заменил две *A функции на *W.


t-rex 09.01.2007 01:03:04 +0200 - build 190

1. Вернул нумерическую сортировку.

2. Убрал несколько Ansi функций.

3. Переделал Ansi функции сравнения строк (которые могут понадобится для врапера плагинов)
   чтоб юзали внутри себя юникод, чем отменил LCIDSort и т.п.


warp 08.01.2007 21:45:00 +0300 - build 189

1. Ужесточена проверка на наличие hotplug устройства. Проверяем, не 
   ждет устройство извлечения. 

svs 08.01.2007 00:07:47 +0300 - build 188

1. Вторая итерация SysLog. Путем "#define" сделаем явный вызов
   функции преобразования из "string" в "const wchar_t *", дабы
   не упасть...

2. Изменен scripts/mkdep.awk - не учитывался objlog для дебажной версии.

3. Именуем внутрение структуры в структуре FilterParams (матюки компилятора)


svs 07.01.2007 21:27:50 +0300 - build 187

1. Первая итерация восстановить работоспособность SysLog.


t-rex 07.01.2007 19:37:52 +0200 - build 186

1. Убрал несколько Ansi функций из фара и импортов.
   И заодно исправил мелкие юникод баги в eject функции для Win9x на случай что оно будет надо.


svs 07.01.2007 18:10:04 +0300 - build 185

1. Изменен формат функции ScreeObject::VMProcess - новые параметры
   Возможно потом нужно будет еще несколько уточнений вводить, но на
   сейчас (для Help.XXXX) вполне достаточно.

warp 07.01.2007 16:48:00 +0300 - build 184

1. Больше не существует GetMsg, MSG и т.п. Обработка .lng только в юникоде (т.е. файлы 
   читаются и в ANSI, но внутри Far'а только юникод).

2. Попутно в обработчике .lng исправлено несколько ошибок с удалением данных.

3. Выкинул USE_WFUNC, Opt.UseUnicodeConsole и неюникодные версии Text/VText/mprintf и т.п.
   Opt.UseUnicodeConsole, видимо, вернется. В виде Opt.UseAnsiConsole (привет телнету).

4. Выкинул еще пачку ANSI функций, которые реально уже не требовались, где еще требовались - исправил.

t-rex 05.01.2007 02:44:35 +0200

1. без билда, обновил инклюды и скрипт генерации оных чтоб в них выводилась версия фара.

2. Удалил файл dummy.cpp из-за ненадобности.

3. Синхронизайия хэлпа и *.pas с 1.7x


warp 05.01.2007 03:36:00 +300 - build 183

1. Выкинул глюкодром по имен RawConvertShortNameToLong, заменил его на
   ConvertNameToLongW. Если чего отвалится, буду крутить дальше, но глюкодром не верну.

2. GetMsg в API зачем-то возвращала char *, теперь, как положено, возвращает const wchar_t *.

t-rex 04.01.2007 13:16:24 +0200 - build 182

1. Убрал /* Revision: $ */ и лишние коменты отовсюду.

2. Входим в эру 64-бит

   Главные изменения:
     DlgProc: long Param2 -> LONG_PTR Param2 и возвращает LONG_PTR вместо long
     SendDlgMessage: long Param2 -> LONG_PTR Param2 и возвращает LONG_PTR вместо long
     DefDlgProc: long Param2 -> LONG_PTR Param2 и возвращает LONG_PTR вместо long
     DialogEx: long Param -> LONG_PTR Param
     FarMenuItemEx: DWORD UserData -> DWORD_PTR UserData
     PluginPanelItem: DWORD UserData -> DWORD_PTR UserData
     AdvControl: возвращает INT_PTR вместо int
     OpenPlugin: int Item -> INT_PTR Item
   А также в execute.cpp добавлено определение 64-bit GUI прог.

   После некоторых экспериментов было выведено что выравнивание должно быть 8 для 64-bit версии.
   Обновил Far.mak и добавил vc.build.debug.64.bat и vc.build.release.64.bat которые используют
   custom.vc.debug.64.bat и custom.vc.release.64.bat соответственно.
   Мой custom.vc.release.64.bat содержит следующее:
   call "I:\Program Files\Microsoft Platform SDK for Windows Server 2003 R2\SetEnv.Cmd" /X64

   Убрал всевозможные ворнинги связанные с x64.
   Включил показ x64 ворнингов для x64 билда - люди, перед тем как вы комитите свои
   изменения, соберите x64 версию и посмотрите на ворнинги - если есть и вы не знаете
   как правильно их решить то стучите ко мне (главное не уберите ворнинг оставив баг).

   Остались несколько ворнингов которые показывают на баг внесенный новыми макросами для
   хэлпа - буду решать когда поймаю Валю.

3. Удалил ClevMutex.hpp из за ненадобности и из за x64 несовместимости.


warp 31.12.2006 16:06:00 +300 - build 181

как это модно писать - regression fixes

1. делал сохранение - в самом конце поломал правильность
получения кодировки в диалоге сохранения.

2. когда менял PluginItem на Plugin откусил возможность грузить плагины.

warp 30.12.2006 06:20:00 +300 - build 180

1. Различные переделки в fileeditor.cpp. новый диалог открытия/создания файла.

2. PluginItem переименован в Plugin и это теперь класс. Попутно устранены несколько memset'ов, нельзя
так очищать классы и структуры, содержащие string.

3. Новый диалог сохранения файла в fileeditor.cpp. Практически реальное сохранение файлов. Зачатки 
механизма переоткрытия файла при смене c юникодной кодовой таблицы на неюникодную или наоборот. 

4. Очень много изменений в editor/fileedit. Все ужасно сыро.

5. lng.generator rc10, тот который с поддержкой UTF-8. 

2SVS: У меня тоже, там ??? не зря стоит. 

svs 27.12.2006 18:36:43 +0300 - build 179

1. Macro: + новых слова:
    Help.FileName - имя просматриваемого файла помощи
    Help.Topic    - просматриваемый топик
    Help.SelTopic - топик, который сейчас выделен

2. Попутно бадья нашлась при формировании топика:
   Shift-F2, а дальше путешествуем по топикам.
   в итоге получаем кучу слешей в конце StackDate.HelpPath
   Решение - удалим все конечные слеши и добавляем единственный.

3. У DeleteEndSlash новый параметр - удалить ли _ВСЕ_ концевые слеши.
   по умолчание "неа, тока один от конца строки".

4. В WindowInfo для Help`а теперь заполням Name - полный путь к файлу.

2WARP: вызывает сомнение вот фрагмент, подобный:

    case MCODE_V_HELPFILENAME: // Help.FileName
       return (int)(const wchar_t *)strFullHelpPathName;     // ???


svs 20.12.2006 15:29:10 +0300 - build 178

1. Откат Mantis#198. Здесь все веселее и веселее...
   Проблема в том, что пока ФАР не получит управление...


svs 15.12.2006 17:20:37 +0300 - build 177

1. Mantis#255 - При вставке пути к файлу/папке по Ctrl+Alt+F последний слеш 
                получается  не в ту сторону 
   Пусть AddEndSlash сама определяет чьих слешей больше :-)
   (второй параметр не "\", а 0x00).

3. Пусть "mkdep.list.txt" будет именоваться как "mkdep.list" 
   (он, гад такой все время попадает... под txt)

4. Mantis#198. Уточнение. В обчем тут такое дело...
   Есть у меня макрос "F11 ? 1 !".
   Здесь 
   '?' - хоткей для "cdHelps"
   '1' - Context-dependent help
   '!' - Previous query
   Если раньше в консоли ничего не появлялось, а просто тупо появлялся гуевый 
   хелп. То сейчас мелькает меню - открывается и закрывается.
   Посему пока просто учтем Mode==MACRO_DIALOG.
   Хмм пока это писал, увидел артефакты и в редакторе...
   Однозначно только MACRO_DIALOG учитываем (а там посмотрим - в смысле
   вернуть все взад...)

svs 15.12.2006 12:26:06 +0300 - build 176

1. Mantis#198: проблема с прорисовкой сообщения при работе с макросом
   Изменил немного механих окончания работы макропоследовательности

svs 14.12.2006 12:22:59 +0300 - build 175

1. Mantis#218: Проблема с копированием файла в самого себя
   (это когда копируем файл "c:\a.txt" в "c:")
   [-] При копировании уничтожалось содержимое файла в корне диска, если в 
       качестве приемника указывался этот самый диск (файл "C:\a.txt" копируем в "C:")

2. Поддержка колеса мыши в объекте выбора папок (копир)


svs 13.12.2006 13:13:20 +0300 - build 174

1. Mantis#235: Не распознаётся zip-архив
   Хотел сначала подателя жалобы послать на... TechInfo#63 :-)
   Но, расположение требуемой сигнатуры этого архива (в сааамом конце файла) 
   не укладывается в указанный диапазон - "Диапазон от 0x1000 до 0x80000".
   Здесь как раз бы 4метра указать, но...
   В общем снял органичение на верхний предел.
   Доку поправлю.


svs 12.12.2006 19:06:46 +0300 - build 173

1. В FolderTree не отрабатывали мышиные правила для диалога (вне диалога).
   
2. Mantis#253 - Пропадание содержимого дерева папок
   Добавил TreeList::SaveState() и TreeList::RestoreState(). чтобы сохранить
   текущие значения кеша и списка каталогов дерева.

3. DMOUSEBUTTON_* перенесены из dialog.hpp в farconst.hpp


svs 07.12.2006 15:31:40 +0300 - build 172

1. Вводим VSMFL_REDRAW для ViewerSetMode.Flags, ибо так правильнее будет.
   т.е. либо VCTL_SETMODE + VCTL_REDRAW, либо VCTL_SETMODE(VSMFL_REDRAW).

svs 06.12.2006 20:02:31 +0300 - build 171

1. Класс FolderTree наследуется от Frame, что позволило вылечить древний баг с 
   прорисовкой (F5 F10 F1 F5 F5 Esc - видим "грязь" на экране).
   Так же это изменение позволило добавить фичи:
   а) Alt-F9 (само получилось, т.к. Manager сам умеет перерисовывать все, что 
      наследуется от Frame)
   б) F5 - распахнуть/вернуть окно поиска каталога (по аналогии с хелпом)

   Так же, конструктор претерпел некоторые изменения в параметрах.

   В хелпах в раздел "@FindFolder" добавлена инфа про F5 и Ctrl[-Shift]-Enter.
   В FarEng.hlf.m4 нужен перевод.

2. Небольшие правки plugins.cpp. Просьба не употреблять __try/__except. Для
   этого есть макросы TRY/EXCEPT, соответственно.

3. Добавлен файл README. Перечислены некоторые правила. Если кто-то вспомнит
   еще правила - писать в этот файл.


warp & t-rex 05.12.2006 03:36:01 +0300 - build 170

1. Добавлена проверка плагина на "плагиновость" из 1.7

2. Устранены пара мелких багов.

svs 01.12.2006 20:19:01 +0300 - build 169

1. Замена в составе: ViewerMode.TypeWrap -> ViewerMode.WordWrap

2. Добавка в ViewerAPI - VCTL_SETMODE, enum VIEWER_SETMODE_TYPES, struct ViewerSetMode

3. В XXXControl добавлена проверка на вшивость с юзанием IsBadReadPtr()


svs 30.11.2006 09:27:43 +0300 - build 168

1. При выключенных настройках [ ] Save file position [ ] Save bookmarks 
   после открытия файла на редактирование курсор по умолчанию становится 
   в конец первой строки.

warp 25.11.2006 03:27:00 +0300 - build 167

1. Кое-какое сохранение в редакторе. Уже даже можно попробовать сохранить файл в UTF-8.
   Сыро до безобразие. Наблюдаются глюки.

2. Исправил кое-какие баги и неточности в обработке кодировок.

3. Еще всякая мелочь.

warp 25.11.2006 01:03:00 +0300 - build 166

1. Изменил в редакторе AddString на InsertString, теперь там указывается после
   какой строки добавить текущую. Пока не совсем точная реализация.

2. Исправил кое-какую мелочь.

warp 25.11.2006 00:17:00 +0300 - build 165

1. Убил FCTL_*ANOTHER* команды. Теперь эта/другая панель задается
   через первый параметр Info.Control как CURRENT_PANEL/ANOTHER_PANEL.
   Функционал еще не протестирован.

t-rex 24.11.2006 22:35:49 +0200 - build 164

1. Немного GCC. Почему вы упорно не используете _i64(NUMBER) вместо NUMBERi64?
   И _ui64(NUMBER) вместо NUMBERui64.

svs 23.11.2006 19:57:42 +0300 - build 163

1. Macro: $AKey - клавиша, который вызвали данный макрос
   (небольшой задел на будущее)


t-rex 23.11.2006 09:03:15 +0200 - build 162

1. При удалении пустой строки или соединении двух строк при помощи DEL или BS выставлялись
   неправильные символы конца строки для "новой" строки.


svs 21.11.2006 00:00:11 +0300 - build 161

1. Copy/Paste: "CurLine->GetEOLW" VS "CurPtr->GetEOLW"

svs 18.11.2006 00:16:11 +0300 - build 160

1. Mantis#139 - Нарушения с концами строк при Отмене

2. + Edit::GetEOLW()

3. У Editor::AddUndoData новый параметр - пусть Undo помнит EOL!

2warp: Эта... есть бага одна (не моя :-). Если открыть редактор, то
       в начале файла есть пустая строка. Судя по всему это результат
       выноса ReadFile из Editor в FileEditor (не уверен).
       Мой патч это не исправляет! (пока не знаю где копать)


warp 16.11.2006 21:27:00 +0300 - build 159

1. Намутил что-то страшное с кодировками. Реализация несколько неправильная
   идеологически (нужен объект для перекодировки, а не какой-то m_codepage), но
   теперь можно даже открыть файл на редактирование в какой-нибудь кодировке
   вроде KOI-8 (кто сказал "а сохранить?").

svs 07.11.2006 21:33:42 +0300 -

1. без билда добавлен tee.exe с коррекцией vc.build.debug.bat и 
   vc.build.release.bat

warp 06.11.2006 02:42:00 +0300 - build 158

1. Убил. Я его убил. Да! Метод ReadFile теперь принадлежит FileEditor, кэш
   тоже теперь принадлежит ему. Editor теперь представляет собой только memo,
   как и положено. На данный момент в кэш может сохраняться туфта, кодировки
   не работают (хм, ну это... не совсем, конечно...), проверка на минимальный 
   размер не работает, сообщение о загрузке файла не работает... Убил, что говорить.

warp 02.11.2006 02:42:00 +0300 - build 157

1. Добавил функцию apiGetFileSize, работающую сразу с unsigned __int64.
   Под это дело сделал в wipe поддержку файлов размером больше 4Гб и заменил
   GetFileSize в соотв. местах.

warp 02.11.2006 01:40:00 +0300 - build 156

1. Выкинул из редактора примерно 3.5 кб кода, путем убиения структуры
   EditList. Теперь поля Next/Prev принадлежат непосредственно Edit'у. 

warp 01.11.2006 02:34:00 +0300 - build 155

1. Попортил редактор немного на предмет унификации функций по 
   добавлению/созданию строк. Готовлю себя к переносу чтения файла
   в FileEditor (где ей и место).

svs 10.10.2006 11:36:00 +0300 - build 154

1. Macro: Area-коды разнесены. Теперь Condition имеет свои OpCode, а
   области - свои. Иначе в дампе макроса при логировании хрень.
   Для ньюсов ничего пистать ненадо.


svs 09.10.2006 12:15:50 +0300 - build  153

1. Упоминание про Ctrl-Shift-Enter при быстром поиске (нужен перевод!)
   Mantis 244

2. FindFile: Зацикливается поиск при поиске подстроки на файле больше 2Gb
   Mantis 243


warp 06.10.2006 17:10:00 +0300 - build 152

1. Вроде поправил ширину DIF_SEPARATOR для диалогов без рамки. 

t-rex 27.09.2006 04:12:34 +0300 - build 151

1. Ещё одно дополнение к фиксу "Падение при старте ФАРа, когда каталог недоступен".
   На пассивной панели открывался каталог без ".." вверху.

t-rex 27.09.2006 03:07:27 +0300

Косметика без билда.

1. Прошлый патч был совсем не в тему. Вернул как было и чтоб больше не было
   вопросов сделал два батника и изменил Far.mak:

   Эти батники на прямую не редактировать!!!!!!!!!
   Только для постоянных изменений для всех участников проекта.
   Читайте объяснение - всё продумано.

   --------------------
   vc.build.release.bat
   --------------------
   Этот батник собирает release версию фара с помощью VC и Far.mak.
   Батник заодно обновляет far.release.dep и языковые файлы.
   С запуском этого батника никогда не будут никаких проблем при сборке фара
   (кроме ошибок в самом коде :).
   Чтобы батник был универсальным и работал у всех без изменений он
   вызывает другой батник - custom.vc.release.bat - если такой есть.
   Этот (custom.vc.release.bat) батник вам надо создать самим так как он ваш
   личный и на SVN комитится не будет. В нём вы можете определять переменные
   среды компайлера и переопределять переменные среды которые используются
   для сборки фара в главном батнике.
   Например у меня он содержит:
   ---->8----
   @echo off
   call F:\lng\VC.Toolkit.2003\vcvars32.bat
   ----8<----
 
   ------------------
   vc.build.debug.bat
   ------------------
   Тоже что и vc.build.release.bat только собирает debug версию, обновляет
   far.debug.dep и вызывает custom.vc.debug.bat если такой есть.
   Пример custom.vc.debug.bat:
   ---->8----
   @echo off
   call F:\lng\VS98\Bin\VCVARS32.BAT
   set FAR_MSVCRT=/D FAR_MSVCRT
   set FARSYSLOG=-DSYSLOG_TREX %FARSYSLOG%
   ----8<----


svs 26.09.2006 10:52:00 +0300 -

Косметика без билда.

1. В mkdep.list.txt добавлены copyright.inc и farversion.inc, т.к. если сделать
   первый раз экспорт, а потом запустить компиляцию, то будет ошибка компиляции
   global.cpp, т.к.  ни copyright.inc ни farversion.inc еще нету.
   
   Так же исправлен scripts\mkdep.awk - учитывает расширение INC, т.е. как раз 
   те самые файлы copyright.inc и farversion.inc, которые генерятся из *.m4.

t-rex 25.09.2006 04:36:38 +0300 - build 150

1. Не влезали русские слова в диалог фильтра.

2. Совершенно не работала функция смены языка Фара.

3. UserData для VMenu при Size==0 ожидается и обрабатывается как wchar_t * а не как char *.

t-rex 23.09.2006 05:07:44 +0300 - build 149

1. Дополнил Валин фикс на тему "Падение при старте ФАРа, когда каталог недоступен"
   а то выходила фигня если недоступный путь был например C:\a - фар открывал C: и
   делал это очень криво.

   ВАЖНО!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   Ну нельзя делать кастинг от string в wchar_t * и потом менять последний,
   если надо ручками изменить string то делать это нужно _обязательно_ используя
   string::GetBuffer() и string::ReleaseBuffer()!

t-rex 23.09.2006 02:51:38 +0300 - build 148

1. В фиксе для висты сделал случайно memcpy вместо wmemcpy.

svs 20.09.2006 16:05:00 +0300 - build 147

1. Macro: первые приближения "Height" и "Width" (и "[A|P]Panel.Height")

2. Macro: fexist fattr и еже с ними возвращаали фингню, если файла нет.
          (преобразования, млин)

3. Добавлена функция Manager::SwapTwoFrame() для макро-нужд.
   ...либо не для макронужд, если умный Ctrl-Tab будет делаться средствами
   FAR.


svs 20.09.2006 15:34:00 +0300 - build 146

1. Падение при старте ФАРа, когда каталог недоступен (например, на
   FS была примонтирована флешка, которой при тсрате на месте не оказалось).

2. Уточнение KeyNameToKey() - для переменной ала "%CtrlAltF1" отрабатывал...
   в общем кривизна была :-)


t-rex 15.09.2006 04:43:53 +0300 - build 145

1. Починил вставку мусора в редакторе в висте при нажатие на Enter.
   В висте realloc на уменьшение не всегда (а может и никогда) ни возвращает тот же адрес.

2. Починил сборку GCC.

3. Мелкие изменения в мэйках.   

4. Начинаем писать changelog, я сделал себе макрос
   "t - r e x Space $Date \"%d.%m0.%Y %H:%M:%S %Z\" Enter"
   чтоб выводить заголовок changelog-а.
   Последующие логи надо писать сверху - т.е. файл будет идти хронологически снизу вверх.
   В changelog прошу писать в Win кодировке.

5. Добавил батник и m4 скрипт для авто пометки нового билда в репоситории.
   Батник выведет вот такое сообщение чтоб вы случайно не сделали ошибки.
   --------------------------------------------------------------------
   Continue only if you are sure that you have set the correct
   build and commited the changes.
   This command will tag the trunk under tags/VERSION_bBUILD, if such
   tag already exists this command might cause problems.
   --------------------------------------------------------------------
   If you're not sure press СtrlC.
   --------------------------------------------------------------------
   --------------------------------------------------------------------
   Продолжайте тольке если вы уверены что вы выставили правельный
   номер билда и закомитили изменения.
   Эта команда пометит текущий trunk в tags/VERSION_bBUILD, если такая
   пометка уже существует то это может привести к проблемам.
   --------------------------------------------------------------------
   Если вы не уверены то нажмите CtrlC
   --------------------------------------------------------------------
