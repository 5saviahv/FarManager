/*
Modify:
  11.07.2006 EL
    - Убрал варнинги
  25.05.2006 SVS
    ! HotPlug: инициализацию сделаем здесь
  23.05.2006 SVS
    - Неправильное позиционирование на каталоге с национальными символами
      в имени при исполнении команды "FAR . Shift-Enter"
    - far "foo bar\" из меню "Пуск|Выполнить" приводит к появлению строки аргумента "foo bar"" -
      т.е. имеем заключительную кавычку, на что GetFileAttributes говорит "неа".
  09.04.2006 AY
    ! Кто то :) забыл printf.
  04.04.2006 SVS
    + Уточнение подсказки командной строки (для far /?)
    - некорретная работа "far ." и "far .\"
  06.12.2005 AY
    ! Mantis#66 - "Far.exe \\computer\share" не пашет.
  02.11.2005 SVS
    + освободим память местного клипборда (на всякий случай)
  25.10.2005 SVS
    ! проверку регистрации перенесем после разбора комстроки и некоторых инициализаций, иначе получим Mantis#31
  14.07.2005 SVS
    + добавлен класс TConsoleRestore, восстанавливающий консоль после завершения работы ФАР
  04.07.2005 WARP
    - Недетский баг с регистрацией
  18.04.2005 SVS
    - хренова OEM
  12.04.2005 SVS
    ! Снова "FARHOME", но теперь не в морг.
  06.08.2004 SKV
    ! see 01825.MSVCRT.txt
  07.07.2004 SVS
    ! Macro II
  14.06.2004 SVS
    + добавки MACRODRIVE2
  01.03.2004 SVS
    ! Обертки FAR_OemTo* и FAR_CharTo* вокруг одноименных WinAPI-функций
      (задел на будущее + править впоследствии только 1 файл)
    + FAR_ANSI - руками не мацать (уж больно трудно синхронизацией заниматься)
      на "сейчас" влияния не окажет, зато потом...
  13.10.2003 SVS
    ! в морг "FARHOME", так в морг.
  09.10.2003 SVS
    - Если фигню подсунули в комстроке, типа %1 %2 %3, то нафиг все...
  09.10.2003 SVS
    ! SetFileApisToANSI() и SetFileApisToOEM() заменены на SetFileApisTo() с параметром
      APIS2ANSI или APIS2OEM - задел на будущее
    + переменные среды: FARHOME
    - Bug: "/p. все равно грузит плагины из %FARHOME%"
    ! EditName и ViewName - как указатели. Этого вполне достаточно и стек экономим
  06.06.2003 SVS
    ! Отделение мух от котлет - ключ /p приоритетный
  19.05.2003 SVS
    ! DetectTTFFont уехал из main.cpp в interf.cpp
  06.05.2003 SVS
    ! /aw удален, вместо него /8, который в масдае не действует, а в NT
      заставляет работать ФАР в 8-битной консоли (по умолчанию в NT
      ФАР стартует as Unicode - как для Out, так и для Inp
    ! Автодетект TTF отключен нафиг
  16.04.2003 SVS
    ! /co преобладает над /p
    ! Уточнение для _beginthread() - вызовем функции напрямую, иначе
      зарегистрированные пользователи в пролете :-(
  31.03.2003 SVS
    ! Проверим код возврата _beginthread() и выставим "Евалюшин копия"
  17.03.2003 SVS
    ! применим новые флаги FFPOL_*
  04.02.2003 SVS
    + В общем, теперь в дебажной версии есть ключ "/cr", отключающий трид
      проверки регистрации. Под TD32 иногда жутчайшие тормоза наблюдаются.
  18.01.2003 IS
    - Не правильно обрабатывалась команда /p[<path>], если в пути были
      буквы национального алфавита.
  10.01.2003 SVS
    - BugZ#765 - Ключи командной строки парсятся неоднозначно.
    ! Научим исключатор понимать (и реагировать предсмертным воплем) исключения
      в самом ФАРе. Для этого часть кода вынесено из main в MainProcess.
      Вызов MainProcess обволочен стандартным способом для исключений
      (учет опции Opt.ExceptRules)
  23.12.2002 SVS
    ! OnlyEditorViewerUsed стал частью структуры Options
  07.10.2002 SVS
    - BugZ#674 - far.exe c:\dir [c:\dir2] - не работает
  21.08.2002 SVS
    ! Уточнение про WaitKey
  02.07.2002 SVS
    - /u USER отломали
  27.06.2002 SVS
    - Падение в масдае при старте ФАРа - нефига автодект TTF-шрифта
      в этой гребанной оси вызывать
  21.06.2002 SVS
    + автодетект TTF-шрифта
    ! /w  - отключена (может потом пригодится)
    + /aw - Отключить автоопределение TrueType шрифта для консоли.
    + В командной строке можно указать не более двух путей к каталогам,
      файлам или архивам. Первый путь для активной панели, второй -
      для пассивной.
  17.06.2002 SVS
    ! Опция /ttf заменена на /w
    ! Для "far /?" в масдае не выводится
  04.06.2002 SVS
    - BugZ#547 - No dot in help description
  30.05.2002 SVS
    ! Новая опция /ttf - для выставленного TTF-фонта для консольного окна
  21.05.2002 IS
    + Получим реальное значение полного длинного пути с учетом
      символических связей для MainPluginsPath
  18.04.2002 SKV
    + потрогаем floating point что бы VC++ его подключил.
    + ifdef что бы компилировалось под VC 7.0
  08.04.2002 SVS
    ! Расквочим строку MainPluginsPath
  26.03.2002 IS
    + Вызов InitLCIDSort, теперь здесь настраивается сортировка, а не в
      LocalUpperInit
  28.01.2002 VVM
    + Если не смогли считать .лнг файл - то перед выдачей сообщения очистим
      буфер ввода - на всякий случай...
  22.01.2002 SVS
    + Опция /xd  "Enable exception handling" - эт, чтобы в отладчике с
      исключениями работать. В "нормальном" ФАРе ЭТОГО нету. Для включения
      нужно скомпилить ФАР с макросом _DEBUGEXC
  22.01.2002 SVS
    - BugZ#201 - Shift of command prompt after exiting FAR
    + OnliEditorViewerUsed,  =TRUE, если старт был /e или /v
  22.01.2002 SVS
    - BugZ#263 - Opening non-existent file in viewer (beta 4 only)
  11.01.2002 IS
    - "Сделал", блин :-(
      Не в LocalUpperInit это нужно вставлять, а в отдельную функцию, а
      LocalUpperInit должно делать только то, что положено и ни грамма больше.
  10.01.2002 SVS
    - "Сделали", блин. :-(
      Считывание Opt.HotkeyRules должно быть раньше вызова LocalUpperInit
      Хмм... а может его в этот самый LocalUpperInit и впиндюлить?
  09.01.2002 IS
    ! Сделаем LocalUpperInit в самом начале main, в противном случае ловим
      глюки, если используем LocalStricmp.
  24.12.2001 VVM
    ! При ожидании окончания регистрации отдаем время виндам...
  08.11.2001 SVS
    ! Народ не понял предыдущей фишки :-(((
  06.11.2001 SVS
    + В момент старта ФАРа смотрим в [HKCU\Software\Far\System\Environment]
      Если определен, и в этой ветке имеются Values, то FAR при старте
      считывает пары Value-Data и устанавливает переменные окружения.
  18.10.2001 SVS
    ! "причесан" хелп
  05.10.2001 SVS
    ! Opt.ExceptRules и бедагер
  03.10.2001 SVS
    ! если под дебагером, то отключаем исключения однозначно, иначе - смотря
      что указал юзвер.
  26.09.2001 SVS
    + Полиция 19 - если у "полиции" выставлен 19-й бит - игнорировать /p
  16.09.2001 SVS
    - Отключаемые исключения (+ спец опция ком.строки для этих целей)
  05.09.2001 SVS
    ! SetHighlighting() переехала в hilight.cpp
  08.08.2001 SVS
    + позволим для "far /e" работать переключалке F6
  06.08.2001 SVS
    + Ключ "/do" документирован только для "меня" :-)
      Он появится в far /? только тогда, когда ФАР скомпилен с макросом
      DIRECT_RT
      (все время забываю что это за хрень :-)
    - для очистки после выхода нужен Flush() :-(
  27.07.2001 SVS
    + Ключ "/co" документирован.
  24.07.2001 SVS
    ! Заюзаем флаг NotUseCAS - чтобы не гасилось ничего для одиночного
      редатора/вьювера (far /e) - иначе БАГА!
    + Чистим экран после выхода из ФАРа
  11.07.2001 SVS
    + переменные среды: FARLANG и FARUSER
  10.07.2001 SVS
    ! Изменены (обобщены) расширения для архиваторов.
  07.07.2001 IS
    ! В 806 патче я выкинул один костыль, связанный с обработкой каталогов с
      именем "..", а взамен ничего не дал. Исправляю ситуацию :-)
  06.07.2001 IS
    ! Изменения в SetHighlighting в соответствие с изменениями в структуре
      HighlightData
  02.07.2001 IS
    - Баг: дублировались записи в PluginsCache в том случае, если far.exe был
      запущен с указанием короткого пути.
  29.06.2001 OT
    ! Косметика оказалась ... с душком-с :( Отменяем :)
  23.06.2001 OT
    ! косметика для команд far -v/-e. Не нужны нам теперь панели-болванки.
  29.05.2001 tran
    + DIRECT_RT
  06.05.2001 DJ
    ! перетрях #include
  29.04.2001 ОТ
    + Внедрение NWZ от Третьякова
  23.04.2001 SVS
    ! КХЕ! Новый вз<ляд на %PATHEXT% - то что редактируем и то, что
      юзаем - разные сущности.
  08.04.2001 SVS
    ! Изменена обработка PATHEXT - при старте FAR`а преобразуем к нужному виду.
  04.04.2001 SVS
    ! Немного опитимизации кода в SetHighlighting()
  03.04.2001 SVS
    ! CmdExt - полностью переработан с учетом %PATHEXT% и WinNT (*.cmd)
    ! Уточнение архиваторных расширений.
  02.04.2001 SVS
    ! Добавлено "некоторое" количество расширений в раскраску для архивов.
    + *.vbs,*.js - подсветка как у исполняемых файлов.
  07.03.2001 IS
    - Избавление от падения при удалении папок в корзину (на основе информации
      от Веши).Удаляем неугодную ветку, если она пуста, потому что в этом
      случае Фар может упасть при удалении каталогов в корзину.
  05.03.2001 SVS
    + Закомментированный /co для /?
  02.03.2001 SVS
    - А слеш поставить забыли :-((((
  01.03.2001 SVS
    ! Унифицирована функция SetHighlighting() - в последствии проще будет
      изменять или добавлять - меняем лишь массив.
    ! При старте ФАР переносит данные в реестре из "Highlight" в
      "Colors\Highlight". Ветка "Highlight" прибивается.
  19.01.2001 SVS
    + FAR.EXE /?
    + проверка на количество строк (MListEval)
  30.12.2000 SVS
    + Проинициализируем функции работы с атрибутами Encryped сразу после
      старта FAR
  28.12.2000 SVS
    + Opt.HotkeyRules - Правило на счет выбора механизма хоткеев
  21.12.2000 SVS
    Если не нашли LNG, то после выдачи сообщения ожидаем любую клавишу.
  15.12.2000 SVS
    + В случае, если не нашли нужных LNG-файлов - выдаем простое сообщение
      и не выпендрючиваемся.
  01.09.2000 tran
    + /co switch
  03.08.2000 SVS
    ! WordDiv -> Opt.WordDiv
  03.08.2000 SVS
    ! Не срабатывал шаблон поиска файлов для под-юзеров
    + Новый параметр "Вместо стандарного %FAR%\Plugins искать плагины из
      указанного пути". При этом персональные тоже грузится будут.
      IMHO нехрен этому параметру делать в системных настройках!!!
  07.07.2000 IS
    - Декларация SetHighlighting перешла в fn.cpp
  07.07.2000 SVS
    + Получить разграничитель слов из реестра (общий для редактирования)
  25.06.2000 SVS
    ! Подготовка Master Copy
    ! Выделение в качестве самостоятельного модуля
*/
