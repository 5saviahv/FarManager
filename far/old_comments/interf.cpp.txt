/*
Modify:
  06.05.2006 SVS
    - mantis#0000146: Глючит EditorControl, если запускаем "far /e filename.txt" и обрабатываем EE_READ
  12.03.2006 SVS
    ! варнинги под MSVC
  23.07.2005 SVS
    ! vsprintf -> vsnprintf
  02.07.2005 WARP
    ! Отдадим 9x возможность распахивать консоль при AltF9 == 1.
  24.04.2005 AY
    ! GCC
  05.04.2005 SVS
    + У GetText() появился доп параметр - скока читать.
    + У ScreenBuf::Read() появился доп параметр - скока читать.
  21.03.2005 WARP
    - BugZ#1928 мерцает экран при поиске в просмотре при включенных часах.
  05.01.2005 WARP
    - При использовании DIF_LISTNOBOX обрезались сепараторы в листе.
  06.08.2004 SKV
    ! see 01825.MSVCRT.txt
  29.03.2004 SVS
    - предыдущая реализация GetVidCharW() была ошибочной
  01.03.2004 SVS
    ! Обертки FAR_OemTo* и FAR_CharTo* вокруг одноименных WinAPI-функций
      (задел на будущее + править впоследствии только 1 файл)
  19.02.2004 SVS
    ! В BoxText() применим TextW вместо BoxTextW - "сокращение расстояния"
    + BoxTextW2()
  23.10.2003 SVS
    ! небольшая оптимизация в Box и ScrollBar
  26.08.2003 SVS
    + TitleModified - выставляется когда прошла модификация заголовка
      (это для макросов).
  23.07.2003 SVS
    ! Новый механизм "разворота" консоли для масдаев.
    + позволим сокрректировать размер (Opt.ScrSize.DeltaXY)
  15.06.2003 SVS
    ! Из _Oem2Unicode "уберем" (обнулим) диапазон псевдографики.
      У нас все равно юзается спец таблица для рамок
    ! Не будет кромсать массив Oem2Unicode, если выставлена опция Opt.NoGraphics
  05.06.2003 SVS
    ! SetFarConsoleMode имеет параметр - нужно ли активировать буфер
  19.05.2003 SVS
    ! DetectTTFFont уехал из main.cpp в interf.cpp
    - Bug 893 - Символ \x7F отрисовывается на панели как '?'
  06.05.2003 SVS
    ! W-Console!!!
    ! Opt.UseTTFFont заменена на Opt.UseUnicodeConsole - так вернее
  29.04.2003 SVS
    ! _Oem2Unicode:
      "...Well, to be exact, you could place 0x221a on position 0xFB (this is a
      checkmark used to indicate currently selected menuitem). Now FAR displays
      this character - u, and after this change the character will be &#8730;.."
  21.04.2003 SVS
    + RegistrationBugs - =TRUE, если трид создать не удалось.
    + PrevFarAltEnterMode - для тестирования "Alt-Enetr"
    ! Уточнение для _beginthread() - вызовем функции напрямую, иначе
      зарегистрированные пользователи в пролете :-(
    + видоизменение "ламерской" защиты - считайте что это бзик :-)
  31.03.2003 SVS
    ! Проверим код возврата _beginthread() и выставим "Евалюшин копия"
    - CtrlHandler() инициализировался до создания CtrlObject
  04.02.2003 SVS
    + В общем, теперь в дебажной версии есть ключ "/cr", отключающий трид
      проверки регистрации. Под TD32 иногда жутчайшие тормоза наблюдаются.
  10.12.2002 SVS
    ! уберу SysLogDump("Oem2Unicode"...)
  18.09.2002 SVS
    ! Про двойные '&' в меню
  17.09.2002 SVS
    + DrawLine()
  27.08.2002 SVS
    - Мдя :-(
  23.08.2002 SVS
    ! PutRealText и GetRealText приведем к USE_WFUNC
    + _GetRealText/_PutRealText - обобщенные функции
  19.08.2002 SVS
    ! Уточнение SetFarTitle - меняем заголовок если сейчас исполнение
      макроса и разрешен вывод или сейчас макроса не исполняется.
  27.06.2002 SVS
    ! С подачи IS исключаем Tab из "празника жизни" (_Oem2Unicode)
  25.06.2002 SVS
    - BugZ#566 - Недограбливаются диалоги, содержащие точки.
  06.06.2002 SVS
    - некомпиляция под VC
  04.06.2002 SVS
    + TextToCharInfo
    + PutTextA (с конвертацией)
  31.05.2002 SVS
    ! GetVidChar стал inline в fn.hpp, код, ответственный за юникод
      перекочевал в GetVidCharW (из-за "for").
    ! Text немного перелужен (раскрутка стека, etc.)
    ! SetVidChar стал inline
  30.05.2002 SVS
    ! В USE_WFUNC, вместо проверки на тип операционки заюзаем Opt.UseTTFFont
    ! InitRecodeOutTable() - самостоятельная (не статическая), исправлена так,
      чтобы не потеряв оригинального содержимого Oem2Unicode можно было бы
      переинициализировать таблицу (когда меняем кодепэйдж консоли)
    ! GetVidChar и SetVidChar оперируют байтами
    ! Для W-функций вывода на экран при создании "CONOUT$" так же юзаем
      CreateFileW
    ! У ClearScreen исключен лишний вызов функции, обратимся напрямую к
      ScrBuf.FillRect()
  22.05.2002 SVS
    ! Editor -> FileEditor
  16.05.2002 SVS
    ! Ограничения при выводе часиков (ProcessShowClock)
    ! Уточнения для W-функций: MB_USEGLYPHCHARS для MultiByteToWideChar
  11.05.2002 SVS
    - добавим недостающую скобоку в Text()
  09.04.2002 DJ
    ! попробуем организовать нормальный запуск под Win2000, даже если в .PIF
      стоит 300 строк
  08.04.2002 SVS
    ! В FlushInputBuffer() очистим так же и инфу про мышь
  02.04.2002 SVS
    + SetInitialCursorType()
  01.04.2002 SVS
    ! Про заголовок
  28.03.2002 SVS
    + ClearScreen()
  22.03.2002 SVS
    ! Масдай - отстой, Alt-F9 ему недоступно!!!
  04.03.2002 DJ
    ! Appli -> Apply
  03.03.2002 SVS
    ! Если для VC вставить ключ /Gr, то видим кучу багов :-/
  03.03.2002 SVS
    + ChangeBlockColor() - изменение цвета в блоке
    ! уточнение юникодовой таблицы
  13.02.2002 SVS
    ! Уборка варнингов
  08.01.2002 SVS
    - Бага с макросом, в котором есть Alt-F9 (смена режима)
    ! Обработаем коды символов 0x10 и 0x11
  26.12.2001 SVS
    ! При закрытии окна "по кресту"... теперь настраиваемо!
  24.12.2001 VVM
    ! При ожидании окончания регистрации отдаем время виндам...
  10.12.2001 SVS
    ! SetFarTitle() - уточнение для макросов (в режиме исполнения если стоит
      флаг MFLAGS_DISABLEOUTPUT не выставлять заголовок консоли)
  23.10.2001 SVS
    + WidthNameForMessage - 38% для размера усечения имени в месагах-процессах
  21.10.2001 SVS
    + PrevScrX,PrevScrY - предыдущие размеры консоли (для позиционирования
      диалогов)
  04.10.2001 SVS
    ! В SetFarTitle сначала сравним старое значение заголовка консоли,
      а уж потом выставим значение... Инача получаем моргание (при
      перетаскивании диалога, например)
  27.09.2001 IS
    - Левый размер при использовании strncpy
  30.08.2001 IS
    - Утечка ресурсов. Теперь при закрытии окна "по кресту" всегда говорим
      системе, что "разберемся сами", в противном случае Фар будет закрыт
      системой принудительно и не будут выполнены обычные при закрытии
      процедуры: оповещение плагинов, вызов деструкторов, сохранение настроек
      и т.п.
  25.07.2001 SVS
    - Бага с детачем - лишний раз инициализировали исходные значения
    ! Немного оптимизации в функциях отрисовки
  24.07.2001 SVS
    ! Немного оптимизации в функциях отрисовки
  06.07.2001 SKV
    - KeyQueue=NULL; в CloseConsole();
  04.07.2001 SVS
    ! BoxText может рисовать вертикальный сепаратор
  25.06.2001 IS
    ! Внедрение const
  08.06.2001 SVS
    + GenerateWINDOW_BUFFER_SIZE_EVENT()
  07.06.2001 SVS
    + "цветные часы" :-)
  06.06.2001 SVS
    ! W-функции юзаем пока только в режиме USE_WFUNC
  06.06.2001 SVS
    ! Добавлена перекодировочная таблица OEM->UNICODE
  23.05.2001 OT
    + Добавление опции "AltF9 - по старому"
  23.05.2001 SVS
    ! немного увеличим размеры локальных буферов для отрисовки (по мотивам
      Alt-F9)
  22.05.2001 tran
    ! по результам прогона на CodeGuard
  21.05.2001 OT
    - Исправление поведения AltF9
  06.05.2001 DJ
    ! перетрях #include
  06.05.2001 ОТ
    ! Переименование Window в Frame :)
  05.05.2001 DJ
    + перетрях NWZ
  29.04.2001 ОТ
    + Внедрение NWZ от Третьякова
  06.03.2001 SVS
   ! SetScreen() - размер строки 256 заменен на 4096 во избежании проблем
     в будущем (new или malloc делать не стоит, т.к. функция часто вызывается)
  27.02.2001 SVS
   + BoxText(Char) - вывод одного символа
   ! В MakeSeparator добавлена отрисовка двойной разделительной линии (Type=3)
  20.02.2001 SVS
   ! ShowSeparator - дополнительный параметр - тип сепаратора
   + MakeSeparator - создание разделителя в памяти
   ! Символы, зависимые от кодовой страницы
     /[\x01-\x08\x0B-\x0C\x0E-\x1F\xB0-\xDF\xF8-\xFF]/
     переведены в коды.
  14.02.2001 SKV
    ! параметр setpal в InitConsole.
  02.02.2001 VVM
    ! Переделал функции Text(...). Т.к. они вызываются очень часто,
      то основной вывод будет идти в Text(char *Str)
  24.01.2001 SVS
    + Инициализация клавиатурной очереди KeyQueue,
      размером  = 1024 кода клавиши
  22.01.2001 SVS
    ! Для FS & WM применяются 2 разных курсора - их параметры можно
      задавать через реестр.
  22.01.2001 SVS
    ! Проблемы с курсором при больших разрешениях - ставим тот курсор в
      SetCursorType, который был до запуска ФАРа.
  03.01.2001 SVS
    + Функции SetFarTitle, ScrollBar, ShowSeparator
      переехали из mix.cpp
  22.12.2000 SVS
    ! Перетасовка исходников
      IsMouseButtonPressed -> keyboard.cpp
      GetInputRecord -> keyboard.cpp
      CheckForEsc -> keyboard.cpp
      WriteInput -> keyboard.cpp
      WaitKey -> keyboard.cpp
      PeekInputRecord -> keyboard.cpp
      CalcKeyCode -> keyboard.cpp
    ! hConOut,hConInp - public статус -> global.cpp
  08.09.2000 SVS
    + KEY_CTRLSHIFTDEL, KEY_ALTSHIFTDEL в функции CalcKeyCode
  24.08.2000 SVS
    + Пераметр у фунции WaitKey - возможность ожидать конкретную клавишу
    + Добавление на реакцию KEY_CTRLALTSHIFTPRESS & KEY_CTRLALTSHIFTRELEASE
  23.08.2000 SVS
    + Код для средней клавиши мыши :-) (ну есть у меня дома эта хрень...)
  09.08.2000 KM
    ! Изменена MakeShadow таким образом, что теперь при достижении
      окном (диалогом) правой или нижней границы экрана и при выходе за неё
      тень продолжает рисоваться, что при нынешней идеологии движения окон
      более правильно.
  23.07.2000 SVS
    ! Немного оптимизации в функциях Box(), HiText() :-)
    + Клавиши (CalcKeyCode):
       Ctrl- Shift- Alt- CtrlShift- AltShift- CtrlAlt- Apps :-)
       KEY_LWIN (VK_LWIN), KEY_RWIN (VK_RWIN)
    + Text(int X, int Y, int Color, char *Str);
    + Text(int X, int Y, int Color, int MsgId);
  13.07.2000 SVS
    ! Некоторые коррекции при использовании new/delete/realloc
  11.07.2000 SVS
    ! Изменения для возможности компиляции под BC & VC
  06.07.2000 SVS
    - Временная отмена патча 11 (NT Console resize bug) до лучших времен :-)
  28.06.2000 tran
    - NT Console resize bug
      adding resize support in GetInputRecord for modal window like
      Viewer, Editor, Help
  25.06.2000 SVS
    ! Подготовка Master Copy
    ! Выделение в качестве самостоятельного модуля
*/
