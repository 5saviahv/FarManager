/*
Modify:
  04.07.2006 IS
    - warnings
  24.07.2005 WARP
    ! see 02033.LockUnlock.txt
  15.07.2005 AY
    - Убрал всё связанное с USE_OLDEXPANDTABS
  26.04.2005 SVS
    ! Под переменную "Путь" отводим стока, скока нужно, а не NM.
  24.04.2005 AY
    ! GCC
  06.04.2005 SVS
    + ECF_TAB1
  05.04.2005 SVS
    + У ScreenBuf::Read() появился доп параметр - скока читать.
    - правки после BugZ#1302
  24.03.2005 SVS
    - BugZ#1302 - Colorization problems when TABs are in text (ЧАСТЬ 2)
  22.03.2005 SVS
    - BugZ#1302 - Colorization problems when TABs are in text
  22.03.2005 WARP
    - BugZ#1297 Неверно устанавливался TabExpandMode для Edit'ов.
  28.02.2005 SVS
    - При потери окна фокуса Far, также выделение исчезает из строки.
  02.02.2005 SVS
    - BugZ#1246 - Макросы производящие манипулирование курсором не снимают выделение в полях ввода
  06.01.2005 WARP
    ! Добавки к трехпозиционному ExpandTabs
  23.12.2004 WARP
    ! 3-х позиционный ExpandTab (старая функциональность возвращается компиляцией с USE_OLDEXPANDTABS)
  17.12.2004 SVS
    - переделаем Edit::TabPosToReal, народ жалуется на падение ФАРа (что, в принципе, и так видно, что проверка на конец строки ведется после анализа '\t')
  11.11.2004 SVS
    + Обработка MCODE_V_ITEMCOUNT и MCODE_V_CURPOS
  11.11.2004 SVS
    ! Вместо кода "Вставить * путь" применена новая функция _MakePath1
  09.11.2004 SVS
    ! пока пробел не добавляем для Shift-Enter. Это будет сделано позже, по человече.
  04.11.2004 SVS
    ! сделаем однообразную обработку "modify-]", "modify-[" и Ctrl-[Shift-]Enter
  10.10.2004 KM
    - Bug #1131 (1165) - после исправления Bug #1122 привнесён баг с невозможностью
      выйти за пределы строки в редакторе при установленном Cursor beyond end of line.
  07.10.2004 SVS
    - BugZ1168 - В редакторе не работают длинные макросы
  06.08.2004 SKV
    ! see 01825.MSVCRT.txt
  07.07.2004 SVS
    ! Macro II
    ! В Edit::TabPosToReal и Edit::RealPosToTab добавим проверку на конец строки...
      (это про BugZ#1122 - При установленном Punto Switcher падает ввод в диалог)
  30.06.2004 SVS
    + Небольшая добавка по поводу Macro II (в "обычном" ФАРе не работает, т.к. ограничена дефайном MACRODRIVE2)
  14.06.2004 SVS
    + добавки MACRODRIVE2
  31.05.2004 SVS
    ! выкинем нафиг MCODE_OP_SENDKEY - ненужен
  29.05.2004 SVS
    - Bugz#794 - пометка блока остается при удалении текста
  24.05.2004 SVS
    - BugZ#1030 - множественная вставка из буфера обмена в окно поиска сигнатур
  22.04.2004 SVS
    - BugZ#1063 - Макросы в диалогах (недочет в пред.патче)
  14.04.2004 SVS
    - BugZ#1053 - Неточности в $Text
  12.01.2004 SVS
    ! Корректировка KEY_MACROSELWORD
  12.01.2004 IS
   - баг: неверно "скачем по словам", когда разделители слов содержат символы
     с кодами больше 128. Решение: для сравнения с WordDiv используем
     IsWordDiv, а не strchr
  15.12.2003 SVS
    - BugZ#1002 - ESPT_SETWORDDIV не влияет на переход по словам
  11.11.2003 SKV
    - shift-end в edit-е с выставленной максимальной
      длинной при максимальной заполненности
  26.10.2003 KM
    ! Уточнение копирования маскированной строки в клипборд.
    ! Скорректируем вставку из клипборда с учётом маски
  20.10.2003 SVS
    ! переименование
        KEY_MACRO_EDITSELECTED -> KEY_MACRO_SELECTED
    + Обработка KEY_MACRO_EMPTY, KEY_MACRO_EOF и KEY_MACRO_BOF
  20.10.2003 SVS
    ! Уточнение размера под вставку даты
  08.10.2003 SVS
    ! Первое исправления "для колорера"
    ! В Edit::Select() если обе компоненты == -1, сделам как
      в конструкторе.
  26.09.2003 SVS
    ! Переименование
      GetMacroPlainText        -> GetPlainText
      GetMacroPlainTextSize    -> GetPlainTextSize
    ! Изменения в названиях макроклавиш
  21.09.2003 KM
    ! Уточнения работы с маской.
    + Добавление EDMASK_HEX для ввода только шестнадцатиричных символов.
  17.09.2003 SVS
    - Неправильно "исправил" в прошлый раз вставку KEY_MACROPLAINTEXT и KEY_MACRODATE.
      не учел тот факт, что $Date может быть без аргументов
  12.09.2003 SVS
    ! Динамически выделим буфер при вставке Plain-text от макроса.
      Для этого воспользуемся новой функцией
      CtrlObject->Macro.GetMacroPlainTextSize(), чтобы получить
      размер строки.
  08.09.2003 SVS
    + Обработка KEY_MACROPLAINTEXT
  03.09.2003 SVS
    ! При откавычивании учтем биты QUOTEDNAME_
  25.08.2003 SVS
    + Opt.QuotedName - заключать имена файлов/папок в кавычки
  08.05.2003 SVS
    - При включенном UseNumpad KEY_SHIFTINS по поведению неравно KEY_SHIFTNUMPAD0
  21.01.2003 SVS
    + xf_malloc,xf_realloc,xf_free - обертки вокруг malloc,realloc,free
      Просьба блюсти порядок и прописывать именно xf_* вместо простых.
  11.12.2002 SVS
    - В ProcessCtrlQ полечим вариант события для KEY_CONSOLE_BUFFER_RESIZE
  05.12.2002 SVS
    ! Применим новую MkStrFTime(), сократив немного кода
  12.11.2002 DJ
    ! убираем лишнюю перерисовку в случае, когда позиция выделенного блока
      не изменилась
  04.11.2002 SVS
    ! Для ReturnAltValue не делаем енкоде для клавиши.
      Это позволяет Alt-212 всегда иметь в нужной кодировке
  16.10.2002 SKV
    - падение в DeleteBlock
  14.10.2002 SKV
    ! выделение
  17.09.2002 SKV
    - правка выделения
  04.09.2002 SVS
    ! У функции SetInputMask параметр имеет сущность const +
      небольшая оптимизация самой функции SetInputMask
  19.08.2002 SVS
    + EOL_TYPE_CHARS (с подачи IS)
  12.07.2002 SVS
    ! Не сбрасываем Unchanged-состояние в строках ввода для Ctrl-Ins
  04.07.2002 SKV
    - Bugz#512 - доделка :)
  02.07.2002 SKV
    - Bugz#512 - Tab+PersistentBlocks+Selection
  25.06.2002 SVS
    ! Косметика:  BitFlags::Skip -> BitFlags::Clear
  24.06.2002 SKV
    - Нельзя выделять за концом строки.
  06.06.2002 SVS
    ! коррекция вставляемого размера в Edit::SetBinaryString, если определен MaxLength
  24.05.2002 SVS
    + Дублирование Numpad-клавиш
  18.05.2002 SVS
    ! Возможность компиляции под BC 5.5
    ! ФЛАГИ - сведем в кучу двухпозиционные переменные
  29.04.2002 SVS
    - не туда залудил этот BugZ#488 (лишнее)
  29.04.2002 SVS
    - BugZ#488 - Shift=enter
  27.04.2002 SVS
    ! 8192 -> MAXSIZE_SHORTCUTDATA
  02.04.2002 SVS
    - BugZ#425 - DI_EDIT and DIF_SELECTONENTRY
  22.03.2002 DJ
    + обработка KEY_MEDIT_ISSELECTED
  18.03.2002 SVS
    ! Уточнения, в связи с введением Opt.Dialogs
  14.03.2002 SVS
    - Ctrl-V != Shift-Ins
    ! немного комментенного optimize (чтобы не забыть ;-))
  07.03.2002 SVS
    - BugZ#340 - edit association
      при вставке символа или куска из клипборда учтем максимальные
      размеры (если MaxLength != -1)
  04.02.2002 SVS
    ! Вызываем самостоятельную функцию IsShiftKey()
  28.01.2002 SVS
    ! Нда... уж... поспешил с предыдущим... было еще одно место, аналогичное
      BugZ#271 - вставка шортката. Да и коду развелось однотипного многовато...
    + ProcessInsPath() - вставка пути с учетом кодовой таблицы
  28.01.2002 SVS
    - BugZ#271 - Редактор: кодировка Shift-Enter
  21.01.2002 SVS
    - BugZ#258 - Alt-1...Alt-30
    + Возможность работы с курсором в диалогах.
  16.01.2002 SVS
    - BugZ#246 - RCtrl-Digit при неизменненом тексте.
  12.01.2002 IS
    ! внедрение const
  11.01.2002 SVS
    - Не квочились пути с пробелами при вставке.
  26.12.2001 SVS
    + Свой курсор для Overtype режима
  21.12.2001 SVS
    + KEY_MACROSELWORD
  21.12.2001 SVS
    - BugZ#187 - Ctrl-X не работает в диалогах
  14.12.2001 IS
    ! внедрение const
  07.12.2001 SVS
    - Неверно работал механизм масок при передаче (очистке) пустой строки.
      (а отсюда и бага BugZ#161)
  27.11.2001 DJ
    - устраняем memory allocation conflict для ColorList
  23.11.2001 SVS
    ! IsDialogParent может иметь 3 значения: EDPARENT_*
    + Вместо длинного "if(Mask[...)" введена функция CheckCharMask()
  15.11.2001 OT
    "Нормальное" исправление предыдущего исправления (бацилла 97)
  13.11.2001 SVS
    - Bug: Shift-F4 и ввести что-нить типа длиннее ширины строки ввода в диалоге.
  08.11.2001 SVS
    - BugZ#97: Недочет в диалогах копирования/переименования итд
  28.10.2001 SVS
    ! Приведем к одному знаманателю реакцию на вставку путей (то же как и
      в панелях)
  24.10.2001 SVS
    - Ну разве так можно? Иван и ты, апологет персистентных блоков (?) не
      заметил такой фигни? Для [Ctrl]ShiftEnter и Ctrl*Bracket блоки должны
      удаляться только(!) если они не постоянные.
  07.10.2001 VVM
    + CTRL+SHIFT+ENTER вставляет файл с пассивной панели.
  14.09.2001 SKV
    - при ctrl-q надо вызывать DeleteBlock, а не RecurseProcessKey(KEY_DEL); :)
  05.09.2001 SVS
    ! Для непостоянных блоков снимаем выделение
  31.07.2001 KM
    ! Для комбобокса сделаем отображение строки
      с первой позиции.
  24.07.2001 IS
    ! Замена проверки на ' ' и '\t' на вызов isspace
  19.07.2001 KM
    - Под NT курсор мигал.
  16.07.2001 KM
    - Борьба через ж*пу с глюком консоли w9x где при запуске
      некоторых досовых прог курсор приобретал "странный"
      внешний вид.
  10.07.2001 IS
    - Баг: в редакторе по ctrl-], ctrl-[, ctrl-shift-]  и ctrl-shift-[
      всегда вставлялась строка в кодировке OEM, даже если текущая кодировка
      была != OEM
  22.06.2001 SVS
    ! Устранены проблемы с Ctrl-Q - теперь кусок кода (для
      неперсистентных блоков) удаляется только в момент вставки символа
    ! Выкинут кусок кода по KEY_MACRO*
    + добавлена обработка KEY_MACRODATE
    + ProcessInsDate()
  08.06.2001 SVS
    - Бага при отрисовке строки с установленным ClearFlag - круто, блин,
      по всей отрисовке стоит контроль за размером, а тут на тебе
      "Text(&ShowStr[LeftPos]);" и хрен с ним :-(
  07.05.2001 SVS
    ! SysLog(); -> _D(SysLog());
  06.05.2001 DJ
    ! перетрях #include
  29.04.2001 ОТ
    + Внедрение NWZ от Третьякова
  13.04.2001 OT
    - Исправляет ситуацию (не до конца) с дерганьем строк в редакторе
  13.04.2001 SVS
    ! Обработка Ctrl-Q вынесена в отдельную функцию ProcessCtrlQ(), т.к.
      используется в editor.cpp
  21.02.2001 IS
    ! Opt.TabSize -> Opt.EdOpt.TabSize
      Opt.EditorPersistentBlocks -> Opt.EdOpt.PersistentBlocks
      Opt.EditorDelRemovesBlocks -> Opt.EdOpt.DelRemovesBlocks
  15.02.2001 IS
    ! Opt.EditorDelRemovesBlocks -> DelRemovesBlocks
      Opt.EditorPersistentBlocks -> PersistentBlocks
  14.02.2001 IS
    + За размер табуляции отвечает TabSize, а поэтому произведена замена
      "Opt.TabSize" на "TabSize"
  13.02.2001 VVM
    + Обработка SHIFT+SPACE
  23.01.2001 SVS
    + На всякий случай проверим Str в деструкторе при освобождении памяти
    ! В паре мест не освобождалась память :-((
  04.01.2001 SVS
    ! Недольшое безобразие с проникновением в "чужой огород" - дополнение 2 :-)
      Часы, минуты, секунды - в диалогах у нас плагины пока не работают :-(
  26.12.2000 SVS
    ! KEY_DTDAY   -> KEY_MACRODAY
      KEY_DTMONTH -> KEY_MACROMONTH
      KEY_DTYEAR  -> KEY_MACROYEAR
   21.12.2000 SVS
    + Обработка пвсевдоклавиш:
      KEY_DTDAY - текущий день месяца - "$Day"
      KEY_DTMONTH - текущий месяц - "$Month"
      KEY_DTYEAR - текущий год - "$Year"
   15.12.2000 OT
    - Исправление бага с (KEY_TAB && OverType)
   10.12.2000 tran & OT
    ! KEY_SHIFTBS изменен на KEY_CTRLSHIFTBS (tran)
    - Исправление бага с KEY_SHIFTTAB (OT)
   13.12.2000 SVS
    + Дополнительный параметр в функции  Xlat()
   10.12.2000 IS
    ! Обрабатываем при Xlat только то слово, на котором стоит курсор, или то
      слово, что находится левее позиции курсора на 1 символ
    - иногда не работала конвертация из-за того, что было SelStart==SelEnd
   25.11.2000 IS
    + Если нет выделения, то обработаем текущее слово. Слово определяется на
      основе специальной группы разделителей.
   15.11.2000 KM 1.23 (номер верный)
    + Функция KeyMatchedMask проверяет позволяемость символу
      быть введённым на основании заданной маски.
    ! Теперь Str не может быть длиннее маски и для Str задан параметр
      MaxLength, равный длине маски.
    - Исправлен баг со вставкой строки символов в строку с маской.
    ! Убрано разрешение ввода пробелов в цифровых масках.
    + Заработал CtrlDel в строках с маской.
   20.10.2000 SVS
    ! Уточнение для масок.
   16.10.2000 tran
    + если стоит MaxLength, из клипборда грузим не больше чем
      положено
   24.09.2000 SVS $
    + Функция Xlat - перекодировка по принципу QWERTY <-> ЙЦУКЕН
   18.09.2000 SVS
    - Для Mask - забыли скорректировать позицию :-)
   15.09.2000 SVS
    - Bug - Выделяем кусочек строки -> Shift-Del удяляет всю строку
           Так должно быть только для UnChanged состояния
   11.09.2000 SVS 1.19
    ! если Opt.DlgEULBsClear = 1, то BS в диалогах для UnChanged строки
      удаляет такую строку также, как и Del
   08.09.2000 SVS 1.18
    При UnChanget строки:
    ! Shift-Del - вырезание строки в буфер в строках редактирования
    ! KEY_BS так же как и KEY_DEL удаляет всю строку (опять же в строках
      редактирования в диалогах, в редакторе поведение KEY_BS как и прежде -
      удаление символа, без удаления блока).
   07.09.2000 KM
    - Исправление глюка при поиске по целым словам.
   24.08.2000 SVS
    ! У DropDowList`а выделение по полной программе - на всю видимую длину
      ДАЖЕ ЕСЛИ ПУСТАЯ СТРОКА
   23.08.2000 SVS
    - исправление глюкавости моих рук :-(((
   13.08.2000 KM
    + Функция GetNextCursorPos - вычисляет положение курсора в строке
      с учётом Mask.
    + Функция RefreshStrByMask - обновляет содержимое строки на основании маски
      ввода.
    ! Общие изменения, добавившие возможность работать в строке
      ввода по заданной маске, находящейся в переменной Mask.
   15.08.2000 SVS
    + У DropDowList`а выделение по полной программе - на всю видимую длину
   03.08.2000 KM
    ! В функцию Search добавлен входной параметр int WholeWords.
    ! Теперь в этой функции реализована возможность поиска целых слов.
   03.08.2000 SVS
    ! WordDiv -> Opt.WordDiv
   28.07.2000 SVS
    ! В функции ApplyColor() SelColor может быть и реальным цветом.
    + Переменная класса ColorUnChanged (для диалога)
    ! SetObjectColor имеет дополнительный параметр для установки ColorUnChanged
  26.08.2000 tran
    + DropDownBox стиль
  26.07.2000 SVS
    - Bugs #??
      В строках ввода при выделенном блоке нажимаем BS и вместо
      ожидаемого удаления блока (как в редакторе) получаем:
       - символ перед курсором удален
       - выделение блока снято
  13.07.2000 SVS
    ! Некоторые коррекции при использовании new/delete/realloc
  11.07.2000 SVS
    ! Изменения для возможности компиляции под BC & VC
  07.07.2000 SVS
    + Разграничитель слов WordDiv находится теперь в global.cpp и
      берется из реестра (общий для редактирования)
  04.07.2000 IG
    - в макросе сбрасывалось выделение до ShiftIns (bug8)
  03.07.2000 tran
    + обработка SHIFT_BS - удаление до начала строки
    - Bug #10 ( ^[,^], ShiftEnter не удаляли выделнный текст)
    + ReadOnly флаг
    + Ctrl-L переключает ReadOnly флаг
  25.06.2000 SVS
    ! Подготовка Master Copy
    ! Выделение в качестве самостоятельного модуля
*/
