/*
Modify:
  28.01.2006 WARP
    - В InitDialogObjects флаги для DI_LISTBOX и DI_COMBOBOX всегда только выставлялись,
      но никогда не менялись. Поэтому DM_SETDLGITEM работал некорректно. Смена флагов не влияла
      на элемент диалога.
  09.12.2005 SVS
    - Mantis#58 - символ-маска с кодом 0х0А - пропадает
  12.10.2005 AY
    - Клик мыши не работал на DI_TEXT с X2==0
  28.09.2005 SVS
    ! плевать на OLDSTYLE. Если флаг DIF_BTNNOCLOSE есть - не закрываем диалог по любому
  11.08.2005 WARP
    - Нельзя было получить нижний заголовок листа в диалоге
  04.08.2005 WARP
    - GetItemRect возвращал для текста те же координаты, что были введены пользователем.
      Если X2 был 0, то ткнуть в текст мышью было нельзя. Немного улучшил ситуацию.
  24.07.2005 WARP
    ! see 02033.LockUnlock.txt
  23.06.2005 WARP
    - Неправильно отрисовывались сепараторы, если диалог не влезал в экран.
  05.05.2005 WARP
    - Падал ACTL_GETWINDOWINFO при отсутствии в диалоге
      элемента из которого можно было бы сформировать имя окна.
  24.04.2005 AY
    ! GCC
  12.04.2005 SVS
    - AVB> - поля ввода: при удалении записи в истории (shift-del),
      AVB>   маркер переводится в первую строку, а не на следующую в списке.
  22.03.2005 SVS
    - BugZ#1303 - Падение, вроде как из за DM_CLOSE в DN_INITDIALOG
  27.02.2005 SVS
    - BugZ#1279 - Сочетание устанавливающие флажок в третье состояние не должно работать на обычных флажках
    - BugZ#1278 - Различное поведение Tab в раскрытом списке и раскрытом списке истории ввода
  17.02.2005 WARP
    - Накосячил в вертикальной границей контролов.
  15.02.2005 SVS
    - BugZ#1201 - Дискриминация списков в Dlg.ItemType
  08.02.2005 WARP
    ! Если X2 в DI_TEXT <= 0, то делаем ширину равной длине строки
  04.02.2005 WARP
    ! Вернул обработку сообщений диалога после DN_CLOSE
  04.02.2005 WARP
    ! Уточнения к X2 в DM_TEXT
  02.02.2005 SVS
    + DialogsOptions.CBoxMaxHeight - максимальный размер открываемого списка (по умолчанию=8)
  31.01.2005 SVS
    ! уточнение для "обрезания" :-)
  29.01.2005 WARP
    ! Небольшой cleanup (см. 01920.vmenu_dialog_cleanup.txt)
  29.01.2005 WARP
    ! X2, Y2 и границы диалогов - ширина/высота контрола больше не может превышать ширину диалога.
  23.01.2005 SVS
    - DM_SETCURSORPOS на Edit'ах в DN_INITDIALOG приводил к тому, что Edit отрисовывался до диалога.
  23.01.2005 WARP
    ! Пара гвоздей в Dialog'и (см. 01915.dialog.DN_CLOSE.txt)
  11.01.2005 SVS
    ! корректировка костыля для DI_TEXT
    - BugZ#1226 - CurPos и ItemCount в диалогах в полях ввода
  05.01.2005 SVS
    ! костыль для DI_TEXT
  05.01.2005 WARP
    - DN_EDITCHANGE от комбо-бокса приходило с ID не того элемента
  05.01.2005 WARP
    - BugZ#1213 Исправляем косяки с новым центрированием диалогов
  27.12.2004 WARP
    ! Сделал критические секции при практически всех вызовах Dialog & VMenu
  25.12.2004 WARP
    ! центрирование диалогов (подробнее см. 01894.DialogCenter.txt)
  15.12.2004 WARP
    - Dialog игнорировал LockRefreshCount. Проверяем LockRefreshCount в ShowDialog
  08.12.2004 SVS
    + Dlg.ItemCount, Dlg.CurPos
    ! обработка типа контрола вынесена из macro.cpp в dialog.cpp
  08.12.2004 WARP
    ! Патч для поиска #1. Подробнее 01864.FindFile.txt
  19.11.2004 SVS
    - воздействие мышкой на скроллбаре в результирующем диалоге поиска
      ...диалог закрывался после отпускания кнопки.
  11.11.2004 SVS
    + Обработка MCODE_V_ITEMCOUNT и MCODE_V_CURPOS
  06.08.2004 SKV
    ! see 01825.MSVCRT.txt
  05.08.2004 SVS
    + MCODE_V_DLGITEMTYPE
  02.08.2004 SVS
    - Bug: С какого-то перепоя при выборе итема из комбобокса в Edit помещались
      приаттаченные данные, но не лейбак.
  26.07.2004 KM
    - Падение в FindInEditForAC, если второй параметр HidtoryName==NULL. Сделана проверка.
  07.07.2004 SVS
    ! Macro II
  06.07.2004 SVS
    + MCODE_F_MENU_CHECKHOTKEY, CheckHighlights для Macro II
  19.05.2004 SVS
    - В продолжении BugZ#962 (мигание курсора на окне диалога плагина без элементов с фокусом ввода)
      При отрисовке только одного элемента (не фокусного) не был учтен тот факт,
      что фокусным элементом может быть DI_USERCONTROL
  11.05.2004 SVS
    ! для листа передадим в конструкторе this диалога и установим ItemID.
    - кривая обработка DN_LISTCHANGE - начиная с того, что... водим мышкой
      по листу, не меняя позиции в списке и... получаем туеву хчу DN_LISTCHANGE
  07.05.2004 SVS
    - BugZ#1053 - Неточности в $Text
  28.02.2004 SVS
    ! DLGEDITLILE_ -> DLGEDITLINE_
    + DIF_LISTNOCLOSE
    + DLGIIF_LISTREACTIONFOCUS и DLGIIF_LISTREACTIONNOFOCUS
    ! DM_LISTSETMOUSEREACTION: Param2=FARLISTMOUSEREACTIONTYPE - 3 значения.
  19.02.2004 SVS
    - Невозможно мышью сменить фокус между листами.
    ! Флаг DMODE_MOUSELIST ненужен, т.к. это была ошибка: управление реакцией
      должно быть на уровне элемента, а не всего диалога
  05.01.2004 SVS
    - если в диалоге не может быть получен заголовок окна Far (нет рамок), то не надо
      делать его (заголовок) пустым, пусть уж лучше там будет "{bla-bla} - Far"
    - горячие клавиши в листе лишь меняют текущий элемент, но никак
      не оповещают обработчик диалога о пользовательском выборе,
      поэтому нельзя выбрать нужный элемент и закрыть диалог,
      имитирую поведение меню
  18.12.2003 SVS
    - BugZ#997 - TechInfo. Отключение восприятие правой/левой кнопки мышы как команд закрытия окна диалога
    - некорректно работал DM_SETCHECK (для прорисовки)
    + автоматизация для DM_SETCHECK
  13.11.2003 SVS
    ! Временно исключим KEY_MACRO_SELECTED для DI_LISTBOX
  24.10.2003 SVS
    ! про диапазон макроклавиш
  23.10.2003 SVS
    ! Dialog::GetDialogTitle возвращает const
    + CRITICAL_SECTION CSection
    - Если заголовок диалога начинается с числа, то это число отрезается в
      заголовке окна Фара.
    - Нажатие клавиши Tab в диалоге с единственным элементом приводило к
      зависанию FAR.
    + поле FarDialogItem.Data для DI_LISTBOX используется как верхний заголовок листа
    + В качестве заголовка консоли принимается заголовок списка (DI_LISTBOX),
      если в диалоге нет рамок и список первый элемент.
  15.10.2003 KM
    ! DN_HOTKEY будем посылать всегда в обработчик диалога
    ! Избавимся от кучи warning'ов
  03.10.2003 SVS
    - BugZ#962 - мигание курсора на окне диалога плагина без элементов с фокусом ввода
  25.09.2003 SVS
    ! KEY_MACROXLAT переименован в KEY_MACRO_XLAT
      KEY_MEDIT_ISSELECTED -> KEY_MACRO_EDITSELECTED
  25.07.2003 SVS
    ! учтем новые коды возврата для KeyMacro::GetCurRecord()
    - в предыдущем патче нужное закомментировал ;-)
  15.06.2003 SVS
    - при центрировании (флаг DIF_CENTERGROUP) Type=DI_RADIOBUTTON получаем
      чудную кашу на экране
    + DN_DRAWDIALOGDONE - приходит после отрисовки диалога
    ! Отрисовка салазок вынесена из DN_DRAWDIALOG в DN_DRAWDIALOGDONE (в DefDlgProc)
  30.05.2003 SVS
    - "...даже не знаю, баг или фича. Если нажать кнопку мыши в пределах
       диалога и, не отпуская её, протянуть мышь за его пределы и отпустить,
       то FAR ведет себя так, как если бы мы просто кликнули за пределами
       диалога, т.е. при "левом" нажатии - молча закрывает, а при "правом" -
       "нажимает" дефолтную кнопку.
         IMHO поведение не совсем очевидное. Юзеры часто "накалываются" на
       этом, пытаясь мышью выделить блок в строке ввода в диалоге..."
  28.05.2003 SVS
    ! Opt.EdOpt.PersistentBlocks -> Opt.Dialogs.EditBlock
  19.05.2003 SVS
    + Про выделения в строках ввода.
    + Добавка к DialogItem - SelStart, SelEnd. Отвечают за сохранение
      параметров выделения в строках редактирования
  06.05.2003 SVS
    + Проверка в конструкторе на IsBadCodePtr((FARPROC)DlgProc)
  16.04.2003 SVS
    + DM_GETSELECTION и DM_SETSELECTION.
  27.02.2003 SVS
    - BugZ#813 - DM_RESIZEDIALOG в DN_DRAWDIALOG -> проблема: Ctrl-F5 - отрисовка только полозьев.
      Убираем вызов плагиновго обработчика.
  25.02.2003 SVS
    ! "free/malloc/realloc -> xf_*" - что-то в прошлый раз пропустил.
  25.02.2003 SVS
    - BugZ#811 - Зависание при невозможности загрузить плуг
  22.02.2003 SVS
    - BugZ#806 - Strange crash
      Пытаюсь при загрузке плагина (setstartupinfo) пополнить историю диалога с
      помощью приаттаченого кода, ФАР падает при наличии DM_CLOSE.
  21.02.2003 SVS
    - неверные цвета для DI_SINGLEBOX и DI_DOUBLEBOX.
  12.02.2003 SVS
    ! не отдаем макроклавиши (для них маска 0x00C00000) в обработчик плагина.
  10.01.2003 SVS
    - "Почему место в диалоге параметров поиска, где выбирают
       кодировку (Using character table), в которой искать, сразу после
       открытия диалога имеет цвет Dialog->Text input, когда как в четвертой
       бете имело цвет Dialog->Unchanged text input?"
  27.12.2002 SVS
    - Enter в DI_COMBOBOX не срабатывал, т.к. обрабатывался в коде обработки DIF_EDITOR`а
  10.12.2002 SVS
    ! Добавим LockScr - плавнее отрисовка!
  10.12.2002 SVS
    ! Уточнение для DI_COMBOBOX: DIF_EDITOR == DIF_LISTNOAMPERSAND!
  04.11.2002 SVS
    - BugZ#691 - теперь у скрытого ListBox (как в принципе и у любого скрытого
      контрола) самовольно изменяются координаты.
    - Dialog: При перемещении курсора нефига отрисовывать весь диалог.
      Достаточно текущего контрола.
  28.10.2002 SVS
    - BugZ#691 - USERCONTROL вместе с LISTBOX
  27.10.2002 DJ
    ! переименуем FarListColors.ColorItem в ColorCount (чтобы было понятно,
      что к чему)
  17.10.2002 SVS
    + Добавим в Do_ProcessNextCtrl() параметр про принудительную
      прорисовку 2 элементов (старого и нового)
    - Бага с прорисовкой DIF_EDITOR - видно в UserMenu, когда в начале
      первой строки жмем Enter - прорисовывается только 2 строки.
  16.10.2002 SKV
    - баги в выделении при автокомплите, в связи с изменениями в Edit
  10.10.2002 SVS
    - BugZ#661 - DI_CHECKBOX&DefaultButton
  04.10.2002 SVS
    - BugZ#666 - Неразбериха с цветами
    + VMENU_DISABLED - говорит о том, что ВЕСЬ список (как элемент диалога) заблокирован
    - BugZ#668 - Не работат шорткаты если фокусе у DI_USERCONTROL
    - BugZ#669 - Если вручную делать DM_SETCHECK группе Радио-кнопок...
  01.10.2002 SVS
    - Стандартные цвета листбокса.
  30.09.2002 SVS
    ! SelectFromComboBox имеет первый параметр типа struct DialogItem
    - BugZ#659 - двигаем FDLG_NODRAWSHADOW
    ! полностью переписываем поведение DN_CTLCOLORDLGLIST
    - траблы с DM_ENABLEREDRAW
  23.09.2002 SVS
    - BugZ#652 - Узкая консоль и DialogEx
    + DialogItem имеет IFlags - для внутренних нужд.
    ! Для DI_CHECKBOX и DI_RADIOBUTTON... если Text == "", то лишний
      пробел не рисуем
  20.09.2002 SVS
    - BugZ#648 - Проблемы в диалоге выбора цветов.
    ! Предобработка KEY_ENTER в DI_LISTBOX
    + флаги DMODE_NODRAWSHADOW и DMODE_NODRAWPANEL
  17.09.2002 SVS
    ! Если у DI_SINGLEBOX (DI_DOUBLEBOX) координаты X1==X2 или Y1==Y2, то
      рисуется соответствующая линия (вертикальная или горизонтальная)
    ! Если у DI_SINGLEBOX (DI_DOUBLEBOX) указан флаг DIF_SETCOLOR, то
      младший байт позволяет задавать первоначальный цвет _рамки_.
  10.09.2002 SVS
    - BugZ#628 - Неправильная длина редактируемого текста.
    - BugZ#626 - User Menu hotkey bug
      В Dialog::ClearDone() добавим "ExitCode=-1", т.к. в предыдущих
      патчах менялся Dialog::Process() - это про BugZ#601.
      Если ЭТОГО не сделать, то ClearDone() бесполезна - т.е. видим BugZ#626
    ! Из обработчика ProcessKey куски кода выносятся в отдельные функции
    ! Там, где есть нечто вроде ProcessKey(KEY_ENTER), заменяется на
      вызов соответствующей функции
    ! Минимизируется количество прорисовок, например:
      при смене фокуса с одно элемента на другой (банальный Tab) диалог
      перерисовывается _ПОЛНОСТЬЮ_!!! Кому это надо? Правильно, ни кому.
      Посему будут прорисовки только этих двух элементов.
    ! Проблемы с фокусом ввода.
      Вызывается обработчик, например, для DN_KEY. Но в это время плагин
      меняет фокус и... но все равно кей попадает в старый элемент, а не
      в том, куда плагин установил фокус.
    ! и прочааааяяя, прочая, прочая....
  31.08.2002 SVS
    - Бага с DM_USER - нужно отдать его плагиновому обработчику AS IS
  27.08.2002 SVS
    - BugZ#601 - DM_CLOSE из DN_INITDIALOG не срабатывает.
  17.08.2002 SVS
    ! Обработка CtrlDown вынесена из обработчика клавиатуры в отдельную
      функцию ProcessOpenComboBox, т.к. вызов ProcessKey(KEY_CTRLDOWN)
      из мышиного обработчика приводит к побочным отрицательным эффектам
    - Если DI_COMBOBOX заполнялся в DI_INITDIALOG, то выбор из такого
      списка невозможен.
    - Уточнение для DI_FIXEDIT размером в 1 символ - траблы однако
  07.08.2002 SVS
    - BugZ#584 - Обрезается вставляемый из клипборда текст.
  12.07.2002 SVS
    - При жмакании Enter нужно прервать цикл после нахождения первого
      дефолтного элемента
  25.06.2002 SVS
    ! Косметика:  BitFlags::Skip -> BitFlags::Clear
  10.06.2002 SVS
    + DIF_EDITPATH - соответственно длина поля ввода выставляется в NM-1
      вместо 511
  09.06.2002 KM
    - Баг при конвертации DialogData в FarDialogItem, что
      явно проявилось в S&R в виде невозможности запустить поиск.
  06.06.2002 KM
    - Изничтожена несовместимость DM_GETTEXT с билдом 1282.
    - Убрано ограничение в 1024 байта на длину получаемой
      при помощи DM_GETTEXT строки.
    - Удавлено падение фара при работе DI_EDIT с флагом
      DIF_VAREDIT с сообщениями DM_[G|S]ETTEXT
  04.06.2002 SVS
    + DIF_CENTERTEXT
    + DIF_NOTCVTUSERCONTROL, если флаг не установлен - вызываем PutTextA
      (с конвертацией)
  02.06.2002 SVS
    - Проблема с unchanged так и осталась - после посылки DN_KEY проверим
      состояние элемента (могло изменится плагином в обработчике)
    - DM_LISTSETDATA возвращает 0, если ему не приходится выделять память
      (т.е. размер <= 4). Это как-то не соответствует букве закона. По
      энциклопедии 0 - ошибка.
      Вернем "4" в этом случае.
  31.05.2002 SVS
    - BugZ#412 - bug в combobox'ах
      (при изменении размеров листа добавим вызов функции VMenu::SetMaxHeight)
  28.05.2002 SVS
    - BugZ#532 - Alt-256  = '\0' в строках ввода
      Символ 0x00 не будет участвовать в автокомплите, ибо...
      все завязано не на "память", а на "строка".
  24.05.2002 SVS
    + Дублирование Numpad-клавиш
  18.05.2002 SVS
    - DM_LISTADDSTR возвращал неверную инфу - не добавляемый индекс, а
      сколько всего в списке было, в принципе достаточно вычесть единицу...
  18.05.2002 SVS
    ! OwnsItems -> DMODE_OWNSITEMS
    ! Edit::ReadOnly и Edit::DropDownBox - юзачем через функции.
  16.05.2002 SVS
    - При отрисовки для DI_VTEXT была неопределена переменная LenText
  15.05.2002 SVS
    ! Вместо Edit юзаем новый класс DlgEdit
  11.05.2002 SVS
    ! Удаляем LIF_UPDATEKEEPUSERDATA
  08.05.2002 SVS
    ! Сделаем относительным FocusPos (иначе, плагин, применив что-то в
      обработчике... в общем, некоректная работа получается :-)
    - Некорректная работа DM_SHOWITEM - DM_SHOWITEM (false) фокус выставляется
      на первый возможный элемент
  06.05.2002 SVS
    - BugZ#497 - CAS & Redraw
    + InitDialog() - инициализация диалога. Инициализируется в Process()
      или самостоятельно, но до вызова Show()
    ! Для DM_CLOSE в Dialog::CloseDialog() вызовем Hide(), так будет
      правильнее.
    ! В Show() и Hide() сначала проверим на "Инициализирован ли диалог?"
  05.05.2002 SVS
    - попытка установить фокус на нефокусный элемент - удачна :-(
    - прячем фокусный элемент - а на экране фиг знает что :-(
  29.04.2002 SVS
    ! Исключим обработку BugZ#488 для DI_BUTTON (иначе Shift-Del Enter
      не срабатывает - Shift, при этом не успевает отжаться :-)))
  29.04.2002 SVS
    - BugZ#488 - Shift=enter
    - BugZ#490 - Проблема радиокнопками.
    + ProcessRadioButton
  28.04.2002 KM
    ! Для комбобокса установим флаг VMENU_COMBOBOX, что
      позволит менеджеру отличить его от обычного меню.
  26.04.2002 SVS
    - BugZ#483 - DN_EDITCHANGE для DI_COMBOBOX с DIF_DROPDOWNLIST
    - BugZ#484 - Addons\Macros\Space.reg (про заголовки консоли)
  23.04.2002 SVS
    - BugZ#471 -  Focus
  22.04.2002 KM
    - Убрана потерявшая свою актуальность функция OnDestroy.
      Этим убит неприятный баг у двух диалогов в панелях:
      После ресайзинга консоли у диалога перед его уничтожением
      убивался ShadowSaveScr, что приводило к невосстановлению
      под одним исходного изображения.
  20.04.2002 KM
    - Необходимо залочить прорисовку при DM_SHOWDIALOG=FALSE,
      в противном случае ОТКУДА менеджер узнает, что отрисовывать
      объект нельзя!
  15.04.2002 SVS
    - BugZ#418 - мерцание окна "Предупреждение" при удалении
      Заодно уберем холостой ход: (DN_DRAGGED,0) посылается только если было движение
    - Размеры подкачали (когда требуем полные координаты - получаем на 2 меньше)
  10.04.2002 SVS
    ! BugZ#453 - Обрезание длинных строк в диалогах.
  08.04.2002 SVS
    - BugZ#446 - unchanged в строках ввода
    + CtlColorDlgItem() - отделим мух от котлет. В CtlColorDlgItem()
      производим все "вычисления" цветов контрола
  06.04.2002 KM
    - Не помню, на кой хрен я в прошлый раз уменьшал на 1 ширину
      и высоту диалога, но по моему именно это вызывало эффект
      дёргания диалога, на который жаловались юзеры в саппорте.
      Также это приводило к различному центрированию диалога при
      его инициализации и AltF9 AltF9 - диалог сдвигался вниз.
  05.04.2002 SVS
    - BugZ#428 - Long titles in dialogs
    - BugZ#427 - Выход мышью
  03.04.2002 SVS
    + DN_ACTIVATEAPP - При потере/получении фокуса консольным окном...
    - В SendDlgMessage была полная лабуда при Param1 < 0... короче, бага.
  02.04.2002 SVS
    - BugZ#416 - Listbox with DIF_LISTNOBOX does not work correctly
  01.04.2002 SVS
    - DN_CLOSE два раза приваливало, когда жмакали на пимпу.
    + При потере/получении фокуса консольным окном произведем уведомление
      обработчика о столь радостном событии.
    - BugZ#388 - DI_EDITCHANGE
       Есть подозрение, что DI_EDITCHANGE посылается даже для
       таких безобидных команд, как Ctrl-Ins.
  26.03.2002 SVS
    * проблемы с цветами в строках ввода - конфликт между unchanged и disabled.
   .! В строках ввода в диалоге для клавишь IsNavKey() не кидаем
      эвент DN_EDITCHANGE.
  22.03.2002 SVS
    - strcpy - Fuck!
  20.03.2002 DJ
    + обработка KEY_MEDIT_ISSELECTED для корректной работы флага
      [x] Selection exists в диалоговых макросов
  18.03.2002 SVS
    - Блин, перелудил с курсором :-(
    ! Уточнения, в связи с введением Opt.Dialogs
  18.03.2002 SVS
    ! Сепаратор должен быть цвета рамки, а не текста.
    ! Бадяга про курсор - там где нужно гасить, выставлялася 1
  12.03.2002 SVS
    - Для DM_SETMOUSEEVENTNOTIFY - в доках одно, в коде совсем по другому :-(
    - BugZ#351, BugZ#352 - куски кода, ответственные _только_ за диалог
      перемещены в Dialog::SendDlgMessage() чуууток повыше (перед проверкой
      Param1 > ItemCount)
  12.03.2002 SVS
    - Пропала история.
  11.03.2002 SVS
    !  Для DI_COMBOBOX и DI_LISTBOX если Param.Selected > 0x2000, то
       обнулим его (иначе... это не есть правильно)
  27.02.2002 SVS
    ! LIFIND_NOPATTERN -> LIFIND_EXACTMATCH
  26.02.2002 SVS
    - BugZ#325 - FDLG_SMALLDIALOG не работает
  23.02.2002 DJ
    - не перерисовывалось меню после DM_LISTDELETE (NULL)
    - еще немного корректировок позиций
    - DM_LISTGETTITLES не мог правильно вернуть оба заголовка
    - не было перерисовки после DM_LISTSETTITLES
  21.02.2002 SVS
    ! Проверим фрейм на NULL в OnDestroy().
  21.02.2002 DJ
    ! корректная отрисовка списков, не имеющих фокуса
    + скорректируем позицию после DM_LISTADD и DM_LISTSET
  13.02.2002 SVS
    ! Первый параметр у IsKeyHighlighted() - const
  11.02.2002 SVS
    ! Уточнение типа Param2 у DM_LISTUPDATE - должен быть типа FarListUpdate
    ! При выходе из диалога юзается ListPosвместо ListItems
  11.02.2002 SVS
    + DM_LISTGETDATASIZE
    ! dialog.cpp::MsgToName() - syslog.cpp::_DLGMSG_ToName()
    - Падение при поиске - забыл проверить CurItem->ListItems на NULL
    - BugZ#294. Колесо, блин... не работало в списках.
  04.02.2002 SVS
    ! Первая попытка "урегулировать отношения" диалога с редактором в плане
      DIF_READONLY
    ! По поводу "невозвратов" информации о списках после возврата из диалога
  30.01.2002 DJ
    ! DM_SETLISTMOUSEREACTION -> DM_LISTSETMOUSEREACTION
  21.01.2002 SVS
    + Добавлены 2 месага - DM_SETCURSORSIZE/DM_GETCURSORSIZE. Работают с
      редакторами и UserControl
    ! Изменены данные для UserControl
  16.01.2002 SVS
    ! DIF_NOFOCUS шалит
  08.01.2002 SVS
    + DM_SETLISTMOUSEREACTION
    ! Неверно учитывался размер диалога (для примера - S&R имеет высоту 25 строк)
  03.01.2002 SVS
    ! Уточнение для обрезания заголовков в DI_SINGLEBOX.
  28.12.2001 SVS
    ! Правка с учетом изменений структур (про анонимный union)
  28.12.2001 SVS
    ! Уточнение для обрезания заголовков в DI_SINGLEBOX.
  21.12.2001 SVS
    - Если DI_LISTBOX был не в фокусе, то... все равно гад реагировал на мышу.
    ! (unsigned char) -> (short)
  19.12.2001 SVS
    ! Раз уж пред.патч влез в область клиппинга, то... сделаем это самое
      отсечение для максимального количества элементов (читай - не для всех).
  17.12.2001 KM
    ! Пусть диалог сам заботится о ширине собственного заголовка.
      > IS "Если ввести слишком длинную маску, то она рисуется за краями
      диалога. TruncStr забыл что ли сделать?"
  12.12.2001 SVS
    - BugZ#172 - unchanged & history
  10.12.2001 SVS
    - Бага для KEY_SPACE+DI_RADIOBUTTON - переменная не инициализировалась
    ! DM_SETREDRAW=DM_REDRAW, DM_SETTEXTLENGTH -> DM_SETMAXTEXTLENGTH,
      DM_LISTGET -> DM_LISTGETITEM
    + struct FarListGetItem для DM_LISTGETITEM
  09.12.2001 DJ
    ! косметика в Dialog API:
      - проверять валидность ID элемента для DM_KEY и юзерских мессаг не надо!
      - DM_SETDROPDOWNOPENED неприменим к DI_PSWEDIT
      - обработка DIF_USELASTHISTORY вынесена в отдельную функцию
  07.12.2001 SVS
    ! Небольшая оптимизация кода
    - Бага в GetDialogObjectsData() - для DI_LISTBOX кусок не работал, т.к.
      у него нету ObjPtr
  07.12.2001 IS
    ! флаг DIF_EDITOR не сбрасывается также для DI_FIXEDIT и DI_PSWEDIT
      (теряли совместимость со старым api)
  04.12.2001 SVS
    ! забыли отцентрировать кпопки (DIF_CENTERGROUP) после расширябильности
  04.12.2001 SVS
    ! сбросим флаг DIF_EDITOR для строки ввода, отличной от DI_EDIT
  03.12.2001 SVS
    ! Уточнение работы DM_SETHISTORY: для DI_EDIT с флагом DIF_USELASTHISTORY
      ФАР сам подставит Line0 из истории, при условии, что строка ввода пуста.
  01.12.2001 KM
    + DM_LISTSET - новое сообщение, отличается от DM_LISTADD тем, что
      если в списке есть строки, то сначала удалим их, т.с. "чистая"
      установка.
  28.11.2001 SVS
    ! DM_EDITCLEARFLAG заменен на более корректное DM_EDITUNCHANGEDFLAG
    ! Закрыта небольшая лазейка для все того же clearflags.
  28.11.2001 SVS
    + DM_EDITCLEARFLAG - управление состоянием флага ClearFlag редактора
  27.11.2001 DJ
    - memory leak
  27.11.2001 SVS
    ! небольшое уточнение при DM_SETTEXT - не вызывать InitDialogObjects()
      для строковых редакторов
  23.11.2001 SVS
    - Бага - если в singleline есть 0x0A или 0x0D, то... в общем не
      выводятся они
  23.11.2001 VVM
    ! Раз уж мы наследники фрейма, неплохо бы посмотреть на лок прорисовки
  21.11.2001 SVS
    + Автоматизация (часть I - для внутренного использования).
    + DM_GETITEMDATA, DM_SETITEMDATA
  15.11.2001 SVS
    - уточнение для DI_COMBOBOX - здесь еще и Edit нужно корректно заполнить
  14.11.2001 SVS
    ! DN_EDITCHANGE: Path#1047:
      "...Уточнение повендения DN_EDITCHANGE при выборе из истории..."
      "...баг прибит в лучших традициях прогрАммерского искусства, те
      наполовину :). почему отмена выбора ESC'ом в комбобоксе все равно
      генерит DN_EDITCHANGE?..."
      Блин,  урод он. Так бы и говорил,  что это про COMBOBOX.
  12.11.2001 SVS
    ! Уточнение по поводу поведения DN_LISTCHANGE (в т.ч. прорисовка во время
      открытого комбобокса)
    ! Уточнение повендения DN_EDITCHANGE при выборе из истории
    ! Уточнение поведения DIF_SELECTONENTRY
  09.11.2001 SVS
    - Падение при раскрытии комбобокса с количеством итемов = 0
  08.11.2001 SVS
    + IsDialogParent - а родитель у нас кто для строк редактирования?
    ! Добавка в виде BitFlags - управление флагами текущего режима диалога
  06.11.2001 SVS
    ! DM_LIST[G|S]ETTITLE -> DM_LIST[G|S]ETTITLES
    - BugZ#36: проблемы с перерисовкой истории после записи макроса
      откройте диалог с  историей,  например,  alt-f7,  откройте  историю
      (ctrl-down), запишите  макрос,  после  назначения  горячей  клавиши
      история как бы пропадает, видны только ее ошметки, если  понажимать
      вверх/вниз, то появляются прочие куски истории
      Сделано через одно место :-( Но работает.
  04.11.2001 SVS
    ! Если DropDown теряет фокус, то не будем отображать его как селектед.
  02.11.2001 SVS
    ! DM_SETNOTIFYMOUSEEVENT -> DM_SETMOUSEEVENTNOTIFY
    ! Выкинем ненужный код (а кое-где добавим :-))
  29.10.2001 SVS
    ! DM_RESIZEDIALOG возвращает новый размер!
  23.10.2001 SVS
    ! FarListTitle -> FarListTitles
    ! Эксперимент - в ProcessMouse делаем обход контролов с конца на начало,
      т.е. учитываем (как бы) Z-order (IMHO так будет вернее, но чем черт
      не шутит)
  21.10.2001 SVS
    ! вызов CALLBACK-функции (в месаге DN_RESIZECONSOLE) перемещен в "нужное место"
    ! Изменена логина добавления в историю:
      "если в истории есть строка, равная без учета регистра той,
      которую добавляем, то удалить старую строку и добавить новую".
      (на самом деле, просто добавляем не оригинал, а добавляемую строку!)
  18.10.2001 SVS
    + DIF_SEPARATOR2 - двойной сепаратор
    + вызов CALLBACK-функции (в месаге DN_RESIZECONSOLE)
      для избавления от BugZ#85
  15.10.2001 SVS
   + _DIALOG - для трассировки сообщений и событий в диалогах.
  15.10.2001 SVS
   ! BugZ#71: "Если "редактор" имеет флаг DIF_NOFOCUS..." - Неверно было
     сделано исправление от 10.10.2001. Теперь все верно - всегда в таком
     случае кажем Unchanged-цветом
  15.10.2001 SVS
   ! if Opt.DlgSelectFromHistory == 0 then (ctrl-down в строке с историей
     курсор устанавливался на самую верхнюю строку)
   - "Если в истории диалоги все 64 элемента залочены..."
  10.10.2001 SVS
   ! Если "редактор" имеет флаг DIF_NOFOCUS, то показывать его нефокусным
     цветом (BugZ#71)
  08.10.2001 SVS
   - Неверно рассчитывались координаты элементов DI_TEXT & DI_VTEXT
  04.10.2001 SVS
   ! УБЕДИТЕЛЬНАЯ ПРОСЬБА!!!
     Функции Dialog::DefDlgProc и Dialog::SendDlgMessage должны быть всегда
     в конце этого файла. Если что-то добавлять - то перед Dialog::DefDlgProc()
     Обоснование: Мне так удобнее ;-)
   - DN_GOTFOCUS -> DM_SETFOCUS - получаем цикл с падением
  04.10.2001 SVS
   - Для DI_USERCONTROL не высвечивался курсор
  27.09.2001 IS
   - Левый размер при использовании strncpy
  16.09.2001 SVS
   ! Отключаемые исключения
  08.09.2001 VVM
   + Использовать Opt.DialogsEditBlock для строк ввода
  05.09.2001 SVS
   - Горячая клавиша, фокус ввода становится, но прорисовка не идет :-((
  30.08.2001 VVM
   + Для обычных строк отрубим постоянные блоки
  15.08.2001 SVS
   + DN_MOUSEEVENT, DM_SETNOTIFYMOUSEEVENT, DMODE_MOUSEEVENT
  13.10.2001 SVS
   - Если у элемента X2 < X1, то ФАР отжирает кучу памяти и сваливается в пике.
  11.10.2001 KM
   - Ещё одно уточнение при ресайзинге, с учётом предполагаемого
     выхода краёв диалога за границу экрана.
  10.08.2001 KM
   - Неправильно работал DM_RESIZEDIALOG. Заметил когда делал
     ресайзинг Alt-F7 при изменении размеров консоли.
   - В SetItemRect неверно выставлялся X1 в 0 при переданном
     параметре -1 (центрировать строку).
  08.08.2001 SVS
   + DM_GETITEMPOSITION
  07.08.2001 SVS
   + DN_RESIZECONSOLE
  06.08.2001 SVS
   ! DM_GETTEXTLENGTH возвращает размер строки без учета '\0'
   ! заголовок ФАР меняет только если DM_SETTEXT был вызван для
     соответствующих элементов (SetFarTitle(Dlg->GetDialogTitle()))
   ! Проверка на видимость диалога (будет полезна в следующих патчах,
     когда манагер будет вызывать Hide() диалога - для Alt-F7+CAS)
   ! Немного скорректированы цвета для строки редактирования (2IS: проверь
     на себе)
  05.08.2001 SVS
   ! Перетрях в математике добавления истории (Dialog::AddToEditHistory)
   - Бага с селекшинами при выборе из хистори.
   ! DM_GETTEXTLENGTH корректно возвращает размер текущего итема для DI_LISTBOX
   ! Изменилось поведение DI_RADIOBUTTON
       Param2 = 0|1 - включен или выключен
  05.08.2001 SVS
   - Проблемы с хелпом в диалогах из-под плагинов.
   ! Отрисовка(?) после DI_EDITCHANGE
   - Ctrl-Enter или Enter при задисабленной дефолтовой кнопке
  01.08.2001 SVS
   + Новая идеология создания топика - пусть об этом позаботится ядро Help`а
  27.07.2001 SVS
   + DM_ALLKEYMODE - для нужд MacroBrowse (пока только для него :-)
  26.07.2001 SVS
   ! VFMenu уничтожен как класс
  24.07.2001 SVS
   ! Учтем новую опцию Opt.Confirm.HistoryClear при очистки истории
  23.07.2001 OT
   - Исправление отрисовки меню в новом MA в макросах
  23.07.2001 VVM
   + При удалении строки из истории курсор оставлять на месте.
   + При очистке истории спросить об этом пользователя.
  23.07.2001 SVS
   ! DIF_SEPARATOR пока не обрабатываем для DI_VTEXT
  23.07.2001 SVS
   - Не освобождалась память, занятая под списки в DeleteDialogObjects()
  22.07.2001 SVS
   ! Пересмотрены параметры функции SelectFromComboBox() - ведь и так
     передаем указатель аж на цельный класс строки, так что...
  18.07.2001 OT
   !  VFMenu
  16.07.2001 SVS
   + DM_SETHISTORY - управление историей
  12.07.2001 OT
   - Исправление ситуации (после 816) F11->F4->Esc-> :(
  11.07.2001 OT
   ! Перенос CtrlAltShift в Manager
  10.07.2001 SVS
   + Обработка KEY_MACROXLAT
  09.07.2001 OT
   - Исправление MacroMode для диалогов
  04.07.2001 SVS
   + DIF_SEPARATOR для DI_VTEXT
   + {-1,-1} для DI_VTEXT
  04.07.2001 SVS
   - XLat в строках ввода - не снималось состояние Unchanged
   - Немного проверок...
  02.07.2001 KM
   - Избавимся от потенциального (и кажется не только) бага
     при Param1==-1 в SendDlgMessage (в основном) и DefDlgProc.
   - Убраны некоторые ворнинги об неиспользуемых переменных.
  30.06.2001 KM
   ! LIFIND_NOPATTER -> LIFIND_NOPATTERN
   ! DM_LISTGETCURPOS: Param2 содержит указатель на FarListPos.
   ! DM_LISTSETCURPOS: Param2 содержит указатель на FarListPos.
   ! Подадим сообщение DN_LISTCHANGE в ProcessMouse на DI_LISTBOX.
  29.06.2001 SVS
   - Бага - двое добавление первоначальных данных в комбобокс
   + ЗАКОММЕНЧЕНО: Во время навигации в открытом боксе (дропдовн)
                   отображаем это в связанной строке редактирования
                   (медленно! :-(
   ! Проблемы с выбором из комбобокса
  26.06.2001 KM
   ! Подадим перед DM_LISTSETCURPOS сообщение DN_LISTCHANGE.
  26.06.2001 SVS
   ! __except -> EXCEPT
  26.06.2001 KM
   - Не работал клик на скролбаре в DI_LISTBOX.
  23.06.2001 KM
   - Не снимался признак активности комбобокса если с него
     уходили мышкой на DI_EDIT.
   + DM_GETDROPDOWNOPENED - определить, открыт ли в диалоге комбобокс или хистори.
   + DM_SETDROPDOWNOPENED - открыть или закрыть программным путём комбобокс или хистори.
  20.06.2001 SVS
   - "функция DM_GETTEXTLENGTH возвращает 0 длину для всех DI_EDIT"
  19.06.2001 SVS
   + DN_DRAGGED
  19.06.2001 SVS
   ! Операция автозавершения не работает во время записи и исполнения макроса.
   - устранение потенциальной проблемы (выход за границу массива) при выборе
     значения из истории.
  14.06.2001 SVS
   ! число -> VMENU_COLOR_COUNT
  14.06.2001 OT
   - баг Панели->F5->CtrlDown->трап
     неверно инициализировался массив цветов для меню истории :((
  12.06.2001 KM
   ! Зачем-то была убрана инициализация DI_COMBOBOX через FarDialogItem.
     Восстановлено!!!
  11.06.2001 KM
   ! Сделана нормальная работа мыши в DI_LISTBOX.
  10.06.2001 SVS
   ! Для DM_LISTFINDSTRING вызовен немного другу функцию.
  08.06.2001 SVS
   + Пока возился с "вылезанием" клеаред-строки за пределы диалога...
     подумалось - а фигля это так несправедливо, что когда раскрываем
     хистори со строки редактирования не снимается клеаред-флаг?
  06.06.2001 SVS
   ! Mix/Max
  05.06.2001 KM
   ! Изменился тип возвращаемого значения у DM_LISTSETTITLE - стал TRUE и
     DM_LISTGETTITLE - стал TRUE, если получен Title или Bottom и FALSE если
     не получили ни того ни другого.
  04.06.2001 SVS
   + Shift-Del очищает текущий пункт истории команд.
  04.06.2001 SVS
   ! выкинут LIF_PTRDATA - изжил себя как класс :-)
   ! SelectFromEditHistory полностью переписана, в т.ч. исключена ненужная
     рекурсия.
   ! В связи с переделкой SelectFromEditHistory() появилась возможность
     обрабатывать неограниченное количество пунктов хистори (в данном случае
     64 - под общий стандарт, т.с. :-)
   ! AddToEditHistory() - параметр про размер теперь нафиг ненужен.
   + При занесении в хистори нового значения, после сортировки...
     происходит удаление неиспользуемых пунктов хистори.
  03.06.2001 KM
   + Добавлены сообщения DM_LISTSETTITLE и DM_LETSGETTITLE для установки/получения
     заголовков DI_LISTBOX. Используется структура FarListTitle.
   ! При каждой перерисовке диалога, кроме режима перемещения, устанавливаем
     заголовок консоли, в противном случае он не всегда восстанавливался.
   ! Исправлена подсветка в DI_LISTBOX и DI_COMBOBOX, теперь на самом деле :)
     для чего используется флаг DIF_LISTAUTOHIGHLIGHT.
  03.06.2001 SVS
   ! Коррекция SelectFromEditHistory с учетом нового ListUserData
     (запонимаем полностью весь текст, который есть в реестре и пихаем
      к итему списка)
   + DM_LISTGETDATA, DM_LISTSETDATA
  30.05.2001 KM
   - Косячило центрирование диалога и изменение размера диалога
     при использовании DM_MOVEDIALOG и DM_RESIZEDIALOG
   + Запущен в действие DM_SETITEMPOSITION:
     Param1 = ID элемента диалога.
     Param2 = Указатель на структуру SMALL_RECT с новыми координатами.
     Возвращает TRUE для верного ID, FALSE в противном случае.
  28.05.2001 SVS
   ! RegKey[80] -> RegKey[NM]
  27.05.2001 SVS
   ! Для RO элемента редактирования сами отслеживаем RO состояние.
   ! Для DM_SHOWITEM нужно перерисовать элемент для случая
  26.05.2001 OT
   - Выпрямление логики вызовов в NFZ
   + Добавление признака способа "конструирования" объекта
  24.05.2001 SVS
   ! Если используется USeLastHistory, то учитываем флаг в реестре, который
     нам подскажет - а нужно ли вообще...
     Т.е. если последний раз мы оставили строку пустой, то в следующий раз
     нефига заполнять поле ввода в следующий раз.
  23.05.2001 VVM
   ! Отменил раскрытие комбобокса по KEY_DOWN. Ну невозможно работать...
  23.05.2001 SVS
   - Проблемы с горячими клавишами в меню - Part II (гады, в другом месте
     вылезли :-( )
  23.05.2001 SVS
   - Проблемы с горячими клавишами в меню.
  21.05.2001 DJ
   + обработка смены фокуса
  21.05.2001 SVS
   + DM_SETITEMPOSITION - резерв на будущее (кусок еще не оттестирован)
   + DM_RESIZEDIALOG
   ! struct MenuData|MenuItem
     Поля Selected, Checked, Separator и Disabled преобразованы в DWORD Flags
  18.05.2001 DJ
   ! Dialog унаследован от Frame
  18.05.2001 SVS
   + DM_GETCHECK/DM_SETCHECK/DM_SET3STATE
   + DM_LISTINFO/DM_LISTFINDSTRING/DM_LISTINSERT
   ! DM_MOVEDIALOG - если Param1 == -1, то Param2=COORD=ResizeDialog
  17.05.2001 SVS
   + DM_LISTUPDATE - совсем забыл про эту хрень ;-(
  15.05.2001 KM
   - Терерь подсветка в DI_LISTBOX работает. Для её включения
     используется флаг DIF_LISTNOAMPERSAND (блин горелый, он уже был).
   ! В связи с предыдущим пунктом удалён дублирующий флаг DIF_LISTHIGHLIGHT.
   ! Подсветка в DI_COMBOBOX сделана с использованием DIF_LISTNOAMPERSAND.
   - Убран баг с зависанием при нажатии KEY_END в DI_LISTBOX.
  14.05.2001 SVS
   ! DMODE_SMALLDILAOG -> DMODE_SMALLDIALOG
   ! DIF_CENTERGROUP только для DI_BUTTON, DI_CHECKBOX, DI_RADIOBUTTON, DI_TEXT.
   - небольшая опЯчатка в InitDialogObjects.
   - В AdjustEditPos не был учтен тот факт, что ListBox "живет" в
     DialogItem.ListPtr
  13.05.2001 SVS
   + DIF_LISTWRAPMODE, DIF_LISTHIGHLIGHT
   ! Для DI_COMBOBOX&DIF_DROPDOWNLIST нажатие клавиши KEY_DOWN эквивалентно
     Ctrl-Down, т.е. список раскроется.
   ! сбросим флаг DIF_CENTERGROUP для редакторов
   - небольшая бага с сепараторами после введения DMODE_SMALLDILAOG
   + Новое сообщение DM_LISTADDSTR (Param1=ID Param2=String)
   ! DI_LISTBOX теперь "живет в DialogItem.ListPtr"
  08.05.2001 SVS
    + обработка флага DMODE_SMALLDILAOG
  07.05.2001 SVS
    + DM_LISTSORT, DM_LISTADD, DM_LISTDELETE, DM_LISTGET, DM_LISTGETCURPOS,
      DM_LISTSETCURPOS
    ! SysLog(); -> _D(SysLog());
  07.05.2001 SVS
    ! При отключенном автодополнении можно воспользоваться клавишами Ctrl-End
  06.05.2001 DJ
    ! перетрях #include
  04.05.2001 SVS
    ! Наконец то дошли руки до DI_LISTBOX ;-) - новый член FarDialogItem.ListPos
    - Бага с DN_INIT* - переведен "на уровень выше", т.е. до запоминания
      области отображения диалога.
    - какого хрена засунули DialogEdit->FastShow() в функцию инициализации?
  28.04.2001 SVS
   + Функция GetItemRect() получения геометрии итема.
   - DN_MOUSECLICK фактически не работал, если рамка стояла первой в списке.
  27.04.2001 SVS
   - Не работали позиционирование в хистори и в комбобоксах - вместо
     MaxLen, стояло sizeof(MaxLen) :-((
  27.04.2001 VVM
   + Обработка KEY_MSWHEEL_XXXX
   - Убрал подмену клавиш при прокрутке.
  26.04.2001 SVS
   - Проблема с DM_SETTEXTLENGTH: выставляем максимальный размер в том
     случае, если он еще не выставлен.
  25.04.2001 SVS
   + уточнения по поводу DM_SETTEXTLENGTH & DIF_VAREDIT
  24.04.2001 SVS
   ! Подмена клавиш при прокрутке колеса.
   ! Если в ответ на событие DN_MOUSECLICK (Param=-1) обработчик диалога
     вернет TRUE, то диалог не будет закрыт. Если игнорировать
     {DN_MOUSECLICK,-1} или вернуть FALSE, то диалог не закроется.
   ! Клик мышой вне диталога - обрабатываются только левая и правая клавиши
     остальные клавиши не имеют значения
  23.04.2001 SVS
   - Забыл послать месаг DN_EDITCHANGE при выборе из хистори.
  22.04.2001 SVS
   + DIF_SHOWAMPERSAND для DI_BUTTON, DI_CHECKBOX, DI_RADIOBUTTON
  16.04.2001 SVS
   + Tab в списке хистори - аналог Enter
   ! Перерисовка в автодополнении должна идти после DN_EDITCHANGE (imho)
  12.04.2001 SVS
   + DM_ADDHISTORY - добавить строку в историю
   + DIF_MANUALADDHISTORY - добавлять в историю только "ручками"
   ! функция AddToEditHistory теперь возвращает результат операции
     добавления строки в историю
  12.04.2001 SVS
   ! Дополнительная проверка для DM_SETDLGITEM на смену типа котрола.
     Нефига пока менять - ядро еще не готово к метаморфозам. Потом как нить.
   + CheckDialogCoord() - проверка и корректировка координат диалога
   ! не был реализован механизм центрирования диалога для DM_MOVEDIALOG
     это когда координаты = -1, и задано абсолютное смещение.
  02.04.2001 SVS
   + исключим смену режима RO для поля ввода с клавиатуры
  23.03.2001 SVS
   ! У функции ConvertItem() новый параметр InternalCall - сейчас
     используется только для DN_EDITCHANGE
  22.03.2001 SVS
   - немного подправлен механизЪм DN_EDITCHANGE
  05.03.2001 SVS
   - Бага в хоткеях :-(
  21.02.2001 IS
   ! Opt.EditorPersistentBlocks -> Opt.EdOpt.PersistentBlocks
  21.02.2001 IS
   - Избавился от утечки памяти в SelectFromEditHistory (проявлялось не у всех,
     но проявлялось же!)
  20.02.2001 SVS
   ! Пересмотр алгоритма IsKeyHighlighted с добавками Alt- на
     сколько это возможно
  20.02.2001 SVS
   ! Уточнение поведения горячих клавиш с учетом Disabled & Hidden...
  20.02.2001 SVS
   - Бага в SelectFromComboBox
  13.02.2001 SVS
   ! HISTORY_COUNT - константа для размера истории.
   + Дополнительный параметр у FindInEditForAC, SelectFromEditHistory,
     AddToEditHistory и SelectFromComboBox - MaxLen - максимальный размер
     строки назначения.
   + DI_COMBOBOX тоже мАгет работать с DIF_VAREDIT
   ! Рисование "салазок" перенесено в DefDlgProc(DN_DRAWDIALOG,1)
   ! Если функция обработчик в ответ на DN_DRAWDIALOG вернула FALSE,
     то диалог отрисовываться не будет
   ! Если функция обработчик в ответ на DN_DRAWDLGITEM вернула FALSE,
     то элемент диалога отрисовываться не будет
  12.02.2001 SVS
   + Добавка на реакцию DOUBLE_CLICK - чекбоксы стали шустрее переключаться :-)
     AN> ...Пробелом те же чекбоксы переключаются очень шустро.
     AN> Это именно отсутствие реакции на (MouseEvent.dwEventFlags==DOUBLE_CLICK).
  11.02.2001 SVS
   ! DIF_VAREDIT - только для DI_EDIT!!!
  11.02.2001 SVS
   ! Несколько уточнений кода в связи с изменениями в структуре MenuItem
  23.01.2001 SVS
   ! Изменены функции DeleteDialogObjects() и GetDialogObjectsData()
   + Введены ексепшины в DataToItem и ConvertItem
   ! Введена проверка на NULL объектов ObjPtr
  04.01.2001 SVS
   - Bug - DM_KEY не реагировал на то, что возвращает пользовательская функция
  04.01.2001 SVS
   - Bug при использовании DM_SETDLGITEM - неверно устанавливался фокус ввода
  28.12.2000 SVS
   + добавлена обработка Opt.HotkeyRules
  25.12.2000 SVS
   - Забыл сделать возврат из функции для DM_GETTEXTPTR
  21.12.2000 SVS
   ! Ctr-Break теперь недействителен, т.е. все зависит от того
     что вернет обработчик.
   + DIF_SHOWAMPERSAND для DI_*BOX
   + DM_GETTEXTPTR, DM_SETTEXTPTR
  15.12.2000 SVS
   ! При перемещении диалога повторяем поведение "бормандовых" сред.
   ! Новый движок мышиного перемещения
  14.12.2000 SVS
   ! Дополнение цветов (пропустил :-)
   + Отмена реакции хоткеев для DIF_DISABLE
  08.12.2000 SVS
   ! DM_SET(GET)TEXT - Param2 указатель на структуру FarDialogItemData
  06.12.2000 SVS
   - Охрененная бага с SelectOnEntry() - эта функция вызывалась
     до создания редактора!!!
   ! Обработка кликания мыши вне диалога вынесена в DefDlgProc
   ! Уточним логику работы:
     1) DI_BUTTON: Если не старый стиль и кнопка "не для закрытия"
                   (DIF_BTNNOCLOSE), то ничего не делаем, иначе -
                   предлагаем закрыть диалог.
     2) Если нажали Enter не на DI_BUTTON, то отрабатываем как и раньше
        при условии, что есть кнопка с Default=1 и у этой кнопки не
        выставлен флаг DIF_BTNNOCLOSE.
  05.12.2000 IS
   ! Все удалил в блоке, где проверяем, автодополнять или нет,
     и написал заново
  04.12.2000 SVS
   - перебор с DIF_NOFOCUS :-(
   - При удаление в предыдущем патче - прихватил нужную строку :-(
   ! Для DI_USERCONTROL - для копирования Data используется memmove()
  04.12.2000 SVS
   ! Проблемы с фокусом ввода:
     "Ctrl-A Alt-N Enter - фокус ввода не устанавливался в поле даты."
   ! Автодополнение - чтобы не работало во время проигрывания макросов.
   ! Оптимизация функций ConvertItem() и DataToItem() - с указателями
     будет генериться компактный и быстрый код (MSVC - это сам делает :-(
   + DIF_3STATE - 3-х уровневый CheckBox
   ! Уточним на что влияет флаг DIF_DROPDOWNLIST - только для DI_COMBOBOX.
   - Исключаем из списка оповещаемых о мыши недоступные элементы
   ! Для DI_PSWEDIT и DI_FIXEDIT обработка DIF_EDITEXPAND не нужна
   ! Отрисовка Disabled
  03.12.2000 IS
   ! Не автодополнять, если после курсора есть невыделенные символы.
     Работает это правило, естественно, только с постоянными блоками.
  21.11.2000 SVS
   - Не стиралась последняя строка в многострочном редакторе
  08.11.2000 SVS
   ! Изменен пересчет кодов клавишь для hotkey (используются сканкоды)
  04.11.2000 SVS
   + Проверка на альтернативную клавишу при XLat-перекодировке
  26.10.2000 SVS
   ! DM_SETEDITPOS/DM_GETEDITPOS -> DM_SETCURSORPOS/DM_GETCURSORPOS
   + Работа с курсором для DI_USERCONTROL в ограниченном варианте.
  23.10.2000 SVS
   + DM_SETEDITPOS, DM_GETEDITPOS -
      позиционирование курсора в строках редактирования.
  20.10.2000 SVS
   + DM_GETFOCUS - получить ID элемента имеющего фокус ввода
  16.10.2000 tran 1.47
   + для EDIT полей выставляется ограничение в 511 символов
  27.09.2000 SVS
   ! Alt-Up/Down/Left/Right - убрал (чтобы в будущем не пересекались
     с MultiEdit)
   ! Ctrl-Alt-Shift - реагируем, если надо.
  24.09.2000 SVS
   + Движение диалога - Alt-стрелки
   + вызов функции Xlat
  22.09.2000 SVS
   ! Уточнение AutoComplete при постоянных блоках.
  20.09.2000 SVS
   ! Enter в строках ввода (кроме DIF_EDITOR) завершает диалог.
  18.09.2000 SVS
   + DIF_READONLY - флаг для строк редактирования
      (пока! для строк редактирования).
  18.09.2000 SVS
   ! Уточнения для SelectOnEntry
   ! Маска не должна быть пустой (строка из пробелов не учитывается)!
  14.09.2000 SVS
   + Флаг DIF_LISTNOAMPERSAND. По умолчанию для DI_LISTBOX
      выставляется флаг MENU_SHOWAMPERSAND. Этот флаг подавляет такое
      поведение
  12.09.2000 SVS
   ! Задаем поведение для кнопки с DefaultButton=1:
     Такая кнопка независимо от стиля диалога инициирует сообщение DM_CLOSE.
   ! Исправляем ситуацию с BackSpace в DIF_EDITOR
   ! Решаем проблему, если Del нажали в позиции большей, чем длина
     строки (DIF_EDITOR)
  11.09.2000 SVS
   + Ctrl-U в строках ввода снимает пометку блока
  09.09.2000 SVS
   + DIF_NOFOCUS - элемент не получает фокуса ввода (клавиатурой)
   + Стиль диалога DMODE_OLDSTYLE - диалог в старом стиле.
   ! вывалить из диалога, ткнув вне диалога, сможем только в старом стиле.
   + Функция SelectOnEntry - выделение строки редактирования
     (Обработка флага DIF_SELECTONENTRY)
  08.09.2000 SVS
   - Если коротко, то DM_SETFOCUS вроде как и работал :-)
   ! Уточнение для DN_MOUSECLICK
  31.08.2000 SVS
   + DM_ENABLE (не полностью готов :-)
   - Бага с вызовом файлов помощи.
  30.08.2000 SVS
   + Метод Hide()
   + Режим диалога DMODE_SHOW - Диалог виден?
   ! уточнения для IsEnableRedraw
   + DM_MOVEDIALOG - перемещение диалога.
   ! Изменение цветов для ComboBox(DowpDownList)
  29.08.2000 SVS
   ! При подмене темы помощи из диаловой процедуры...
     короче, нужно вновь формировать контент!
  29.08.2000 SVS
   - Первый официальный альфа-баг - функция ProcessHighlighting
     MY> Работа с диалогами стала ГЛЮЧНАЯ. Я имею в виду горячие клавиши.
     MY> Входим в настройку чего угодно, жмем Alt-нужную букву и
     MY> наблюдаем разнообразные глюки.
  28.08.2000 SVS
   - баг рук кривых (или не внимательности!) :-)
  25.08.2000 SVS
   + DM_GETDLGRECT - получить координаты диалогового окна
   ! Уточнение для DN_MOUSECLICK
  25.08.2000 SVS
   ! Уточнения, относительно фокуса ввода - ох уж эти сказочки, блин.
  24.08.2000 SVS
   + InitDialogObjects имеет параметр - для выборочной реинициализации
     элементов
  24.08.2000 SVS
   ! Охрененная дыра!!!! (дальше только матом)... это про ComboBox
     Этого лучше не знать...
   + CtrlAltShift - спрятать/показать диалог...
   + Элемент DI_USERCONTROL - отрисовкой занимается плагин.
  24.08.2000 SVS
   ! Критическая ошибка - с фокусов не порядки...
     перестарался с ChangeFocus()
  23.08.2000 SVS
   ! Уточнения категорий DMSG_* -> DM_ (месаг) & DN_ (нотифи)
   + DM_KEY        - послать/получить клавишу(ы)
   + DM_GETDLGDATA - взять данные диалога.
   + DM_SETDLGDATA - установить данные диалога.
   + DM_SHOWDIALOG - показать/спрятать диалог
   + Переменная класса FocusPos - всегда известно какой элемент в фокусе
   ! Переменные IsCanMove, InitObjects, CreateObjects, WarningStyle, Dragged
     удалены -> битовые флаги в DialogMode
   + множество мелких уточнений ;-)
  22.08.2000 SVS
   ! С моим английским вообще ни как :-((
     IsMovedDialog -> IsCanMove
   ! DMSG_PAINT -> DMSG_DRAWDIALOG
   ! DMSG_DRAWITEM -> DMSG_DRAWDLGITEM
   ! DMSG_CHANGELIST -> DMSG_LISTCHANGE
   ! ShowDialog - дополнительный параметр - какой элемент отрисовывать
  21.08.2000 SVS 1.23
   ! Описание сообщений убрано - смотрите в хелпе :-)))
   ! Самыми последними в этом файле должны быть DefDlgProc и SendDlgMessage
     (мне так удобно :-)
   + Перед отрисовкой DI_LISTBOX спросим об изменении цветовых атрибутов
   ! DIF_HISTORY имеет более высокий приоритет, чем DIF_MASKEDIT
   - глюк в AutoComplete при включенных постоянных блоках
   ! DMSG_CHANGEITEM -> DMSG_EDITCHANGE
   + DMSG_BTNCLICK
  12.08.2000 KM 1.20
   + Добавление работы DI_FIXEDIT с флагом DIF_MASKEDIT для установки
     маски в строку ввода.
  18.08.2000 SVS
   + DialogMode - Флаги текущего режима диалога
   + Флаг IsEnableRedraw - разрешающий/запрещающий перерисовку диалога
   + Сообщения: DMSG_ENABLEREDRAW, DMSG_MOUSECLICK
   + DI_BUTTON тоже теперь может иметь DIF_SETCOLOR
   + Флаг для DI_BUTTON - DIF_BTNNOCLOSE - "кнопка не для закрытия диалога"
   - Если на выход процедура ответила "НЕТ", то диалог зацикливался, т.к.
     не был сброшен флаг выхода.
  15.08.2000 SVS
   ! Для DropDownList цвета обрабатываем по иному.
   + Сделаем так, чтобы ткнув мышкой в DropDownList список раскрывался сам.
  11.08.2000 SVS
   + Данные, специфические для конкретного экземпляра диалога
   + Для того, чтобы послать DMSG_CLOSE нужно переопределить Process
   ! Уточнение для DMSG_CLOSE
  11.08.2000 KM 1.18
   ! Убран дублирующий код, исправляющий некорректное перемещение диалога
     мышкой. Оказывается мы с Андреем сделали патчик в один день :)
   ! Чуть-чуть переделано таскание мышкой диалога. Было: после первого нажатия
     мышкой на диалоге отображение режима перемещения не включалось до тех пор
     пока не начиналось само движение диалога, после чего и происходило
     отображение начала этого режима, что есть в корне идеологически неверно :)
   ! Артефакт: если после первого запуска фара, не пермещая мышь
     нажать левую кнопку, чтобы переместить диалог (диалог находится под мышью),
     то из-за того, что к этому моменту PrevMouseX и PrevMouseY ещё не определены,
     также неопределённым получался прыжок диалога.
  10.08.2000 SVS
   + переменная IsMovedDialog - можно ли двигать диалог :-)
   + функция установки IsMovedDialog
  09.08.2000 tran 1.16
   - убраны "салазки"
  09.08.2000 KM
   ! При включении режима перемещения диалога добавлено
     отключение мигающего курсора. Так косметика.
   ! Поправлено перемещение диалога мышкой, Андрей-то не захотел
     исправлять :). Теперь перемещение стало корректным, без прокатывания
     диалога по экрану.
   ! При выходе за край экрана диалогом, тень, по возможности, продолжает
     рисоваться.

     Номер редакции остался прежним - здесь было
     забегание вперёд.
  07.08.2000 SVS
   + В Функции выравнивания кооржинат про ListBox забыли!
  04.08.2000 SVS
    + FarListItems.CountItems -> FarListItems.ItemsNumber
  03.08.2000 tran
   + мышиный перетаск диалога - хватание за пустое место
     внимание - ограничение невыхода за границы экрана посталено не зря
     иначе ползут глюки...
     изменена индикация - по углам красные палки
     с MOVE в угла могут быть глюки в изображении.
     строки про MOVE закоментарены "//# "
  01.08.2000 SVS
   ! History теперь ВСЕГДА имеет ScrollBar, т.к. этот элемент ближе
     к ComboBox`у, нежели к меню.
   - переменная класса lastKey удалена за ненадобностью :-)
   + Обычный ListBox
   - Небольшой глючек с AutoComplete
   ! В History должно заносится значение (для DIF_EXPAND...) перед
     расширением среды!
   + Еже ли стоит флаг DIF_USELASTHISTORY и непустая строка ввода,
     то подстанавливаем первое значение из History
   - Отключена возможность для DI_PSWEDIT иметь History...
     ...Что бы небыло повадно... и для повыщения защиты, т.с.
  31.07.2000 tran & SVS
   + перемещение диалога по экрану клавишами. Ctrl-F5 включает режим
     перемещения. Индикация перемещения - "Move" в левом верхнем углу
  28.07.2000 SVS
   ! Переметр Edit *EditLine в функции FindInEditForAC нафиг ненужен!
   - Небольшой баг с автозавершением:
       ...Есть в хистори на F7 - "templates". Жму F7, нажимаю shift+t=T и ...
       получаю маленькую t. В итоге большую добился только набиранием её
       после маленькой и стиранием оной...
   - Если плагин не выставил ни одного эелемента с фокусом,
     то придется самому об этом позаботиться, и выставить
     фокус на первом вразумительном элементе ;-)
   + AutoComplite: Для DI_COMBOBOX.
   ! SelectFromComboBox имеет дополнительный параметр с тем, чтобы
     позиционировать item в меню со списком в соответсвии со строкой ввода
   ! FindInEditHistory -> FindInEditForAC
     Поиск как в истории, так и в ComboBox`е (чтобы не пладить кода)
   + Функция IsFocused, определяющая - "Может ли элемент диалога
     иметь фокус ввода"
   + Функция ConvertItem - преобразования из внутреннего представления
     в FarDialogItem и обратно
   + Некоторое количество сообщений:
        DMSG_INITDIALOG, DMSG_ENTERIDLE, DMSG_HELP, DMSG_PAINT,
        DMSG_SETREDRAW, DMSG_DRAWITEM, DMSG_GETDLGITEM, DMSG_KILLFOCUS,
        DMSG_GOTFOCUS, DMSG_SETFOCUS, DMSG_GETTEXTLENGTH, DMSG_GETTEXT,
        DMSG_CTLCOLORDIALOG, DMSG_CTLCOLORDLGITEM, DMSG_CTLCOLORDLGLIST,
        DMSG_SETTEXTLENGTH, DMSG_SETTEXT, DMSG_CHANGEITEM, DMSG_HOTKEY,
        DMSG_CLOSE,
  26.07.2000 SVS
   + Ну наконец-то - долгожданный нередактируемый ComboBox
  26.07.2000 SVS
   + AutoComplite: Для DIF_HISTORY.
  25.07.2000 SVS
   + Новый параметр в конструкторе
  23.07.2000 SVS
   + Куча ремарок в исходниках :-)
   + Изменен вызов конструтора - добавка в виде функции обработки
   ! Строковые константы "SavedDialogHistory\\%s",
     "Locked%d" и "Line%d" сделаны поименованными.
   + Функция обработки диалога (по умолчанию) DefDlgProc() - забито место :-)
  19.07.2000 SVS
   ! "...В редакторе команд меню нажмите home shift+end del
     блок не удаляется..."
     DEL у итемов, имеющих DIF_EDITOR, работал без учета выделения...
  18.07.2000 SVS
   + Обработка элемента DI_COMBOBOX (пока все еще редактируемого)
   + Функция-обработчик выбора из списка - SelectFromComboBox
  11.07.2000 SVS
   ! Изменения для возможности компиляции под BC & VC
  05.07.2000 SVS
   + добавлена проверка на флаг DIF_EDITEXPAND - расширение переменных
     среды в элементе диалога DI_EDIT
  25.06.2000 SVS
   ! Подготовка Master Copy
   ! Выделение в качестве самостоятельного модуля
*/
