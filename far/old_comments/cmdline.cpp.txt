/*
Modify:
  13.04.2006 SVS
    ! Для Alt-F12 сначала предоставим слово плагинам на предмет проврки и исполнения префиксов
  05.04.2006 SVS
    ! Расширен набор символов в Формате командной строки.
    ! после выбора из истории всегда создавать файл - оно проверено на в хистори!
  29.07.2005 SVS
    Временно убрем
  28.07.2005 SVS
    ! застолбленное место для autocomplete при скрытых панелях
  06.05.2005 SVS
    ! ???::GetCurDir() теперь возвращает размер пути, при этом
      его параметр может быть равен NULL. Сделано для того, чтобы
      как то получить этот размер.
  24.04.2005 AY
    ! GCC
  28.02.2005 SVS
    ! В строках ввода (диалоги) и ком.строка - будет конвертироваться
      ближайшее слово или выделение.
    + XLAT_CONVERTALLCMDLINE
  23.12.2004 WARP
    ! Нафиг отрубаем показ дерева, если его создание прервали по Esc (нечего пустое дерево показывать).
      Ставим флаг IsPanel в FALSE. Мы ведь панель не создаем.
  08.12.2004 SVS
    + CmdLine.ItemCount, CmdLine.CurPos
  11.11.2004 SVS
    + Обработка MCODE_V_ITEMCOUNT и MCODE_V_CURPOS
  04.11.2004 SVS
    - Alt+F11 F3/F4: по ф3 ничего не происходит, по ф4 - просмотр
  25.10.2004 SVS
    + Реакция на Ctrl-Shift-Enter в истории папок - перейти в папку на пассивной панели
  06.08.2004 SKV
    ! see 01825.MSVCRT.txt
  05.08.2004 SVS
    ! MCODE_C_CMDLINE_BOF, MCODE_C_CMDLINE_EOF, MCODE_C_CMDLINE_EMPTY, MCODE_C_CMDLINE_SELECTED
  02.08.2004 SVS
    + обработка MCODE_C_CMDLINE_BOF и MCODE_C_CMDLINE_EOF
  07.07.2004 SVS
    ! Macro II
  06.05.2004 SVS
    + ProcessOSAliases()
  09.03.2004 SVS
    + CorrectRealScreenCoord() - корректировка размеров буфера
  09.01.2004 SVS
    + Opt.ExcludeCmdHistory
  25.09.2003 SVS
    ! KEY_MACROXLAT переименован в KEY_MACRO_XLAT
  09.09.2003 SVS
    - Автодополнение по ^End в пустой строке сразу после старта не работает.
  03.09.2003 SVS
    + Продвинутый вариант промптера, как в XP. Добавил, чтобы не потерялось (трудные времена настают :-(
  21.08.2003 SVS
    ! Сделаем LastCmdStr динамической переменной.
      Отсюда все остальные изменения
    + CommandLine::SetLastCmdStr() - "выставляет" эту самую LastCmdStr.
  28.05.2003 SVS
    ! Opt.EdOpt.PersistentBlocks -> Opt.Dialogs.EditBlock
  22.04.2003 SVS
    ! strcpy -> strNcpy
  20.09.2002 SVS
    - BugZ#619 - ftp: /pub в истории папок
  06.08.2002 SVS
    - после открытия дерева по Alt-F10 и после отмены диалога не по esc,
      а нажатием мыши вне его, не восстанавливается текст линейки клавиш
      модифицированных нажатием Alt, Shift, ...
  30.05.2002 IS
    ! взял управление на себя :-) - тут IsLocalPath применять можно
      безболезненно
  29.05.2002 SVS
    ! "Не справился с управлением" - откат IsLocalPath() до лучших времен.
  28.05.2002 SVS
    ! применим функцию  IsLocalPath()
  24.05.2002 SVS
    + Дублирование Numpad-клавиш
  05.04.2002 SVS
    ! Продолжение для BugZ#239 (Folder shortcuts для несуществующих папок)
      Аналогичное поведение сделаем и для Alt-F12, ибо это правильно!
  25.03.2002 VVM
    + При погашенных панелях колесом крутим историю
  18.03.2002 SVS
    ! Уточнения, в связи с введением Opt.Dialogs
    ! Немного оптимизации и комментариния кода
  06.03.2002 SVS
    ! У функций Истории появились доп.параметры
  28.02.2002 SVS
    ! SetString() имеет доп. параметр - надобность в прорисовке новой строки
  14.12.2001 IS
    + GetStringAddr();
  06.12.2001 SVS
    ! PrepareDiskPath() - имеет доп.параметр - максимальный размер буфера
  26.11.2001 SVS
    ! Заюзаем PrepareDiskPath() для преобразования пути.
  15.11.2001 IS
    - очепятка при предыдущем изменении :-(
  13.11.2001 IS
    - После xlat неправильно работал ctrl-end.
  02.11.2001 SVS
    + GetSelection()
  10.10.2001 SVS
    ! Часть кода, ответственная за "пусковик" внешних прилад вынесена
      в отдельный модуль execute.cpp
  05.10.2001 SVS
    ! Немного оптимизации (с сокращение повторяющегося кода)
  27.09.2001 IS
    - Левый размер при использовании strncpy
  26.09.2001 VVM
    ! Перерисовать панели, если были изменения. В догонку к предыдущему патчу.
  23.09.2001 VVM
    ! CmdExecute: RedrawDesktop должен уничтожиться _до_ вызова UpdateIfChanged.
      Иначе InfoPanel перерисовывается при изменении каталога и портит background
  09.09.2001 IS
    + SetPersistentBlocks - установить/сбросить постоянные блоки
  08.09.2001 VVM
    + Использовать Opt.DialogsEditBlock
  30.08.2001 VVM
    ! В командной строке блоки всегда непостояные.
  23.08.2001 OT
    - исправление far -e file -> AltF9
  13.08.2001 SKV
    + GetSelString, Select
  07.08.2001 SVS
    + Добавим обработку команды OS - CLS
  10.07.2001 SVS
    + Обработка KEY_MACROXLAT
  25.06.2001 SVS
    - неверно работало в "If exist" преобразование toFullName, не учитывался
      факт того, что имя уже может иметь полный путь.
  22.06.2001 SKV
    - Update панелей после исполнения команды.
  18.06.2001 SVS
    - Во время проверки "If exist" не учитывался текущий каталог.
  17.06.2001 IS
    ! Вместо ExpandEnvironmentStrings применяем ExpandEnvironmentStr, т.к. она
      корректно работает с символами, коды которых выше 0x7F.
    + Перекодируем строки перед SetEnvironmentVariable из OEM в ANSI
  07.06.2001 SVS
    + Добавлена обработка операторов "REM" и "::"
  04.06.2001 OT
    - Исправление отрисовки консоли при наличии Qinfo и или других "настандартных" панелей
  26.05.2001 OT
    - Выпрямление логики вызовов в NFZ
  17.05.2001 OT
    - Отрисовка при изменении размеров консоли - ResizeConsole().
  15.05.2001 OT
    ! NWZ -> NFZ
  12.05.2001 DJ
    ! перерисовка командной строки после обработки команды делается только
      если панели остались верхним фреймом
  11.05.2001 OT
    ! Новые методы для отрисовки Background
  10.05.2001 DJ
    * ShowViewEditHistory()
  07.05.2001 SVS
    ! SysLog(); -> _D(SysLog());
  06.05.2001 DJ
    ! перетрях #include
  06.05.2001 ОТ
    ! Переименование Window в Frame :)
  05.05.2001 DJ
    + перетрях NWZ
  29.04.2001 ОТ
    + Внедрение NWZ от Третьякова
  25.04.2001 DJ
    * обработка @ в IF EXIST
    * обработка кавычек внутри имени файла в IF EXIST
  11.04.2001 SVS
    ! Для Alt-F11 и Alt-F12 - теперь будут свои конкретные темы помощи, а не
      абстрактное описание команд командной строки (не нужное для этих
      историй)
  02.04.2001 VVM
    + Обработка Opt.FlagPosixSemantics
  12.03.2001 SVS
    + Alt-Shift-Left, Alt-Shift-Right, Alt-Shift-Home и Alt-Shift-End выделяют
      блок в командной строке независимо от состояния панелей.
  21.02.2001 IS
    ! Opt.EditorPersistentBlocks -> Opt.EdOpt.PersistentBlocks
  19.02.2001 IS
    - баг: не сбрасывалось выделение в командной строке по enter и shift-enter
  14.01.2001 SVS
    + В ProcessOSCommands добавлена обработка
       "IF [NOT] EXIST filename command"
       "IF [NOT] DEFINED variable command"
  18.12.2000 SVS
    - Написано же "Ctrl-D - Символ вправо"!
    + Сбрасываем выделение при редактировании на некоторых клавишах
  13.12.2000 SVS
    ! Для CmdLine - если нет выделения, преобразуем всю строку (XLat)
  04.11.2000 SVS
    + Проверка на альтернативную клавишу при XLat-перекодировке
  24.09.2000 SVS
    + поведение ESC.
    + вызов функции Xlat
  19.09.2000 SVS
    - При выборе из History (по Alt-F8) плагин не получал управление!
  13.09.2000 tran 1.02
    + COL_COMMANDLINEPREFIX
  02.08.2000 tran 1.01
    - мелкий фикс - при выходе по CtrlF10, если файл был открыт на просмотр
      из Alt-F11, был виден keybar в панелях
      как всегда добавил CtrlObject->Cp()->Redraw()
  25.06.2000 SVS
    ! Подготовка Master Copy
    ! Выделение в качестве самостоятельного модуля
*/
