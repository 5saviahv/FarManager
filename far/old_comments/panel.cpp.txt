/*
Modify:
  19.09.2006 SVS
    - Падение при старте ФАРа, когда каталог недоступен (например, на FS была примонтирована флешка, которой при тсрате на месте не оказалось).
  12.07.2006 SVS
    ! kill class int64
  05.07.2006 IS
    - warnings
  29.05.2006 SVS
    - В плагиновых панелях в заголовке обрезается 2 символа
  25.05.2006 SVS
    + EJECT_NOTIFY_AFTERREMOVE
  24.05.2006 SVS
    + Shift-Del - извлечение HotPlu`ов
  22.05.2006 SVS
    ! Уточнение GetTitle.
  09.05.2006 SVS
    + GetTitle + доп параметр, на сколько усеч
  03.05.2006 SVS
    + В "панельные" классы добавлена виртуальная функция GetTitle(), которая формирует заголовок панели.
  06.04.2006 AY
    ! Размер дисков больше терабайта показывался не правильно
    + Новые режимы меню дисков - показ размера с точкой и отмена показа инфы для сетевых дисков
  04.04.2006 SVS
    ! сохраняем для потомком Macro_DskShowPosType (локальный класс Guard_Macro_DskShowPosType :-))
  24.07.2005 WARP
    ! see 02033.LockUnlock.txt
  23.06.2005 SVS
    - BugZ#1349 - Быстрый поиск: Вставка из буфера обмена не добавляет, а заменяет строку
  30.05.2005 SVS
    ! временно откатим проект про USB
  06.05.2005 SVS
    ! ???::GetCurDir() теперь возвращает размер пути, при этом
      его параметр может быть равен NULL. Сделано для того, чтобы
      как то получить этот размер.
    + Добавлен конфирманс про удаление SUBST-девайсов (задолбася уже
      промахиваться, а боевой диск - как раз SUBST)
    + Eject USB-девайсов
  26.04.2005 SVS
    + Panel::ProcessShortcutFolder()
  24.04.2005 AY
    ! GCC
  05.03.2005 SVS
    ! В меню выбора дисков сетевое имя усекаем.
  03.03.2005 SVS
    ! FastFind теперь "умеет обратную ходку" по Ctrl-Shift-Enter
  16.01.2005 WARP
    - При вставлении в быствый поиск строки из буфера обмена
      происходил переход на первый файл даже если строка не
      совпадала не с одним из имен.
  06.08.2004 SKV
    ! see 01825.MSVCRT.txt
  26.07.2004 SVS
    - strcpy()
  26.07.2004 VVM
    - Функция SetCurPath() зависала при вызове из панели QuickView.
  08.07.2004 SVS
    - В макросе: "%file=APanel.Current; Tab Home Alt< $Text %file"
      не работает вставка текста в Alt< с помощью $Text "xx"
  07.07.2004 SVS
    ! Macro II
  01.07.2004 SVS
    ! тип CD в меню выбора дисков определяется тока если выставлен DRIVE_SHOW_CDROM
  21.06.2004 SVS
    + DRIVE_DVD_RAM
  09.06.2004 SVS
    + DRIVE_CD_RWDVD
  08.06.2004 SVS
    ! Вместо GetDriveType теперь вызываем FAR_GetDriveType().
    ! Вместо "DriveType==DRIVE_CDROM" вызываем IsDriveTypeCDROM()
    + добавка типа CD-привода
  04.06.2004 SVS
    - Copy/Paste :-(
  03.06.2004 SVS
    ! SetPluginCommand теперь возвращает TRUE/FALSE
    ! подсократим код... за счет CtrlObject->Cp() -> FPanels
  24.05.2004 SVS
    + PFLAGS_NUMERICSORT, FCTL_SETNUMERICSORT,FCTL_SETANOTHERNUMERICSORT - логическое дополнение к NumericSort
  18.05.2004 SVS
    ! инициализация NumericSort
  06.05.2004 SVS
    - BugZ#1069 - cosmetic bug: прорисовка меню невто время.
      MainMenu перерисуем пораньше....
  05.05.2004 SVS
    ! проверим медию на выбрасываемость - вызов новой функции IsEjectableMedia()
  07.01.2004 SVS
    + FastFindProcessName() - подбор имени файла :-)
    - BugZ#992 - XLat в FastFind
  07.01.2004 SVS
    - AA> вставляю из буфера обмена в пустое инксеч-окно всякую ерунду. чего-то
      AA> находится и подсветка на это "чего-то" перемещается. но по CtrlEnter
      AA> делается перебор всех файлов по порядку, словно окно инксеч все еще пустое
  11.11.2003 SVS
    ! несколько иной взгляд на Shift-Ins в быстром поиске
    ! Доп проверки на вшивость в Panel::SetPluginCommand()
  24.10.2003 SVS
    - Макрос "Alt> ShiftIns" не работал.
      забыл, что кроме KEY_EVENT нужно так же FARMACRO_KEY_EVENT анализироват
  15.10.2003 SVS
    - После предыдущего патча перестал работать Shift-Ins в макросах для квиксерча
      Воспользуемся новой возможность макродвижка - сохранение/восстановление своего
      состояния, т.е. если сейчас выполнение макроса, то сохраним состояние,
      запостим (Ctrl-V) новый макрос, после отработки этого макроса возобновим
      выполнение предыдущего, вызвав PopState
  13.10.2003 SVS
    - BugZ#973 - panels QuickSearch wish
  09.10.2003 SVS
    - BugZ#858 - проблемы с [Drive]
  12.09.2003 SVS
    ! Уточнение логики Panel::SetCurPath().
  04.06.2003 SVS
    ! Уберем двойные '**' при обработке FastFind
  08.05.2003 SVS
    - BugZ#888 - две строки подстветки в драйв меню
  02.05.2003 SVS
    - BugZ#727 - [wish] Прикрутить Ctrl-R к меню выбора дисков
      Теперь поправлен:
      "...после Ctrl-R все равно прыгает на A:, если до перечитывания
      курсор стоял на одном из плагинов (например, FTP)..."
  05.03.2003 SVS
    ! Закоментим _SVS
  23.02.2003 SVS
    + BugZ#727 - [wish] Прикрутить Ctrl-R к меню выбора дисков
  20.02.2003 SVS
    ! Заменим strcmp(FooBar,"..") на TestParentFolderName(FooBar)
  03.02.2003 SVS
    - BugZ#787 - Криво активируется QuickSearch при выполнении макроса.
  20.01.2003 SVS
    + Показ по F1 в FastFind соответствующего раздела помощи
  15.01.2003 SVS
    ! Корректировка Fastind на предмет Alt-Б и еже с ним
  11.12.2002 VVM
    - При проверке сетевого диска под НТ и 9х разные ветки реестра.
  10.12.2002 SVS
    + ProcessDelDisk() - поимел третий параметр, указатель на VMenu для того, чтобы патом
      прорефрешить меню!
    - BugZ#721 - Кривизна отрисовки при удалении примапленного диска
  09.11.2002 SVS
    - Bug: В панелях Ctrl-L Ctrl-U - видим багу.
      Лечится путем инициализации ViewSettings.FullScreen в 0
  27.09.2002 SVS
    - BugZ#640 - отрисовка
  22.01.2002 IS
    ! Автохоткеи назначаем после основных (меню выбора дисков)
  21.01.2002 IS
    + Снимем ограничение на количество пунктов плагинов в меню выбора дисков
  18.06.2002 SVS
    + Panel::IfGoHome()
    ! Код из Panel::ProcessDelDisk(), отвечающий за извлечение CD вынесен
      в обработчик KEY_DEL меню выбора дисков. Сама же обработка извелечения
      значительно переработана для того, чтобы решить проблему с прорисовкой
    ! В манагер добавлена переменная StartManager, отвечающая на вопрос
      "Манагер уже стартовал?". Это позволяет в Panel::SetCurPath() избежать
      ситуации, когда при старте FAR`а диска как бы нету (скажем CD вынут).
      При этом мы просто перейдем в корень того диска, откуда запущен
      ФАР (т.к. манагер еще не запущен, то возникают проблемы, когда
      в такой ситуации ФАР пытается вызавть меню смены диска... а манагер
      еще не стартован - получаем либо висюна, либо GPF)
  24.05.2002 SVS
    + Дублирование Numpad-клавиш
  22.05.2002 SVS
    ! Opt.CloseCDGate + IsDiskInDrive() перед монтированием CD
  15.05.2002 SVS
    ! Вместо прямого присвоения значения переменной воспользуемся
      вызовом функции
  11.04.2002 SVS
    + FCTL_GET[ANOTHER]PANELSHORTINFO
    + Проверка вида IsBadWritePtr(Param,sizeof(struct PanelInfo))
  22.03.2002 DJ
    ! косметика от BoundsChecker
  20.03.2002 SVS
    ! GetCurrentDirectory -> FarGetCurDir
  19.03.2002 DJ
    ! при обработке FCTL_GET[ANOTHER]PANELINFO прочитаем данные, даже
      если панель невидима
  21.02.2002 SVS
    + Небольшой сервис, аля WC ;-) Если CD-диск выдвинут и мы при выборе
      этого диска из меню жмакаем Enter, то... сначала всунем онный, а потом
      только прочтем оглавление ;-)
  15.02.2002 IS
    - Не дергаем пассивный каталог в SetCurPath
  09.02.2002 VVM
    ! Когда жмет Del на сидюке - не надо сдвигать позицию.
  06.02.2002 tran
    ! Bugz#208 - уточняем еще раз - панель должна быть FILE_PANEL
      а не TREE, INFO, QUICK и пр.
  05.02.2002 SVS
    ! BugZ#208 - Панель должна быть видимой для "простого Update", иначе
      перевыводим панель
  04.02.2002 SVS
    ! Уточнение для BugZ#208 - просто сделаем Update, если панель не
      плагиновая и пути совпадают.
  31.01.2002 SVS
    - BugZ#208 - Несохранение позиции в панели.
  19.01.2002 VVM
    ! При удалении последнего диска из меню остаемся на предыдущем диске
  18.01.2002 VVM
    ! Избавимся от setdisk() - используем FarChDir
  14.01.2002 IS
    ! chdir -> FarChDir
  28.12.2001 DJ
    ! обработка Del в меню дисков вынесена в отдельную функцию
  14.12.2001 IS
    ! stricmp -> LocalStricmp
  14.12.2001 VVM
    ! Ошибочка в NeedUpdatePanel
  12.12.2001 DJ
    ! перетрях флагов в GETPANELINFO
  06.12.2001 SVS
    ! PrepareDiskPath() - имеет доп.параметр - максимальный размер буфера
    ! Во время вызова команд FCTL_SETANOTHERPANELDIR и FCTL_SETPANELDIR не
      вызываем PrepareDiskPath(), это делается потом (исключаем лишний вызов
      функции)
  03.12.2001 DJ
    - вызываем PrepareDiskPath() для пути, переданного в FCTL_SETPANELDIR
      и FCTL_SETANOTHERPANELDIR
  27.11.2001 SVS
    + GetCurBaseName() выдает на гора имя файлового объекта под курсором
      с учетом вложенности панельного плагина, т.е. имя самого верхнего
      хост-файла в стеке.
  26.11.2001 SVS
    ! Заюзаем PrepareDiskPath() для преобразования пути.
  19.11.2001 OT
    - Исправление поведения режима фуллскриновых панелей. 115 и 116 баги
  12.11.2001 SVS
    ! откат 1041 до лучших времен.
  08.11.2001 SVS
    - Shift-Enter на дисках запускал черти что, но только не проводник
  01.11.2001 SVS
    ! уберем Opt.CPAJHefuayor ;-(
  30.10.2001 SVS
    + HEFUAYOR: если плагин закрывается и передает в качестве каталога нечто,
      связанное с префиксами, то... выполним эти префиксы. Фича опциональная
      и по умолчанию пока отрублена
  29.10.2001 SVS
    ! уточнение Panel::SetCurPath()
  24.10.2001 SVS
    ! Немного оптимизации в SetCurPath()
  05.10.2001 SVS
    ! Для начала выставим нужные значения в Panel::SetCurPath()
      для пассивной панели, а уж потом...
    ! Перенос функции Panel::MakeListFile() в fnparse.cpp - там ей место
  03.10.2001 IS
    + перерисуем строчку меню при показе панели
  01.10.2001 IS
    - косметические дефекты при усечении длинных строк
  27.09.2001 IS
    - Левый размер при использовании strncpy
  26.09.2001 SVS
    + Panel::NeedUpdatePanel() - нужно ли обновлять панели с учетом нового
      параметра Opt.AutoUpdateLimit
  24.09.2001 SVS
    ! немного оптимизации (сокращение кода)
  26.07.2001 SVS
    ! VFMenu уничтожен как класс
  24.07.2001 SVS
    + Opt.PgUpChangeDisk
  23.07.2001 SVS
    ! В функции FastFind() код ограничим WaitInFastFind++ и WaitInFastFind--
      ибо здесь ему место (сама переменная как раз за ЭТО и отвечает)
  23.07.2001 SVS
    ! Вернем обратно режим отображения размера в меню выбора диска
      но несколько расширим размеры (+1) числа и сократим "MB" до "M"
  22.07.2001 SVS
    + Повторное нажатие CtrlPgUp в меню выбора дисков гасит это меню.
    + Shift-Enter в меню выбора дисков вызывает проводник для данного диска
  18.07.2001 OT
    ! VFMenu
  21.06.2001 tran
    ! убран глюк AltF1,F1,esc
  17.06.2001 KM
    ! Добавление WRAPMODE в меню.
  14.06.2001 KM
    + Добавлена установка переменных окружения, определяющих
      текущие директории дисков как для активной, так и для
      пассивной панели. Это необходимо программам запускаемым
      из FAR.
  06.06.2001 SVS
    ! Mix/Max
  03.06.2001 SVS
    ! Изменения в связи с переделкой UserData в VMenu
  21.05.2001 DJ
    ! в связи с появлением нового типа немодальных окон переписана отрисовка
      счетчика фоновых экранов
  21.05.2001 SVS
    ! struct MenuData|MenuItem
      Поля Selected, Checked, Separator и Disabled преобразованы в DWORD Flags
  12.05.2001 DJ
    - FCTL_REDRAW[ANOTHER]PANEL обрабатывается только тогда, когда панели
      являются активным фреймом
  10.05.2001 SVS
    - Косметика: при огромных размерах диска в меню "выбора диска" криво
      показываются размеры (сдвиг вправо).
  09.05.2001 OT
    - исправление Panel::Show
  07.05.2001 SVS
    ! SysLog(); -> _D(SysLog());
  06.05.2001 DJ
    ! перетрях #include
  06.05.2001 ОТ
    ! Переименование Window в Frame :)
  05.05.2001 DJ
    + перетрях NWZ
  29.04.2001 ОТ
    + Внедрение NWZ от Третьякова
  30.04.2001 DJ
    - не давало закрыть по Esc менюшку выбора диска, вызванную из quick view
      панели
  28.04.2001 VVM
    + GetSubstName() принимает тип носителя
  27.04.2001 SVS
    + Т.к. нет способа получить состояние "открытости" устройства,
      то добавим обработку Ins для CD - "закрыть диск"
  26.04.2001 VVM
    ! Отмена патча 547
  24.04.2001 SVS
    + Заполнение флагов PanelInfo.Flags
    - !@AFQ! в корне любого диска делал "E:\\file.txt", т.е. 2 слеша.
  24.04.2001 VVM
    - Баг при смене порядка сортировки
  22.04.2001 SVS
    ! Временная отмена куска патча 547
    + Добавка для NT/2000 - вторичный Del на CDROOM задвигает диск.
      Афишировать пока не бум :-)
  19.04.2001 SVS
    - не удалялся SUBST-диск - портилось оригинальное значение DriveType
      в момент проверки "Мы хотим спрятать cd-rom или сменный диск"
  09.04.2001 SVS
    ! проблемы с быстрым поиском.
  02.04.2001 SVS
    ! DRIVE_SUSTITUTE -> DRIVE_SUBSTITUTE
  02.04.2001 VVM
    ! Попытка не будить спящие диски...
  30.03.2001 SVS
    ! GetLogicalDrives заменен на FarGetLogicalDrives() в связи с началом
      компании по поддержке виндовой "полиции".
  28.03.2001 VVM
    + Обработка Opt.RememberLogicalDrives.
  27.03.2001 SVS
    + Shift-F1 на пункте плагина в меню выбора дисков тоже покажет хелп...
  16.03.2001 SVS
    + добавлена информация о пути соединения в диалог подтверждения удаления
      мапленного диска.
    ! Кусок кода, получающий информацию о RemoteName вынесен в функцию
      DriveLocalToRemoteName()
  15.03.2001 SVS
    ! Del в меню дисков
  15.03.2001 IS
    + Используем дополнительные хоткеи, а не просто '#', как раньше, если строк
      от плагинов в меню выбора диска больше 9 штук
  12.03.2001 SVS
    ! Коррекция в связи с изменениями в классе int64
  28.02.2001 IS
    ! "CtrlObject->CmdLine." -> "CtrlObject->CmdLine->"
  27.02.2001 VVM
    ! Символы, зависимые от кодовой страницы
      /[\x01-\x08\x0B-\x0C\x0E-\x1F\xB0-\xDF\xF8-\xFF]/
      переведены в коды.
  26.02.2001 VVM
    - Отмена предыдущего патча
  26.02.2001 VVM
    ! Обработка NULL после OpenPlugin
  14.02.2001 SVS
    ! Дополнительный параметр для MakeListFile - модификаторы
  11.02.2001 SVS
    ! Несколько уточнений кода в связи с изменениями в структуре MenuItem
  22.01.2001 VVM
    - Порядок сортировки задается аналогично StartSortOrder
  09.01.2001 SVS
    - Для KEY_XXX_BASE нужно прибавить 0x01
  05.01.2001 SVS
    + Попробуем удалить SUBST диск
    + Покажем инфу, что ЭТО - SUBST-диск
  14.12.2000 SVS
    + Попробуем сделать Eject для съемных дисков в меню выбора дисковода.
  11.11.2000 SVS
    ! FarMkTemp() - убираем (как всегда - то ставим, то тут же убираем :-(((
  11.11.2000 SVS
    ! Используем конструкцию FarMkTemp()
  24.09.2000 SVS
    ! Перерисовка CtrlObject->MainKeyBar (случай, если:
       Ctr-Alt-Shift, потом, Alt-отжать, появится быстрый поиск,
       дальше отпускаем Ctrl и Shift - окно быстрого поиска на месте.
       Теперь, если нажать Esc - KeyBar не перерисуется)
  08.09.2000 VVM
    + Обработка команд
      FCTL_SETSORTMODE, FCTL_SETANOTHERSORTMODE
      FCTL_SETSORTORDER, FCTL_SETANOTHERSORTORDER
  07.09.2000 SVS
    ! Еще одна поправочка (с подачи AT) для Bug#12:
      еще косяк, не дает выйти из меню, если у нас текущий путь - UNC
      "\\server\share\"
  06.09.2000 tran
    - правя баг, внесли пару новых:
       1. strncpy не записывает 0 в конец строки
       2. GetDriveType вызывается постоянно, что грузит комп.
  05.09.2000 SVS
    - Bug#12 -   При удалении сетевого диска по Del и отказе от меню
        фар продолжает показывать удаленный диск. хотя не должен.
        по ctrl-r переходит на ближайший.
  21.07.2000 IG
    - Bug 21 (заголовок после Ctrl-Q, Tab, F3, Esc был кривой)
  11.07.2000 SVS
    ! Изменения для возможности компиляции под BC & VC
  25.06.2000 SVS
    ! Подготовка Master Copy
    ! Выделение в качестве самостоятельного модуля
*/
